{"config":{"lang":["en","ru"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Kirish","text":""},{"location":"#xush-kelibsiz","title":"Xush kelibsiz!","text":"<p>Sizning oldingizda men, Groosha,  Telegram botlarini Python tilida aiogram frameworkidan foydalangan holda yaratish bo'yicha kitob deb ataydigan narsani ko'rmoqdasiz. Bu  [kitob]ni o'quv material sifatida qabul qilish mumkin,  kerak bo'lganda alohida bo'limlarga murojaat qilish mumkin,  ammo birinchi marta o'qiyotganingizda bu matnning chap tomonida ko'rsatilgan bo'limlar tartibida o'qishni tavsiya qilaman.</p> <p>Bu qo'llanmaning uchinchi versiyasidir, birinchi versiya 2015-2017  yillarda pyTelegramBotAPI kutubxonasi uchun yozilgan, ikkinchi versiya esa 2019 yilda aiogram 2.x uchun paydo bo'ldi.  Bu yangilangan kitob versiyasida biz 2023 yil 1 sentyabrda to'liq chiqarilgan aiogram 3 versiyasidan foydalanamiz.</p> <p>Bu kitob kimlar uchun? Ushbu kitob umumiy dasturlashni va xususan Python tilini yaxshi biladiganlar uchun mo'ljallangan,  \"venv\" va \"pip\" tushunchalaridan xabardor, shuningdek, SyntaxError va IndentationError kabi \"oddiy\" xatolarini tushunib va  tuzatishga qodir bo'lganlar uchun. Internetda bir nechta Python kurslarini toping, ularni o'rganing va  faqat shundan keyingina botlarni yozishga kirishing, bu sizga vaqt va asab hujayralarini tejashga yordam beradi.</p> <p>Barcha bo'limlarda operatsion tizim sifatida GNU/Linux oilasidan birortasini, masalan, Ubuntu,  Python 3.11 (Virtual Environmentda) va dasturlash muhiti sifatida PyCharmdan foydalanamiz.  Ammo, Visual Studio Codedan foydalanish ham mumkin. Shu bilan birga,  Windows foydalanuvchilari ham chetda qolmaydi: kodga tegishli hamma narsa sizda ham bemalol ishlaydi,  systemd kabi maxsus narsalar uchun siz VirtualBoxda Ubuntu\u2019dan foydalanishingiz mumkin.</p> <p>Kitob matni va tegishli kodlar mos repoda to'liq bepul,  MIT litsenziyasi ostida nashr etilgan va har kimga yuklab olish, o'zgartirish va har qanday maqsadda foydalanish uchun mavjud.</p> <p>Donatlar Ushbu kitobni yozish va yangilash uchun juda ko'p vaqt va kuch sarfladim. Agar siz Rossiyadan bo'lsangiz va  muallifni moddiy jihatdan rag'batlantirmoqchi bo'lsangiz, Yoo.Money orqali buni amalga oshirishingiz mumkin  (iltimos, izohlarda bu kitob uchun ekanligini ko'rsating). Shuni aniqlik kiritib o'taman, har qanday xayriya ixtiyoriydir va hech qanday imtiyoz bermaydi, faqat menga bu kitobni mukkammallashtirishda yordam berishi mumkin.</p> <p>Minnatdorchiliklar Ushbu kitobning hozirgi ko'rinishda paydo bo'lishi va mavjudligi uchun aiogram yaratuvchisi Alex JRootJunior,  aiogram va kitobning repodagi kontirbutorlarga va  siz, aziz o'quvchilarga minnatdorchilik bildiraman!</p>"},{"location":"advanced-teaser/","title":"Yuqori daraja","text":""},{"location":"advanced-teaser/#yuqori-daraja","title":"Yuqori daraja","text":"<p>BotAPI sizga allaqachon oddiy tuyulyaptimi? Har kuni hujjatlarni o'qishdan boshlaysizmi? Oddiy botlar zerikdirdimi, murakkab botlarga esa qo'l urishga ikkilanayapsizmi?</p> <p>Sizga men hammualliflik qilgan yangi kursni \u2014 \"Python-da Telegram-botlar: yuqori daraja\" \u2014 tavsiya qilaman. Hozircha kurs boshlang'ich bosqichda, ya'ni materialning taxminan 70% tayyor, lekin tez orada yangi modullar bilan to'ldiriladi. Siz bu kursda nafaqat botlar yaratish, balki Python'dagi boshqa loyihalar uchun ham foydali bilimlarni olishingiz mumkin.</p> <p>Mana ba'zi misollar:</p> <ul> <li> <p> aiogram-dialog</p> <p>aiogram-dialog yordamida messenger oynasi ichida chiroyli va qulay interfeyslar yarating.</p> </li> <li> <p> Testlash</p> <p>Kodingiz mantiqini zerikarli qo'l bilan testlashsiz va \"ishlab chiqarishda xatolarni tutish\"siz tekshiring.</p> </li> <li> <p> Docker</p> <p>Tez va qulay joylashtirish hamda boshqa foydalanuvchilar bilan almashish uchun Docker konteynerlarini yarating. GitHub va GitLab'da yig'ishni avtomatlashtiring. Docker Compose bilan ishlang.</p> </li> <li> <p> Lokalizatsiya </p> <p>Botlaringizni foydalanuvchilar bilan turli tillarda gaplashishga o'rgating. Bu ishda sizga Babel va Project Fluent yordam beradi.</p> </li> <li> <p> Navbatlar *</p> <p>Ishonchlilik va yetkazib berish kafolatini oshirish uchun turli vazifalarni alohida mikroservislarga chiqarish maqsadida navbatlar va xabar brokerlaridan (RabbitMQ, NATS) foydalaning.</p> </li> <li> <p> Ma'lumotlar bazasi bilan ishlash *</p> <p>Foydalanuvchilar va ularning kontenti haqidagi ma'lumotlarni tez va samarali saqlash uchun zamonaviy ma'lumotlar bazalari va ular bilan ishlash vositalaridan foydalaning.</p> </li> </ul> <p>* \u2014 tez orada mavjud bo'ladi</p>"},{"location":"buttons/","title":"Tugmalar","text":""},{"location":"buttons/#tugmalar","title":"Tugmalar","text":"<p>Ushbu bobda ishlatilayotgan aiogram versiyasi: 3.7.0</p> <p>Bu bobda biz Telegram botlarida keng qo'llaniladigan tugmalar bilan tanishamiz. Avvalo, chalkashliklarning oldini olish uchun tugmalar turlarini ajratib olamiz. Qurilmangiz ekranining pastki qismida, matn kiritish oynasi ostida joylashadigan tugmalarni oddiy tugmalar deb ataymiz. Xabarlarga bevosita biriktiriladigan tugmalar esa inline tugmalar hisoblanadi. Quyidagi rasmda bu ikki turdagi tugmalarni ko'rishingiz mumkin:</p> <p></p>"},{"location":"buttons/#reply-buttons","title":"Oddiy tugmalar","text":""},{"location":"buttons/#reply-as-text","title":"Tugmalar matn shabloni sifatida","text":"<p>Ushbu turdagi tugmalar 2015 yilda Bot API bilan birga paydo bo'lgan (Contact, Location va boshqa bir nechta alohida holatlar bundan mustasno  ular haqida keyinroq gaplashamiz) va  ular xabar shablonlari hisoblanadi. Ishlash usuli oddiy: tugmada nima yozilgan bo'lsa,  aynan o'sha narsa joriy chatga yuboriladi (siz bunday holatda tugma bosish o'rniga aynan tugmadagi matnni chatga yuborish orqali bir xil natija olishinggiz mumkin).  Shuning uchun bunday tugma bosilishini qayta ishlash uchun bot kiruvchi matnli xabarlarni oldindan bilishi kerak.</p> <p>Keling <code>/start</code> buyrug'ini bosganingizda ikkita tugma bilan xabar yuboradigan handler'ni yozamiz:</p> <pre><code>@dp.message(Command(\"start\"))\nasync def cmd_start(message: types.Message):\n    kb = [\n        [types.KeyboardButton(text=\"Pyure bilan\")],\n        [types.KeyboardButton(text=\"Pyuresiz\")]\n    ]\n    keyboard = types.ReplyKeyboardMarkup(keyboard=kb)\n    await message.answer(\"Kotletni qanday beramiz?\", reply_markup=keyboard)\n</code></pre> <p>Telegram Bot API sizga <code>KeyboardButton</code> ob'ekti o'rniga faqat satrlarni belgilash imkonini berishiga qaramay,  stringdan foydalanmoqchi bo'lganingizda, aiogram 3.x ValidationError xatosini chiqaradi va bu xato emas, balki xususiyatdir. Hozircha undan foydalanishga majbursiz \ud83e\udd37\u200d\u2642\ufe0f</p> <p>Botni ishga tushiramiz va unda \"ulkan\" tugmalarni ko'rishimiz mumkin:</p> <p></p> <p>Qandaydir xunuk ko'rinib qoldi shunday emasmi. Avvalo tugmalarni kichikroq qilishni, ikkinchidan ularni gorizontal  joylashtirishni xohlaymiz. Nega ular bunday ko'rinishga ega? Gap shundaki, birlamchi holatda bunday tugmalar ilovaning standard tugmalari o'lchamida bo'ladi.  Tugmalarni kichraytirish uchun klaviatura obyektiga qo'shimcha <code>resize_keyboard=True</code> parametrini ko'rsatishimiz kerak.   Ammo vertikal tugmalarni gorizontal tugmalarga qanday almashtirish mumkin?  Bot API nuqtai nazaridan klaviatura \u2014 ichma ich massiv bu esa tugmalarni tashkil qiladi,  ya'ni oddiy qilib aytganda, qatorlar massivi. Kodimizni chiroyli bo'lishi uchun uni qayta yozamiz va foydalanuvchiga nima kiritishni ko'rsatish uchun  <code>input_field_placeholder</code> parametrini qo'shamiz, bu bizga klaviatura faol bo'lgan paytda matn kiritish maydoni fonida xira ko'rinishda biz belgilagan matnni ko'rsatadi:</p> <pre><code>@dp.message(Command(\"start\"))\nasync def cmd_start(message: types.Message):\n    kb = [\n        [\n            types.KeyboardButton(text=\"Pyure bilan\"),\n            types.KeyboardButton(text=\"Pyuresiz\")\n        ],\n    ]\n    keyboard = types.ReplyKeyboardMarkup(\n        keyboard=kb,\n        resize_keyboard=True,\n        input_field_placeholder=\"Qanday usulda berishni tanlang\"\n    )\n    await message.answer(\"Kotletni qanday beramiz?\", reply_markup=keyboard)\n</code></pre> <p>Qarang - haqiqatan ham chiroyli:</p> <p></p> <p>Endi bunday tugmalar bosilishini qayta ishlashni botga o'rgatish qoldi. Yuqorida aytib o'tilganidek, matnning to'liq mos kelishini tekshirish kerak. Buni magic-filter F yordamida qilamiz, bu haqida esa batafsil boshqa bobda gaplashamiz:</p> <pre><code># yangi import\nfrom aiogram import F\n\n@dp.message(F.text.lower() == \"pyure bilan\")\nasync def with_puree(message: types.Message):\n    await message.reply(\"Ajoyib tanlov!\")\n\n@dp.message(F.text.lower() == \"pyuresiz\")\nasync def without_puree(message: types.Message):\n    await message.reply(\"Bunday mazali emas!\")\n</code></pre> <p></p> <p>Tugmalarni olib tashlash uchun <code>ReplyKeyboardRemove</code> kabi maxsus \"o'chirish\" klaviaturasi bilan yangi xabar yuborishingiz kerak.  Masalan: <code>await message.reply(\"Ajoyib tanlov!\", reply_markup=types.ReplyKeyboardRemove())</code></p>"},{"location":"buttons/#reply-builder","title":"Keyboard Builder","text":"<p>Tugmalarni dinamikroq yaratish uchun klaviatura yasagich (keyboard builder) dan foydalanish mumkin.  Bizga quyidagi metodlar kerak bo'ladi:</p> <ul> <li><code>add(&lt;KeyboardButton&gt;)</code> \u2014 tugmani yasagich (Builder) xotirasiga qo'shadi;</li> <li><code>adjust(int1, int2, int3...)</code> \u2014 <code>int1, int2, int3...</code> tugmalardan iborat qatorlarni yaratadi;</li> <li><code>as_markup()</code> \u2014 tayyor klaviatura obyektini qaytaradi;</li> <li><code>button(&lt;params&gt;)</code> \u2014 berilgan parametrlar bilan tugmani qo'shadi, tugma turi (Reply yoki Inline) avtomatik ravishda aniqlanadi.</li> </ul> <p>Keling, 4\u00d74 o'lchamdagi raqamlardan iborat klaviatura yaratamiz:</p> <pre><code># yangi import\nfrom aiogram.utils.keyboard import ReplyKeyboardBuilder\n\n@dp.message(Command(\"reply_builder\"))\nasync def reply_builder(message: types.Message):\n    builder = ReplyKeyboardBuilder()\n    for i in range(1, 17):\n        builder.add(types.KeyboardButton(text=str(i)))\n    builder.adjust(4)\n    await message.answer(\n        \"Sonni tanlang:\",\n        reply_markup=builder.as_markup(resize_keyboard=True),\n    )\n</code></pre> <p></p> <p>Oddiy klaviatura obyektida yana ikki foydali parametr mavjud:  biri <code>one_time_keyboard</code> - tugmani bosilgandan keyin avtomatik ravishda yashirish uchun va ikkinchisi <code>selective</code> - klaviaturani  faqat guruhning ayrim ishtirokchilariga ko'rsatish uchun. Ularni ishlatishni mustaqil o'rganishingiz mumkin.</p>"},{"location":"buttons/#reply-special","title":"Maxsus oddiy tugmalar","text":"<p>Hozirda (Ushbu bobni yozish vaqtida) Telegramda oddiy xabar shablonlari bo'lmagan olti xil maxsus oddiy tugma mavjud.  Ular quyidagilar uchun mo'ljallangan:</p> <ul> <li>joriy joylashuvni yuborish;</li> <li>telefon raqami bilan o'z kontaktini yuborish;</li> <li>so'rovnoma/viktorina yaratish;</li> <li>kerakli mezonlarga ega foydalanuvchi ma'lumotlarini tanlash va botga yuborish;</li> <li>kerakli mezonlarga ega (super)guruh yoki kanal ma'lumotlarini tanlash va botga yuborish;</li> <li>veb-ilovani (WebApp) ishga tushirish.</li> </ul> <p>Ular haqida batafsil gaplashamiz.</p> <p>Joriy joylashuvni yuborish. Bu yerda hammasi oddiy: foydalanuvchi qayerda bo'lsa, o'sha koordinatalarni yuboradi. Bu statik manzil bo'ladi, avtomatik yangilanadigan Live Location emas. Albatta ayyor foydalanuvchilar o'z joylashuvini o'zgartirishi mumkin, ba'zida hatto butun (Android) tizim darajasida.</p> <p>O'z kontaktini telefon raqamini bilan yuborish. Tugmani bosganda (avval tasdiqlash bilan) foydalanuvchi o'z kontaktini telefon raqami bilan botga yuboradi. Ba'zi ayyor foydalanuvchilar bu tugmani bosmasdan, istalgan boshqa kontaktni yuborishi mumkin, lekin bu holatda ularga qarshi choralar ko'rish mumkin: handlerda yoki filtrda <code>message.contact.user_id == message.from_user.id</code> tengligini tekshirish kifoya.</p> <p>So'rov/viktorina yaratish. Tugmani bosganda foydalanuvchiga so'rov yoki viktorina yaratish taklif etiladi, ular keyin joriy chatga yuboriladi. Buning uchun KeyboardButtonPollType obyektini uzatish kerak, ixtiyoriy <code>type</code> argumenti so'rov turi (so'rov yoki viktorina) uchun xizmat qiladi.</p> <p>Kerakli mezonlarga ega foydalanuvchi ma'lumotlarini tanlash va botga yuborish. Tugmani bosgan foydalanuvchining chatlar ro'yxatidan foydalanuvchini tanlash oynasini ko'rsatadi. Buning uchun KeyboardButtonRequestUser obyektini uzatish kerak, bunda istalgan usul bilan yaratilgan so'rov ID sini va mezonlarni ko'rsatish kerak, masalan, \"bot\", \"Telegram Premium obunasi bor\" va h.k. Foydalanuvchi tanlangandan keyin bot UserShared turidagi xizmat xabarini oladi.</p> <p>Kerakli mezonlarga ega chat ma'lumotlarini tanlash va botga yuborish. Tugmani bosgan foydalanuvchining chatlar ro'yxatidan chatni tanlash oynasini ko'rsatadi. Buning uchun KeyboardButtonRequestChat obyektini uzatish kerak, bunda istalgan usul bilan yaratilgan so'rov ID sini va mezonlarni ko'rsatish kerak, masalan, \"guruh yoki kanal\", \"foydalanuvchi \u2014 chat yaratuvchisi\" va h.k. Foydalanuvchi tanlangandan keyin bot ChatShared turidagi xizmat xabarini oladi.</p> <p>Veb-ilovani ishga tushirish (WebApp). Tugmani bosganda WebApp ni ochadi. Buning uchun WebAppInfo obyektini uzatish kerak. Ushbu kitobda veb-ilovalar hali ko'rib chiqilmaydi.</p> <p>Biroq, buni bir marta kodda ko'rgan afzal: </p><pre><code>@dp.message(Command(\"special_buttons\"))\nasync def cmd_special_buttons(message: types.Message):\n    builder = ReplyKeyboardBuilder()\n    # row metodi bir yoki bir nechta tugmadan iborat qatordan aniq foydalanish imkonini beradi. Masalan, birinchi qator ikki tugmadan iborat bo'ladi...\n    builder.row(\n        types.KeyboardButton(text=\"Geolokatsiyani so'rash\", request_location=True),\n        types.KeyboardButton(text=\"Kontaktni so'rash\", request_contact=True)\n    )\n    # ... ikkinchi qator bitta tugmadan ...\n    builder.row(types.KeyboardButton(\n        text=\"Viktorina yaratish\",\n        request_poll=types.KeyboardButtonPollType(type=\"quiz\"))\n    )\n    # ... va uchinchi qator yana ikki tugmadan\n    builder.row(\n        types.KeyboardButton(\n            text=\"Premium foydalanuvchini tanlash\",\n            request_user=types.KeyboardButtonRequestUser(\n                request_id=1,\n                user_is_premium=True\n            )\n        ),\n        types.KeyboardButton(\n            text=\"Forumli supergruppani tanlash\",\n            request_chat=types.KeyboardButtonRequestChat(\n                request_id=2,\n                chat_is_channel=False,\n                chat_is_forum=True\n            )\n        )\n    )\n    # WebApp tugmalari hozircha yo'q, uzr :(\n\n    await message.answer(\n        \"Amalni tanlang:\",\n        reply_markup=builder.as_markup(resize_keyboard=True),\n    )\n</code></pre> <p></p> <p>Oxirida, pastdagi ikki tugma uchun handlerlar namunasi:</p> <pre><code># yangi import\nfrom aiogram import F\n\n@dp.message(F.user_shared)\nasync def on_user_shared(message: types.Message):\n    print(\n        f\"So'rov {message.user_shared.request_id}. \"\n        f\"Foydalanuvchi ID: {message.user_shared.user_id}\"\n    )\n\n\n@dp.message(F.chat_shared)\nasync def on_user_shared(message: types.Message):\n    print(\n        f\"So'rov {message.chat_shared.request_id}. \"\n        f\"Chat ID: {message.chat_shared.chat_id}\"\n    )\n</code></pre>"},{"location":"buttons/#inline-buttons","title":"Inline tugmalar","text":""},{"location":"buttons/#url-buttons","title":"URL-tugmalar","text":"<p>Oddiy tugmalardan farqli o'laroq, inline tugmalar ekran pastiga emas, balki yuborilgan xabarga biriktiriladi. Ushbu bobda biz bunday tugmalarning ikki turini ko'rib chiqamiz: URL va Callback. Yana biri \u2014 Switch \u2014 esa inline-rejim bobida ko'rib chiqiladi.</p> <p>Login va Pay tugmalari bu kitobda umuman ko'rib chiqilmaydi. Agar kimdir avtorizatsiya yoki to'lov uchun ishlaydigan kod bilan yordam bermoqchi bo'lsa, iltimos, GitHub ga Pull Request yarating. Rahmat!</p> <p>Eng oddiy inline tugmalar URL turiga kiradi, ya'ni \"havola\". Faqat HTTP(S) va tg:// protokollari qo'llab-quvvatlanadi.</p> <pre><code># yangi import\nfrom aiogram.utils.keyboard import InlineKeyboardBuilder\n\n@dp.message(Command(\"inline_url\"))\nasync def cmd_inline_url(message: types.Message, bot: Bot):\n    builder = InlineKeyboardBuilder()\n    builder.row(types.InlineKeyboardButton(\n        text=\"GitHub\", url=\"https://github.com\")\n    )\n    builder.row(types.InlineKeyboardButton(\n        text=\"Telegram rasmiy kanali\",\n        url=\"tg://resolve?domain=telegram\")\n    )\n\n    # ID-tugmani ko'rsatish uchun,\n    # foydalanuvchida has_private_forwards flagi False bo'lishi kerak\n    user_id = 1234567890\n    chat_info = await bot.get_chat(user_id)\n    if not chat_info.has_private_forwards:\n        builder.row(types.InlineKeyboardButton(\n            text=\"Noma'lum foydalanuvchi\",\n            url=f\"tg://user?id={user_id}\")\n        )\n\n    await message.answer(\n        'Havolani tanlang',\n        reply_markup=builder.as_markup(),\n    )\n</code></pre> <p>Kodning o'rta qismiga alohida to'xtalamiz. 2019 yil mart oyida Telegram ishlab chiquvchilari foydalanuvchi profili havolasini o'chirish imkonini joriy qilishdi. Agar sizda forward orqali o'tish o'chirilgan foydalanuvchi ID'si bilan URL-tugma yaratsangiz, bot <code>Bad Request: BUTTON_USER_PRIVACY_RESTRICTED</code> xatosini oladi. Shuning uchun bunday tugmani ko'rsatishdan oldin, ushbu sozlamaning holatini aniqlash kerak. Buning uchun getChat metodini chaqirib, <code>has_private_forwards</code> maydonini tekshirish mumkin. Agar u <code>True</code> bo'lsa, URL-ID tugmasini qo'shishga urinish xatoga olib keladi.</p>"},{"location":"buttons/#callback-buttons","title":"Callback tugmalar","text":"<p>URL-tugmalar haqida gaplashib bo'ldik, endi esa asosiy mavzuga \u2014 Callback tugmalarga o'tamiz. Bu juda kuchli imkoniyat bo'lib, deyarli har bir botda uchraydi. Masalan, postlarga reaktsiya tugmalari (layklar), @BotFather menyusi va boshqalar. Callback tugmalarning o'ziga xos qiymati (data) bo'ladi, shu qiymat orqali dastur qaysi tugma bosilganini va nima qilish kerakligini aniqlaydi. To'g'ri data tanlash juda muhim! Shuni ham aytish kerakki, oddiy tugmalardan farqli o'laroq, callback tugmasi bosilganda deyarli istalgan amalni bajarish mumkin \u2014 pizza buyurtma qilishdan tortib, superkompyuter klasterida hisob-kitoblarni ishga tushirishgacha.</p> <p>Keling, <code>/random</code> komandasi bosilganda callback tugmasi bilan xabar yuboradigan handler yozamiz: </p><pre><code>@dp.message(Command(\"random\"))\nasync def cmd_random(message: types.Message):\n    builder = InlineKeyboardBuilder()\n    builder.add(types.InlineKeyboardButton(\n        text=\"Meni bos\",\n        callback_data=\"random_value\")\n    )\n    await message.answer(\n        \"Tugmani bosing, bot 1 dan 10 gacha son yuboradi\",\n        reply_markup=builder.as_markup()\n    )\n</code></pre> <p>Endi esa tugma bosilishini qanday qayta ishlashni ko'ramiz. Oldin xabarlar uchun <code>message</code> handler ishlatgan bo'lsak, callback tugmalar uchun <code>callback_query</code> handlerdan foydalanamiz. Tugmaning qiymati (data) bo'yicha aniqlaymiz:</p> <pre><code>@dp.callback_query(F.data == \"random_value\")\nasync def send_random_value(callback: types.CallbackQuery):\n    await callback.message.answer(str(randint(1, 10)))\n</code></pre> <p></p> <p>E'tibor bering, Telegram serveri callback yetkazib berilganini tasdiqlashimizni kutadi, aks holda 30 soniya davomida maxsus soatcha belgisi ko'rinadi. Soatchani yashirish uchun callback obyektining <code>answer()</code> metodini chaqirish kerak (yoki API'dagi <code>answer_callback_query()</code> metodidan foydalanish mumkin). Odatda <code>answer()</code> ga hech narsa uzatmaslik mumkin, lekin xohlasangiz maxsus oynacha (ekranning yuqorisida yoki ustida) ko'rsatishingiz mumkin:</p> <pre><code>@dp.callback_query(F.data == \"random_value\")\nasync def send_random_value(callback: types.CallbackQuery):\n    await callback.message.answer(str(randint(1, 10)))\n    await callback.answer(\n        text=\"Botdan foydalanganingiz uchun rahmat!\",\n        show_alert=True\n    )\n    # yoki shunchaki await callback.answer()\n</code></pre> <p></p> <p>Savol tug'ilishi mumkin: callbackni qayta ishlashda <code>answer()</code> metodini qachon chaqirish kerak? Asosiy qoidasi \u2014 Telegram'ga callback so'rovi olinganini unutmasdan bildirish. Men esa <code>answer()</code> ni har doim oxirida chaqirishni tavsiya qilaman. Chunki agar callbackni qayta ishlashda xatolik yuz bersa va botda istisno chiqsa, foydalanuvchi soatchani yarim daqiqa ko'radi va nimadir noto'g'ri ketganini tushunadi. Aks holda, soatcha yo'qoladi, lekin foydalanuvchi so'rovi muvaffaqiyatli bajarildimi yoki yo'qmi \u2014 bilmaydi.</p> <p>Diqqat</p> <p><code>send_random_value</code> funksiyasida biz <code>answer()</code> metodini <code>message</code> emas, balki <code>callback.message</code> obyektida chaqirdik. Chunki callback handlerlar xabarlar (Message) bilan emas, callbacklar (CallbackQuery) bilan ishlaydi, ularning maydonlari boshqacha va xabar \u2014 faqat bir qismi xolos. Shuningdek, <code>message</code> \u2014 bu tugma biriktirilgan xabar (ya'ni, bunday xabarni yuborgan \u2014 botning o'zi). Kim tugmani bosganini bilmoqchi bo'lsangiz, <code>from</code> maydoniga qarang (<code>callback.from_user</code> \u2014 Python'da <code>from</code> kalit so'z bo'lgani uchun).</p> <p>Callbackdagi <code>message</code> obyektiga oid</p> <p>Agar xabar inline-rejim orqali yuborilgan bo'lsa, callbackda <code>message</code> maydoni bo'sh bo'ladi. Bunday xabar mazmunini olishning iloji bo'lmaydi, faqat oldindan saqlab qo'ymagan bo'lsangiz.</p> <p>Endi murakkabroq misolga o'tamiz. Foydalanuvchiga 0 soni ko'rsatilgan xabar yuboriladi, pastda esa uchta tugma: +1, -1 va Tasdiqlash. Birinchi ikkitasi sonni o'zgartiradi, oxirgisi esa klaviaturani olib tashlab, natijani tasdiqlaydi. Qiymatlarni xotirada, lug'atda saqlaymiz (avtomatlar haqida keyinroq gaplashamiz).</p> <pre><code># \u0417\u0434\u0435\u0441\u044c \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435.\n# \u0422.\u043a. \u044d\u0442\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u0432 \u043f\u0430\u043c\u044f\u0442\u0438, \u0442\u043e \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u043e\u043d \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u0441\u044f\nuser_data = {}\n\ndef get_keyboard():\n    buttons = [\n        [\n            types.InlineKeyboardButton(text=\"-1\", callback_data=\"num_decr\"),\n            types.InlineKeyboardButton(text=\"+1\", callback_data=\"num_incr\")\n        ],\n        [types.InlineKeyboardButton(text=\"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c\", callback_data=\"num_finish\")]\n    ]\n    keyboard = types.InlineKeyboardMarkup(inline_keyboard=buttons)\n    return keyboard\n\n\nasync def update_num_text(message: types.Message, new_value: int):\n    await message.edit_text(\n        f\"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e: {new_value}\",\n        reply_markup=get_keyboard()\n    )\n\n\n@dp.message(Command(\"numbers\"))\nasync def cmd_numbers(message: types.Message):\n    user_data[message.from_user.id] = 0\n    await message.answer(\"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e: 0\", reply_markup=get_keyboard())\n\n\n@dp.callback_query(F.data.startswith(\"num_\"))\nasync def callbacks_num(callback: types.CallbackQuery):\n    user_value = user_data.get(callback.from_user.id, 0)\n    action = callback.data.split(\"_\")[1]\n\n    if action == \"incr\":\n        user_data[callback.from_user.id] = user_value+1\n        await update_num_text(callback.message, user_value+1)\n    elif action == \"decr\":\n        user_data[callback.from_user.id] = user_value-1\n        await update_num_text(callback.message, user_value-1)\n    elif action == \"finish\":\n        await callback.message.edit_text(f\"\u0418\u0442\u043e\u0433\u043e: {user_value}\")\n\n    await callback.answer()\n</code></pre> <p>Hammasi ishlayotgandek tuyuladi:</p> <p></p> <p>Endi tasavvur qiling, ayyor foydalanuvchi quyidagicha harakat qildi: <code>/numbers</code> buyrug'ini chaqirdi (qiymat 0), qiymatni 1 ga oshirdi, yana <code>/numbers</code> buyrug'ini chaqirdi (qiymat 0 ga tushdi) va birinchi xabardagi \"+1\" tugmasini bosdi. Nima bo'ladi? Bot xabar matnini 1 ga o'zgartirishga harakat qiladi, lekin o'sha xabarda allaqachon 1 turgani uchun Bot API xato qaytaradi: eski va yangi matn bir xil, bot esa istisno oladi: <code>Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message</code></p> <p></p> <p>Bu xatoga siz ham tez-tez duch kelishingiz mumkin, ayniqsa xabarlarni tahrirlashga harakat qilganda. Odatda, bunday xato xabar mazmunini yangilashdagi mantiqiy muammolarni bildiradi, lekin ba'zan, yuqoridagi misolda bo'lgani kabi, bu kutilgan holat bo'lishi mumkin.</p> <p>Bu holatda xatoni butunlay e'tiborsiz qoldiramiz, chunki bizga faqat yakuniy natija muhim, u esa aniq to'g'ri bo'ladi. MessageNotModified xatosi Bad Request turiga kiradi, shuning uchun butun bu turdagi xatolarni e'tiborsiz qoldirish yoki matn bo'yicha aniq sababini aniqlash mumkin. Misolni murakkablashtirmaslik uchun birinchi usuldan foydalanamiz va <code>update_num_text()</code> funksiyasini quyidagicha yangilaymiz:</p> <pre><code># Yangi importlar!\nfrom contextlib import suppress\nfrom aiogram.exceptions import TelegramBadRequest\n\nasync def update_num_text(message: types.Message, new_value: int):\n    with suppress(TelegramBadRequest):\n        await message.edit_text(\n            f\"Sonni kiriting: {new_value}\",\n            reply_markup=get_keyboard()\n        )\n</code></pre> <p>Endi yuqoridagi misolni yana takrorlasangiz, bot bu xatoni shunchaki e'tiborsiz qoldiradi.</p>"},{"location":"buttons/#callback-factory","title":"Callback factory (CallbackData)","text":"<p>Agar sizda umumiy prefiksli oddiy callbacklar bo'lsa, masalan, <code>order_1</code>, <code>order_2</code> va hokazo, <code>split()</code> yordamida satrni ajratish osondek tuyuladi. Endi tasavvur qiling, uchta qiymat saqlash kerak: <code>order_1_1994_2731519</code>. Qaysi biri artikul, qaysi biri narx, qaysi biri miqdor? Yoki bu umuman chiqarilgan yilmi? Satrni ajratish ham chalkash ko'rinadi: <code>.split(\"_\")[2]</code>. Nega aynan 1 yoki 3?</p> <p>Bir payt kelib, bunday callback data mazmunini strukturalash zarurati tug'iladi va aiogram'da buning yechimi bor! Siz <code>CallbackData</code> tipidagi obyektlar yaratasiz, prefiks ko'rsatasiz, tuzilmani belgilaysiz, framework esa callback ma'lumotini to'g'ri yig'adi va eng muhimi, kelgan qiymatni to'g'ri ajratadi. Keling, aniq misolda ko'ramiz: <code>fabnum</code> prefiksli, <code>action</code> va <code>value</code> maydonli <code>NumbersCallbackFactory</code> klassini yaratamiz. <code>action</code> \u2014 nima qilish kerakligini (o'zgartirish yoki tasdiqlash), <code>value</code> esa o'zgarish miqdorini bildiradi. \"finish\" uchun value kerak emas, shuning uchun u default bo'lib None bo'ladi. Kod:</p> <pre><code># Yangi importlar!\nfrom typing import Optional\nfrom aiogram.filters.callback_data import CallbackData\n\nclass NumbersCallbackFactory(CallbackData, prefix=\"fabnum\"):\n    action: str\n    value: Optional[int] = None\n</code></pre> <p>Klass albatta <code>CallbackData</code> dan meros olishi va prefiks qabul qilishi kerak. Prefiks \u2014 bu callback boshida bo'ladigan umumiy qism, framework shu orqali strukturani aniqlaydi.</p> <p>Endi klaviatura generatsiya qiluvchi funksiya yozamiz. Bu yerda <code>button()</code> metodidan foydalanamiz, u tugma turini avtomatik aniqlaydi, bizdan faqat argumentlarni uzatish talab qilinadi. <code>callback_data</code> argumentiga satr o'rniga <code>NumbersCallbackFactory</code> obyektini uzatamiz:</p> <pre><code>def get_keyboard_fab():\n    builder = InlineKeyboardBuilder()\n    builder.button(\n        text=\"-2\", callback_data=NumbersCallbackFactory(action=\"change\", value=-2)\n    )\n    builder.button(\n        text=\"-1\", callback_data=NumbersCallbackFactory(action=\"change\", value=-1)\n    )\n    builder.button(\n        text=\"+1\", callback_data=NumbersCallbackFactory(action=\"change\", value=1)\n    )\n    builder.button(\n        text=\"+2\", callback_data=NumbersCallbackFactory(action=\"change\", value=2)\n    )\n    builder.button(\n        text=\"Tasdiqlash\", callback_data=NumbersCallbackFactory(action=\"finish\")\n    )\n    # Tugmalarni 4 tadan bir qatorda joylashtiramiz, natijada 4 + 1 bo'ladi\n    builder.adjust(4)\n    return builder.as_markup()\n</code></pre> <p>Xabar yuborish va tahrirlash metodlarini o'sha holicha qoldiramiz (nom va komandaga <code>_fab</code> qo'shimchasini qo'shamiz):</p> <pre><code>async def update_num_text_fab(message: types.Message, new_value: int):\n    with suppress(TelegramBadRequest):\n        await message.edit_text(\n            f\"Sonni kiriting: {new_value}\",\n            reply_markup=get_keyboard_fab()\n        )\n\n@dp.message(Command(\"numbers_fab\"))\nasync def cmd_numbers_fab(message: types.Message):\n    user_data[message.from_user.id] = 0\n    await message.answer(\"Sonni kiriting: 0\", reply_markup=get_keyboard_fab())\n</code></pre> <p>Endi eng asosiysi \u2014 callbacklarni qayta ishlash. Dekoratorda klassni va uning <code>filter()</code> metodini uzatamiz. Shuningdek, <code>callback_data</code> nomli qo'shimcha argument paydo bo'ladi, u ham xuddi shu klass tipida bo'ladi:</p> <pre><code>@dp.callback_query(NumbersCallbackFactory.filter())\nasync def callbacks_num_change_fab(\n        callback: types.CallbackQuery, \n        callback_data: NumbersCallbackFactory\n):\n    # Joriy qiymat\n    user_value = user_data.get(callback.from_user.id, 0)\n    # Agar sonni o'zgartirish kerak bo'lsa\n    if callback_data.action == \"change\":\n        user_data[callback.from_user.id] = user_value + callback_data.value\n        await update_num_text_fab(callback.message, user_value + callback_data.value)\n    # Agar sonni tasdiqlash kerak bo'lsa\n    else:\n        await callback.message.edit_text(f\"Yakuniy natija: {user_value}\")\n    await callback.answer()\n</code></pre> <p>Handlerlarni yanada aniqroq ajratamiz va sonli tugmalar hamda \"Tasdiqlash\" tugmasi uchun alohida handler yozamiz. <code>action</code> qiymati bo'yicha filtrlaymiz, bunda aiogram 3.x ning \"Magic Filter\" imkoniyatidan foydalanamiz. Bu haqda keyinroq alohida bobda gaplashamiz, hozircha esa shunchaki foydalanamiz:</p> <pre><code># Yangi import!\nfrom magic_filter import F\n\n# -2, -1, +1, +2 tugmalardan birini bosganda\n@dp.callback_query(NumbersCallbackFactory.filter(F.action == \"change\"))\nasync def callbacks_num_change_fab(\n        callback: types.CallbackQuery, \n        callback_data: NumbersCallbackFactory\n):\n    # Joriy qiymat\n    user_value = user_data.get(callback.from_user.id, 0)\n\n    user_data[callback.from_user.id] = user_value + callback_data.value\n    await update_num_text_fab(callback.message, user_value + callback_data.value)\n    await callback.answer()\n\n# \"Tasdiqlash\" tugmasi bosilganda\n@dp.callback_query(NumbersCallbackFactory.filter(F.action == \"finish\"))\nasync def callbacks_num_finish_fab(callback: types.CallbackQuery):\n    # Joriy qiymat\n    user_value = user_data.get(callback.from_user.id, 0)\n\n    await callback.message.edit_text(f\"Yakuniy natija: {user_value}\")\n    await callback.answer()\n</code></pre> <p></p> <p>Birinchi qarashda bu murakkabdek ko'rinishi mumkin, lekin aslida callback factory yordamida murakkab callback tugmalarni qulay va mantiqan ajratilgan kod bilan yaratish mumkin. Amalda factorydan foydalanishni Saper o'yini botida ko'rishingiz mumkin.</p>"},{"location":"buttons/#callback-autoreply","title":"Callback'larga avtomatik javob","text":"<p>Agar sizda callback handlerlari juda ko'p bo'lsa va ularga bir xil yoki oddiy javob qaytarish kerak bo'lsa, hayotingizni yengillashtirish uchun maxsus middleware'dan foydalanishingiz mumkin. Bu haqda batafsil alohida bobda gaplashamiz, hozir esa qisqacha tanishamiz.</p> <p>Eng oddiy variant \u2014 dispatcher yaratilgandan so'ng quyidagi qatorni qo'shish:</p> <pre><code># Yangi importni unutmang\nfrom aiogram.utils.callback_answer import CallbackAnswerMiddleware\n\ndp = Dispatcher()\ndp.callback_query.middleware(CallbackAnswerMiddleware())\n</code></pre> <p>Bu holda handler bajarilgandan so'ng aiogram callback'ga avtomatik javob beradi. Standart sozlamalarni manba kodida ko'rishingiz yoki o'zgartirishingiz mumkin, masalan:</p> <pre><code>dp.callback_query.middleware(\n    CallbackAnswerMiddleware(\n        pre=True, text=\"Tayyor!\", show_alert=True\n    )\n)\n</code></pre> <p>Afsuski, barcha callback handlerlar uchun bir xil javob kerak bo'ladigan holatlar kam uchraydi. Yaxshiyamki, middleware xatti-harakatini aniq handlerda oson o'zgartirish mumkin: <code>callback_answer</code> argumentini uzatib, unga yangi qiymatlar berish kifoya:</p> <pre><code># Yangi import!\nfrom aiogram.utils.callback_answer import CallbackAnswer\n\n@dp.callback_query()\nasync def my_handler(callback: CallbackQuery, callback_answer: CallbackAnswer):\n    ... # bu yerda kod\n    if &lt;hammasi yaxshi&gt;:\n        callback_answer.text = \"A'lo!\"\n    else:\n        callback_answer.text = \"Nimadir noto'g'ri ketdi. Keyinroq urinib ko'ring\"\n        callback_answer.cache_time = 10\n    ... # bu yerda kod\n</code></pre> <p>Muhim: agar middleware'da <code>pre=True</code> flagi o'rnatilgan bo'lsa, bu usul ishlamaydi. Bunday holatda flaglarni to'liq o'zgartirish kerak, bu bilan keyinroq tanishamiz:</p> <pre><code>from aiogram import flags\nfrom aiogram.utils.callback_answer import CallbackAnswer\n\n@dp.callback_query()\n@flags.callback_answer(pre=False)  # pre flagini o'zgartiramiz\nasync def my_handler(callback: CallbackQuery, callback_answer: CallbackAnswer):\n    ... # bu yerda kod\n    if &lt;hammasi yaxshi&gt;:\n        callback_answer.text = \"Endi bu matn ko'rinadi!\"\n    ... # bu yerda kod\n</code></pre> <p>Shu bilan tugmalar bilan tanishuvni yakunlaymiz.</p>"},{"location":"filters-and-middlewares/","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u044b \u0438 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438","text":""},{"location":"filters-and-middlewares/#_1","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u044b \u0438 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f aiogram: 3.7.0</p> <p>\u041d\u0430\u0441\u0442\u0430\u043b\u043e \u0432\u0440\u0435\u043c\u044f \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f, \u043a\u0430\u043a \u0443\u0441\u0442\u0440\u043e\u0435\u043d\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0438 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u0432 aiogram 3.x, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043f\u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441  \u00ab\u0443\u0431\u0438\u0439\u0446\u0435\u0439 \u043b\u044f\u043c\u0431\u0434\u0430-\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439\u00bb \u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a\u0430 \u2014 \u043c\u0430\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u043c\u0438.</p>"},{"location":"filters-and-middlewares/#filters","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u044b","text":""},{"location":"filters-and-middlewares/#why-filters","title":"\u0417\u0430\u0447\u0435\u043c \u043d\u0443\u0436\u043d\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u044b?","text":"<p>\u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0430\u043f\u0438\u0441\u0430\u043b\u0438 \u0441\u0432\u043e\u0435\u0433\u043e \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0431\u043e\u0442\u0430, \u0442\u043e \u043c\u043e\u0433\u0443 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u0438\u0442\u044c: \u0432\u044b \u0443\u0436\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u043c\u0438,  \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438, \u0430 \u043d\u0435 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c\u0438. \u0414\u0430-\u0434\u0430, \u0442\u043e \u0441\u0430\u043c\u043e\u0435 <code>Command(\"start\")</code> \u0438 \u0435\u0441\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e,  \u0447\u0442\u043e\u0431\u044b \u043e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0439 \u0430\u043f\u0434\u0435\u0439\u0442 \u043e\u0442 \u0442\u0435\u043b\u0435\u0433\u0438 \u043f\u043e\u043f\u0430\u043b \u0432 \u043d\u0443\u0436\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a, \u0442.\u0435. \u0442\u0443\u0434\u0430, \u0433\u0434\u0435 \u0435\u0433\u043e [\u0430\u043f\u0434\u0435\u0439\u0442] \u0436\u0434\u0443\u0442. </p> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0441\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u0440\u0438\u043c\u0435\u0440, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c \u0432\u0430\u0436\u043d\u043e\u0441\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432. \u041f\u0443\u0441\u0442\u044c \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0410\u043b\u0438\u0441\u0430 \u0441 ID 111  \u0438 \u0411\u043e\u0431 \u0441 ID 777. \u0418 \u0435\u0441\u0442\u044c \u0431\u043e\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430 \u043b\u044e\u0431\u043e\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0440\u0430\u0434\u0443\u0435\u0442 \u043d\u0430\u0448\u0438\u0445 \u0434\u0432\u0443\u0445 \u0440\u0435\u0431\u044f\u0442 \u043a\u0430\u043a\u043e\u0439-\u043d\u0438\u0431\u0443\u0434\u044c  \u043c\u043e\u0442\u0438\u0432\u0438\u0440\u0443\u044e\u0449\u0435\u0439 \u0444\u0440\u0430\u0437\u043e\u0439, \u0430 \u0432\u0441\u0435\u0445 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0442\u0448\u0438\u0432\u0430\u0435\u0442:</p> <pre><code>from random import choice\n\n@router.message(F.text)\nasync def my_text_handler(message: Message):\n    phrases = [\n        \"\u041f\u0440\u0438\u0432\u0435\u0442! \u041e\u0442\u043b\u0438\u0447\u043d\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0448\u044c :)\",\n        \"\u0425\u044d\u043b\u043b\u043e\u0443, \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u043b\u0438\u0447\u043d\u044b\u0439 \u0434\u0435\u043d\u044c!\",\n        \"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439)) \u0443\u043b\u044b\u0431\u043d\u0438\u0441\u044c :)\"\n    ]\n    if message.from_user.id in (111, 777):\n        await message.answer(choice(phrases))\n    else:\n        await message.answer(\"\u042f \u0441 \u0442\u043e\u0431\u043e\u0439 \u043d\u0435 \u0440\u0430\u0437\u0433\u043e\u0432\u0430\u0440\u0438\u0432\u0430\u044e!\")\n</code></pre> <p>\u0417\u0430\u0442\u0435\u043c \u0432 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u043c\u043e\u043c\u0435\u043d\u0442 \u043c\u044b \u0440\u0435\u0448\u0430\u0435\u043c, \u0447\u0442\u043e \u043d\u0430\u0434\u043e \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0438\u0437 \u0440\u0435\u0431\u044f\u0442 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435,  \u0430 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u043c \u043d\u0430\u0448 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0430 \u0442\u0440\u0438: \u0434\u043b\u044f \u0410\u043b\u0438\u0441\u044b, \u0434\u043b\u044f \u0411\u043e\u0431\u0430 \u0438 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445:</p> <pre><code>@router.message(F.text)\nasync def greet_alice(message: Message):\n    # print(\"\u0425\u044d\u043d\u0434\u043b\u0435\u0440 \u0434\u043b\u044f \u0410\u043b\u0438\u0441\u044b\")\n    phrases = [\n        \"\u041f\u0440\u0438\u0432\u0435\u0442, {name}. \u0422\u044b \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u043a\u0440\u0430\u0441\u043e\u0442\u043a\u0430!\",\n        \"\u0422\u044b \u0441\u0430\u043c\u0430\u044f \u0443\u043c\u043d\u0430\u044f, {name}\",\n    ]\n    if message.from_user.id == 111:\n        await message.answer(\n            choice(phrases).format(name=\"\u0410\u043b\u0438\u0441\u0430\")\n        )\n\n@router.message(F.text)\nasync def greet_bob(message: Message):\n    phrases = [\n        \"\u041f\u0440\u0438\u0432\u0435\u0442, {name}. \u0422\u044b \u0441\u0430\u043c\u044b\u0439 \u0441\u0438\u043b\u044c\u043d\u044b\u0439!\",\n        \"\u0422\u044b \u043a\u0440\u0443\u0442, {name}!\",\n    ]\n    if message.from_user.id == 777:\n        await message.answer(\n            choice(phrases).format(name=\"\u0411\u043e\u0431\")\n        )\n\n@router.message(F.text)\nasync def stranger_go_away(message: Message):\n    if message.from_user.id not in (111, 777):\n        await message.answer(\"\u042f \u0441 \u0442\u043e\u0431\u043e\u0439 \u043d\u0435 \u0440\u0430\u0437\u0433\u043e\u0432\u0430\u0440\u0438\u0432\u0430\u044e!\")\n</code></pre> <p>\u041f\u0440\u0438 \u0442\u0430\u043a\u043e\u043c \u0440\u0430\u0441\u043a\u043b\u0430\u0434\u0435 \u0410\u043b\u0438\u0441\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438 \u0440\u0430\u0434\u043e\u0432\u0430\u0442\u044c\u0441\u044f. \u0410 \u0432\u043e\u0442 \u0432\u0441\u0435 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u043d\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442 \u043d\u0438\u0447\u0435\u0433\u043e, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443  \u043a\u043e\u0434 \u0431\u0443\u0434\u0435\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u0442\u044c \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>greet_alice()</code>, \u0438 \u043d\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442\u044c \u043f\u043e \u0443\u0441\u043b\u043e\u0432\u0438\u044e <code>if message.from_user.id == 111</code>.  \u0412 \u044d\u0442\u043e\u043c \u043b\u0435\u0433\u043a\u043e \u0443\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f, \u0440\u0430\u0441\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0432 \u0432\u044b\u0437\u043e\u0432 <code>print()</code>. </p> <p>\u041d\u043e \u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a? \u041e\u0442\u0432\u0435\u0442 \u043f\u0440\u043e\u0441\u0442: \u043b\u044e\u0431\u043e\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u043f\u043e\u043f\u0430\u0434\u0451\u0442 \u0432 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 <code>F.text</code> \u043d\u0430\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439  <code>greet_alice()</code>, \u044d\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u0435\u0440\u043d\u0451\u0442 <code>True</code> \u0438 \u0430\u043f\u0434\u0435\u0439\u0442 \u043f\u043e\u043f\u0430\u0434\u0451\u0442 \u0438\u043c\u0435\u043d\u043d\u043e \u0432 \u044d\u0442\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043e\u0442\u043a\u0443\u0434\u0430, \u043d\u0435 \u043f\u0440\u043e\u0439\u0434\u044f \u043f\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c\u0443  \u0443\u0441\u043b\u043e\u0432\u0438\u044e <code>if</code>, \u0432\u044b\u0439\u0434\u0435\u0442 \u0438 \u043a\u0430\u043d\u0435\u0442 \u0432 \u041b\u0435\u0442\u0443. </p> <p>\u0427\u0442\u043e\u0431\u044b \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044c \u043f\u043e\u0434\u043e\u0431\u043d\u044b\u0445 \u043a\u0430\u0437\u0443\u0441\u043e\u0432, \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442 \u0444\u0438\u043b\u044c\u0442\u0440\u044b. \u0412 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u043e\u0439 \u0431\u0443\u0434\u0435\u0442  \u00ab\u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0418 \u0430\u0439\u0434\u0438 \u044e\u0437\u0435\u0440\u0430 111\u00bb. \u0422\u043e\u0433\u0434\u0430 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435, \u043a\u043e\u0433\u0434\u0430 \u0431\u043e\u0442\u0443 \u043d\u0430\u043f\u0438\u0448\u0435\u0442 \u0411\u043e\u0431 \u0441 \u0430\u0439\u0434\u0438 777, \u0441\u043e\u0432\u043e\u043a\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432  \u0432\u0435\u0440\u043d\u0451\u0442 False, \u0438 \u0440\u043e\u0443\u0442\u0435\u0440 \u043f\u043e\u0439\u0434\u0451\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u0433\u0434\u0435 \u043e\u0431\u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u0430 \u0432\u0435\u0440\u043d\u0443\u0442 True \u0438 \u0430\u043f\u0434\u0435\u0439\u0442 \u0443\u043f\u0430\u0434\u0451\u0442 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440.  \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0437\u0433\u043b\u044f\u0434 \u0432\u044b\u0448\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0435 \u0437\u0432\u0443\u0447\u0438\u0442 \u043e\u0447\u0435\u043d\u044c \u0441\u043b\u043e\u0436\u043d\u043e, \u043d\u043e \u043a \u043a\u043e\u043d\u0446\u0443 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u044b \u0432\u044b \u043f\u043e\u0439\u043c\u0451\u0442\u0435, \u043a\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043e\u0432\u0430\u0442\u044c  \u043f\u043e\u0434\u043e\u0431\u043d\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443.</p>"},{"location":"filters-and-middlewares/#filters-as-classes","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u044b \u043a\u0430\u043a \u043a\u043b\u0430\u0441\u0441\u044b","text":"<p>\u0412 \u043e\u0442\u043b\u0438\u0447\u0438\u0435 \u043e\u0442 aiogram 2.x, \u0432 \u00ab\u0442\u0440\u043e\u0439\u043a\u0435\u00bb \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442 \u0444\u0438\u043b\u044c\u0442\u0440\u0430-\u043a\u043b\u0430\u0441\u0441\u0430 ChatTypeFilter \u043d\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0442\u0438\u043f \u0447\u0430\u0442\u0430  (\u043b\u0438\u0447\u043a\u0430, \u0433\u0440\u0443\u043f\u043f\u0430, \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0430 \u0438\u043b\u0438 \u043a\u0430\u043d\u0430\u043b). \u041d\u0430\u043f\u0438\u0448\u0435\u043c \u0435\u0433\u043e \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e. \u041f\u0443\u0441\u0442\u044c \u0443 \u044e\u0437\u0435\u0440\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0443\u0436\u043d\u044b\u0439 \u0442\u0438\u043f  \u043b\u0438\u0431\u043e \u0441\u0442\u0440\u043e\u043a\u043e\u0439, \u043b\u0438\u0431\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c (list). \u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u044c\u0441\u044f, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430\u0441 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0442 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0442\u0438\u043f\u043e\u0432,  \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0433\u0440\u0443\u043f\u043f\u044b \u0438 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u044b.</p> <p>\u041d\u0430\u0448\u0430 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435, \u0430 \u0438\u043c\u0435\u043d\u043d\u043e \u0444\u0430\u0439\u043b <code>bot.py</code>, \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0437\u043d\u0430\u043a\u043e\u043c\u043e:</p> bot.py<pre><code>import asyncio\n\nfrom aiogram import Bot, Dispatcher\n\n\nasync def main():\n    bot = Bot(token=\"TOKEN\")\n    dp = Dispatcher()\n\n    # \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u043e\u0442\u0430 \u0438 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0432\u0441\u0435 \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u044b\u0435 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435\n    # \u0414\u0430, \u044d\u0442\u043e\u0442 \u043c\u0435\u0442\u043e\u0434 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043f\u043e\u043b\u043b\u0438\u043d\u0433\n    await bot.delete_webhook(drop_pending_updates=True)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>\u0420\u044f\u0434\u043e\u043c \u0441 \u043d\u0438\u043c \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433 <code>filters</code>, \u0430 \u0432 \u043d\u0451\u043c \u0444\u0430\u0439\u043b <code>chat_type.py</code>:</p> filters/chat_type.py<pre><code>from typing import Union\n\nfrom aiogram.filters import BaseFilter\nfrom aiogram.types import Message\n\n\nclass ChatTypeFilter(BaseFilter):  # [1]\n    def __init__(self, chat_type: Union[str, list]): # [2]\n        self.chat_type = chat_type\n\n    async def __call__(self, message: Message) -&gt; bool:  # [3]\n        if isinstance(self.chat_type, str):\n            return message.chat.type == self.chat_type\n        else:\n            return message.chat.type in self.chat_type\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u043c \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u043c\u0435\u0447\u0435\u043d\u043d\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438:</p> <ol> <li>\u041d\u0430\u0448\u0438 \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043d\u0430\u0441\u043b\u0435\u0434\u0443\u044e\u0442\u0441\u044f \u043e\u0442 \u0431\u0430\u0437\u043e\u0432\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430 <code>BaseFilter</code></li> <li>\u0412 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0435 \u043a\u043b\u0430\u0441\u0441\u0430 \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0434\u0430\u0442\u044c \u0431\u0443\u0434\u0443\u0449\u0438\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u0430. \u0412 \u0434\u0430\u043d\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043c\u044b \u0437\u0430\u044f\u0432\u043b\u044f\u0435\u043c \u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 <code>chat_type</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043a\u0430\u043a \u0441\u0442\u0440\u043e\u043a\u043e\u0439 (<code>str</code>), \u0442\u0430\u043a \u0438 \u0441\u043f\u0438\u0441\u043a\u043e\u043c (<code>list</code>).</li> <li>\u0412\u0441\u0451 \u0434\u0435\u0439\u0441\u0442\u0432\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 <code>__call__()</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442, \u043a\u043e\u0433\u0434\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430  <code>ChatTypeFilter()</code> \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442 \u043a\u0430\u043a \u0444\u0443\u043d\u043a\u0446\u0438\u044e.  \u0412\u043d\u0443\u0442\u0440\u0438 \u043d\u0438\u0447\u0435\u0433\u043e \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0433\u043e: \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0442\u0438\u043f \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u043c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443.  \u041c\u044b \u0441\u0442\u0440\u0435\u043c\u0438\u043c\u0441\u044f \u043a \u0442\u043e\u043c\u0443, \u0447\u0442\u043e\u0431\u044b \u0444\u0438\u043b\u044c\u0442\u0440 \u0432\u0435\u0440\u043d\u0443\u043b \u0431\u0443\u043b\u0435\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0434\u0430\u043b\u0435\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u0442 \u0445\u044d\u043d\u0434\u043b\u0435\u0440,  \u0432\u0441\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0432\u0435\u0440\u043d\u0443\u043b\u0438 <code>True</code>.</li> </ol> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u043f\u0430\u0440\u0443 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0430\u043c <code>/dice</code> \u0438 <code>/basketball</code> \u0431\u0443\u0434\u0435\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0434\u0430\u0439\u0441  \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u0442\u0438\u043f\u0430, \u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0433\u0440\u0443\u043f\u043f\u0443. \u0421\u043e\u0437\u0434\u0430\u0451\u043c \u0444\u0430\u0439\u043b <code>handlers/group_games.py</code> \u0438 \u043f\u0438\u0448\u0435\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430\u0440\u043d\u044b\u0439 \u043a\u043e\u0434:</p> handlers/group_games.py<pre><code>from aiogram import Router\nfrom aiogram.enums.dice_emoji import DiceEmoji\nfrom aiogram.types import Message\nfrom aiogram.filters import Command\n\nfrom filters.chat_type import ChatTypeFilter\n\nrouter = Router()\n\n\n@router.message(\n    ChatTypeFilter(chat_type=[\"group\", \"supergroup\"]),\n    Command(commands=[\"dice\"]),\n)\nasync def cmd_dice_in_group(message: Message):\n    await message.answer_dice(emoji=DiceEmoji.DICE)\n\n\n@router.message(\n    ChatTypeFilter(chat_type=[\"group\", \"supergroup\"]),\n    Command(commands=[\"basketball\"]),\n)\nasync def cmd_basketball_in_group(message: Message):\n    await message.answer_dice(emoji=DiceEmoji.BASKETBALL)\n</code></pre> <p>\u0427\u0442\u043e \u0436, \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0442\u044c\u0441\u044f. \u0412\u043e-\u043f\u0435\u0440\u0432\u044b\u0445, \u043c\u044b \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u0444\u0438\u043b\u044c\u0442\u0440 <code>Command</code> \u0438 \u043d\u0430\u0448 \u0441\u0432\u0435\u0436\u0435\u043d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439  <code>ChatTypeFilter</code>. \u0412\u043e-\u0432\u0442\u043e\u0440\u044b\u0445, \u043c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u043b\u0438 \u043d\u0430\u0448 \u0444\u0438\u043b\u044c\u0442\u0440 \u043a\u0430\u043a \u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0432 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440, \u0443\u043a\u0430\u0437\u0430\u0432  \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0435 \u0442\u0438\u043f(\u044b) \u0447\u0430\u0442\u043e\u0432. \u0412-\u0442\u0440\u0435\u0442\u044c\u0438\u0445, \u0432 aiogram 2.x \u0432\u044b \u043f\u0440\u0438\u0432\u044b\u043a\u043b\u0438 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043a\u0430\u043a <code>commands=...</code>, \u043e\u0434\u043d\u0430\u043a\u043e \u0432 aiogram 3 \u044d\u0442\u043e\u0433\u043e \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442,  \u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0442\u0430\u043a \u0436\u0435, \u043a\u0430\u043a \u0438 \u0441\u0432\u043e\u0438, \u0447\u0435\u0440\u0435\u0437 \u0438\u043c\u043f\u043e\u0440\u0442 \u0438 \u0432\u044b\u0437\u043e\u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043a\u043b\u0430\u0441\u0441\u043e\u0432.  \u0420\u043e\u0432\u043d\u043e \u044d\u0442\u043e \u043c\u044b \u0432\u0438\u0434\u0438\u043c \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0435 \u0441 \u0432\u044b\u0437\u043e\u0432\u043e\u043c <code>Command(commands=\"somecommand\")</code> \u0438\u043b\u0438 \u043a\u0440\u0430\u0442\u043a\u043e: <code>Command(\"somecommand\")</code></p> <p>\u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0441 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430\u043c\u0438 \u0432 \u0442\u043e\u0447\u043a\u0443 \u0432\u0445\u043e\u0434\u0430 \u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440 \u043a \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0443 (\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u044b \u043d\u043e\u0432\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438):</p> bot.py<pre><code>import asyncio\n\nfrom aiogram import Bot, Dispatcher\n\nfrom handlers import group_games\n\n\nasync def main():\n    bot = Bot(token=\"TOKEN\")\n    dp = Dispatcher()\n\n    dp.include_router(group_games.router)\n\n    # \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u043e\u0442\u0430 \u0438 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0432\u0441\u0435 \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u044b\u0435 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435\n    # \u0414\u0430, \u044d\u0442\u043e\u0442 \u043c\u0435\u0442\u043e\u0434 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043f\u043e\u043b\u043b\u0438\u043d\u0433\n    await bot.delete_webhook(drop_pending_updates=True)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c:</p> <p></p> <p>\u0412\u0440\u043e\u0434\u0435 \u0432\u0441\u0451 \u0445\u043e\u0440\u043e\u0448\u043e, \u043d\u043e \u0447\u0442\u043e, \u0435\u0441\u043b\u0438 \u0443 \u043d\u0430\u0441 \u0431\u0443\u0434\u0435\u0442 \u043d\u0435 2 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430, \u0430 10? \u041f\u0440\u0438\u0434\u0451\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043d\u0430\u0448  \u0444\u0438\u043b\u044c\u0442\u0440 \u0438 \u043d\u0438\u0433\u0434\u0435 \u043d\u0435 \u0437\u0430\u0431\u044b\u0442\u044c. \u041a \u0441\u0447\u0430\u0441\u0442\u044c\u044e, \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043c\u043e\u0436\u043d\u043e \u0446\u0435\u043f\u043b\u044f\u0442\u044c \u043f\u0440\u044f\u043c\u043e \u043d\u0430 \u0440\u043e\u0443\u0442\u0435\u0440\u044b! \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430  \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0440\u043e\u0432\u043d\u043e \u043e\u0434\u0438\u043d \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u0430\u043f\u0434\u0435\u0439\u0442 \u0434\u043e\u043b\u0435\u0442\u0438\u0442 \u0434\u043e \u044d\u0442\u043e\u0433\u043e \u0440\u043e\u0443\u0442\u0435\u0440\u0430. \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u0435\u0437\u043d\u043e,  \u0435\u0441\u043b\u0438 \u0432 \u0444\u0438\u043b\u044c\u0442\u0440\u0435 \u0432\u044b \u0434\u0435\u043b\u0430\u0435\u0442\u0435 \u0440\u0430\u0437\u043d\u044b\u0435 \u00ab\u0442\u044f\u0436\u0435\u043b\u044b\u0435\u00bb \u0437\u0430\u0434\u0430\u0447\u0438, \u0442\u0438\u043f\u0430 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f \u043a Bot API; \u0438\u043d\u0430\u0447\u0435 \u043c\u043e\u0436\u043d\u043e  \u043b\u0435\u0433\u043a\u043e \u0441\u043b\u043e\u0432\u0438\u0442\u044c \u0444\u043b\u0443\u0434\u0432\u0435\u0439\u0442.</p> <p>\u0422\u0430\u043a \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043d\u0430\u0448 \u0444\u0430\u0439\u043b \u0441 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043b\u044f \u0434\u0430\u0439\u0441\u043e\u0432 \u0432 \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u043c \u0432\u0438\u0434\u0435:</p> handlers/group_games.py<pre><code>from aiogram import Router\nfrom aiogram.enums.dice_emoji import DiceEmoji\nfrom aiogram.filters import Command\nfrom aiogram.types import Message\n\nfrom filters.chat_type import ChatTypeFilter\n\nrouter = Router()\nrouter.message.filter(\n    ChatTypeFilter(chat_type=[\"group\", \"supergroup\"])\n)\n\n\n@router.message(Command(\"dice\"))\nasync def cmd_dice_in_group(message: Message):\n    await message.answer_dice(emoji=DiceEmoji.DICE)\n\n\n@router.message(Command(\"basketball\"))\nasync def cmd_basketball_in_group(message: Message):\n    await message.answer_dice(emoji=DiceEmoji.BASKETBALL)\n</code></pre> <p>\u0412\u043e\u043e\u0431\u0449\u0435 \u0433\u043e\u0432\u043e\u0440\u044f, \u0442\u0430\u043a\u043e\u0439 \u0444\u0438\u043b\u044c\u0442\u0440 \u043d\u0430 \u0442\u0438\u043f \u0447\u0430\u0442\u0430 \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0447\u0443\u0442\u044c \u0438\u043d\u0430\u0447\u0435. \u041d\u0435\u0441\u043c\u043e\u0442\u0440\u044f \u043d\u0430 \u0442\u043e,  \u0447\u0442\u043e \u0442\u0438\u043f\u043e\u0432 \u0447\u0430\u0442\u043e\u0432 \u0443 \u043d\u0430\u0441 \u0447\u0435\u0442\u044b\u0440\u0435 (\u041b\u0421, \u0433\u0440\u0443\u043f\u043f\u0430, \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0430, \u043a\u0430\u043d\u0430\u043b), \u0430\u043f\u0434\u0435\u0439\u0442 \u0442\u0438\u043f\u0430 <code>message</code>  \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043b\u0435\u0442\u0430\u0442\u044c \u0438\u0437 \u043a\u0430\u043d\u0430\u043b\u043e\u0432, \u0442.\u043a. \u0443 \u043d\u0438\u0445 \u0441\u0432\u043e\u0439 \u0430\u043f\u0434\u0435\u0439\u0442 <code>channel_post</code>. \u0410 \u043a\u043e\u0433\u0434\u0430 \u043c\u044b  \u0444\u0438\u043b\u044c\u0442\u0440\u0443\u0435\u043c \u0433\u0440\u0443\u043f\u043f\u044b, \u043e\u0431\u044b\u0447\u043d\u043e \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e, \u043e\u0431\u044b\u0447\u043d\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0430 \u0438\u043b\u0438 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0430, \u043b\u0438\u0448\u044c \u0431\u044b \u043d\u0435 \u043b\u0438\u0447\u043a\u0430.</p> <p>\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0441\u0430\u043c \u0444\u0438\u043b\u044c\u0442\u0440 \u043c\u043e\u0436\u043d\u043e \u0441\u0432\u0435\u0441\u0442\u0438 \u043a \u0443\u0441\u043b\u043e\u0432\u043d\u043e\u043c\u0443 <code>ChatTypeFilter(is_group=True/False)</code> \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c, \u041b\u0421 \u0438\u043b\u0438 \u043d\u0435 \u041b\u0421. \u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043e\u0441\u0442\u0430\u0451\u0442\u0441\u044f \u043d\u0430 \u0443\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u0438\u0435 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f.</p> <p>\u041f\u043e\u043c\u0438\u043c\u043e True/False, \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043c\u043e\u0433\u0443\u0442 \u0447\u0442\u043e-\u0442\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b, \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440. \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u044c\u0441\u044f,  \u043a\u043e\u0433\u0434\u0430 \u043c\u044b \u043d\u0435 \u0445\u043e\u0442\u0438\u043c \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0443\u0436\u0435 \u044d\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u043b\u0438 \u0432 \u0444\u0438\u043b\u044c\u0442\u0440\u0435. \u0427\u0442\u043e\u0431\u044b  \u0441\u0442\u0430\u043b\u043e \u043f\u043e\u043d\u044f\u0442\u043d\u0435\u0435, \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0444\u0438\u043b\u044c\u0442\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435, \u0435\u0441\u043b\u0438 \u0432 \u043d\u0451\u043c \u0435\u0441\u0442\u044c \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u044b, \u0430 \u0437\u0430\u043e\u0434\u043d\u043e  \u00ab\u043f\u0440\u043e\u0442\u043e\u043b\u043a\u043d\u0451\u0442\u00bb \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.</p> <p>\u0412 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 filters \u0441\u043e\u0437\u0434\u0430\u0451\u043c \u043d\u043e\u0432\u044b\u0439 \u0444\u0430\u0439\u043b <code>find_usernames.py</code>:</p> filters/find_usernames.py<pre><code>from typing import Union, Dict, Any\n\nfrom aiogram.filters import BaseFilter\nfrom aiogram.types import Message\n\n\nclass HasUsernamesFilter(BaseFilter):\n    async def __call__(self, message: Message) -&gt; Union[bool, Dict[str, Any]]:\n        # \u0415\u0441\u043b\u0438 entities \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0435\u0442, \u0432\u0435\u0440\u043d\u0451\u0442\u0441\u044f None,\n        # \u0432 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0441\u0447\u0438\u0442\u0430\u0435\u043c, \u0447\u0442\u043e \u044d\u0442\u043e \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\n        entities = message.entities or []\n\n        # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043b\u044e\u0431\u044b\u0435 \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u044b \u0438 \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u0438\u0445 \u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430\n        # \u043c\u0435\u0442\u043e\u0434\u043e\u043c extract_from(). \u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \u0441\u043c. \u0433\u043b\u0430\u0432\u0443\n        # \u043f\u0440\u043e \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438\n        found_usernames = [\n            item.extract_from(message.text) for item in entities\n            if item.type == \"mention\"\n        ]\n\n        # \u0415\u0441\u043b\u0438 \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u044b \u0435\u0441\u0442\u044c, \u0442\u043e \"\u043f\u0440\u043e\u0442\u0430\u043b\u043a\u0438\u0432\u0430\u0435\u043c\" \u0438\u0445 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\n        # \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \"usernames\"\n        if len(found_usernames) &gt; 0:\n            return {\"usernames\": found_usernames}\n        # \u0415\u0441\u043b\u0438 \u043d\u0435 \u043d\u0430\u0448\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430, \u0432\u0435\u0440\u043d\u0451\u043c False\n        return False\n</code></pre> <p>\u0418 \u0441\u043e\u0437\u0434\u0430\u0451\u043c \u043d\u043e\u0432\u044b\u0439 \u0444\u0430\u0439\u043b \u0441 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u043c:</p> handlers/usernames.py<pre><code>from typing import List\n\nfrom aiogram import Router, F\nfrom aiogram.types import Message\n\nfrom filters.find_usernames import HasUsernamesFilter\n\nrouter = Router()\n\n\n@router.message(\n    F.text,\n    HasUsernamesFilter()\n)\nasync def message_with_usernames(\n        message: Message,\n        usernames: List[str]\n):\n    await message.reply(\n        f'\u0421\u043f\u0430\u0441\u0438\u0431\u043e! \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u0434\u043f\u0438\u0448\u0443\u0441\u044c \u043d\u0430 '\n        f'{\", \".join(usernames)}'\n    )\n</code></pre> <p>\u0412 \u0441\u043b\u0443\u0447\u0430\u0435 \u043d\u0430\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u043e\u0433\u043e \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430 \u0444\u0438\u043b\u044c\u0442\u0440 <code>HasUsernamesFilter</code> \u0432\u0435\u0440\u043d\u0451\u0442 \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e <code>True</code>, \u0430  \u0441\u043b\u043e\u0432\u0430\u0440\u044c, \u0433\u0434\u0435 \u0438\u0437\u0432\u043b\u0435\u0447\u0451\u043d\u043d\u044b\u0435 \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u044b \u0431\u0443\u0434\u0443\u0442 \u043b\u0435\u0436\u0430\u0442\u044c \u043f\u043e\u0434 \u043a\u043b\u044e\u0447\u043e\u043c <code>usernames</code>. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435, \u043d\u0430  \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430\u0432\u0435\u0448\u0430\u043d \u044d\u0442\u043e\u0442 \u0444\u0438\u043b\u044c\u0442\u0440, \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0441 \u0442\u043e\u0447\u043d\u043e \u0442\u0430\u043a\u0438\u043c \u0436\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u044e-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a. \u0412\u0443\u0430\u043b\u044f!  \u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0435\u0442 \u043d\u0443\u0436\u0434\u044b \u0435\u0449\u0451 \u0440\u0430\u0437 \u043f\u0430\u0440\u0441\u0438\u0442\u044c \u0432\u0441\u0451 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438 \u0441\u043d\u043e\u0432\u0430 \u0432\u044b\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u043e\u0432: </p> <p></p>"},{"location":"filters-and-middlewares/#magic-filters","title":"\u041c\u0430\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b","text":"<p>\u041f\u043e\u0441\u043b\u0435 \u0437\u043d\u0430\u043a\u043e\u043c\u0441\u0442\u0432\u0430 \u0441 <code>ChatTypeFilter</code> \u0438\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u0430, \u043a\u0442\u043e-\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0432\u043e\u0441\u043a\u043b\u0438\u043a\u043d\u0443\u0442\u044c:  \u00ab\u0430 \u0437\u0430\u0447\u0435\u043c \u0432\u043e\u043e\u0431\u0449\u0435 \u0442\u0430\u043a \u0441\u043b\u043e\u0436\u043d\u043e, \u0435\u0441\u043b\u0438 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043b\u044f\u043c\u0431\u0434\u043e\u0439:  <code>lambda m: m.chat.type in (\"group\", \"supergroup\")</code>\u00bb? \u0418 \u0432\u044b \u043f\u0440\u0430\u0432\u044b! \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e, \u0434\u043b\u044f \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445  \u043f\u0440\u043e\u0441\u0442\u044b\u0445 \u0441\u043b\u0443\u0447\u0430\u0435\u0432, \u043a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439  \u0444\u0430\u0439\u043b \u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u043c, \u043f\u043e\u0442\u043e\u043c \u0435\u0433\u043e \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0441\u043c\u044b\u0441\u043b\u0430 \u043c\u0430\u043b\u043e. </p> <p>\u0410\u043b\u0435\u043a\u0441, \u043e\u0441\u043d\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0438 \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a aiogram, \u043d\u0430\u043f\u0438\u0441\u0430\u043b \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443  magic-filter, \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u044e\u0449\u0443\u044e \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435  \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 (\u044d\u0434\u0430\u043a\u0438\u0439 <code>getattr</code> \u043d\u0430 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u043a\u0430\u0445). \u0411\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u043e\u043d\u0430 \u0443\u0436\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 aiogram 3.x.  \u0415\u0441\u043b\u0438 \u0432\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0438 \u0441\u0435\u0431\u0435 \u00ab\u0442\u0440\u043e\u0439\u043a\u0443\u00bb, \u0437\u043d\u0430\u0447\u0438\u0442, \u0443 \u0432\u0430\u0441 \u0443\u0436\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d magic-filter.</p> <p>\u0411\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0430 magic-filter \u0442\u0430\u043a\u0436\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u0432 PyPi  \u0438 \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 aiogram \u0432 \u0434\u0440\u0443\u0433\u0438\u0445 \u0432\u0430\u0448\u0438\u0445 \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445. \u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438  \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u0432 aiogram \u0432\u0430\u043c \u0431\u0443\u0434\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043e\u0434\u043d\u0430 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0444\u0438\u0447\u0430, \u043e \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0440\u0435\u0447\u044c \u043f\u043e\u0439\u0434\u0451\u0442  \u0434\u0430\u043b\u0435\u0435 \u0432 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435</p> <p>\u0414\u043e\u0432\u043e\u043b\u044c\u043d\u043e \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u00ab\u043c\u0430\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u00bb \u043e\u043f\u0438\u0441\u0430\u043d\u044b \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 aiogram, \u0437\u0434\u0435\u0441\u044c \u0436\u0435  \u043c\u044b \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043c\u0441\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043c\u043e\u043c\u0435\u043d\u0442\u0430\u0445.</p> <p>\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0432\u0441\u043f\u043e\u043c\u043d\u0438\u043c, \u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u00ab\u043a\u043e\u043d\u0442\u0435\u043d\u0442-\u0442\u0430\u0439\u043f\u00bb \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f. \u0422\u0430\u043a\u043e\u0433\u043e \u043f\u043e\u043d\u044f\u0442\u0438\u044f \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 Bot API, \u043d\u043e \u043e\u043d\u043e  \u0435\u0441\u0442\u044c \u0438 \u0432 pyTelegramBotAPI, \u0438 \u0432 aiogram. \u0418\u0434\u0435\u044f \u043f\u0440\u043e\u0441\u0442\u0430\u044f: \u0435\u0441\u043b\u0438 \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0435  Message \u043f\u043e\u043b\u0435 <code>photo</code> \u043d\u0435\u043f\u0443\u0441\u0442\u043e\u0435 (\u0442.\u0435. \u043d\u0435 \u0440\u0430\u0432\u043d\u043e <code>None</code>  \u0432 Python), \u0437\u043d\u0430\u0447\u0438\u0442, \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435, \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u0441\u0447\u0438\u0442\u0430\u0435\u043c, \u0447\u0442\u043e \u0435\u0433\u043e  \u043a\u043e\u043d\u0442\u0435\u043d\u0442-\u0442\u0430\u0439\u043f \u0440\u0430\u0432\u0435\u043d <code>photo</code>. \u0418 \u0442\u0430\u043c\u043e\u0448\u043d\u0438\u0439 \u0444\u0438\u043b\u044c\u0442\u0440 <code>content_types=\"photo\"</code> \u0431\u0443\u0434\u0435\u0442 \u043b\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0430\u043a\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f,  \u0438\u0437\u0431\u0430\u0432\u043b\u044f\u044f \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430 \u043e\u0442 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u044d\u0442\u043e\u0442 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 \u0432\u043d\u0443\u0442\u0440\u0438 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430.</p> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0435\u0442\u0440\u0443\u0434\u043d\u043e \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u044c, \u0447\u0442\u043e \u043b\u044f\u043c\u0431\u0434\u0430-\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435 \u0437\u0432\u0443\u0447\u0438\u0442 \u043a\u0430\u043a  \u00ab\u0430\u0442\u0440\u0438\u0431\u0443\u0442 'photo' \u0443 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 'm' \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0440\u0430\u0432\u0435\u043d None\u00bb, \u043d\u0430 Python \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043a\u0430\u043a  <code>lambda m: m.photo is not None</code>, \u0438\u043b\u0438, \u0447\u0443\u0442\u044c \u0443\u043f\u0440\u043e\u0441\u0442\u0438\u0432, <code>lambda m: m.photo</code>. \u0410 \u0441\u0430\u043c <code>m</code> \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f  \u0442\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c, \u043a\u043e\u0433\u043e \u043c\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u0443\u0435\u043c. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043e\u0431\u044a\u0435\u043a\u0442 \u0442\u0438\u043f\u0430 <code>Message</code></p> <p>Magic-filter \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u0443\u044e \u0432\u0435\u0449\u044c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0434\u043e \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043b\u0430\u0441\u0441 <code>MagicFilter</code> \u0438\u0437 aiogram,  \u043d\u043e \u043c\u044b \u0435\u0433\u043e \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u043d\u0435 \u043f\u043e \u043f\u043e\u043b\u043d\u043e\u043c\u0443 \u0438\u043c\u0435\u043d\u0438, \u0430 \u043f\u043e \u043e\u0434\u043d\u043e\u0431\u0443\u043a\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0430\u043b\u0438\u0430\u0441\u0443 <code>F</code>:</p> <pre><code>from aiogram import F\n\n# \u0417\u0434\u0435\u0441\u044c F - \u044d\u0442\u043e message\n@router.message(F.photo)\nasync def photo_msg(message: Message):\n    await message.answer(\"\u042d\u0442\u043e \u0442\u043e\u0447\u043d\u043e \u043a\u0430\u043a\u043e\u0435-\u0442\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435!\")\n</code></pre> <p>\u0412\u043c\u0435\u0441\u0442\u043e \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 <code>ContentTypesFilter(content_types=\"photo\")</code> \u043d\u043e\u0432\u044b\u0439 <code>F.photo</code>. \u0423\u0434\u043e\u0431\u043d\u043e! \u0418 \u0442\u0435\u043f\u0435\u0440\u044c,  \u043e\u0431\u043b\u0430\u0434\u0430\u044f \u0442\u0430\u043a\u0438\u043c \u0441\u0430\u043a\u0440\u0430\u043b\u044c\u043d\u044b\u043c \u0437\u043d\u0430\u043d\u0438\u0435\u043c, \u043c\u044b \u043b\u0435\u0433\u043a\u043e \u043c\u043e\u0436\u0435\u043c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440 <code>ChatTypeFilter</code> \u043d\u0430 \u043c\u0430\u0433\u0438\u044e: <code>router.message.filter(F.chat.type.in_({\"group\", \"supergroup\"}))</code>. \u0411\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u0434\u0430\u0436\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043d\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442-\u0442\u0430\u0439\u043f\u044b \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 \u0432\u0438\u0434\u0435 \u043c\u0430\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0444\u0438\u043b\u044c\u0442\u0440\u0430: <code>F.content_type.in_({'text', 'sticker', 'photo'})</code> \u0438\u043b\u0438 <code>F.photo | F.text | F.sticker</code>.</p> <p>\u0422\u0430\u043a\u0436\u0435 \u0441\u0442\u043e\u0438\u0442 \u043f\u043e\u043c\u043d\u0438\u0442\u044c, \u0447\u0442\u043e \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043c\u043e\u0436\u043d\u043e \u0432\u0435\u0448\u0430\u0442\u044c \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 Message, \u043d\u043e \u0438 \u043d\u0430 \u043b\u044e\u0431\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u0435  \u0442\u0438\u043f\u044b \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432: \u043a\u043e\u043b\u0431\u044d\u043a\u0438, \u0438\u043d\u043b\u0430\u0439\u043d-\u0437\u0430\u043f\u0440\u043e\u0441\u044b, (my_)chat_member \u0438 \u0434\u0440\u0443\u0433\u0438\u0435.</p> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0430 \u0442\u0443 \u0441\u0430\u043c\u0443\u044e \u00ab\u044d\u043a\u0441\u043a\u043b\u044e\u0437\u0438\u0432\u043d\u0443\u044e\u00bb \u0444\u0438\u0447\u0443 magic-filter \u0432 \u0441\u043e\u0441\u0442\u0430\u0432\u0435 aiogram 3.x. \u0420\u0435\u0447\u044c \u043f\u0440\u043e  \u043c\u0435\u0442\u043e\u0434 <code>as_(&lt;some text&gt;)</code>, \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0449\u0438\u0439 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0444\u0438\u043b\u044c\u0442\u0440\u0430 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430. \u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439  \u043f\u0440\u0438\u043c\u0435\u0440, \u0447\u0442\u043e\u0431\u044b \u0441\u0442\u0430\u043b\u043e \u043f\u043e\u043d\u044f\u0442\u043d\u043e: \u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0441 \u0444\u043e\u0442\u043e \u044d\u0442\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u043b\u0435\u0442\u0430\u044e\u0442 \u043c\u0430\u0441\u0441\u0438\u0432\u043e\u043c, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0431\u044b\u0447\u043d\u043e  \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0438\u044f \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u043c\u043e\u0436\u043d\u043e \u0441\u0440\u0430\u0437\u0443 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0444\u043e\u0442\u043a\u0438  \u0441 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u043c:</p> <pre><code>from aiogram.types import Message, PhotoSize\n\n@router.message(F.photo[-1].as_(\"largest_photo\"))\nasync def forward_from_channel_handler(message: Message, largest_photo: PhotoSize) -&gt; None:\n    print(largest_photo.width, largest_photo.height)\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u043e\u0441\u043b\u043e\u0436\u043d\u0435\u0435. \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043e \u043e\u0442 \u0430\u043d\u043e\u043d\u0438\u043c\u043d\u044b\u0445 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u044b  \u0438\u043b\u0438 \u0438\u0437 \u043a\u0430\u043a\u043e\u0433\u043e-\u043b\u0438\u0431\u043e \u043a\u0430\u043d\u0430\u043b\u0430, \u0442\u043e \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 <code>Message</code> \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u043f\u0443\u0441\u0442\u044b\u043c \u043f\u043e\u043b\u0435 <code>forward_from_chat</code> \u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c  \u0442\u0438\u043f\u0430 <code>Chat</code> \u0432\u043d\u0443\u0442\u0440\u0438. \u0412\u043e\u0442 \u043a\u0430\u043a \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0433\u043b\u044f\u0434\u0435\u0442\u044c \u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043f\u043e\u043b\u0435 <code>forward_from_chat</code>  \u043d\u0435\u043f\u0443\u0441\u0442\u043e\u0435, \u0430 \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 <code>Chat</code> \u043f\u043e\u043b\u0435 <code>type</code> \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u043d\u043e <code>channel</code> (\u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043e\u0442\u0441\u0435\u043a\u0430\u0435\u043c \u0444\u043e\u0440\u0432\u0430\u0440\u0434\u044b \u043e\u0442 \u0430\u043d\u043e\u043d\u0438\u043c\u043d\u044b\u0445  \u0430\u0434\u043c\u0438\u043d\u043e\u0432, \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0444\u043e\u0440\u0432\u0430\u0440\u0434\u044b \u0438\u0437 \u043a\u0430\u043d\u0430\u043b\u043e\u0432):</p> <pre><code>from aiogram import F\nfrom aiogram.types import Message, Chat\n\n@router.message(F.forward_from_chat[F.type == \"channel\"].as_(\"channel\"))\nasync def forwarded_from_channel(message: Message, channel: Chat):\n    await message.answer(f\"This channel's ID is {channel.id}\")\n</code></pre> <p>\u0415\u0449\u0451 \u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440. \u041f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 magic-filter \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0441\u043f\u0438\u0441\u043a\u0430 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043a\u0430\u043a\u043e\u043c\u0443-\u043d\u0438\u0431\u0443\u0434\u044c \u043f\u0440\u0438\u0437\u043d\u0430\u043a\u0443:</p> <pre><code>from aiogram.enums import MessageEntityType\n\n@router.message(F.entities[:].type == MessageEntityType.EMAIL)\nasync def all_emails(message: Message):\n    await message.answer(\"All entities are emails\")\n\n\n@router.message(F.entities[...].type == MessageEntityType.EMAIL)\nasync def any_emails(message: Message):\n    await message.answer(\"At least one email!\")\n</code></pre>"},{"location":"filters-and-middlewares/#magic-data","title":"MagicData","text":"<p>\u041d\u0430\u043a\u043e\u043d\u0435\u0446, \u0441\u043b\u0435\u0433\u043a\u0430 \u0437\u0430\u0442\u0440\u043e\u043d\u0435\u043c MagicData. \u042d\u0442\u043e\u0442 \u0444\u0438\u043b\u044c\u0442\u0440  \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u0434\u043d\u044f\u0442\u044c\u0441\u044f \u043d\u0430 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0432\u044b\u0448\u0435 \u0432 \u043f\u043b\u0430\u043d\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432, \u0438 \u043e\u043f\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u0438\u043b\u0438  \u0432 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440/\u043f\u043e\u043b\u043b\u0438\u043d\u0433/\u0432\u0435\u0431\u0445\u0443\u043a. \u041f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c, \u0443 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0439 \u0431\u043e\u0442. \u0418 \u0432\u043e\u0442 \u043d\u0430\u0441\u0442\u0430\u043b\u043e \u0432\u0440\u0435\u043c\u044f  \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u0442\u0435\u0445.\u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u0435: \u0437\u0430\u0431\u044d\u043a\u0430\u043f\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445, \u043f\u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043b\u043e\u0433\u0438 \u0438 \u0442.\u0434. \u041d\u043e \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u043d\u0435 \u0445\u043e\u0447\u0435\u0442\u0441\u044f \u0437\u0430\u0442\u044b\u043a\u0430\u0442\u044c \u0431\u043e\u0442\u0430,  \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0442\u0435\u0440\u044f\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0430\u0443\u0434\u0438\u0442\u043e\u0440\u0438\u044e: \u043f\u0443\u0441\u0442\u044c \u043e\u043d \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c, \u043c\u043e\u043b, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e. </p> <p>\u041e\u0434\u043d\u043e \u0438\u0437 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0445 \u0440\u0435\u0448\u0435\u043d\u0438\u0439 \u2014 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u043a\u043e\u043b\u0431\u044d\u043a\u0438 \u0438 \u0434\u0440., \u0435\u0441\u043b\u0438  \u043a\u0430\u043a\u0438\u043c-\u043b\u0438\u0431\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u0432 \u0431\u043e\u0442\u0430 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043e \u0431\u0443\u043b\u0435\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 maintenance_mode, \u0440\u0430\u0432\u043d\u043e\u0435 <code>True</code>. \u041f\u0440\u043e\u0441\u0442\u0435\u043d\u044c\u043a\u0438\u0439 \u043e\u0434\u043d\u043e\u0444\u0430\u0439\u043b\u043e\u0432\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440 \u0434\u043b\u044f  \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u044d\u0442\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043d\u0438\u0436\u0435: </p> <pre><code>import asyncio\nimport logging\nimport sys\n\nfrom aiogram import Bot, Dispatcher, Router, F\nfrom aiogram.filters import MagicData, CommandStart\nfrom aiogram.types import Message, CallbackQuery\nfrom aiogram.utils.keyboard import InlineKeyboardBuilder\n\n# \u0421\u043e\u0437\u0434\u0430\u0451\u043c \u0440\u043e\u0443\u0442\u0435\u0440 \u0434\u043b\u044f \u0440\u0435\u0436\u0438\u043c\u0430 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u0438 \u0441\u0442\u0430\u0432\u0438\u043c \u0435\u043c\u0443 \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u043d\u0430 \u0442\u0438\u043f\u044b\nmaintenance_router = Router()\nmaintenance_router.message.filter(MagicData(F.maintenance_mode.is_(True)))\nmaintenance_router.callback_query.filter(MagicData(F.maintenance_mode.is_(True)))\n\nregular_router = Router()\n\n# \u0425\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u044d\u0442\u043e\u0433\u043e \u0440\u043e\u0443\u0442\u0435\u0440\u0430 \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044f\u0442 \u0432\u0441\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438 \u043a\u043e\u043b\u0431\u044d\u043a\u0438, \n# \u0435\u0441\u043b\u0438 maintenance_mode \u0440\u0430\u0432\u0435\u043d True\n@maintenance_router.message()\nasync def any_message(message: Message):\n    await message.answer(\"\u0411\u043e\u0442 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.\")\n\n\n@maintenance_router.callback_query()\nasync def any_callback(callback: CallbackQuery):\n    await callback.answer(\n        text=\"\u0411\u043e\u0442 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435\",\n        show_alert=True\n    )\n\n# \u0425\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u044d\u0442\u043e\u0433\u043e \u0440\u043e\u0443\u0442\u0435\u0440\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0412\u041d\u0415 \u0440\u0435\u0436\u0438\u043c\u0430 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f,\n# \u0442.\u0435. \u043a\u043e\u0433\u0434\u0430 maintenance_mode \u0440\u0430\u0432\u0435\u043d False \u0438\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0432\u043e\u043e\u0431\u0449\u0435\n@regular_router.message(CommandStart())\nasync def cmd_start(message: Message):\n    builder = InlineKeyboardBuilder()\n    builder.button(text=\"\u041d\u0430\u0436\u043c\u0438 \u043c\u0435\u043d\u044f\", callback_data=\"anything\")\n    await message.answer(\n        text=\"\u041a\u0430\u043a\u043e\u0439-\u0442\u043e \u0442\u0435\u043a\u0441\u0442 \u0441 \u043a\u043d\u043e\u043f\u043a\u043e\u0439\",\n        reply_markup=builder.as_markup()\n    )\n\n\n@regular_router.callback_query(F.data == \"anything\")\nasync def callback_anything(callback: CallbackQuery):\n    await callback.answer(\n        text=\"\u042d\u0442\u043e \u043a\u0430\u043a\u043e\u0435-\u0442\u043e \u043e\u0431\u044b\u0447\u043d\u043e\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435\",\n        show_alert=True\n    )\n\n\nasync def main() -&gt; None:\n    bot = Bot('1234567890:AaBbCcDdEeFfGrOoShAHhIiJjKkLlMmNnOo')\n    # \u0412 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0436\u0438\u0437\u043d\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 maintenance_mode\n    # \u0431\u0443\u0434\u0435\u0442 \u0432\u0437\u044f\u0442\u043e \u0438\u0437 \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0435\u0433\u043e \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u043e\u043d\u0444\u0438\u0433 \u0438\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 API)\n    # \u041f\u043e\u043c\u043d\u0438\u0442\u0435, \u0447\u0442\u043e \u0442.\u043a. bool \u0442\u0438\u043f \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u043c\u043c\u0443\u0442\u0430\u0431\u0435\u043b\u044c\u043d\u044b\u043c,\n    # \u0435\u0433\u043e \u0441\u043c\u0435\u043d\u0430 \u0432 \u0440\u0430\u043d\u0442\u0430\u0439\u043c\u0435 \u043d\u0438 \u043d\u0430 \u0447\u0442\u043e \u043d\u0435 \u043f\u043e\u0432\u043b\u0438\u044f\u0435\u0442\n    dp = Dispatcher(maintenance_mode=True)\n    # Maintenance-\u0440\u043e\u0443\u0442\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439\n    dp.include_routers(maintenance_router, regular_router)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    logging.basicConfig(level=logging.INFO, stream=sys.stdout)\n    asyncio.run(main())\n</code></pre> <p>\u0412\u0441\u0435\u0433\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u043c\u0435\u0440\u0443</p> <p>Magic-filter \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0434\u043e\u0432\u043e\u043b\u044c\u043d\u043e \u043c\u043e\u0449\u043d\u044b\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0434\u043b\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0438 \u0438 \u043f\u043e\u0440\u043e\u0439 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043a\u043e\u043c\u043f\u0430\u043a\u0442\u043d\u043e \u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043b\u043e\u0436\u043d\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443,  \u043d\u043e \u044d\u0442\u043e \u043d\u0435 \u043f\u0430\u043d\u0430\u0446\u0435\u044f \u0438 \u043d\u0435 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0435 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u043e. \u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0445\u043e\u0434\u0443 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439 \u043c\u0430\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0444\u0438\u043b\u044c\u0442\u0440,  \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0436\u0438\u0432\u0430\u0442\u044c; \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u043a\u043b\u0430\u0441\u0441-\u0444\u0438\u043b\u044c\u0442\u0440.  \u041d\u0438\u043a\u0442\u043e \u0432\u0430\u0441 \u0437\u0430 \u044d\u0442\u043e \u043d\u0435 \u043e\u0441\u0443\u0434\u0438\u0442.</p>"},{"location":"filters-and-middlewares/#middlewares","title":"\u041c\u0438\u0434\u043b\u0432\u0430\u0440\u0438","text":""},{"location":"filters-and-middlewares/#why-middlewares","title":"\u0417\u0430\u0447\u0435\u043c \u043d\u0443\u0436\u043d\u044b \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438?","text":"<p>\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435, \u0447\u0442\u043e \u0432\u044b \u043f\u0440\u0438\u0448\u043b\u0438 \u0432 \u043d\u043e\u0447\u043d\u043e\u0439 \u043a\u043b\u0443\u0431 \u0441 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0446\u0435\u043b\u044c\u044e (\u043f\u043e\u0441\u043b\u0443\u0448\u0430\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443, \u0432\u044b\u043f\u0438\u0442\u044c \u043a\u043e\u043a\u0442\u0435\u0439\u043b\u044c,  \u043f\u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u043b\u044e\u0434\u044c\u043c\u0438). \u0410 \u043d\u0430 \u0432\u0445\u043e\u0434\u0435 \u0441\u0442\u043e\u0438\u0442 \u043e\u0445\u0440\u0430\u043d\u043d\u0438\u043a. \u041e\u043d \u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u0441 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c,  \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u0430\u0441\u043f\u043e\u0440\u0442 \u0438 \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u0435, \u0437\u0430\u0439\u0434\u0451\u0442\u0435 \u0432\u044b \u0438\u043b\u0438 \u043d\u0435\u0442, \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0434\u0430\u0442\u044c \u0431\u0443\u043c\u0430\u0436\u043d\u044b\u0439 \u0431\u0440\u0430\u0441\u043b\u0435\u0442, \u0447\u0442\u043e\u0431\u044b  \u043f\u043e\u0442\u043e\u043c \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0445 \u0433\u043e\u0441\u0442\u0435\u0439 \u043e\u0442 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e \u0437\u0430\u0431\u043b\u0443\u0434\u0448\u0438\u0445, \u0430 \u043c\u043e\u0436\u0435\u0442 \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0435 \u043f\u0443\u0441\u0442\u0438\u0442\u044c, \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0432 \u0434\u043e\u043c\u043e\u0439.</p> <p>\u0412 \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u043b\u043e\u0433\u0438\u0438 aiogram \u0432\u044b \u2014 \u044d\u0442\u043e \u0430\u043f\u0434\u0435\u0439\u0442, \u043d\u043e\u0447\u043d\u043e\u0439 \u043a\u043b\u0443\u0431 \u2014 \u043d\u0430\u0431\u043e\u0440 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432, \u0430 \u043e\u0445\u0440\u0430\u043d\u043d\u0438\u043a \u043d\u0430 \u0432\u0445\u043e\u0434\u0435 \u2014 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c. \u0417\u0430\u0434\u0430\u0447\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e  \u0432\u043a\u043b\u0438\u043d\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432 \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043a\u043e\u0439-\u043b\u0438\u0431\u043e \u043b\u043e\u0433\u0438\u043a\u0438. \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f\u0441\u044c \u043a \u043f\u0440\u0438\u043c\u0435\u0440\u0443 \u0432\u044b\u0448\u0435, \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e  \u0434\u0435\u043b\u0430\u0442\u044c \u0432\u043d\u0443\u0442\u0440\u0438 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439? </p> <ul> <li>\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f;</li> <li>\u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u043a\u0430\u043a\u0438\u0435-\u0442\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u044b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441\u0435\u0441\u0441\u0438\u044e \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u043f\u0443\u043b\u0430 \u0441\u0435\u0441\u0441\u0438\u0439);</li> <li>\u043f\u043e\u0434\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432, \u043d\u0435 \u0434\u043e\u0432\u043e\u0434\u044f \u0434\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432;</li> <li>\u043f\u043e-\u0442\u0438\u0445\u043e\u043c\u0443 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0430\u043f\u0434\u0435\u0439\u0442\u044b, \u043a\u0430\u043a \u0431\u0443\u0434\u0442\u043e \u0438\u0445 \u0438 \u043d\u0435 \u0431\u044b\u043b\u043e;</li> <li>... \u0447\u0442\u043e \u0443\u0433\u043e\u0434\u043d\u043e \u0435\u0449\u0451!</li> </ul>"},{"location":"filters-and-middlewares/#middlewares-structure","title":"\u0412\u0438\u0434\u044b \u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439","text":"<p>\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430 \u043e\u0431\u0440\u0430\u0442\u0438\u043c\u0441\u044f \u043a \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 aiogram 3.x, \u043d\u043e \u0443\u0436\u0435 \u0432  \u0434\u0440\u0443\u0433\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0430  \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435:</p> <p></p> <p>\u041e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f, \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439 \u0434\u0432\u0430 \u0432\u0438\u0434\u0430: \u0432\u043d\u0435\u0448\u043d\u0438\u0435 (outer) \u0438 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0435 (inner \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u00ab\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438\u00bb). \u0412 \u0447\u0451\u043c \u0440\u0430\u0437\u043d\u0438\u0446\u0430?  Outer \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0434\u043e \u043d\u0430\u0447\u0430\u043b\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u043c\u0438, \u0430 inner \u2014 \u043f\u043e\u0441\u043b\u0435. \u041d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435 \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435/\u043a\u043e\u043b\u0431\u044d\u043a/\u0438\u043d\u043b\u0430\u0439\u043d-\u0437\u0430\u043f\u0440\u043e\u0441,  \u043f\u0440\u043e\u0445\u043e\u0434\u044f\u0449\u0438\u0439 \u0447\u0435\u0440\u0435\u0437 outer-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c, \u043c\u043e\u0436\u0435\u0442 \u0442\u0430\u043a \u043d\u0438 \u0432 \u043e\u0434\u0438\u043d \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u0438 \u043d\u0435 \u043f\u043e\u043f\u0430\u0441\u0442\u044c, \u043d\u043e \u0435\u0441\u043b\u0438 \u043e\u043d \u043f\u043e\u043f\u0430\u043b \u0432 inner, \u0442\u043e \u0434\u0430\u043b\u044c\u0448\u0435  100% \u0431\u0443\u0434\u0435\u0442 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440.</p> <p>\u041c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u043d\u0430 \u0442\u0438\u043f Update</p> <p>\u0421\u0442\u043e\u0438\u0442 \u043d\u0430\u043f\u043e\u043c\u043d\u0438\u0442\u044c, \u0447\u0442\u043e Update \u2014 \u044d\u0442\u043e \u043e\u0431\u0449\u0438\u0439 \u0442\u0438\u043f \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u0438\u0434\u043e\u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0432 Telegram. \u0418 \u0441 \u043d\u0438\u043c \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0434\u0432\u0435 \u0432\u0430\u0436\u043d\u044b\u0445 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0432  \u043f\u043b\u0430\u043d\u0435 \u0438\u0445 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 aiogram-\u043e\u043c: \u2022 Inner-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043d\u0430 Update \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432\u0441\u0435\u0433\u0434\u0430 (\u0442.\u0435. \u0432 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043d\u0435\u0442 \u0440\u0430\u0437\u043d\u0438\u0446\u044b \u043c\u0435\u0436\u0434\u0443 Outer \u0438 Inner). \u2022 \u041c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u043d\u0430 Update \u043c\u043e\u0436\u043d\u043e \u0432\u0435\u0448\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440 (\u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0440\u043e\u0443\u0442\u0435\u0440).</p> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043f\u0440\u043e\u0441\u0442\u0435\u0439\u0448\u0443\u044e \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c:</p> <pre><code>from typing import Callable, Dict, Any, Awaitable\nfrom aiogram import BaseMiddleware\nfrom aiogram.types import TelegramObject\n\nclass SomeMiddleware(BaseMiddleware):\n    async def __call__(\n        self,\n        handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],\n        event: TelegramObject,\n        data: Dict[str, Any]\n    ) -&gt; Any:\n        print(\"Before handler\")\n        result = await handler(event, data)\n        print(\"After handler\")\n        return result\n</code></pre> <p>\u041a\u0430\u0436\u0434\u0430\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c, \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u0430\u044f \u043d\u0430 \u043a\u043b\u0430\u0441\u0441\u0430\u0445 (\u043c\u044b \u043d\u0435 \u0431\u0443\u0434\u0435\u043c \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0442\u044c  \u0438\u043d\u044b\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u044b), \u0434\u043e\u043b\u0436\u043d\u0430 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u044b\u0432\u0430\u0442\u044c  \u043c\u0435\u0442\u043e\u0434 <code>__call__()</code> \u0441 \u0442\u0440\u0435\u043c\u044f \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430\u043c\u0438:</p> <ol> <li>handler \u2014 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u043e\u0431\u044a\u0435\u043a\u0442 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d. \u0418\u043c\u0435\u0435\u0442 \u0441\u043c\u044b\u0441\u043b \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f inner-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439,  \u0442.\u043a. outer-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u0435\u0449\u0451 \u043d\u0435 \u0437\u043d\u0430\u0435\u0442, \u0432 \u043a\u0430\u043a\u043e\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043f\u043e\u043f\u0430\u0434\u0451\u0442 \u0430\u043f\u0434\u0435\u0439\u0442.</li> <li>event \u2014 \u0442\u0438\u043f Telegram-\u043e\u0431\u044a\u0435\u043a\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u043c. \u041e\u0431\u044b\u0447\u043d\u043e \u044d\u0442\u043e Update, Message, CallbackQuery \u0438\u043b\u0438 InlineQuery  (\u043d\u043e \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e). \u0415\u0441\u043b\u0438 \u0442\u043e\u0447\u043d\u043e \u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0435, \u0441\u043c\u0435\u043b\u043e \u043f\u0438\u0448\u0438\u0442\u0435, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>Message</code> \u0432\u043c\u0435\u0441\u0442\u043e  <code>TelegramObject</code>.</li> <li>data \u2014 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0442\u0435\u043a\u0443\u0449\u0438\u043c \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u043c \u0434\u0430\u043d\u043d\u044b\u0435: FSM, \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u043f. \u043f\u043e\u043b\u044f \u0438\u0437 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432, \u0444\u043b\u0430\u0433\u0438 (\u043e \u043d\u0438\u0445 \u043f\u043e\u0437\u0436\u0435) \u0438 \u0442.\u0434.  \u0412 \u044d\u0442\u043e\u0442 \u0436\u0435 <code>data</code> \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043a\u043b\u0430\u0441\u0442\u044c \u0438\u0437 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439 \u043a\u0430\u043a\u0438\u0435-\u0442\u043e \u0441\u0432\u043e\u0438 \u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u0432 \u0432\u0438\u0434\u0435  \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430\u0445 (\u0442\u0430\u043a \u0436\u0435, \u043a\u0430\u043a \u0432 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0445).</li> </ol> <p>\u0421 \u0442\u0435\u043b\u043e\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0435\u0449\u0451 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u0435\u0435. </p> <ul> <li>\u0412\u0441\u0451, \u0447\u0442\u043e \u0432\u044b \u043d\u0430\u043f\u0438\u0448\u0435\u0442\u0435 \u0414\u041e 13-\u0439 \u0441\u0442\u0440\u043e\u043a\u0438, \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0434\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f  \u043d\u0438\u0436\u0435\u0441\u0442\u043e\u044f\u0449\u0435\u043c\u0443 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443 (\u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0434\u0440\u0443\u0433\u0430\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u0438\u043b\u0438 \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440). </li> <li>\u0412\u0441\u0451, \u0447\u0442\u043e \u0432\u044b \u043d\u0430\u043f\u0438\u0448\u0435\u0442\u0435 \u041f\u041e\u0421\u041b\u0415 13-\u0439 \u0441\u0442\u0440\u043e\u043a\u0438, \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0443\u0436\u0435 \u043f\u043e\u0441\u043b\u0435 \u0432\u044b\u0445\u043e\u0434\u0430 \u0438\u0437 \u043d\u0438\u0436\u0435\u0441\u0442\u043e\u044f\u0449\u0435\u0433\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430.</li> <li>\u0415\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u043b\u0430\u0441\u044c, \u0432\u044b \u041e\u0411\u042f\u0417\u0410\u041d\u042b \u0432\u044b\u0437\u0432\u0430\u0442\u044c <code>await handler(event, data)</code>. \u0415\u0441\u043b\u0438 \u0445\u043e\u0442\u0438\u0442\u0435  \u00ab\u0434\u0440\u043e\u043f\u043d\u0443\u0442\u044c\u00bb \u0430\u043f\u0434\u0435\u0439\u0442, \u043f\u0440\u043e\u0441\u0442\u043e \u043d\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u0439\u0442\u0435 \u0435\u0433\u043e.</li> <li>\u0415\u0441\u043b\u0438 \u0432\u0430\u043c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430, \u0442\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u0442\u0440\u043e\u043a\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435  <code>return await handler(event, data)</code>. \u0415\u0441\u043b\u0438 \u043d\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c <code>await handler(event, data)</code> (\u043d\u0435\u044f\u0432\u043d\u044b\u0439 <code>return None</code>),  \u0442\u043e \u0430\u043f\u0434\u0435\u0439\u0442 \u0431\u0443\u0434\u0435\u0442 \u0441\u0447\u0438\u0442\u0430\u0442\u044c\u0441\u044f \u00ab\u0434\u0440\u043e\u043f\u043d\u0443\u0442\u044b\u043c\u00bb.</li> </ul> <p>\u0412\u0441\u0435 \u043f\u0440\u0438\u0432\u044b\u0447\u043d\u044b\u0435 \u043d\u0430\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u044b (<code>Message</code>, <code>CallbackQuery</code> \u0438 \u0442.\u0434.) \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0430\u043f\u0434\u0435\u0439\u0442\u0430\u043c\u0438 (<code>Update</code>), \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0434\u043b\u044f <code>Message</code> \u0441\u043d\u0430\u0447\u0430\u043b\u0430  \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u0441\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u0434\u043b\u044f <code>Update</code>, \u0430 \u0443\u0436\u0435 \u0437\u0430\u0442\u0435\u043c \u0434\u043b\u044f \u0441\u0430\u043c\u043e\u0433\u043e <code>Message</code>. \u041e\u0441\u0442\u0430\u0432\u0438\u043c \u043d\u0430 \u043c\u0435\u0441\u0442\u0435 \u043d\u0430\u0448\u0438 <code>print()</code> \u0438\u0437 \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u0432\u044b\u0448\u0435 \u0438  \u043f\u0440\u043e\u0441\u043b\u0435\u0434\u0438\u043c, \u043a\u0430\u043a \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438, \u0435\u0441\u043b\u0438 \u043c\u044b \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e \u043e\u0434\u043d\u043e\u0439 outer- \u0438 inner-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u0434\u043b\u044f \u0442\u0438\u043f\u043e\u0432  <code>Update</code> \u0438 <code>Message</code>.</p> <p>\u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 (<code>Message</code>) \u0432 \u043a\u043e\u043d\u0435\u0447\u043d\u043e\u043c \u0441\u0447\u0451\u0442\u0435 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043b\u043e\u0441\u044c \u043a\u0430\u043a\u0438\u043c-\u0442\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u043c:</p> <ol> <li><code>[Update Outer] Before handler</code></li> <li><code>[Update Inner] Before handler</code></li> <li><code>[Message Outer] Before handler</code></li> <li><code>[Message Inner] Before handler</code></li> <li><code>[Message Inner] After handler</code></li> <li><code>[Message Outer] After handler</code></li> <li><code>[Update Inner] After handler</code></li> <li><code>[Update Outer] After handler</code></li> </ol> <p>\u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u043d\u0430\u0448\u043b\u043e \u043d\u0443\u0436\u043d\u044b\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440:</p> <ol> <li><code>[Update Outer] Before handler</code></li> <li><code>[Update Inner] Before handler</code></li> <li><code>[Message Outer] Before handler</code></li> <li><code>[Message Outer] After handler</code></li> <li><code>[Update Inner] After handler</code></li> <li><code>[Update Outer] After handler</code></li> </ol> <p>\u0411\u0430\u043d\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0431\u043e\u0442\u0435</p> <p>\u041e\u0447\u0435\u043d\u044c \u0447\u0430\u0441\u0442\u043e \u0432 \u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u043f\u043e Telegram-\u0431\u043e\u0442\u0430\u043c \u0437\u0430\u0434\u0430\u044e\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u0432\u043e\u043f\u0440\u043e\u0441: \u00ab\u0430 \u043a\u0430\u043a \u0431\u0430\u043d\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0431\u043e\u0442\u0435, \u0447\u0442\u043e\u0431\u044b  \u0442\u043e\u0442 \u043d\u0435 \u043c\u043e\u0433 \u0431\u043e\u0442\u0443 \u043f\u0438\u0441\u0430\u0442\u044c?\u00bb. \u0421\u043a\u043e\u0440\u0435\u0435 \u0432\u0441\u0435\u0433\u043e, \u043b\u0443\u0447\u0448\u0438\u043c \u043c\u0435\u0441\u0442\u043e\u043c \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0431\u0443\u0434\u0435\u0442 outer-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043d\u0430 Update, \u043a\u0430\u043a \u0441\u0430\u043c\u044b\u0439 \u0440\u0430\u043d\u043d\u0438\u0439  \u044d\u0442\u0430\u043f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u044e\u0437\u0435\u0440\u0430. \u0411\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u043e\u0434\u043d\u0430 \u0438\u0437 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0445 \u0432 aiogram \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439 \u043a\u043b\u0430\u0434\u0451\u0442 \u0432 <code>data</code> \u0441\u043b\u043e\u0432\u0430\u0440\u0438\u043a  \u0441 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443 <code>event_from_user</code>. \u0414\u0430\u043b\u0435\u0435 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u043e\u0441\u0442\u0430\u0442\u044c \u043e\u0442\u0442\u0443\u0434\u0430 ID \u044e\u0437\u0435\u0440\u0430, \u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441  \u043a\u0430\u043a\u0438\u043c-\u043d\u0438\u0431\u0443\u0434\u044c \u0441\u0432\u043e\u0438\u043c \u00ab\u0441\u043f\u0438\u0441\u043a\u043e\u043c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445\u00bb \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c <code>return</code>, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0442\u0438\u0442\u044c \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0443\u044e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443  \u043f\u043e \u0446\u0435\u043f\u043e\u0447\u043a\u0435.</p>"},{"location":"filters-and-middlewares/#middlewares-examples","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439","text":"<p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439.</p>"},{"location":"filters-and-middlewares/#middleware-pass-arguments","title":"\u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c","text":"<p>\u041c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438-\u043a\u043b\u0430\u0441\u0441\u044b, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0443 \u043d\u0438\u0445 \u0435\u0441\u0442\u044c \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440. \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043a\u0430\u0441\u0442\u043e\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043a\u043e\u0434\u0430 \u0432\u043d\u0443\u0442\u0440\u0438,  \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044f \u0438\u043c \u0441\u043d\u0430\u0440\u0443\u0436\u0438. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438. \u041d\u0430\u043f\u0438\u0448\u0435\u043c \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u0443\u044e, \u043d\u043e \u043d\u0430\u0433\u043b\u044f\u0434\u043d\u0443\u044e \"\u0437\u0430\u043c\u0435\u0434\u043b\u044f\u044e\u0449\u0443\u044e\" \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c,  \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0442\u043e\u0440\u043c\u043e\u0437\u0438\u0442\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u043a\u0443\u043d\u0434:</p> <pre><code>import asyncio\nfrom typing import Any, Callable, Dict, Awaitable\nfrom aiogram import BaseMiddleware\nfrom aiogram.types import TelegramObject\n\nclass SlowpokeMiddleware(BaseMiddleware):\n    def __init__(self, sleep_sec: int):\n        self.sleep_sec = sleep_sec\n\n    async def __call__(\n            self,\n            handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],\n            event: TelegramObject,\n            data: Dict[str, Any],\n    ) -&gt; Any:\n        # \u0416\u0434\u0451\u043c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u043a\u0443\u043d\u0434 \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0451\u043c \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u0430\u043b\u044c\u0448\u0435 \u043f\u043e \u0446\u0435\u043f\u043e\u0447\u043a\u0435\n        # (\u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043a\u0430\u043a \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u0442\u0430\u043a \u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c)\n        await asyncio.sleep(self.sleep_sec)\n        result = await handler(event, data)\n        # \u0415\u0441\u043b\u0438 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435 \u0441\u0434\u0435\u043b\u0430\u0442\u044c return, \u0442\u043e \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043f\u0430\u0434\u0451\u0442 \u0432 result\n        print(f\"Handler was delayed by {self.sleep_sec} seconds\")\n        return result\n</code></pre> <p>\u0418 \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u0432\u0435\u0441\u0438\u043c \u0435\u0451 \u043d\u0430 \u0434\u0432\u0430 \u0440\u043e\u0443\u0442\u0435\u0440\u0430 \u0441 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438:</p> <pre><code>from aiogram import Router\nfrom &lt;...&gt; import SlowpokeMiddleware\n\n# \u0413\u0434\u0435-\u0442\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043c\u0435\u0441\u0442\u0435\nrouter1 = Router()\nrouter2 = Router()\n\nrouter1.message.middleware(SlowpokeMiddleware(sleep_sec=5))\nrouter2.message.middleware(SlowpokeMiddleware(sleep_sec=10))\n</code></pre>"},{"location":"filters-and-middlewares/#middleware-store-data","title":"\u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438","text":"<p>\u041a\u0430\u043a \u043c\u044b \u0443\u0436\u0435 \u0432\u044b\u044f\u0441\u043d\u0438\u043b\u0438 \u0440\u0430\u043d\u0435\u0435, \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0433\u043e \u0430\u043f\u0434\u0435\u0439\u0442\u0430 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044f\u043c \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0441\u043b\u043e\u0432\u0430\u0440\u044c <code>data</code>,  \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043b\u0435\u0436\u0430\u0442 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u043f\u043e\u043b\u0435\u0437\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b: \u0431\u043e\u0442, \u0430\u0432\u0442\u043e\u0440 \u0430\u043f\u0434\u0435\u0439\u0442\u0430 (event_from_user) \u0438 \u0442.\u0434. \u041d\u043e \u0442\u0430\u043a\u0436\u0435 \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043d\u0430\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u044d\u0442\u043e\u0442  \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u0447\u0435\u043c \u0443\u0433\u043e\u0434\u043d\u043e. \u0411\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u043f\u043e\u0437\u0434\u043d\u0435\u0435 \u0432\u044b\u0437\u0432\u0430\u043d\u043d\u044b\u0435 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u043c\u043e\u0433\u0443\u0442 \u0432\u0438\u0434\u0435\u0442\u044c \u0442\u043e, \u0447\u0442\u043e \u0442\u0443\u0434\u0430 \u043f\u043e\u043b\u043e\u0436\u0438\u043b\u0438 \u0440\u0430\u043d\u0435\u0435 \u0432\u044b\u0437\u0432\u0430\u043d\u043d\u044b\u0435.</p> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044e: \u043f\u0435\u0440\u0432\u0430\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043f\u043e Telegram ID \u044e\u0437\u0435\u0440\u0430 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u0430\u0439\u0434\u0438\u0448\u043d\u0438\u043a (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0438\u0437  \u044f\u043a\u043e\u0431\u044b \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0438\u0441\u0430), \u0430 \u0432\u0442\u043e\u0440\u0430\u044f \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043f\u043e \u044d\u0442\u043e\u043c\u0443 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c\u0443 \u0430\u0439\u0434\u0438 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 \u00ab\u0441\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u044b\u0439 \u043c\u0435\u0441\u044f\u0446\u00bb \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (\u043e\u0441\u0442\u0430\u0442\u043e\u043a \u043e\u0442 \u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u0430\u0439\u0434\u0438 \u043d\u0430 12). \u0412\u0441\u0451 \u044d\u0442\u043e \u043a\u043b\u0430\u0434\u0451\u0442\u0441\u044f \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0440\u0430\u0434\u0443\u0435\u0442 \u0438\u043b\u0438 \u043e\u0433\u043e\u0440\u0447\u0430\u0435\u0442 \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430, \u0432\u044b\u0437\u0432\u0430\u0432\u0448\u0435\u0433\u043e  \u043a\u043e\u043c\u0430\u043d\u0434\u0443. \u0417\u0432\u0443\u0447\u0438\u0442 \u0441\u043b\u043e\u0436\u043d\u043e, \u043d\u043e \u0441\u0435\u0439\u0447\u0430\u0441 \u0432\u0441\u0451 \u043f\u043e\u0439\u043c\u0451\u0442\u0435. \u041d\u0430\u0447\u043d\u0451\u043c \u0441 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0435\u0439:</p> <pre><code>from random import randint\nfrom typing import Any, Callable, Dict, Awaitable\nfrom datetime import datetime\nfrom aiogram import BaseMiddleware\nfrom aiogram.types import TelegramObject\n\n# \u041c\u0438\u0434\u043b\u0432\u0430\u0440\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0434\u043e\u0441\u0442\u0430\u0451\u0442 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u0430\u0439\u0434\u0438 \u044e\u0437\u0435\u0440\u0430 \u0438\u0437 \u043a\u0430\u043a\u043e\u0433\u043e-\u0442\u043e \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0438\u0441\u0430\nclass UserInternalIdMiddleware(BaseMiddleware):\n    # \u0420\u0430\u0437\u0443\u043c\u0435\u0435\u0442\u0441\u044f, \u043d\u0438\u043a\u0430\u043a\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u0443 \u043d\u0430\u0441 \u0432 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u043d\u0435\u0442,\n    # \u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0443\u0440\u043e\u0432\u044b\u0439 \u0440\u0430\u043d\u0434\u043e\u043c:\n    def get_internal_id(self, user_id: int) -&gt; int:\n        return randint(100_000_000, 900_000_000) + user_id\n\n    async def __call__(\n            self,\n            handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],\n            event: TelegramObject,\n            data: Dict[str, Any],\n    ) -&gt; Any:\n        user = data[\"event_from_user\"]\n        data[\"internal_id\"] = self.get_internal_id(user.id)\n        return await handler(event, data)\n\n# \u041c\u0438\u0434\u043b\u0432\u0430\u0440\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 \"\u0441\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u044b\u0439 \u043c\u0435\u0441\u044f\u0446\" \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\nclass HappyMonthMiddleware(BaseMiddleware):\n    async def __call__(\n            self,\n            handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],\n            event: TelegramObject,\n            data: Dict[str, Any],\n    ) -&gt; Any:\n        # \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438\n        internal_id: int = data[\"internal_id\"]\n        current_month: int = datetime.now().month\n        is_happy_month: bool = (internal_id % 12) == current_month\n        # \u041a\u043b\u0430\u0434\u0451\u043c True \u0438\u043b\u0438 False \u0432 data, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435\n        data[\"is_happy_month\"] = is_happy_month\n        return await handler(event, data)\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u043f\u043e\u043b\u043e\u0436\u0438\u043c \u0435\u0433\u043e \u0432 \u0440\u043e\u0443\u0442\u0435\u0440 \u0438 \u043f\u0440\u0438\u0446\u0435\u043f\u0438\u043c \u0440\u043e\u0443\u0442\u0435\u0440 \u043a \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0443. \u041f\u0435\u0440\u0432\u0443\u044e \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043f\u043e\u0432\u0435\u0441\u0438\u043c \u043a\u0430\u043a outer \u043d\u0430 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440,  \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e (\u043f\u043e \u0437\u0430\u0434\u0443\u043c\u043a\u0435) \u044d\u0442\u043e\u0442 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u0430\u0439\u0434\u0438 \u043d\u0443\u0436\u0435\u043d \u0432\u0441\u0435\u0433\u0434\u0430 \u0438 \u0432\u0435\u0437\u0434\u0435. \u0410 \u0432\u0442\u043e\u0440\u0443\u044e \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043f\u043e\u0432\u0435\u0441\u0438\u043c \u043a\u0430\u043a inner \u043d\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440,  \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0441\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u043e\u0433\u043e \u043c\u0435\u0441\u044f\u0446\u0430 \u043d\u0443\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u043d\u0451\u043c.</p> <pre><code>@router.message(Command(\"happymonth\"))\nasync def cmd_happymonth(\n        message: Message, \n        internal_id: int, \n        is_happy_month: bool\n):\n    phrases = [f\"\u0412\u0430\u0448 ID \u0432 \u043d\u0430\u0448\u0435\u043c \u0441\u0435\u0440\u0432\u0438\u0441\u0435: {internal_id}\"]\n    if is_happy_month:\n        phrases.append(\"\u0421\u0435\u0439\u0447\u0430\u0441 \u0432\u0430\u0448 \u0441\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u044b\u0439 \u043c\u0435\u0441\u044f\u0446!\")\n    else:\n        phrases.append(\"\u0412 \u044d\u0442\u043e\u043c \u043c\u0435\u0441\u044f\u0446\u0435 \u0431\u0443\u0434\u044c\u0442\u0435 \u043e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u0435\u0435...\")\n    await message.answer(\". \".join(phrases))\n\n# \u0413\u0434\u0435-\u0442\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043c\u0435\u0441\u0442\u0435:\nasync def main():\n    dp = Dispatcher()\n    # &lt;...&gt;\n    dp.update.outer_middleware(UserInternalIdMiddleware())\n    router.message.middleware(HappyMonthMiddleware())\n</code></pre> <p>\u0412\u043e\u0442 \u043a\u0430\u043a\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438\u0441\u044c \u0432 \u043d\u043e\u044f\u0431\u0440\u0435 (11-\u0439 \u043c\u0435\u0441\u044f\u0446):</p> <p></p>"},{"location":"filters-and-middlewares/#no-callbacks-on-weekend","title":"\u041d\u0438\u043a\u0430\u043a\u0438\u0445 \u043a\u043e\u043b\u0431\u044d\u043a\u043e\u0432 \u043f\u043e \u0432\u044b\u0445\u043e\u0434\u043d\u044b\u043c!","text":"<p>\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u043c, \u0447\u0442\u043e \u0443 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0437\u0430\u0432\u043e\u0434\u0430 \u0435\u0441\u0442\u044c Telegram-\u0431\u043e\u0442 \u0438 \u043a\u0430\u0436\u0434\u043e\u0435 \u0443\u0442\u0440\u043e \u0437\u0430\u0432\u043e\u0434\u0447\u0430\u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u043d\u0430\u0436\u0438\u043c\u0430\u0442\u044c \u043d\u0430 \u0438\u043d\u043b\u0430\u0439\u043d-\u043a\u043d\u043e\u043f\u043a\u0443,  \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u0441\u0432\u043e\u0451 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0438 \u0434\u0435\u0435\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c. \u0417\u0430\u0432\u043e\u0434 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 5/2 \u0438 \u043c\u044b \u0445\u043e\u0442\u0438\u043c, \u0447\u0442\u043e\u0431\u044b \u0432 \u0441\u0443\u0431\u0431\u043e\u0442\u0443 \u0438 \u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435 \u043d\u0430\u0436\u0430\u0442\u0438\u044f  \u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u043b\u0438\u0441\u044c. \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043d\u0430 \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 \u0437\u0430\u0432\u044f\u0437\u0430\u043d\u0430 \u0441\u043b\u043e\u0436\u043d\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430 (\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0421\u041a\u0414), \u0442\u043e \u0432 \u0432\u044b\u0445\u043e\u0434\u043d\u044b\u0435 \u0431\u0443\u0434\u0435\u043c  \u043f\u0440\u043e\u0441\u0442\u043e \u00ab\u0434\u0440\u043e\u043f\u0430\u0442\u044c\u00bb \u0430\u043f\u0434\u0435\u0439\u0442 \u0438 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043e\u043a\u043e\u0448\u043a\u043e \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439. \u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043f\u0440\u0438\u043c\u0435\u0440 \u043c\u043e\u0436\u043d\u043e \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0446\u0435\u043b\u0438\u043a\u043e\u043c \u0438 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c:</p> <pre><code>import asyncio\nimport logging\nimport sys\nfrom datetime import datetime\nfrom typing import Any, Callable, Dict, Awaitable\n\nfrom aiogram import Bot, Dispatcher, Router, BaseMiddleware, F\nfrom aiogram.filters import Command\nfrom aiogram.types import Message, CallbackQuery, TelegramObject\nfrom aiogram.utils.keyboard import InlineKeyboardBuilder\n\nrouter = Router()\n\n# \u042d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 outer-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u043d\u0430 \u043b\u044e\u0431\u044b\u0435 \u043a\u043e\u043b\u0431\u044d\u043a\u0438\nclass WeekendCallbackMiddleware(BaseMiddleware):\n    def is_weekend(self) -&gt; bool:\n        # 5 - \u0441\u0443\u0431\u0431\u043e\u0442\u0430, 6 - \u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435\n        return datetime.utcnow().weekday() in (5, 6)\n\n    async def __call__(\n            self,\n            handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],\n            event: TelegramObject,\n            data: Dict[str, Any]\n    ) -&gt; Any:\n        # \u041c\u043e\u0436\u043d\u043e \u043f\u043e\u0434\u0441\u0442\u0440\u0430\u0445\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0438 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c,\n        # \u0435\u0441\u043b\u0438 \u043e\u043d\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043f\u043e \u043e\u0448\u0438\u0431\u043a\u0435 \u041d\u0415 \u043d\u0430 \u043a\u043e\u043b\u0431\u044d\u043a\u0438\n        if not isinstance(event, CallbackQuery):\n            # \u0442\u0443\u0442 \u043a\u0430\u043a-\u043d\u0438\u0431\u0443\u0434\u044c \u0437\u0430\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c\n            return await handler(event, data)\n\n        # \u0415\u0441\u043b\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435 \u0441\u0443\u0431\u0431\u043e\u0442\u0430 \u0438 \u043d\u0435 \u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435,\n        # \u0442\u043e \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443.\n        if not self.is_weekend():\n            return await handler(event, data)\n        # \u0412 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u043c \u043d\u0430 \u043a\u043e\u043b\u0431\u044d\u043a \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e\n        # \u0438 \u043f\u0440\u0435\u043a\u0440\u0430\u0449\u0430\u0435\u043c \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0443\u044e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443\n        await event.answer(\n            \"\u041a\u0430\u043a\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430? \u0417\u0430\u0432\u043e\u0434 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d \u0434\u043e \u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a\u0430!\",\n            show_alert=True\n        )\n        return\n\n\n@router.message(Command(\"checkin\"))\nasync def cmd_checkin(message: Message):\n    builder = InlineKeyboardBuilder()\n    builder.button(text=\"\u042f \u043d\u0430 \u0440\u0430\u0431\u043e\u0442\u0435!\", callback_data=\"checkin\")\n    await message.answer(\n        text=\"\u041d\u0430\u0436\u0438\u043c\u0430\u0439\u0442\u0435 \u044d\u0442\u0443 \u043a\u043d\u043e\u043f\u043a\u0443 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e \u0431\u0443\u0434\u043d\u0438\u043c \u0434\u043d\u044f\u043c!\",\n        reply_markup=builder.as_markup()\n    )\n\n\n@router.callback_query(F.data == \"checkin\")\nasync def callback_checkin(callback: CallbackQuery):\n    # \u0422\u0443\u0442 \u043c\u043d\u043e\u0433\u043e \u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0430\n    await callback.answer(\n        text=\"\u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u043b\u0438 \u0441\u0432\u043e\u0451 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435!\",\n        show_alert=True\n    )\n\n\nasync def main() -&gt; None:\n    bot = Bot('1234567890:AaBbCcDdEeFfGrOoShAHhIiJjKkLlMmNnOo')\n    dp = Dispatcher()\n    dp.callback_query.outer_middleware(WeekendCallbackMiddleware())\n    dp.include_router(router)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    logging.basicConfig(level=logging.INFO, stream=sys.stdout)\n    asyncio.run(main())\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c, \u0435\u0441\u043b\u0438 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043f\u043e\u0431\u0430\u043b\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f\u043c\u0438 \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c, \u0447\u0442\u043e \u043f\u043e \u0431\u0443\u0434\u043d\u0438\u043c \u0434\u043d\u044f\u043c \u0431\u043e\u0442 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e,  \u0430 \u043f\u043e \u0432\u044b\u0445\u043e\u0434\u043d\u044b\u043c \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u043e\u0448\u0438\u0431\u043a\u0443.</p>"},{"location":"filters-and-middlewares/#flags","title":"\u0424\u043b\u0430\u0433\u0438","text":"<p>\u0415\u0449\u0451 \u043e\u0434\u043d\u0430 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u0430\u044f \u0444\u0438\u0447\u0430 aiogram 3.x \u2014 \u0444\u043b\u0430\u0433\u0438. \u041f\u043e \u0441\u0443\u0442\u0438,  \u044d\u0442\u043e \u043d\u0435\u043a\u0438\u0435 \u00ab\u043c\u0430\u0440\u043a\u0435\u0440\u044b\u00bb \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u0447\u0438\u0442\u0430\u0442\u044c \u0432 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044f\u0445 \u0438 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e. \u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0444\u043b\u0430\u0433\u043e\u0432 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b,  \u043d\u0435 \u0432\u043b\u0435\u0437\u0430\u044f \u0432 \u0438\u0445 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044e\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0442\u0435\u043c \u0447\u0442\u043e-\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0432 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044f\u0445, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0442\u0440\u043e\u0442\u0442\u043b\u0438\u043d\u0433. </p> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0438\u0437\u043c\u0435\u043d\u0451\u043d\u043d\u044b\u0439 \u043a\u043e\u0434  \u0438\u0437 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438. \u041f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c,  \u0432 \u0432\u0430\u0448\u0435\u043c \u0431\u043e\u0442\u0435 \u043c\u043d\u043e\u0433\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0437\u0430\u043d\u0438\u043c\u0430\u044e\u0442\u0441\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u043e\u0439 \u043c\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u043b\u0438 \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u043e\u0439 \u0442\u0435\u043a\u0441\u0442\u0430 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439  \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438. \u0415\u0441\u043b\u0438 \u0442\u0430\u043a\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0434\u043e\u043b\u0433\u043e, \u0442\u043e \u0445\u043e\u0440\u043e\u0448\u0438\u043c \u0442\u043e\u043d\u043e\u043c \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442  \u0438\u043b\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0444\u043e\u0442\u043e \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 \u043c\u0435\u0442\u043e\u0434\u0430 sendChatAction.  \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, \u0442\u0430\u043a\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u0441\u0435\u0433\u043e \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434, \u043d\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u0441\u044f, \u0435\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435  \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0440\u0430\u043d\u044c\u0448\u0435. \u0423 aiogram \u0435\u0441\u0442\u044c \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0441 <code>ChatActionSender</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c  \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043e \u0442\u0435\u0445 \u043f\u043e\u0440, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.</p> <p>\u041c\u044b \u0442\u0430\u043a\u0436\u0435 \u043d\u0435 \u0445\u043e\u0442\u0438\u043c \u0432\u043d\u0443\u0442\u0440\u044c \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430 \u0437\u0430\u043f\u0438\u0445\u0438\u0432\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 <code>ChatActionSender</code>, \u043f\u0443\u0441\u0442\u044c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u0441 \u0442\u0435\u043c\u0438  \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430\u043c\u0438, \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d \u0444\u043b\u0430\u0433 <code>long_operation</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>typing</code>, <code>choose_sticker</code>...).  \u0410 \u0432\u043e\u0442 \u0438 \u0441\u0430\u043c\u0430 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c:</p> <pre><code>from aiogram.dispatcher.flags import get_flag\nfrom aiogram.utils.chat_action import ChatActionSender\n\nclass ChatActionMiddleware(BaseMiddleware):\n    async def __call__(\n        self,\n        handler: Callable[[Message, Dict[str, Any]], Awaitable[Any]],\n        event: Message,\n        data: Dict[str, Any]\n    ) -&gt; Any:\n        long_operation_type = get_flag(data, \"long_operation\")\n\n        # \u0415\u0441\u043b\u0438 \u0442\u0430\u043a\u043e\u0433\u043e \u0444\u043b\u0430\u0433\u0430 \u043d\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435 \u043d\u0435\u0442\n        if not long_operation_type:\n            return await handler(event, data)\n\n        # \u0415\u0441\u043b\u0438 \u0444\u043b\u0430\u0433 \u0435\u0441\u0442\u044c\n        async with ChatActionSender(\n                action=long_operation_type, \n                chat_id=event.chat.id\n        ):\n            return await handler(event, data)\n</code></pre> <p>\u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0447\u0442\u043e\u0431\u044b \u0444\u043b\u0430\u0433 \u0431\u044b\u043b \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d, \u0435\u0433\u043e \u043d\u0430\u0434\u043e \u0433\u0434\u0435-\u0442\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c.  \u0412\u0430\u0440\u0438\u0430\u043d\u0442: <code>@dp.message(&lt;\u0442\u0443\u0442 \u0432\u0430\u0448\u0438 \u0444\u0438\u043b\u044c\u0442\u0440\u044b&gt;, flags={\"long_operation\": \"upload_video_note\"})</code></p> <p>\u041f\u0440\u0438\u043c\u0435\u0440 throttling-\u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0432 \u043c\u043e\u0451\u043c  \u043a\u0430\u0437\u0438\u043d\u043e-\u0431\u043e\u0442\u0435.</p>"},{"location":"fsm/","title":"\u041a\u043e\u043d\u0435\u0447\u043d\u044b\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u044b (FSM)","text":""},{"location":"fsm/#fsm-start","title":"\u041a\u043e\u043d\u0435\u0447\u043d\u044b\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u044b (FSM)","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f aiogram: 3.7.0</p>"},{"location":"fsm/#theory","title":"\u0422\u0435\u043e\u0440\u0438\u044f","text":"<p>\u0412 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435 \u043c\u044b \u043f\u043e\u0433\u043e\u0432\u043e\u0440\u0438\u043c \u043e \u0435\u0449\u0451 \u043e\u0434\u043d\u043e\u0439 \u0432\u0430\u0436\u043d\u043e\u0439 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0431\u043e\u0442\u043e\u0432: \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432. \u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0434\u0430\u043b\u0435\u043a\u043e \u043d\u0435 \u0432\u0441\u0435  \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0432 \u0431\u043e\u0442\u0435 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430 \u043e\u0434\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 \u043a\u043e\u043c\u0430\u043d\u0434\u0443. \u041f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c, \u0435\u0441\u0442\u044c \u0431\u043e\u0442 \u0434\u043b\u044f \u0437\u043d\u0430\u043a\u043e\u043c\u0441\u0442\u0432, \u0433\u0434\u0435 \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043d\u0443\u0436\u043d\u043e  \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043c\u044f, \u0432\u043e\u0437\u0440\u0430\u0441\u0442 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e \u0441 \u043b\u0438\u0446\u043e\u043c. \u041c\u043e\u0436\u043d\u043e, \u043a\u043e\u043d\u0435\u0447\u043d\u043e, \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e, \u0430 \u0432 \u043f\u043e\u0434\u043f\u0438\u0441\u0438  \u043a \u043d\u0435\u0439 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043d\u043e \u044d\u0442\u043e \u043d\u0435\u0443\u0434\u043e\u0431\u043d\u043e \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u0432\u043e\u0434\u0430. \u0422\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u043c \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u0432\u0432\u043e\u0434 \u0434\u0430\u043d\u043d\u044b\u0445, \u0433\u0434\u0435 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0431\u043e\u0442 \u00ab\u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u00bb \u0440\u0435\u0436\u0438\u043c \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e\u0442 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e  \u044e\u0437\u0435\u0440\u0430, \u0434\u0430\u043b\u0435\u0435 \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u0432\u043e\u0434\u0438\u043c\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u0430 \u043f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/cancel</code> \u043f\u0440\u0435\u043a\u0440\u0430\u0449\u0430\u0435\u0442 \u043e\u0436\u0438\u0434\u0430\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u043d\u043e\u0439 \u0448\u0430\u0433 \u0438  \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0440\u0435\u0436\u0438\u043c. \u0412\u0437\u0433\u043b\u044f\u043d\u0438\u0442\u0435 \u043d\u0430 \u0441\u0445\u0435\u043c\u0443 \u043d\u0438\u0436\u0435:</p> <p></p> <p>\u0417\u0435\u043b\u0451\u043d\u043e\u0439 \u0441\u0442\u0440\u0435\u043b\u043a\u043e\u0439 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u043f\u043e \u0448\u0430\u0433\u0430\u043c \u0431\u0435\u0437 \u043e\u0448\u0438\u0431\u043e\u043a, \u0441\u0438\u043d\u0438\u0435 \u0441\u0442\u0440\u0435\u043b\u043a\u0438 \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438  \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u0432\u043e\u0434\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u044e\u0437\u0435\u0440 \u0443\u043a\u0430\u0437\u0430\u043b, \u0447\u0442\u043e \u0435\u043c\u0443 250 \u043b\u0435\u0442, \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u0432\u043e\u0437\u0440\u0430\u0441\u0442 \u0437\u0430\u043d\u043e\u0432\u043e), \u0430 \u043a\u0440\u0430\u0441\u043d\u044b\u0435  \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0442 \u0432\u044b\u0445\u043e\u0434 \u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0438\u0437-\u0437\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b <code>/cancel</code> \u0438\u043b\u0438 \u043b\u044e\u0431\u043e\u0439 \u0434\u0440\u0443\u0433\u043e\u0439, \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0435\u0439 \u043e\u0442\u043c\u0435\u043d\u0443.</p> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441 \u0441\u043e \u0441\u0445\u0435\u043c\u044b \u0432\u044b\u0448\u0435 \u0432 \u0442\u0435\u043e\u0440\u0438\u0438 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u043e\u0432 \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u043c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u043e\u043c (\u0438\u043b\u0438 FSM \u2014 Finite State Machine). \u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \u043e\u0431 \u044d\u0442\u043e\u043c \u043c\u043e\u0436\u043d\u043e  \u043f\u0440\u043e\u0447\u0435\u0441\u0442\u044c \u0437\u0434\u0435\u0441\u044c.</p> <p>\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432</p> <p>\u041f\u043e\u0441\u043b\u0435 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u043f\u043e\u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0443\u0435\u0442\u0435\u0441\u044c \u0441 FSM \u0432 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435, \u0432\u044b \u043d\u0430\u0432\u0435\u0440\u043d\u044f\u043a\u0430 \u043e\u0449\u0443\u0442\u0438\u0442\u0435, \u043a\u0430\u043a \u043c\u043d\u043e\u0433\u043e \u0432\u0441\u0435\u0433\u043e \u043f\u0440\u0438\u0434\u0451\u0442\u0441\u044f \u0441\u0434\u0435\u043b\u0430\u0442\u044c, \u0447\u0442\u043e\u0431\u044b  \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043b\u043e\u0436\u043d\u043e\u0440\u0430\u0437\u0432\u0435\u0442\u0432\u043b\u0451\u043d\u043d\u0443\u044e \u0446\u0435\u043f\u043e\u0447\u043a\u0443 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439. \u041a \u0441\u0447\u0430\u0441\u0442\u044c\u044e, \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0430  aiogram-dialog \u043e\u0442 Tishka17, \u0443\u043f\u0440\u043e\u0449\u0430\u044e\u0449\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u043c\u0430\u0448\u0438\u043d\u043e\u0439 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439.</p>"},{"location":"fsm/#practice","title":"\u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430","text":"<p>\u0412 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0445 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u043e\u0432 \u0432 aiogram \u0443\u0436\u0435 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0431\u044d\u043a\u0435\u043d\u0434\u043e\u0432 \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439  \u043c\u0435\u0436\u0434\u0443 \u044d\u0442\u0430\u043f\u0430\u043c\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0441 \u0431\u043e\u0442\u043e\u043c (\u0432\u043f\u0440\u043e\u0447\u0435\u043c, \u043d\u0438\u043a\u0442\u043e \u043d\u0435 \u043c\u0435\u0448\u0430\u0435\u0442 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u0432\u043e\u0439), \u0430 \u043f\u043e\u043c\u0438\u043c\u043e, \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439  \u043c\u043e\u0436\u043d\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u044b\u0448\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0435 \u0438\u043c\u044f \u0438 \u0432\u043e\u0437\u0440\u0430\u0441\u0442 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f  \u0433\u0434\u0435-\u043b\u0438\u0431\u043e. \u0421\u043f\u0438\u0441\u043e\u043a \u0438\u043c\u0435\u044e\u0449\u0438\u0445\u0441\u044f \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449 FSM \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0439\u0442\u0438  \u0432 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438 aiogram,  \u0430 \u0432 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435 \u043c\u044b \u0431\u0443\u0434\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0441\u0430\u043c\u044b\u043c \u043f\u0440\u043e\u0441\u0442\u044b\u043c \u0431\u044d\u043a\u0435\u043d\u0434\u043e\u043c  MemoryStorage, \u043a\u043e\u0442\u043e\u0440\u044b\u0439  \u0445\u0440\u0430\u043d\u0438\u0442 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438. \u041e\u043d \u0438\u0434\u0435\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432, \u043d\u043e \u043d\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445  \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445, \u0442.\u043a. MemoryStorage \u0445\u0440\u0430\u043d\u0438\u0442 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \u0431\u0435\u0437 \u0441\u0431\u0440\u043e\u0441\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a. \u0422\u0430\u043a\u0436\u0435 \u0441\u0442\u043e\u0438\u0442 \u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c, \u0447\u0442\u043e \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0435  \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u044b \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430\u043c\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (<code>message_handler</code>, <code>edited_message_handler</code>), \u043d\u043e \u0442\u0430\u043a\u0436\u0435  \u0441 \u043a\u043e\u043b\u0431\u044d\u043a\u0430\u043c\u0438 \u0438 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u043e\u043c.</p> <p>\u0412 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u043c\u044b \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0438\u043c\u0438\u0442\u0430\u0442\u043e\u0440 \u0437\u0430\u043a\u0430\u0437\u0430 \u0435\u0434\u044b \u0438 \u043d\u0430\u043f\u0438\u0442\u043a\u043e\u0432 \u0432 \u043a\u0430\u0444\u0435. </p>"},{"location":"fsm/#define-states","title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0448\u0430\u0433\u043e\u0432","text":"<p>\u041f\u0440\u0435\u0436\u0434\u0435, \u0447\u0435\u043c \u043f\u0440\u0438\u0441\u0442\u0443\u043f\u0438\u043c \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043a FSM, \u043e\u043f\u0438\u0448\u0435\u043c \u043f\u043e-\u0431\u044b\u0441\u0442\u0440\u043e\u043c\u0443 \u043f\u0440\u043e\u0441\u0442\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c  \u043e\u0431\u044b\u0447\u043d\u0443\u044e \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0443 \u0441 \u043a\u043d\u043e\u043f\u043a\u0430\u043c\u0438 \u0432 \u043e\u0434\u0438\u043d \u0440\u044f\u0434, \u043e\u043d\u0430 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0430\u043c \u0432 \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u043c:</p> keyboards/simple_row.py<pre><code>from aiogram.types import ReplyKeyboardMarkup, KeyboardButton\n\n\ndef make_row_keyboard(items: list[str]) -&gt; ReplyKeyboardMarkup:\n    \"\"\"\n    \u0421\u043e\u0437\u0434\u0430\u0451\u0442 \u0440\u0435\u043f\u043b\u0430\u0439-\u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0443 \u0441 \u043a\u043d\u043e\u043f\u043a\u0430\u043c\u0438 \u0432 \u043e\u0434\u0438\u043d \u0440\u044f\u0434\n    :param items: \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0435\u043a\u0441\u0442\u043e\u0432 \u0434\u043b\u044f \u043a\u043d\u043e\u043f\u043e\u043a\n    :return: \u043e\u0431\u044a\u0435\u043a\u0442 \u0440\u0435\u043f\u043b\u0430\u0439-\u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u044b\n    \"\"\"\n    row = [KeyboardButton(text=item) for item in items]\n    return ReplyKeyboardMarkup(keyboard=[row], resize_keyboard=True)\n</code></pre> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0448\u0430\u0433\u043e\u0432 \u0434\u043b\u044f \u00ab\u0437\u0430\u043a\u0430\u0437\u0430\u00bb \u0435\u0434\u044b. \u0421\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u0444\u0430\u0439\u043b <code>handlers/ordering_food.py</code>, \u0433\u0434\u0435 \u043e\u043f\u0438\u0448\u0435\u043c \u0441\u043f\u0438\u0441\u043a\u0438 \u0431\u043b\u044e\u0434 \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u0432  (\u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0436\u0438\u0437\u043d\u0438 \u044d\u0442\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043c\u043e\u0436\u0435\u0442 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0442\u044c\u0441\u044f \u0438\u0437 \u043a\u0430\u043a\u043e\u0439-\u043b\u0438\u0431\u043e \u0411\u0414):</p> <pre><code># \u042d\u0442\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043b\u0435\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u0432 \u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u0442\u0435\u043a\u0441\u0442, \u043e\u0442\u0441\u044e\u0434\u0430 \n# \u0442\u0430\u043a\u0430\u044f \u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0437\u0433\u043b\u044f\u0434 \u0441\u0442\u0440\u0430\u043d\u043d\u0430\u044f \u0444\u043e\u0440\u043c\u0430 \u043f\u0440\u0438\u043b\u0430\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445\navailable_food_names = [\"\u0421\u0443\u0448\u0438\", \"\u0421\u043f\u0430\u0433\u0435\u0442\u0442\u0438\", \"\u0425\u0430\u0447\u0430\u043f\u0443\u0440\u0438\"]\navailable_food_sizes = [\"\u041c\u0430\u043b\u0435\u043d\u044c\u043a\u0443\u044e\", \"\u0421\u0440\u0435\u0434\u043d\u044e\u044e\", \"\u0411\u043e\u043b\u044c\u0448\u0443\u044e\"]\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043e\u043f\u0438\u0448\u0435\u043c \u0432\u0441\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u00ab\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u00bb \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (\u0432\u044b\u0431\u043e\u0440 \u0435\u0434\u044b). \u041d\u0430 \u0441\u043b\u043e\u0432\u0430\u0445 \u043c\u043e\u0436\u043d\u043e \u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0442\u0430\u043a: \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442  \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/food</code>, \u0431\u043e\u0442 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c \u0441 \u043f\u0440\u043e\u0441\u044c\u0431\u043e\u0439 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043b\u044e\u0434\u043e \u0438 \u0432\u0441\u0442\u0430\u0451\u0442 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 *\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u044b\u0431\u043e\u0440 \u0431\u043b\u044e\u0434\u0430* \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e  \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f. \u041a\u0430\u043a \u0442\u043e\u043b\u044c\u043a\u043e \u044e\u0437\u0435\u0440 \u0434\u0435\u043b\u0430\u0435\u0442 \u0432\u044b\u0431\u043e\u0440, \u0431\u043e\u0442, \u043d\u0430\u0445\u043e\u0434\u044f\u0441\u044c \u0432 \u044d\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438, \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u0432\u0432\u043e\u0434\u0430, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0440\u0435\u0448\u0435\u043d\u0438\u0435,  \u0437\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u0432\u0432\u043e\u0434 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e (\u0431\u0435\u0437 \u0441\u043c\u0435\u043d\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f) \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443 \u0448\u0430\u0433\u0443 *\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u044b\u0431\u043e\u0440 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u043e\u0440\u0446\u0438\u0438*. \u041a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c  \u0438 \u0437\u0434\u0435\u0441\u044c \u0432\u0432\u043e\u0434\u0438\u0442 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u0431\u043e\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 (\u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0437\u0430\u043a\u0430\u0437\u0430) \u0438 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u041f\u043e\u0437\u0434\u043d\u0435\u0435  \u0432 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435 \u043c\u044b \u043d\u0430\u0443\u0447\u0438\u043c\u0441\u044f \u0434\u0435\u043b\u0430\u0442\u044c \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0431\u0440\u043e\u0441 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439 <code>/cancel</code>.</p>"},{"location":"fsm/#step-1","title":"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0448\u0430\u0433\u0430 1","text":"<p>\u0418\u0442\u0430\u043a, \u043f\u0435\u0440\u0435\u0439\u0434\u0451\u043c \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043a \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439. \u0414\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043b\u0430\u0441\u0441, \u043d\u0430\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439\u0441\u044f  \u043e\u0442 \u043a\u043b\u0430\u0441\u0441\u0430 <code>StatesGroup</code>, \u0432\u043d\u0443\u0442\u0440\u0438 \u043d\u0435\u0433\u043e \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435, \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0432 \u0438\u043c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u044b \u043a\u043b\u0430\u0441\u0441\u0430 <code>State</code>:</p> <pre><code>class OrderFood(StatesGroup):\n    choosing_food_name = State()\n    choosing_food_size = State()\n</code></pre> <p>\u041d\u0430\u043f\u0438\u0448\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0448\u0430\u0433\u0430, \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/food</code> \u0432 \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d \u043d\u0438\u043a\u0430\u043a\u043e\u0439 \u0441\u0442\u0435\u0439\u0442:</p> <pre><code>from aiogram.filters import Command, StateFilter\nfrom aiogram.fsm.context import FSMContext\n\n@router.message(StateFilter(None), Command(\"food\"))\nasync def cmd_food(message: Message, state: FSMContext):\n    await message.answer(\n        text=\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0431\u043b\u044e\u0434\u043e:\",\n        reply_markup=make_row_keyboard(available_food_names)\n    )\n    # \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \"\u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\"\n    await state.set_state(OrderFood.choosing_food_name)\n</code></pre> <p>\u0427\u0442\u043e\u0431\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u043e\u043c FSM, \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>state</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0438\u043c\u0435\u0442\u044c  \u0442\u0438\u043f <code>FSMContext</code>. \u0410 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u0442\u0440\u043e\u043a\u0435 \u043c\u044b \u044f\u0432\u043d\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u043c \u0431\u043e\u0442\u0443 \u0432\u0441\u0442\u0430\u0442\u044c \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 <code>choosing_food_name</code> \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b <code>OrderFood</code>. </p> <p>\u041e\u0442\u043b\u0438\u0447\u0438\u0435 \u043e\u0442 aiogram 2.x</p> <p>\u0412 aiogram 2.x \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u0430 \u043d\u0430 state \u043e\u0437\u043d\u0430\u0447\u0430\u043b\u043e \u00ab\u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0438 \u044f\u0432\u043d\u043e \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u00bb  (\u0438\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, <code>state=None</code>). \u0412 aiogram 3.x \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u0430 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u00ab\u043f\u0440\u0438 \u043b\u044e\u0431\u043e\u043c \u0441\u0442\u0435\u0439\u0442\u0435\u00bb. \u041d\u0430\u043f\u043e\u043c\u043d\u044e, \u0447\u0442\u043e \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u0439  \u043f\u043e\u0434\u0445\u043e\u0434 \u0432 \u00ab\u0442\u0440\u043e\u0439\u043a\u0435\u00bb \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441 \u043a\u043e\u043d\u0442\u0435\u043d\u0442-\u0442\u0430\u0439\u043f\u0430\u043c\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.</p> <p>\u0414\u0430\u043b\u0435\u0435 \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043b\u043e\u0432\u0438\u0442 \u043e\u0434\u0438\u043d \u0438\u0437 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 \u0431\u043b\u044e\u0434 \u0438\u0437 \u043d\u0430\u0448\u0435\u0433\u043e \u0441\u043f\u0438\u0441\u043a\u0430:</p> <pre><code>@router.message(\n    OrderFood.choosing_food_name, \n    F.text.in_(available_food_names)\n)\nasync def food_chosen(message: Message, state: FSMContext):\n    await state.update_data(chosen_food=message.text.lower())\n    await message.answer(\n        text=\"\u0421\u043f\u0430\u0441\u0438\u0431\u043e. \u0422\u0435\u043f\u0435\u0440\u044c, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u043e\u0440\u0446\u0438\u0438:\",\n        reply_markup=make_row_keyboard(available_food_sizes)\n    )\n    await state.set_state(OrderFood.choosing_food_size)\n</code></pre> <p>\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430. \u0424\u0438\u043b\u044c\u0442\u0440\u044b (\u0441\u0442\u0440\u043e\u043a\u0438 2-3) \u0441\u043e\u043e\u0431\u0449\u0430\u044e\u0442, \u0447\u0442\u043e \u043d\u0438\u0436\u0435\u0441\u0442\u043e\u044f\u0449\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442  \u0442\u043e\u0433\u0434\u0430 \u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u0433\u0434\u0430, \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0431\u0443\u0434\u0435\u0442 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 <code>OrderFood.choosing_food_name</code> \u0438 \u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0431\u0443\u0434\u0435\u0442  \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0442\u044c \u0441 \u043e\u0434\u043d\u0438\u043c \u0438\u0437 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0441\u043f\u0438\u0441\u043a\u0430 <code>available_food_names</code>. \u0412 \u0441\u0442\u0440\u043e\u043a\u0435 6 \u043c\u044b \u043f\u0438\u0448\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435 (\u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f)  \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 FSM, \u0438 \u044d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b \u0434\u043b\u044f \u043f\u0430\u0440\u044b <code>(chat_id, user_id)</code> (\u0435\u0441\u0442\u044c \u043d\u044e\u0430\u043d\u0441, \u043e \u043d\u0451\u043c \u043f\u043e\u0437\u0436\u0435). \u041d\u0430\u043a\u043e\u043d\u0435\u0446,  \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 11 \u043c\u044b \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 <code>OrderFood.choosing_food_size</code>.</p> <p>\u0410 \u0435\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0440\u0435\u0448\u0438\u0442 \u0432\u0432\u0435\u0441\u0442\u0438 \u0447\u0442\u043e-\u0442\u043e \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e, \u0431\u0435\u0437 \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u044b? \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043d\u0430\u0434\u043e \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e  \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435 \u0438 \u0434\u0430\u0442\u044c \u0435\u043c\u0443 \u0435\u0449\u0451 \u043f\u043e\u043f\u044b\u0442\u043a\u0443. \u041e\u0447\u0435\u043d\u044c \u0447\u0430\u0441\u0442\u043e \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0449\u0438\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u043a\u0438 \u0431\u043e\u0442\u043e\u0432 \u043d\u0430 \u044d\u0442\u043e\u043c \u043c\u043e\u043c\u0435\u043d\u0442\u0435 \u0437\u0430\u0434\u0430\u044e\u0442 \u0432\u043e\u043f\u0440\u043e\u0441:  \u00ab\u0430 \u043a\u0430\u043a \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u044e\u0437\u0435\u0440\u0430 \u0432 \u0442\u043e\u043c \u0436\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438?\u00bb. \u041e\u0442\u0432\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0439: \u0447\u0442\u043e\u0431\u044b \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438, \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e  \u0435\u0433\u043e [\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435] \u043d\u0435 \u043c\u0435\u043d\u044f\u0442\u044c, \u0442.\u0435. \u0431\u0443\u043a\u0432\u0430\u043b\u044c\u043d\u043e \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u0435\u043b\u0430\u0442\u044c. </p> <p>\u041d\u0430\u043f\u0438\u0448\u0435\u043c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u0443 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0431\u0443\u0434\u0435\u0442 \u0444\u0438\u043b\u044c\u0442\u0440 \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 <code>OrderFood.choosing_food_name</code>, \u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u0430  \u043d\u0430 \u0442\u0435\u043a\u0441\u0442 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442. \u0415\u0441\u043b\u0438 \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u044c \u0435\u0433\u043e \u043f\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439 <code>food_chosen()</code>,  \u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0441\u044f \u00ab\u0440\u0435\u0430\u0433\u0438\u0440\u0443\u0439 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 choosing_food_name, \u043d\u0430 \u0432\u0441\u0435 \u0442\u0435\u043a\u0441\u0442\u044b, \u043a\u0440\u043e\u043c\u0435 \u0442\u0435\u0445, \u0447\u0442\u043e \u043b\u043e\u0432\u0438\u0442 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u00bb  (\u0438\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u00ab\u043b\u043e\u0432\u0438 \u0432\u0441\u0435 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u044b\u00bb).</p> <pre><code>@router.message(OrderFood.choosing_food_name)\nasync def food_chosen_incorrectly(message: Message):\n    await message.answer(\n        text=\"\u042f \u043d\u0435 \u0437\u043d\u0430\u044e \u0442\u0430\u043a\u043e\u0433\u043e \u0431\u043b\u044e\u0434\u0430.\\n\\n\"\n             \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u043e \u0438\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0439 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043d\u0438\u0436\u0435:\",\n        reply_markup=make_row_keyboard(available_food_names)\n    )\n</code></pre>"},{"location":"fsm/#step-2","title":"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0448\u0430\u0433\u0430 2","text":"<p>\u0412\u0442\u043e\u0440\u043e\u0439 \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u044d\u0442\u0430\u043f \u2014 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432\u0432\u043e\u0434 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u043e\u0440\u0446\u0438\u0438 \u044e\u0437\u0435\u0440\u043e\u043c. \u0410\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u043c\u0443 \u044d\u0442\u0430\u043f\u0443 \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430  (\u043d\u0430 \u0432\u0435\u0440\u043d\u044b\u0439 \u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442\u044b), \u043d\u043e \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u0438\u0437 \u043d\u0438\u0445 \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0432\u044b\u0431\u043e\u0440 \u0441\u0432\u043e\u0434\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0437\u0430\u043a\u0430\u0437\u0435:</p> <pre><code>@router.message(OrderFood.choosing_food_size, F.text.in_(available_food_sizes))\nasync def food_size_chosen(message: Message, state: FSMContext):\n    user_data = await state.get_data()\n    await message.answer(\n        text=f\"\u0412\u044b \u0432\u044b\u0431\u0440\u0430\u043b\u0438 {message.text.lower()} \u043f\u043e\u0440\u0446\u0438\u044e {user_data['chosen_food']}.\\n\"\n             f\"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0442\u0435\u043f\u0435\u0440\u044c \u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u043f\u0438\u0442\u043a\u0438: /drinks\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n    await state.clear()\n\n\n@router.message(OrderFood.choosing_food_size)\nasync def food_size_chosen_incorrectly(message: Message):\n    await message.answer(\n        text=\"\u042f \u043d\u0435 \u0437\u043d\u0430\u044e \u0442\u0430\u043a\u043e\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u043e\u0440\u0446\u0438\u0438.\\n\\n\"\n             \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u0437 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043d\u0438\u0436\u0435:\",\n        reply_markup=make_row_keyboard(available_food_sizes)\n    )\n</code></pre> <p>\u0412\u044b\u0437\u043e\u0432 <code>get_data()</code> \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 \u21163 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c \u0447\u0430\u0442\u0435. \u0418\u0437 \u043d\u0435\u0433\u043e  [\u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430] \u043c\u044b \u0434\u043e\u0441\u0442\u0430\u0451\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0431\u043b\u044e\u0434\u0430 \u0438 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u043c \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u041c\u0435\u0442\u043e\u0434 <code>clear()</code> \u0443 \u0441\u0442\u0435\u0439\u0442\u0430  \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u00ab\u043f\u0443\u0441\u0442\u043e\u0435\u00bb \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435. \u0427\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c  \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u043b\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0442\u0435\u0440\u0435\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435? \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043c\u0441\u044f \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>clear()</code> \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a\u0430\u0445 aiogram 3.x:</p> <pre><code>class FSMContext:\n    # \u0427\u0430\u0441\u0442\u044c \u043a\u043e\u0434\u0430 \u043f\u0440\u043e\u043f\u0443\u0449\u0435\u043d\u0430\n\n    async def clear(self) -&gt; None:\n        await self.set_state(state=None)\n        await self.set_data({})\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0432\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0447\u0442\u043e-\u0442\u043e \u043e\u0434\u043d\u043e :)</p> <p>\u0428\u0430\u0433\u0438 \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u043d\u0430\u043f\u0438\u0442\u043a\u043e\u0432 \u0434\u0435\u043b\u0430\u044e\u0442\u0441\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u043e \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043b\u0438 \u0437\u0430\u0433\u043b\u044f\u043d\u0438\u0442\u0435 \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0442\u0435\u043a\u0441\u0442\u044b  \u043a \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u0435.</p> <p>\u041f\u043e\u043b\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0444\u0430\u0439\u043b\u0430 \u0441 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043b\u044f \u0437\u0430\u043a\u0430\u0437\u0430 \u0435\u0434\u044b:</p> handlers/ordering_food.py<pre><code>from aiogram import Router, F\nfrom aiogram.filters import Command, StateFilter\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.fsm.state import StatesGroup, State\nfrom aiogram.types import Message, ReplyKeyboardRemove\n\nfrom keyboards.simple_row import make_row_keyboard\n\nrouter = Router()\n\n# \u042d\u0442\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043b\u0435\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u0432 \u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u0442\u0435\u043a\u0441\u0442, \u043e\u0442\u0441\u044e\u0434\u0430\n# \u0442\u0430\u043a\u0430\u044f \u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0437\u0433\u043b\u044f\u0434 \u0441\u0442\u0440\u0430\u043d\u043d\u0430\u044f \u0444\u043e\u0440\u043c\u0430 \u043f\u0440\u0438\u043b\u0430\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445\navailable_food_names = [\"\u0421\u0443\u0448\u0438\", \"\u0421\u043f\u0430\u0433\u0435\u0442\u0442\u0438\", \"\u0425\u0430\u0447\u0430\u043f\u0443\u0440\u0438\"]\navailable_food_sizes = [\"\u041c\u0430\u043b\u0435\u043d\u044c\u043a\u0443\u044e\", \"\u0421\u0440\u0435\u0434\u043d\u044e\u044e\", \"\u0411\u043e\u043b\u044c\u0448\u0443\u044e\"]\n\n\nclass OrderFood(StatesGroup):\n    choosing_food_name = State()\n    choosing_food_size = State()\n\n\n@router.message(Command(\"food\"))\nasync def cmd_food(message: Message, state: FSMContext):\n    await message.answer(\n        text=\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0431\u043b\u044e\u0434\u043e:\",\n        reply_markup=make_row_keyboard(available_food_names)\n    )\n    # \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \"\u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\"\n    await state.set_state(OrderFood.choosing_food_name)\n\n# \u042d\u0442\u0430\u043f \u0432\u044b\u0431\u043e\u0440\u0430 \u0431\u043b\u044e\u0434\u0430 #\n\n\n@router.message(OrderFood.choosing_food_name, F.text.in_(available_food_names))\nasync def food_chosen(message: Message, state: FSMContext):\n    await state.update_data(chosen_food=message.text.lower())\n    await message.answer(\n        text=\"\u0421\u043f\u0430\u0441\u0438\u0431\u043e. \u0422\u0435\u043f\u0435\u0440\u044c, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u043e\u0440\u0446\u0438\u0438:\",\n        reply_markup=make_row_keyboard(available_food_sizes)\n    )\n    await state.set_state(OrderFood.choosing_food_size)\n\n\n# \u0412 \u0446\u0435\u043b\u043e\u043c, \u043d\u0438\u043a\u0442\u043e \u043d\u0435 \u043c\u0435\u0448\u0430\u0435\u0442 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0441\u0442\u0435\u0439\u0442\u044b \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0441\u0442\u0440\u043e\u043a\u0430\u043c\u0438\n# \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u044c\u0441\u044f, \u0435\u0441\u043b\u0438 \u043f\u043e \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 \n# \u0432\u0430\u0448\u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u043e\u0432 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0432 \u0440\u0430\u043d\u0442\u0430\u0439\u043c\u0435 (\u043d\u043e \u0437\u0430\u0447\u0435\u043c?)\n@router.message(StateFilter(\"OrderFood:choosing_food_name\"))\nasync def food_chosen_incorrectly(message: Message):\n    await message.answer(\n        text=\"\u042f \u043d\u0435 \u0437\u043d\u0430\u044e \u0442\u0430\u043a\u043e\u0433\u043e \u0431\u043b\u044e\u0434\u0430.\\n\\n\"\n             \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u043e \u0438\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0439 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043d\u0438\u0436\u0435:\",\n        reply_markup=make_row_keyboard(available_food_names)\n    )\n\n# \u042d\u0442\u0430\u043f \u0432\u044b\u0431\u043e\u0440\u0430 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u043e\u0440\u0446\u0438\u0438 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u0432\u043e\u0434\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 #\n\n\n@router.message(OrderFood.choosing_food_size, F.text.in_(available_food_sizes))\nasync def food_size_chosen(message: Message, state: FSMContext):\n    user_data = await state.get_data()\n    await message.answer(\n        text=f\"\u0412\u044b \u0432\u044b\u0431\u0440\u0430\u043b\u0438 {message.text.lower()} \u043f\u043e\u0440\u0446\u0438\u044e {user_data['chosen_food']}.\\n\"\n             f\"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0442\u0435\u043f\u0435\u0440\u044c \u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u043f\u0438\u0442\u043a\u0438: /drinks\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n    # \u0421\u0431\u0440\u043e\u0441 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n    await state.clear()\n\n\n@router.message(OrderFood.choosing_food_size)\nasync def food_size_chosen_incorrectly(message: Message):\n    await message.answer(\n        text=\"\u042f \u043d\u0435 \u0437\u043d\u0430\u044e \u0442\u0430\u043a\u043e\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u043e\u0440\u0446\u0438\u0438.\\n\\n\"\n             \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u0437 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043d\u0438\u0436\u0435:\",\n        reply_markup=make_row_keyboard(available_food_sizes)\n    )\n</code></pre>"},{"location":"fsm/#common-commands","title":"\u041e\u0431\u0449\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u0420\u0430\u0437 \u0443\u0436 \u0437\u0430\u0433\u043e\u0432\u043e\u0440\u0438\u043b\u0438 \u043e \u0441\u0431\u0440\u043e\u0441\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439, \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0432 \u0444\u0430\u0439\u043b\u0435 <code>handlers/common.py</code> \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0438 \u043a\u043e\u043c\u0430\u043d\u0434\u044b <code>/start</code> \u0438  \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u00ab\u043e\u0442\u043c\u0435\u043d\u044b\u00bb. \u0412 \u043f\u0435\u0440\u0432\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0435\u043a\u0438\u0439 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439/\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442, \u0430 \u0434\u043b\u044f \u043e\u0442\u043c\u0435\u043d\u044b \u043d\u0430\u043f\u0438\u0448\u0435\u043c  \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430: \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u0441\u0442\u0435\u0439\u0442\u0435, \u0438 \u043a\u043e\u0433\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u043a\u0430\u043a\u043e\u043c-\u043b\u0438\u0431\u043e.</p> <p>\u0412\u0441\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u044e\u0442 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u0443\u0431\u0438\u0440\u0430\u044e\u0442 \u043e\u0431\u044b\u0447\u043d\u0443\u044e \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0443, \u0435\u0441\u043b\u0438 \u0432\u0434\u0440\u0443\u0433 \u043e\u043d\u0430 \u0435\u0441\u0442\u044c:</p> handlers/common.py<pre><code>from aiogram import F, Router\nfrom aiogram.filters import Command\nfrom aiogram.filters import StateFilter\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.fsm.state import default_state\nfrom aiogram.types import Message, ReplyKeyboardRemove\n\nrouter = Router()\n\n\n@router.message(Command(commands=[\"start\"]))\nasync def cmd_start(message: Message, state: FSMContext):\n    await state.clear()\n    await message.answer(\n        text=\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c: \"\n             \"\u0431\u043b\u044e\u0434\u0430 (/food) \u0438\u043b\u0438 \u043d\u0430\u043f\u0438\u0442\u043a\u0438 (/drinks).\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n\n\n# \u041d\u0435\u0442\u0440\u0443\u0434\u043d\u043e \u0434\u043e\u0433\u0430\u0434\u0430\u0442\u044c\u0441\u044f, \u0447\u0442\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430 \u043c\u043e\u0436\u043d\u043e \n# \u0441\u043f\u043e\u043a\u043e\u0439\u043d\u043e \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0432 \u043e\u0434\u0438\u043d, \u043d\u043e \u0434\u043b\u044f \u043f\u043e\u043b\u043d\u043e\u0442\u044b \u043a\u0430\u0440\u0442\u0438\u043d\u044b \u043e\u0441\u0442\u0430\u0432\u0438\u043c \u0442\u0430\u043a\n\n# default_state - \u044d\u0442\u043e \u0442\u043e \u0436\u0435 \u0441\u0430\u043c\u043e\u0435, \u0447\u0442\u043e \u0438 StateFilter(None)\n@router.message(StateFilter(None), Command(commands=[\"cancel\"]))\n@router.message(default_state, F.text.lower() == \"\u043e\u0442\u043c\u0435\u043d\u0430\")\nasync def cmd_cancel_no_state(message: Message, state: FSMContext):\n    # \u0421\u0442\u0435\u0439\u0442 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0442\u044c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e, \u0443\u0434\u0430\u043b\u0438\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0430\u043d\u043d\u044b\u0435\n    await state.set_data({})\n    await message.answer(\n        text=\"\u041d\u0435\u0447\u0435\u0433\u043e \u043e\u0442\u043c\u0435\u043d\u044f\u0442\u044c\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n\n\n@router.message(Command(commands=[\"cancel\"]))\n@router.message(F.text.lower() == \"\u043e\u0442\u043c\u0435\u043d\u0430\")\nasync def cmd_cancel(message: Message, state: FSMContext):\n    await state.clear()\n    await message.answer(\n        text=\"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043e\u0442\u043c\u0435\u043d\u0435\u043d\u043e\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n</code></pre>"},{"location":"fsm/#entrypoint","title":"\u0424\u0430\u0439\u043b bot.py","text":"<p>\u041d\u0430\u043f\u043e\u0441\u043b\u0435\u0434\u043e\u043a \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0442\u043e\u0447\u043a\u0443 \u0432\u0445\u043e\u0434\u0430 \u2014 \u0444\u0430\u0439\u043b <code>bot.py</code> \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0438\u043c\u043f\u043e\u0440\u0442\u0430\u043c\u0438 \u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u043c\u0438 \u0440\u043e\u0443\u0442\u0435\u0440\u0430\u043c\u0438:</p> bot.py<pre><code>import asyncio\nimport logging\n\nfrom aiogram import Bot, Dispatcher\nfrom aiogram.fsm.storage.memory import MemoryStorage\n\n# \u0444\u0430\u0439\u043b config_reader.py \u043c\u043e\u0436\u043d\u043e \u0432\u0437\u044f\u0442\u044c \u0438\u0437 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f\n# \u043f\u0440\u0438\u043c\u0435\u0440 \u2014 \u0432 \u043f\u0435\u0440\u0432\u043e\u0439 \u0433\u043b\u0430\u0432\u0435\nfrom config_reader import config\nfrom handlers import common, ordering_food\n\n\nasync def main():\n    logging.basicConfig(\n        level=logging.INFO,\n        format=\"%(asctime)s - %(levelname)s - %(name)s - %(message)s\",\n    )\n\n    # \u0415\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u044c storage, \u0442\u043e \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u0431\u0443\u0434\u0435\u0442 MemoryStorage\n    # \u041d\u043e \u044f\u0432\u043d\u043e\u0435 \u043b\u0443\u0447\u0448\u0435 \u043d\u0435\u044f\u0432\u043d\u043e\u0433\u043e =]\n    dp = Dispatcher(storage=MemoryStorage())\n    bot = Bot(config.bot_token.get_secret_value())\n\n    dp.include_router(common.router)\n    dp.include_router(ordering_food.router)\n    # \u0441\u044e\u0434\u0430 \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u0432\u0430\u0448 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440 \u0434\u043b\u044f \u043d\u0430\u043f\u0438\u0442\u043a\u043e\u0432\n\n    await dp.start_polling(bot)\n\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre>"},{"location":"fsm/#strategies","title":"\u0420\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 FSM","text":"<p>Aiogram 3.x \u043f\u0440\u0438\u0432\u043d\u0451\u0441 \u043d\u0435\u043e\u0431\u044b\u0447\u043d\u043e\u0435, \u043d\u043e \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e\u0435 \u043d\u043e\u0432\u043e\u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0432 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0445 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u043e\u0432 \u2014 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 FSM. \u041e\u043d\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0442  \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043f\u0430\u0440 \u0434\u043b\u044f \u0441\u0442\u0435\u0439\u0442\u043e\u0432 \u0438 \u0434\u0430\u043d\u043d\u044b\u0445. \u0412\u0441\u0435\u0433\u043e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0439 \u0447\u0435\u0442\u044b\u0440\u0435, \u0432\u043e\u0442 \u043e\u043d\u0438:</p> <ul> <li>USER_IN_CHAT \u2014 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e. \u0421\u0442\u0435\u0439\u0442 \u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0430\u0437\u043d\u044b\u0435 \u0443 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u044e\u0437\u0435\u0440\u0430 \u0432 \u043a\u0430\u0436\u0434\u043e\u043c \u0447\u0430\u0442\u0435. \u0422\u043e \u0435\u0441\u0442\u044c, \u0443 \u044e\u0437\u0435\u0440\u0430 \u0431\u0443\u0434\u0443\u0442  \u0440\u0430\u0437\u043d\u044b\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0433\u0440\u0443\u043f\u043f\u0430\u0445, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0432 \u041b\u0421 \u0441 \u0431\u043e\u0442\u043e\u043c.</li> <li>CHAT \u2014 \u0441\u0442\u0435\u0439\u0442 \u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u0449\u0438\u0435 \u0434\u043b\u044f \u0432\u0441\u0435\u0433\u043e \u0447\u0430\u0442\u0430 \u0446\u0435\u043b\u0438\u043a\u043e\u043c. \u0412 \u041b\u0421 \u0440\u0430\u0437\u043d\u0438\u0446\u0430 \u043d\u0435\u0437\u0430\u043c\u0435\u0442\u043d\u0430, \u043d\u043e \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0443 \u0432\u0441\u0435\u0445 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0431\u0443\u0434\u0435\u0442  \u043e\u0434\u0438\u043d \u0441\u0442\u0435\u0439\u0442 \u0438 \u043e\u0431\u0449\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435.</li> <li>GLOBAL_USER \u2014 \u0432\u043e \u0432\u0441\u0435\u0445 \u0447\u0430\u0442\u0430\u0445 \u0443 \u043e\u0434\u043d\u043e\u0433\u043e \u0438 \u0442\u043e\u0433\u043e \u0436\u0435 \u044e\u0437\u0435\u0440\u0430 \u0431\u0443\u0434\u0435\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u0441\u0442\u0435\u0439\u0442 \u0438 \u0434\u0430\u043d\u043d\u044b\u0435.</li> <li>USER_IN_TOPIC \u2014 \u0443 \u044e\u0437\u0435\u0440\u0430 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u0435 \u0441\u0442\u0435\u0439\u0442\u044b \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u043e\u043f\u0438\u043a\u0430  \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0435-\u0444\u043e\u0440\u0443\u043c\u0435.</li> </ul> <p>\u0427\u0435\u0441\u0442\u043d\u043e \u0433\u043e\u0432\u043e\u0440\u044f, \u044f \u043d\u0435 \u043c\u043e\u0433\u0443 \u043f\u0440\u0438\u0434\u0443\u043c\u0430\u0442\u044c \u0445\u043e\u0440\u043e\u0448\u0438\u0439 use-case \u0434\u043b\u044f GLOBAL_USER, \u043e\u0434\u043d\u0430\u043a\u043e CHAT \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0431\u043e\u0442\u043e\u0432,  \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u044e\u0442 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u0438\u0433\u0440\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0430\u0445. \u0415\u0441\u043b\u0438 \u0432\u044b \u0437\u043d\u0430\u0435\u0442\u0435 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u044b\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0440\u0430\u0441\u0441\u043a\u0430\u0436\u0438\u0442\u0435 \u043e \u043d\u0438\u0445  \u0432 \u043d\u0430\u0448\u0435\u043c \u0447\u0430\u0442\u0438\u043a\u0435!</p> <p>\u0412 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044e, \u043a\u043e\u0433\u0434\u0430 \u0431\u043e\u0442 \u0434\u043b\u044f \u0437\u0430\u043a\u0430\u0437\u0430 \u0435\u0434\u044b \u043f\u043e\u0447\u0435\u043c\u0443-\u0442\u043e \u043e\u043a\u0430\u0437\u0430\u043b\u0441\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0438 \u0438\u043c\u0435\u0435\u0442 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e CHAT.  \u0410 \u0447\u0442\u043e\u0431\u044b \u044d\u0442\u043e \u0441\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043d\u0435\u0441\u0442\u0438 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u0440\u0430\u0432\u043a\u0438 \u0432 \u0444\u0430\u0439\u043b <code>bot.py</code>:</p> <pre><code># \u043d\u043e\u0432\u044b\u0439 \u0438\u043c\u043f\u043e\u0440\u0442\nfrom aiogram.fsm.strategy import FSMStrategy\n\nasync def main():\n    # \u0442\u0443\u0442 \u043a\u043e\u0434\n    dp = Dispatcher(storage=MemoryStorage(), fsm_strategy=FSMStrategy.CHAT)\n    # \u0442\u0443\u0442 \u0442\u043e\u0436\u0435 \u043a\u043e\u0434\n</code></pre> <p>\u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0431\u043e\u0442\u0430 \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u043c \u043b\u044e\u0434\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u043f\u043e\u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0441 \u043d\u0438\u043c:</p> <p></p> <p>\u0412\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0441\u0442\u0440\u0430\u043d\u043d\u043e, \u043d\u0435 \u043f\u0440\u0430\u0432\u0434\u0430 \u043b\u0438?</p> <p>\u0422\u0435\u043f\u0435\u0440\u044c, \u0432\u043e\u043e\u0440\u0443\u0436\u0438\u0432\u0448\u0438\u0441\u044c \u0437\u043d\u0430\u043d\u0438\u044f\u043c\u0438 \u043e \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0445 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0430\u0445, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0431\u0435\u0437\u0431\u043e\u044f\u0437\u043d\u0435\u043d\u043d\u043e \u043f\u0438\u0441\u0430\u0442\u044c \u0431\u043e\u0442\u043e\u0432 \u0441 \u0441\u0438\u0441\u0442\u0435\u043c\u043e\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432.</p>"},{"location":"inline-mode/","title":"\u0418\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c","text":""},{"location":"inline-mode/#-","title":"\u0418\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f aiogram: 3.7.0</p>"},{"location":"inline-mode/#theory","title":"\u0422\u0435\u043e\u0440\u0438\u044f","text":""},{"location":"inline-mode/#why-inline-mode","title":"\u0417\u0430\u0447\u0435\u043c \u043d\u0443\u0436\u0435\u043d \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c?","text":"<p>\u0412 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0433\u043b\u0430\u0432\u0430\u0445 \u0431\u043e\u0442 \u0438 \u0447\u0435\u043b\u043e\u0432\u0435\u043a \u043e\u0431\u0449\u0430\u043b\u0438\u0441\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u0441\u0430\u043c \u0437\u0430 \u0441\u0435\u0431\u044f, \u043e\u0434\u043d\u0430\u043a\u043e \u0432 Telegram \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c,  \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0449\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e\u0442 \u0441\u0432\u043e\u0435\u0433\u043e \u0438\u043c\u0435\u043d\u0438, \u043d\u043e \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0431\u043e\u0442\u0430. \u042d\u0442\u043e \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c  (Inline mode), \u0438 \u0432\u043e\u0442 \u043a\u0430\u043a \u043e\u043d \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0436\u0438\u0437\u043d\u0438:</p> <p></p> <p>\u041d\u043e \u043a\u0430\u043a \u043d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435 \u0432\u043e\u043e\u0431\u0449\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0442\u0430\u043a\u0443\u044e \u0444\u0438\u0447\u0443? \u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u044e \u0432\u0437\u0433\u043b\u044f\u043d\u0443\u0442\u044c \u043d\u0430 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043e\u043a\u043e\u043b\u043e-\u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0445 Telegram-\u0431\u043e\u0442\u043e\u0432, \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0435\u0441\u0442\u044c \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c:</p> <ul> <li>@gif </li> <li>@wiki</li> <li>@imdb</li> <li>@youtube</li> <li>@foursquare</li> <li>@music</li> <li>@gamee</li> <li>@like</li> </ul> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0442\u044c \u0434\u043e\u043b\u0433\u043e, \u043d\u043e \u0441\u0443\u0442\u044c, \u043d\u0430\u0434\u0435\u044e\u0441\u044c, \u044f\u0441\u043d\u0430: \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c \u043e\u0442\u043b\u0438\u0447\u043d\u043e \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0432\u0441\u0442\u0430\u0432\u043a\u0438  \u0432 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0447\u0430\u0442. \u0427\u0430\u0441\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0435\u0439 \u0442\u0430\u043a\u0438\u0445 \u0431\u043e\u0442\u043e\u0432 (like, poll, gif) Telegram \u0432\u043d\u0435\u0434\u0440\u0438\u043b \u0432 \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f, \u043d\u043e \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435  \u043e\u0442\u043b\u0438\u0447\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043f\u043e \u0441\u0435\u0439 \u0434\u0435\u043d\u044c.</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041d\u0430\u043f\u043e\u043c\u043d\u044e, \u0447\u0442\u043e \u0435\u0441\u043b\u0438 \u043a \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044e, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u0437 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0430, \u043f\u0440\u0438\u043a\u0440\u0435\u043f\u043b\u0435\u043d\u0430 \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0430 \u0441 \u043a\u043e\u043b\u0431\u044d\u043a-\u043a\u043d\u043e\u043f\u043a\u043e\u0439,  \u0442\u043e \u043f\u0440\u0438 \u0435\u0451 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u0431\u043e\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 <code>CallbackQuery</code> \u0431\u0435\u0437 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 <code>Message</code> \u0432\u043d\u0443\u0442\u0440\u0438. \u0412\u043c\u0435\u0441\u0442\u043e  \u044d\u0442\u043e\u0433\u043e \u0431\u0443\u0434\u0435\u0442 \u043c\u0430\u043b\u043e \u043e \u0447\u0451\u043c \u0433\u043e\u0432\u043e\u0440\u044f\u0449\u0438\u0439 <code>inline_message_id</code>.</p>"},{"location":"inline-mode/#incoming-update-format","title":"\u0424\u043e\u0440\u043c\u0430\u0442 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432","text":"<p>\u041a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0438\u0448\u0435\u0442 \u0432 \u0447\u0430\u0442\u0435 \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c \u0431\u043e\u0442\u0430 \u0438 \u0434\u0430\u043b\u0435\u0435 \u0432\u0432\u043e\u0434\u0438\u0442 \u0442\u0435\u043a\u0441\u0442, \u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0441\u044f \u0430\u043f\u0434\u0435\u0439\u0442 \u0442\u0438\u043f\u0430  InlineQuery. \u0415\u0441\u043b\u0438 \u0432\u043d\u0438\u043c\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0437\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430,  \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u043c\u0435\u0442\u0438\u0442\u044c \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0442\u0440\u0430\u043d\u043d\u043e\u0441\u0442\u0438. </p> <p>\u0412\u043e-\u043f\u0435\u0440\u0432\u044b\u0445, \u043d\u0435\u0442 \u0430\u0439\u0434\u0438 \u0447\u0430\u0442\u0430, \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0432\u044b\u0437\u0432\u0430\u043b\u0438 \u0431\u043e\u0442\u0430, \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0435  \u043f\u043e\u043b\u0435 <code>chat_type</code>, \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0435 (\u0435\u0441\u043b\u0438 \u043d\u0435\u043f\u0443\u0441\u0442\u043e\u0435) \u0442\u0438\u043f \u0447\u0430\u0442\u0430 (\u043b\u0438\u0447\u043a\u0430, \u0433\u0440\u0443\u043f\u043f\u0430, \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0430, \u043a\u0430\u043d\u0430\u043b). \u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u043e\u0441\u0442\u0430\u044f:  \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u043e\u0442\u0430 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435 \u043d\u0435 \u043d\u0430\u0434\u043e \u0435\u0433\u043e \u043d\u0438\u043a\u0443\u0434\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 Chat  \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u043b\u043e \u0431\u044b \u043d\u0435\u0437\u0430\u043c\u0435\u0442\u043d\u043e \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c \u0438 \u0441\u043e\u0431\u0438\u0440\u0430\u0442\u044c \u0447\u0430\u0442\u044b \u0432 \u0442\u0435\u043b\u0435\u0433\u0435. </p> <p>\u0412\u043e-\u0432\u0442\u043e\u0440\u044b\u0445, \u0435\u0441\u0442\u044c \u043f\u043e\u043b\u0435 <code>offset</code>, \u043f\u0440\u0438\u0447\u0451\u043c \u044d\u0442\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e, \u0430 \u0441\u0442\u0440\u043e\u043a\u0430. \u0414\u0435\u043b\u043e \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0431\u043e\u0442 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043d\u0435 \u0431\u043e\u043b\u0435\u0435  50 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u0438\u043d\u043b\u0430\u0439\u043d-\u0437\u0430\u043f\u0440\u043e\u0441. \u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435, \u043d\u0430\u0434\u043e \u043f\u0440\u0438 \u043e\u0442\u0432\u0435\u0442\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 <code>next_offset</code>,  \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u0434\u0443\u0431\u043b\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 \u043f\u043e\u043b\u0435 <code>offset</code> \u0443 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e <code>InlineQuery</code>. \u0422\u0430\u043a \u0431\u043e\u0442 \u043f\u043e\u0439\u043c\u0451\u0442, \u0447\u0442\u043e \u043d\u0430\u0434\u043e \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435,  \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 <code>offset</code>. \u0410 \u0441\u0442\u0440\u043e\u043a\u0430 \u044d\u0442\u043e \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043f\u043e\u043c\u0438\u043c\u043e \u0447\u0438\u0441\u0435\u043b \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u043a\u0438\u0435-\u043d\u0438\u0431\u0443\u0434\u044c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b, \u0442\u0438\u043f\u0430 UUID.</p>"},{"location":"inline-mode/#outgoing-answer-format","title":"\u0424\u043e\u0440\u043c\u0430\u0442 \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432","text":"<p>\u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0440\u043e\u0432\u043d\u043e \u043e\u0434\u0438\u043d \u043c\u0435\u0442\u043e\u0434:  answerInlineQuery.  \u041d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u0430\u0436 \u0446\u0435\u043b\u044b\u0445 20. \u0422\u043e\u0447\u043d\u0435\u0435,  \u043f\u043e \u0444\u0430\u043a\u0442\u0443 \u0438\u0445 11, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u0441\u0442\u0430\u0432\u0448\u0438\u0435\u0441\u044f \u2014 \u043f\u0440\u043e\u0441\u0442\u043e \u0442\u0435 \u0436\u0435 \u0442\u0438\u043f\u044b, \u043d\u043e \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>file_id</code>  \u0432\u043c\u0435\u0441\u0442\u043e \u0441\u0441\u044b\u043b\u043a\u0438 \u043d\u0430 \u043c\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043b. \u0420\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u0442\u0438\u043f\u044b \u043b\u0443\u0447\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u043d\u0435 \u0441\u043c\u0435\u0448\u0438\u0432\u0430\u0442\u044c \u0434\u0440\u0443\u0433 \u0441 \u0434\u0440\u0443\u0433\u043e\u043c, \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e Article \u0441 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u043c\u0438. \u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u0437 \u043d\u0438\u0445 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e.</p> <p></p> <p>\u041f\u043e\u0436\u0430\u043b\u0443\u0439, \u0441\u0430\u043c\u044b\u0439 \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 \u0442\u0438\u043f \u2014 \u044d\u0442\u043e InlineQueryResultArticle (\u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0438 \u0441\u0432\u0435\u0440\u0445\u0443). \u0412\u043e \u0432\u0441\u0435\u0445 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u0445 \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043a\u0430\u043a \u0441\u0442\u043e\u043f\u043a\u0430 \u0438\u0437 \u043f\u0440\u044f\u043c\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u044b\u0445 \u0431\u043b\u043e\u043a\u043e\u0432, \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0432\u0441\u0435\u0433\u0434\u0430 \u0435\u0441\u0442\u044c  \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a, \u0438\u043d\u043e\u0433\u0434\u0430 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435, \u0430 \u0441\u043b\u0435\u0432\u0430 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043b\u0438\u0431\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430-\u043f\u0440\u0435\u0432\u044c\u044e, \u043b\u0438\u0431\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u0437\u0430\u0433\u043b\u0443\u0448\u043a\u0430.  \u0415\u0441\u043b\u0438 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0437\u0430\u0434\u0430\u043b \u0430\u0442\u0440\u0438\u0431\u0443\u0442 <code>url</code>, \u0442\u043e \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u044b \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u044e\u0442 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u0441\u0441\u044b\u043b\u043a\u0443 \u043f\u043e\u0434 \u0441\u0442\u0440\u043e\u043a\u043e\u0439 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f, \u0430  \u043f\u0440\u0435\u0432\u044c\u044e \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u043a\u043b\u0438\u043a\u0430\u0431\u0435\u043b\u044c\u043d\u044b\u043c \u0438 \u0432\u0435\u0434\u0451\u0442 \u043f\u043e \u0441\u0430\u043c\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440. \u041f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043d\u0430 \u0441\u0442\u0440\u043e\u043a\u0443 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0442\u043e,  \u0447\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0435 <code>input_message_content</code> (\u043e\u043d \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043c\u043e\u0436\u0435\u0442 \u0438\u043c\u0435\u0442\u044c 5 \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432:</p> <ul> <li>\u0442\u0435\u043a\u0441\u0442</li> <li>\u0433\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044f</li> <li>\u0434\u043e\u0441\u0442\u043e\u043f\u0440\u0438\u043c\u0435\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c (venue)</li> <li>\u043a\u043e\u043d\u0442\u0430\u043a\u0442</li> <li>\u0441\u0447\u0451\u0442 \u043d\u0430 \u043e\u043f\u043b\u0430\u0442\u0443 (invoice)</li> </ul> <p></p> <p>\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0442\u0438\u043f\u044b \u043e\u0442\u043d\u043e\u0441\u044f\u0442\u0441\u044f \u043a \u0442.\u043d. \u00ab\u043c\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043b\u0430\u043c\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u044b \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439. \u041f\u0440\u0438 \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0430\u0431\u043e\u0440\u043e\u043c  \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432\u044b\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u043b\u0438\u0431\u043e \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043f\u043b\u0438\u0442\u043a\u0430\u043c\u0438, \u043a\u0430\u043a \u043d\u0430 \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442\u0435 \u0432\u044b\u0448\u0435, \u043b\u0438\u0431\u043e \u043f\u0440\u043e\u043a\u0440\u0443\u0447\u0438\u0432\u0430\u0435\u043c\u043e\u0439 \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u044c\u043d\u043e\u0439  \u043f\u043e\u043b\u043e\u0441\u043e\u0439 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432 iOS-\u0432\u0435\u0440\u0441\u0438\u0438). </p> <p>\u0415\u0441\u043b\u0438 \u0432\u044b \u0435\u0449\u0451 \u0440\u0430\u0437 \u043e\u0442\u043a\u0440\u043e\u0435\u0442\u0435 \u0440\u0430\u0437\u0434\u0435\u043b \u043f\u0440\u043e InlineQueryResult, \u0442\u043e  \u0443\u0432\u0438\u0434\u0438\u0442\u0435, \u0447\u0442\u043e Photo (\u043a\u0430\u043a \u0438 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u0435 \u0442\u0438\u043f\u044b) \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0434\u0432\u0443\u0445 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430\u0445:  <code>InlineQueryResultPhoto</code> \u0438 <code>InlineQueryResultCachedPhoto</code>. \u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0441\u0441\u044b\u043b\u043a\u0443  \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u0437 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0430, \u0430 \u0432\u0442\u043e\u0440\u043e\u0439 \u2014 <code>file_id</code> \u043e\u0442 \u0443\u0436\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0433\u043e \u0432 Telegram \u043c\u0435\u0434\u0438\u0430.</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0412 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u0437\u0430\u043b\u0438\u0432\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438\u0437 \u0444\u0430\u0439\u043b\u0430. \u041b\u0438\u0431\u043e \u0441\u0441\u044b\u043b\u043a\u0430 \u0432 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0435, \u043b\u0438\u0431\u043e <code>file_id</code>.  \u0422\u0440\u0435\u0442\u044c\u0435\u0433\u043e \u043d\u0435 \u0434\u0430\u043d\u043e.</p> <p>\u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u043c\u0435\u0434\u0438\u0430\u0444\u0430\u0439\u043b \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u044d\u0442\u043e\u0433\u043e \u043c\u0435\u0434\u0438\u0430 \u0432 \u0432\u044b\u0437\u0432\u0430\u043d\u043d\u044b\u0439 \u0447\u0430\u0442.  \u041e\u0434\u043d\u0430\u043a\u043e \u0435\u0441\u043b\u0438 \u0437\u0430\u0434\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 <code>input_message_content</code> (\u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 \u043c\u0435\u0434\u0438\u0430 \u043e\u043d \u0443\u0436\u0435 \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439), \u0442\u043e \u043f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u0431\u0443\u0434\u0435\u0442  \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0442\u043e, \u0447\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432 \u044d\u0442\u043e\u043c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0435. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u043e\u0431\u043b\u043e\u0436\u043a\u0443 \u0444\u0438\u043b\u044c\u043c\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442 \u0435\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435  \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u043e\u0439 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0432 \u043e\u043d\u043b\u0430\u0439\u043d-\u043a\u0438\u043d\u043e\u0442\u0435\u0430\u0442\u0440\u0435. \u0418\u043b\u0438 \u043f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043d\u0430 \u0444\u043e\u0442\u043e \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0441\u044f \u0435\u0433\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0432 \u0432\u0438\u0434\u0435  \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0430 \ud83d\udc40. \u041a\u0441\u0442\u0430\u0442\u0438, \u043d\u0435\u0441\u043c\u043e\u0442\u0440\u044f \u043d\u0430 \u0442\u043e, \u0447\u0442\u043e \u0443 \u043c\u0435\u0434\u0438\u0430 \u0435\u0441\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b <code>title</code> \u0438 <code>description</code>, \u043a\u043b\u0438\u0435\u043d\u0442\u044b \u0438\u0445 \u043d\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u044e\u0442,  \u0434\u0430 \u0438 \u0441\u0430\u043c Bot API \u0438\u0445 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442. </p> <p>\u0423 \u043c\u0435\u0442\u043e\u0434\u0430 answerInlineQuery \u0435\u0441\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0430\u0434\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435. \u0412\u043e-\u043f\u0435\u0440\u0432\u044b\u0445, \u044d\u0442\u043e <code>cache_time</code>.  \u041e\u043d \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442, \u043d\u0430 \u043a\u0430\u043a\u043e\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0437\u0430\u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c\u0438 \u0442\u0435\u043b\u0435\u0433\u0438, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0441\u043b\u0430\u0442\u044c \u0435\u0433\u043e \u0432 \u0431\u043e\u0442\u0430.  \u0415\u0441\u043b\u0438 \u0432\u0430\u0448\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0430\u0442\u0438\u0447\u043d\u044b\u0435 \u0438\u043b\u0438 \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u0440\u0435\u0434\u043a\u043e, \u0441\u043c\u0435\u043b\u043e \u043f\u043e\u0432\u044b\u0448\u0430\u0439\u0442\u0435 \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435. \u0412\u043e-\u0432\u0442\u043e\u0440\u044b\u0445, \u0444\u043b\u0430\u0433 <code>is_personal</code>,  \u0432\u043b\u0438\u044f\u044e\u0449\u0438\u0439 \u043d\u0430 \u0442\u043e, \u0431\u0443\u0434\u0435\u0442 \u043b\u0438 \u0437\u0430\u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u0441\u0440\u0430\u0437\u0443 \u0434\u043b\u044f \u0432\u0441\u0435\u0445. \u0415\u0441\u043b\u0438 \u0432\u0430\u0448 \u0431\u043e\u0442  \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 ID \u044e\u0437\u0435\u0440\u0430, \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0432 True.</p> <p>\u0410\u0432\u0442\u043e\u0440 \u044d\u0442\u0438\u0445 \u0441\u0442\u0440\u043e\u043a \u043e\u0434\u043d\u0430\u0436\u0434\u044b \u0437\u0430\u0431\u044b\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0444\u043b\u0430\u0433 <code>is_personal</code> \u0432 \u0435\u0433\u043e \u0431\u043e\u0442\u0435 @my_id_bot,  \u0432\u044b\u0441\u0442\u0430\u0432\u0438\u043b \u043a\u044d\u0448 \u043d\u0430 86400 \u0441\u0435\u043a\u0443\u043d\u0434 (1 \u0441\u0443\u0442\u043a\u0438) \u0438 \u0432\u044b\u0441\u043b\u0443\u0448\u0430\u043b \u043c\u043d\u043e\u0433\u043e \u0432\u043e\u0437\u043c\u0443\u0449\u0435\u043d\u0438\u0439 \u043e\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0432\u0448\u0438\u0445 \u0435\u0433\u043e ID \u0432\u043c\u0435\u0441\u0442\u043e \u0438\u0445  \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445. \u0423\u0447\u0438\u0442\u0435\u0441\u044c \u043d\u0430 \u0447\u0443\u0436\u0438\u0445 \u043e\u0448\u0438\u0431\u043a\u0430\u0445, \u043d\u0435 \u043d\u0430 \u0441\u0432\u043e\u0438\u0445.</p> <p>\u0412-\u0442\u0440\u0435\u0442\u044c\u0438\u0445, \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 <code>next_offset</code>, \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0449\u0438\u0439 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u043a\u0443 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u043f\u043e \u043c\u0435\u0440\u0435 \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443  \u0432 \u043e\u0434\u043d\u043e\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0430 InlineQuery \u043c\u043e\u0436\u043d\u043e \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0435 \u0431\u043e\u043b\u0435\u0435 50 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 <code>next_offset</code> \u043c\u044b \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u043c  \u043f\u0440\u0438\u043c\u0435\u0440\u0435.</p> <p>\u0412-\u0447\u0435\u0442\u0432\u0451\u0440\u0442\u044b\u0445, <code>switch_pm_text</code> \u0438 <code>switch_pm_parameter</code>. \u041f\u043e\u043c\u0438\u043c\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u0431\u043e\u0442 \u043c\u043e\u0436\u0435\u0442 \u043d\u0430\u0434 \u043d\u0438\u043c\u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0443\u044e  \u043a\u043d\u043e\u043f\u043e\u0447\u043a\u0443 \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c \u0438\u0437 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 <code>switch_pm_text</code>, \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0434\u0438\u043f\u043b\u0438\u043d\u043a\u0443, \u0442.\u0435. \u044e\u0437\u0435\u0440 \u043f\u0435\u0440\u0435\u0439\u0434\u0451\u0442 \u0432  \u043b\u0438\u0447\u043a\u0443 \u0441 \u0431\u043e\u0442\u043e\u043c, \u0432\u043c\u0435\u0441\u0442\u043e \u043f\u043e\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u043a\u043d\u043e\u043f\u043a\u0430 \u00ab\u041d\u0410\u0427\u0410\u0422\u042c\u00bb, \u0430 \u043f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u0431\u043e\u0442\u0443 \u043f\u0440\u0438\u043b\u0435\u0442\u0438\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c  <code>/start \u0422\u0415\u041a\u0421\u0422</code>, \u0433\u0434\u0435 \u0432\u043c\u0435\u0441\u0442\u043e \u0422\u0415\u041a\u0421\u0422 \u2014 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 <code>switch_pm_parameter</code>.</p> <p></p> <p>\u041f\u043e\u0434\u043e\u0431\u043d\u0443\u044e \u0448\u0442\u0443\u043a\u0443 \u043e\u0447\u0435\u043d\u044c \u0443\u0434\u043e\u0431\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c, \u0435\u0441\u043b\u0438 \u043f\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0438\u043b\u0438 \u0445\u043e\u0447\u0435\u0442\u0441\u044f \u0434\u0430\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c  \u044e\u0437\u0435\u0440\u0443 \u0431\u044b\u0441\u0442\u0440\u043e \u0447\u0442\u043e-\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c. \u0415\u0441\u0442\u044c \u0438 \u0435\u0449\u0451 \u043e\u0434\u043d\u0430 \u0444\u0438\u0447\u0430, \u043d\u043e \u0435\u0451 \u043c\u044b \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043f\u043e\u0437\u0434\u043d\u0435\u0435 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0431\u043e\u0442\u0430. \u041a\u0441\u0442\u0430\u0442\u0438,  \u043e \u043d\u0451\u043c... </p>"},{"location":"inline-mode/#practice","title":"\u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430","text":"<p>\u0427\u0442\u043e\u0431\u044b \u0431\u043e\u0442 \u0437\u043d\u0430\u043b, \u0447\u0442\u043e \u043d\u0430\u0434\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435, \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u044b \u043a\u0430\u043a\u0438\u0435-\u0442\u043e \u0434\u0430\u043d\u043d\u044b\u0435: \u043b\u0438\u0431\u043e \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435,  \u043b\u0438\u0431\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c\u044b\u0435 \u043e\u0442 \u0441\u0430\u043c\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f. \u0412 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0431\u043e\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043e\u0442 \u044e\u0437\u0435\u0440\u0430 \u0441\u0441\u044b\u043b\u043a\u0438  \u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u044d\u0442\u043e \u0432\u0441\u0451 \u0434\u043e\u0431\u0440\u043e \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435 \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443.</p> <p>\u041d\u0435 \u0437\u0430\u0431\u0443\u0434\u044c\u0442\u0435 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c \u0443 \u0431\u043e\u0442\u0430 \u0447\u0435\u0440\u0435\u0437 @BotFather:  Bot Settings -&gt; Inline Mode -&gt; Turn on</p>"},{"location":"inline-mode/#storage","title":"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f","text":"<p>\u0414\u0430\u0431\u044b \u043d\u0435 \u043f\u043e\u0433\u0440\u0443\u0436\u0430\u0442\u044c\u0441\u044f \u0441\u0438\u043b\u044c\u043d\u043e \u0432 \u0434\u0435\u0442\u0430\u043b\u0438, \u0442\u0435\u043c \u0431\u043e\u043b\u0435\u0435, \u0447\u0442\u043e \u044d\u0442\u0430 \u0433\u043b\u0430\u0432\u0430 \u0438 \u0442\u0430\u043a \u0434\u043e\u0432\u043e\u043b\u044c\u043d\u043e \u0434\u043b\u0438\u043d\u043d\u0430\u044f, \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0438\u043c\u0441\u044f, \u0447\u0442\u043e \u043d\u0430\u0448 \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0439  \u0431\u043e\u0442 \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044b\u0447\u043d\u044b\u0439 in-memory \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0438\u043c\u0438\u0442\u0430\u0446\u0438\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445. \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u043d\u0435 \u0437\u0430\u043c\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044c\u0441\u044f  \u043f\u043e \u043f\u043e\u0432\u043e\u0434\u0443 \u0441\u0431\u0440\u043e\u0441\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043f\u0440\u0438 \u043e\u0442\u043b\u0430\u0434\u043a\u0435, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0443\u043f\u0440\u043e\u0441\u0442\u0438\u0442 \u043d\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0437\u0430\u0440\u0430\u043d\u0435\u0435, \u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u0434\u0440\u0443\u0433 \u0437\u0430\u0445\u043e\u0442\u0438\u0442\u0435  \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0431\u043e\u0442\u0430 \u0441\u0440\u0430\u0437\u0443 \u0441 \u0433\u043e\u0442\u043e\u0432\u044b\u043c\u0438 \u0441\u0441\u044b\u043b\u043a\u0430\u043c\u0438 \u0438\u043b\u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430\u043c\u0438. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u0437 \u0434\u0432\u0443\u0445 \u0442\u0438\u043f\u043e\u0432 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e \u0442\u0440\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0438:  \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435, \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435, \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435. \u0421\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0432\u043e\u0442 \u0432\u0435\u0441\u044c \u043a\u043e\u0434 \u0444\u0430\u0439\u043b\u0430:</p> storage.py<pre><code>from typing import Optional\n\n# \u0412 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0436\u0438\u0437\u043d\u0438 \u0437\u0434\u0435\u0441\u044c \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0421\u0423\u0411\u0414.\n# \u041d\u043e \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u043d\u0430\u043c \u0431\u0443\u0434\u0435\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430 \u043e\u0431\u044b\u0447\u043d\u043e\u043c \u0441\u043b\u043e\u0432\u0430\u0440\u0435.\n# \u0423\u0447\u0442\u0438\u0442\u0435, \u0447\u0442\u043e \u043e\u043d \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0431\u043e\u0442\u0430.\ndata = dict()\n\n\ndef add_link(\n        telegram_id: int,\n        link: str,\n        title: str,\n        description: Optional[str]\n):\n    \"\"\"\n    \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0441\u0441\u044b\u043b\u043a\u0443 \u0432 \u0441\u043b\u043e\u0432\u0430\u0440\u044c\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :param link: \u0442\u0435\u043a\u0441\u0442 \u0441\u0441\u044b\u043b\u043a\u0438\n    :param title: \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0441\u0441\u044b\u043b\u043a\u0438\n    :param description: (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e) \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u0441\u044b\u043b\u043a\u0438\n    \"\"\"\n    data.setdefault(telegram_id, dict())\n    data[telegram_id].setdefault(\"links\", dict())\n    data[telegram_id][\"links\"][link] = {\n        \"title\": title,\n        \"description\": description\n    }\n\ndef add_photo(\n        telegram_id: int,\n        photo_file_id: str,\n        photo_unique_id: str\n):\n    \"\"\"\n    \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 \u0441\u043b\u043e\u0432\u0430\u0440\u044c\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :param photo_file_id: file_id \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n    :param photo_unique_id: file_unique_id \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n    \"\"\"\n    data.setdefault(telegram_id, dict())\n    data[telegram_id].setdefault(\"images\", [])\n    if photo_file_id not in data[telegram_id][\"images\"]:\n        data[telegram_id][\"images\"].append((photo_file_id, photo_unique_id))\n\ndef get_links_by_id(telegram_id: int) -&gt; dict:\n    \"\"\"\n    \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435 \u0441\u0441\u044b\u043b\u043a\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :return: \u0435\u0441\u043b\u0438 \u043f\u043e \u044e\u0437\u0435\u0440\u0443 \u0435\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435, \u0442\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u0430\u043c\u0438\n    \"\"\"\n    if telegram_id in data and \"links\" in data[telegram_id]:\n        return data[telegram_id][\"links\"]\n    return dict()\n\ndef get_images_by_id(telegram_id: int) -&gt; list[str]:\n    \"\"\"\n    \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :return:\n    \"\"\"\n    if telegram_id in data and \"images\" in data[telegram_id]:\n        return [item[0] for item in data[telegram_id][\"images\"]]\n    return []\n\ndef delete_link(telegram_id: int, link: str):\n    \"\"\"\n    \u0423\u0434\u0430\u043b\u044f\u0435\u0442 \u0441\u0441\u044b\u043b\u043a\u0443\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :param link: \u0441\u0441\u044b\u043b\u043a\u0430\n    \"\"\"\n    if telegram_id in data:\n        if \"links\" in data[telegram_id]:\n            if link in data[telegram_id][\"links\"]:\n                del data[telegram_id][\"links\"][link]\n\ndef delete_image(telegram_id: int, photo_file_unique_id: str):\n    \"\"\"\n    \u0423\u0434\u0430\u043b\u044f\u0435\u0442 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\n\n    :param telegram_id: ID \u044e\u0437\u0435\u0440\u0430 \u0432 Telegram\n    :param photo_file_unique_id: file_unique_id \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f\n    \"\"\"\n    if telegram_id in data and \"images\" in data[telegram_id]:\n        for index, (_, unique_id) in enumerate(data[telegram_id][\"images\"]):\n            if unique_id == photo_file_unique_id:\n                data[telegram_id][\"images\"].pop(index)\n</code></pre>"},{"location":"inline-mode/#common-commands","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b \u0432 \u0431\u043e\u0442\u0435","text":"<p>\u0423 \u0431\u043e\u0442\u0430 \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043e\u0431\u0449\u0438\u0445 \u043a\u043e\u043c\u0430\u043d\u0434: <code>/start</code>, <code>/help</code>, <code>/save</code>, <code>/delete</code> \u0438 <code>/cancel</code>. \u041f\u0435\u0440\u0432\u044b\u0435 \u0434\u0432\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435,  <code>/save</code> \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445, <code>/delete</code> \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445, \u0430 <code>/cancel</code>, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e,  \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442 \u043e\u0434\u0438\u043d \u0438\u0437 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432. \u041d\u0430\u0447\u043d\u0451\u043c \u0441 \u043a\u043e\u043c\u0430\u043d\u0434\u044b <code>/save</code>.</p>"},{"location":"inline-mode/#data-saving","title":"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u041d\u0430 \u044d\u0442\u043e\u0442 \u0440\u0430\u0437 \u043c\u044b \u043e\u043f\u0438\u0448\u0435\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (states) \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u043c \u0444\u0430\u0439\u043b\u0435, \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u043e \u0443\u0434\u043e\u0431\u043d\u0435\u0435 \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u0444\u0430\u0439\u043b  <code>states.py</code> \u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u043a\u043b\u0430\u0441\u0441 <code>SaveCommon</code>, \u0433\u0434\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0434\u043d\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u00ab\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u0432\u043e\u0434\u00bb:</p> states.py<pre><code>from aiogram.fsm.state import StatesGroup, State\n\nclass SaveCommon(StatesGroup):\n    waiting_for_save_start = State()\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0437\u0430\u0439\u043c\u0451\u043c\u0441\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u043e\u0439 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 </p>"},{"location":"inline-mode/#save-text","title":"\u0422\u0435\u043a\u0441\u0442","text":"<p>\u041d\u0430\u0447\u043d\u0451\u043c \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u0418\u0434\u0435\u044f \u043f\u0440\u043e\u0441\u0442\u0430\u044f: \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043a\u0438\u0434\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u0415\u0441\u043b\u0438 \u0442\u0430\u043c \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430, \u0442\u043e  \u043e\u043d\u0430 \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442\u0441\u044f, \u0430 \u0434\u0430\u043b\u0435\u0435 \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442\u0441\u044f \u0432\u0432\u0435\u0441\u0442\u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0441\u044b\u043b\u043a\u0438 (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e) \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435. \u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0448\u0430\u0433 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c  \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439 <code>/skip</code>. \u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043e\u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e, \u0442\u043e \u0431\u0435\u0440\u0451\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0432\u0430\u044f.</p> <p>\u041f\u043e\u043c\u0438\u043c\u043e \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0433\u043e \u0432\u044b\u0448\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u00ab\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u0432\u043e\u0434\u00bb, \u0431\u0443\u0434\u0435\u0442 \u0435\u0449\u0451 \u0434\u0432\u0430 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0445 \u0434\u043b\u044f \u0442\u0435\u043a\u0441\u0442\u0430: \u00ab\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u0432\u043e\u0434 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430\u00bb \u0438  \u00ab\u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u0432\u043e\u0434 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f\u00bb. \u0412 <code>states.py</code> \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u044d\u0442\u0438 \u0441\u0442\u0435\u0439\u0442\u044b:</p> states.py<pre><code># \u0442\u0443\u0442 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043a\u043e\u0434\n\nclass TextSave(StatesGroup):\n    waiting_for_title = State()\n    waiting_for_description = State()\n</code></pre> <p>\u041d\u0430\u0447\u043d\u0451\u043c \u0441 \u0434\u0432\u0443\u0445 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432 \u043d\u0430 \u0442\u0435\u043a\u0441\u0442 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 <code>SaveCommon</code> -&gt; <code>waiting_for_save_start</code>. \u041d\u0430\u0434\u043e \u043b\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u0430\u043c\u0438.  \u0412 \u0433\u043b\u0430\u0432\u0435 \u043f\u0440\u043e \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0438 \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u0438 \u043c\u044b \u0443\u0436\u0435 \u0434\u0435\u043b\u0430\u043b\u0438 \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u0444\u0438\u043b\u044c\u0442\u0440, \u043d\u043e \u0434\u043b\u044f  \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u043e\u0432. \u041d\u0430\u0441\u0442\u0430\u043b\u043e \u0432\u0440\u0435\u043c\u044f \u0435\u0433\u043e \u043e\u0442\u0442\u0443\u0434\u0430 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0430\u0434\u0430\u043f\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0434 \u0441\u0441\u044b\u043b\u043a\u0438:</p> filters/text_has_link.py<pre><code>from typing import Union, Dict, Any\n\nfrom aiogram.filters import BaseFilter\nfrom aiogram.types import Message\n\n\nclass HasLinkFilter(BaseFilter):\n    async def __call__(self, message: Message) -&gt; Union[bool, Dict[str, Any]]:\n        # \u0415\u0441\u043b\u0438 entities \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0435\u0442, \u0432\u0435\u0440\u043d\u0451\u0442\u0441\u044f None,\n        # \u0432 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0441\u0447\u0438\u0442\u0430\u0435\u043c, \u0447\u0442\u043e \u044d\u0442\u043e \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\n        entities = message.entities or []\n\n        # \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c \u0435\u0451\n        for entity in entities:\n            if entity.type == \"url\":\n                return {\"link\": entity.extract_from(message.text)}\n\n        # \u0415\u0441\u043b\u0438 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0448\u043b\u0438, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c None\n        return False\n</code></pre> <p>\u0427\u0442\u043e\u0431\u044b \u0441\u043e\u043a\u0440\u0430\u0442\u0438\u0442\u044c \u0438\u043c\u043f\u043e\u0440\u0442, \u043e\u0442\u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u0443\u0435\u043c \u0444\u0430\u0439\u043b <code>filters/__init__.py</code>:</p> filters/__init__.py<pre><code>from .text_has_link import HasLinkFilter\n\n# \u0414\u0435\u043b\u0430\u0435\u043c \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0442\u0435\u043c \u043f\u0440\u043e\u0441\u0442\u043e \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\n# from filters import HasLinkFilter\n__all__ = [\n    \"HasLinkFilter\"\n]\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432 \u043d\u0430 \u0442\u0435\u043a\u0441\u0442 \u043d\u0443\u0436\u043d\u043e \u0434\u0432\u0430? \u041f\u0435\u0440\u0432\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043b\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u0433\u0434\u0435 \u0435\u0441\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0430, \u0430 \u0432\u0442\u043e\u0440\u043e\u0439 \u2014 \u0433\u0434\u0435 \u0435\u0451 \u043d\u0435\u0442. \u041f\u0438\u0448\u0435\u043c:</p> handlers/save_text.py<pre><code># &lt;\u0438\u043c\u043f\u043e\u0440\u0442\u044b&gt;\n\n@router.message(SaveCommon.waiting_for_save_start, F.text, HasLinkFilter())\nasync def save_text_has_link(message: Message, link: str, state: FSMContext):\n    await state.update_data(link=link)\n    await state.set_state(TextSave.waiting_for_title)\n    await message.answer(\n        text=f\"\u041e\u043a\u0435\u0439, \u044f \u043d\u0430\u0448\u0451\u043b \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u0441\u0441\u044b\u043b\u043a\u0443 {link}. \"\n             f\"\u0422\u0435\u043f\u0435\u0440\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u044c \u043c\u043d\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a (\u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)\"\n    )\n\n@router.message(SaveCommon.waiting_for_save_start, F.text)\nasync def save_text_no_link(message: Message):\n    await message.answer(\n        text=\"\u042d\u043c\u043c.. \u044f \u043d\u0435 \u043d\u0430\u0448\u0451\u043b \u0432 \u0442\u0432\u043e\u0451\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u0441\u0441\u044b\u043b\u043a\u0443. \"\n             \"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0451 \u0440\u0430\u0437 \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438 /cancel, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c.\"\n    )\n</code></pre> <p>\u0414\u0430\u043b\u0435\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u043c \u043e\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432\u0432\u043e\u0434 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0437\u0430\u043f\u0438\u0441\u0438. \u0417\u0434\u0435\u0441\u044c \u0442\u043e\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u043d\u0430 \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430: \u0434\u043b\u044f \u0443\u0434\u0430\u0447\u043d\u043e\u0433\u043e  \u0438 \u043d\u0435\u0443\u0434\u0430\u0447\u043d\u043e\u0433\u043e \u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u0441\u0442\u0432:</p> handlers/save_text.py<pre><code># \u0438\u043c\u043f\u043e\u0440\u0442\u044b \u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0448\u0430\u0433\u0438\n\n@router.message(TextSave.waiting_for_title, F.text.func(len) &lt;= 30)\nasync def title_entered_ok(message: Message, state: FSMContext):\n    await state.update_data(title=message.text, description=None)\n    await state.set_state(TextSave.waiting_for_description)\n    await message.answer(\n        text=\"\u0422\u0430\u043a, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0438\u0436\u0443. \u0422\u0435\u043f\u0435\u0440\u044c \u0432\u0432\u0435\u0434\u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \"\n             \"(\u0442\u043e\u0436\u0435 \u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432) \"\n             \"\u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438 /skip, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0448\u0430\u0433\"\n    )\n\n@router.message(TextSave.waiting_for_title, F.text)\nasync def too_long_title(message: Message):\n    await message.answer(\"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0451 \u0440\u0430\u0437\")\n    return\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043a\u043e\u0434 <code>F.text.func(len) &lt;= 30</code>. Magic filter \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043d\u0430 \u0432\u0445\u043e\u0434 \u043a\u0430\u043a\u0443\u044e-\u043b\u0438\u0431\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0430\u044f  \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u043d\u0430\u0434 \u0442\u0435\u043c, \u0447\u0442\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0434\u043e <code>.func</code>. \u0422.\u0435. <code>F.text.func(len)</code> -&gt; <code>len(F.text)</code> \u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 <code>.text</code>  \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f None (\u0438\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u0437\u0434\u0435\u0441\u044c \u0435\u0449\u0451 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442-\u0442\u0430\u0439\u043f). \u041d\u043e \u0432\u043e\u043e\u0431\u0449\u0435 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e \u0434\u043b\u044f <code>len()</code>  \u0435\u0441\u0442\u044c \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u043f\u0440\u044f\u043c \u0432  magic-filter:  <code>F.text.len() &lt;= 30</code></p> <p>\u041d\u0430 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0430 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435. \u0417\u0434\u0435\u0441\u044c \u043c\u043e\u0436\u043d\u043e \u0441\u043d\u043e\u0432\u0430 \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u043d\u0430 \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430... \u043f\u043e\u0441\u0442\u043e\u0439\u0442\u0435, \u043d\u043e \u0432\u0435\u0434\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044f <code>too_long_title()</code>,  \u043f\u043e \u0441\u0443\u0442\u0438, \u043c\u043e\u0436\u0435\u0442 \u0442\u0430\u043a \u0436\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442\u044c \u0438 \u0434\u043b\u044f \u0448\u0430\u0433\u0430 \u0441 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435\u043c, \u0440\u0430\u0437 \u0443\u0436 \u0443 \u043d\u0430\u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u043b\u0438\u043c\u0438\u0442\u044b \u043d\u0430 \u0442\u0435\u043a\u0441\u0442! \u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u0443\u0435\u043c \u0435\u0451 \u0438  \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0444\u0438\u043b\u044c\u0442\u0440 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u0441\u0442\u0435\u0439\u0442:</p> handlers/save_text.py<pre><code>@router.message(TextSave.waiting_for_title, F.text)\n@router.message(TextSave.waiting_for_description, F.text)\nasync def text_too_long(message: Message):  # \u0431\u044b\u0432\u0448. too_long_title()\n    await message.answer(\"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0451 \u0440\u0430\u0437\")\n    return\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0432\u043e\u0437\u044c\u043c\u0451\u043c\u0441\u044f \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0445\u044d\u043d\u0434\u043b\u0435\u0440, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u043c \u043b\u0438\u0431\u043e \u043f\u0440\u0438 \u0432\u0432\u043e\u0434\u0435 \u043a\u043e\u0440\u043e\u0442\u043a\u043e\u0433\u043e \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f, \u043b\u0438\u0431\u043e \u043f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/skip</code>.  \u0410 \u0440\u0430\u0437 \u043d\u0430\u0434\u043e \u043b\u043e\u0432\u0438\u0442\u044c \u0434\u0432\u0430 \u0432\u0445\u043e\u0434\u0430, \u0442\u043e \u0432\u0435\u0448\u0430\u0435\u043c \u0434\u0432\u0430 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430, \u0432 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430\u0445 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u043c \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 <code>CommandObject</code> \u0438 \u0432\u043d\u0443\u0442\u0440\u0438  \u0441\u043c\u043e\u0442\u0440\u0438\u043c: \u0435\u0441\u043b\u0438 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043d\u0435\u0442, \u0437\u043d\u0430\u0447\u0438\u0442, \u0432\u0432\u0435\u043b\u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435:</p> handlers/save_text.py<pre><code># \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u041f\u0415\u0420\u0415\u0414 text_too_long() !\n@router.message(TextSave.waiting_for_description, F.text.func(len) &lt;= 30)\n@router.message(TextSave.waiting_for_description, Command(\"skip\"))\nasync def last_step(\n        message: Message,\n        state: FSMContext,\n        command: Optional[CommandObject] = None\n):\n    if not command:\n        await state.update_data(description=message.text)\n    # \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0430\u0448\u0443 \u043d\u0435\u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0443\u044e \u0411\u0414\n    data = await state.get_data()\n    add_link(message.from_user.id, data[\"link\"], data[\"title\"], data[\"description\"])\n\n    await message.answer(\"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430!\")\n    await state.clear()\n</code></pre> <p>\u0418\u0442\u0430\u043a, \u043c\u044b \u0441\u0434\u0435\u043b\u0430\u043b\u0438 \u043d\u0430\u0431\u043e\u0440 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432 \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u0441\u044b\u043b\u043e\u043a \u0432 \u043d\u0430\u0448\u0443 in-memory \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \u0412\u043e\u0442 \u0432\u0435\u0441\u044c \u043a\u043e\u0434 \u0444\u0430\u0439\u043b\u0430 \u0446\u0435\u043b\u0438\u043a\u043e\u043c:</p> handlers/save_text.py<pre><code>from typing import Optional\n\nfrom aiogram import Router, F\nfrom aiogram.filters.command import Command, CommandObject\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton\n\nfrom filters import HasLinkFilter\nfrom states import SaveCommon, TextSave\nfrom storage import add_link\n\nrouter = Router()\n\n@router.message(SaveCommon.waiting_for_save_start, F.text, HasLinkFilter())\nasync def save_text_has_link(message: Message, link: str, state: FSMContext):\n    await state.update_data(link=link)\n    await state.set_state(TextSave.waiting_for_title)\n    await message.answer(\n        text=f\"\u041e\u043a\u0435\u0439, \u044f \u043d\u0430\u0448\u0451\u043b \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u0441\u0441\u044b\u043b\u043a\u0443 {link}. \"\n             f\"\u0422\u0435\u043f\u0435\u0440\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u044c \u043c\u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 (\u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)\"\n    )\n\n@router.message(SaveCommon.waiting_for_save_start, F.text)\nasync def save_text_no_link(message: Message):\n    await message.answer(\n        text=\"\u042d\u043c\u043c.. \u044f \u043d\u0435 \u043d\u0430\u0448\u0451\u043b \u0432 \u0442\u0432\u043e\u0451\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u0441\u0441\u044b\u043b\u043a\u0443. \"\n             \"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0451 \u0440\u0430\u0437 \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438 /cancel, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c.\"\n    )\n\n@router.message(TextSave.waiting_for_title, F.text.func(len) &lt;= 30)\nasync def title_entered_ok(message: Message, state: FSMContext):\n    await state.update_data(title=message.text, description=None)\n    await state.set_state(TextSave.waiting_for_description)\n    await message.answer(\n        text=\"\u0422\u0430\u043a, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0438\u0436\u0443. \u0422\u0435\u043f\u0435\u0440\u044c \u0432\u0432\u0435\u0434\u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \"\n             \"(\u0442\u043e\u0436\u0435 \u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 30 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432) \"\n             \"\u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438 /skip, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0448\u0430\u0433\"\n    )\n\n@router.message(TextSave.waiting_for_description, F.text.func(len) &lt;= 30)\n@router.message(TextSave.waiting_for_description, Command(\"skip\"))\nasync def last_step(\n        message: Message,\n        state: FSMContext,\n        command: Optional[CommandObject] = None\n):\n    if not command:\n        await state.update_data(description=message.text)\n    # \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0430\u0448\u0443 \u043d\u0435\u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0443\u044e \u0411\u0414\n    data = await state.get_data()\n    add_link(message.from_user.id, data[\"link\"], data[\"title\"], data[\"description\"])\n    await state.clear()\n    kb = [[InlineKeyboardButton(\n        text=\"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c\",\n        switch_inline_query=\"links\"\n    )]]\n    await message.answer(\n        text=\"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430!\",\n        reply_markup=InlineKeyboardMarkup(inline_keyboard=kb)\n    )\n\n@router.message(TextSave.waiting_for_title, F.text)\n@router.message(TextSave.waiting_for_description, F.text)\nasync def text_too_long(message: Message):\n    await message.answer(\"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0435\u0449\u0451 \u0440\u0430\u0437\")\n    return\n</code></pre>"},{"location":"inline-mode/#save-images","title":"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f","text":"<p>\u0421 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430\u043c\u0438 \u0433\u043e\u0440\u0430\u0437\u0434\u043e \u043f\u0440\u043e\u0449\u0435; \u043e\u043d\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0432 \u043e\u0434\u0438\u043d \u0448\u0430\u0433. \u041d\u043e \u0435\u0441\u0442\u044c \u043d\u044e\u0430\u043d\u0441: \u043f\u043e\u043c\u0438\u043c\u043e <code>file_id</code> \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f,  \u043d\u0430\u043c \u043d\u0430\u0434\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c <code>file_unique_id</code>, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u043d \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u0441\u044f, \u043a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u043c \u044e\u0437\u0435\u0440\u0443 \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438:</p> handlers/save_images.py<pre><code>from aiogram import Router, F\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.types import Message, PhotoSize\nfrom states import SaveCommon\nfrom storage import add_photo\n\nrouter = Router()\n\n@router.message(SaveCommon.waiting_for_save_start, F.photo[-1].as_(\"photo\"))\nasync def save_image(message: Message, photo: PhotoSize, state: FSMContext):\n    add_photo(message.from_user.id, photo.file_id, photo.file_unique_id)\n    await message.answer(\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!\")\n    await state.clear()\n</code></pre>"},{"location":"inline-mode/#show-data","title":"\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u041e\u043a\u0435\u0439, \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u043d\u0430\u0443\u0447\u0438\u043b\u0438\u0441\u044c, \u0442\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u0434\u043e \u0438\u0445 \u043a\u0430\u043a-\u0442\u043e \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0431\u043e\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043b\u043e\u0432\u0438\u0442\u044c \u0430\u043f\u0434\u0435\u0439\u0442\u044b \u0441 \u0442\u0438\u043f\u043e\u043c  <code>inline_query</code>, \u0430 \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043f\u0440\u0438\u0434\u0451\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 \u0442\u0438\u043f\u0430 InlineQuery.  \u0423\u0441\u043b\u043e\u0432\u0438\u043c\u0441\u044f, \u0447\u0442\u043e \u043d\u0430 \u043f\u0443\u0441\u0442\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 (\u043f\u043e\u043a\u0430) \u043d\u0438\u0447\u0435\u0433\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043d\u0435 \u0431\u0443\u0434\u0435\u043c, \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441 <code>@bot links</code> \u043f\u043e\u043a\u0430\u0436\u0435\u043c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0441\u044b\u043b\u043e\u043a, \u0430  \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441 <code>@bot images</code> \u2014 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438. \u0412\u043c\u0435\u0441\u0442\u043e <code>@bot</code>, \u043a\u043e\u043d\u0435\u0447\u043d\u043e \u0436\u0435, \u0431\u0443\u0434\u0435\u0442 \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c \u0431\u043e\u0442\u0430.</p>"},{"location":"inline-mode/#show-text","title":"\u0422\u0435\u043a\u0441\u0442","text":"<p>\u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u043c\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438 \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0441 \u0442\u0438\u043f\u043e\u043c InlineQueryResultArticle. \u0412\u0441\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435  (\u0438 \u0434\u0430\u0436\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435) \u0434\u0430\u043d\u043d\u044b\u0435 \u0443 \u043d\u0430\u0441 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c:</p> <p></p> <p>\u0414\u043b\u044f \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 <code>input_message_content</code> \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u043f\u0440\u043e\u0441\u0442\u0443\u044e \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u044f \u0438\u043b\u0438  \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u044f \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f:</p> <pre><code>def get_message_text(\n        link: str,\n        title: str,\n        description: Optional[str]\n) -&gt; str:\n    text_parts = [f'{html.bold(html.quote(title))}']\n    if description:\n        text_parts.append(html.quote(description))\n    text_parts.append(\"\")  # \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u043f\u0443\u0441\u0442\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443\n    text_parts.append(link)\n    return \"\\n\".join(text_parts)\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043e\u043f\u0438\u0448\u0435\u043c \u0441\u0430\u043c \u0445\u044d\u043d\u0434\u043b\u0435\u0440:</p> handlers/inline_mode.py<pre><code>@router.inline_query(F.query == \"links\")\nasync def show_user_links(inline_query: InlineQuery):\n\n    # \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442 \u0442\u0435\u043a\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442\n    # \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u043f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043d\u0430 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435\n    def get_message_text():\n        # \u044d\u0442\u0430 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043e\u043f\u0438\u0441\u0430\u043d\u0430 \u0432\u044b\u0448\u0435 \u2191\n\n    results = []\n    for link, link_data in get_links_by_id(inline_query.from_user.id).items():\n        # \u0412 \u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u0430\u043f\u0438\u0445\u0438\u0432\u0430\u0435\u043c \u043a\u0430\u0436\u0434\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c\n        results.append(InlineQueryResultArticle(\n            id=link,  # \u0441\u0441\u044b\u043b\u043a\u0438 \u0443 \u043d\u0430\u0441 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435, \u043f\u043e\u0442\u043e\u043c\u0443 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u0431\u0443\u0434\u0435\u0442\n            title=link_data[\"title\"],\n            description=link_data[\"description\"],\n            input_message_content=InputTextMessageContent(\n                message_text=get_message_text(\n                    link=link,\n                    title=link_data[\"title\"],\n                    description=link_data[\"description\"]\n                ),\n                parse_mode=\"HTML\"\n            )\n        ))\n    # \u0412\u0430\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c is_personal=True!\n    await inline_query.answer(results, is_personal=True)\n</code></pre> <p>\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0432 \u0438\u0442\u043e\u0433\u0435 (\u0443 \u0432\u0442\u043e\u0440\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0431\u044b\u043b \u043f\u0440\u043e\u043f\u0443\u0449\u0435\u043d \u044d\u0442\u0430\u043f \u0441\u043e \u0441\u0432\u043e\u0434\u043e\u043c <code>description</code>):</p> <p></p> <p>\u041f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0442 \u0442\u0430\u043a\u043e\u0435 \u043a\u0440\u0430\u0441\u0438\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435:</p> <p></p>"},{"location":"inline-mode/#show-images","title":"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f","text":"<p>\u0421 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043f\u0440\u043e\u0449\u0435, \u043e\u0434\u043d\u0430\u043a\u043e \u0442\u0443\u0442 \u0435\u0441\u0442\u044c \u043d\u044e\u0430\u043d\u0441: \u043c\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u043c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0439\u0434\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c  <code>file_id</code> \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u043d \u0434\u043b\u0438\u043d\u043d\u0435\u0435 64 \u0431\u0430\u0439\u0442 (\u043b\u0438\u043c\u0438\u0442 Bot API). \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043c\u044b \u0431\u0443\u0434\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440  \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435, \u0441\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0432 \u0441\u0442\u0440\u043e\u043a\u0443. \u0412 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u043c \u043a\u043e\u0434 \u043f\u0440\u0435\u0434\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u0445\u043e\u0436 \u043d\u0430 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439:</p> handlers/inline_mode.py<pre><code>@router.inline_query(F.query == \"images\")\nasync def show_user_images(inline_query: InlineQuery):\n    results = []\n    for index, file_id in enumerate(get_images_by_id(inline_query.from_user.id)):\n        # \u0412 \u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u0430\u043f\u0438\u0445\u0438\u0432\u0430\u0435\u043c \u043a\u0430\u0436\u0434\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c\n        results.append(InlineQueryResultCachedPhoto(\n            id=str(index),  # \u0438\u043d\u0434\u0435\u043a\u0441 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 list\n            photo_file_id=file_id\n        ))\n    # \u0412\u0430\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c is_personal=True!\n    await inline_query.answer(results, is_personal=True)\n</code></pre> <p>\u041d\u0443 \u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:</p> <p></p>"},{"location":"inline-mode/#delete-data","title":"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u0421\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043a\u0438 \u043d\u0430\u0434\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0447\u0438\u0441\u0442\u0438\u0442\u044c. \u0422\u0430\u043a \u0438 \u043c\u044b \u0445\u043e\u0442\u0438\u043c \u0434\u0430\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u044b\u0435 \u0441\u0441\u044b\u043b\u043a\u0438  \u0438/\u0438\u043b\u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/delete</code>. \u041d\u043e \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c \u0431\u043e\u0442\u0430  \u0438 \u043f\u0438\u0441\u0430\u0442\u044c <code>links</code> \u0438\u043b\u0438 <code>images</code> \u043c\u044b \u043d\u0435 \u0445\u043e\u0442\u0438\u043c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u043e\u0434 \u043e\u0442\u0432\u0435\u0442\u043e\u043c \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0438\u043c \u0434\u0432\u0435 \u043a\u043d\u043e\u043f\u043a\u0438. \u041e\u0434\u043d\u0430 \u043e\u0442\u043a\u0440\u043e\u0435\u0442  \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435 \u0441\u0441\u044b\u043b\u043e\u043a, \u0434\u0440\u0443\u0433\u0430\u044f \u2014 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439. </p> <p>\u0414\u043e\u0431\u0430\u0432\u0438\u043c \u0432 <code>states.py</code> \u043d\u043e\u0432\u044b\u0439 \u043a\u043b\u0430\u0441\u0441:</p> states.py<pre><code>class DeleteCommon(StatesGroup):\n    waiting_for_delete_start = State()\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/delete</code>:</p> handlers/common.py<pre><code># \u043d\u043e\u0432\u044b\u0439 \u0438\u043c\u043f\u043e\u0440\u0442\nfrom aiogram.filters.state import StateFilter\n\n@router.message(Command(\"delete\"), StateFilter(None))\nasync def cmd_delete(message: Message, state: FSMContext):\n    kb = []\n    kb.append([\n        InlineKeyboardButton(\n            text=\"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443\",\n            switch_inline_query_current_chat=\"links\"\n        )\n    ])\n    kb.append([\n        InlineKeyboardButton(\n            text=\"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\",\n            switch_inline_query_current_chat=\"images\"\n        )\n    ])\n    await state.set_state(DeleteCommon.waiting_for_delete_start)\n    await message.answer(\n        text=\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c:\",\n        reply_markup=InlineKeyboardMarkup(inline_keyboard=kb)\n    )\n</code></pre> <p>\u041f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043d\u0430 \u0442\u0430\u043a\u0443\u044e \u043a\u043d\u043e\u043f\u043a\u0443 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0443\u0436\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c, \u0447\u0442\u043e \u0441\u0440\u0430\u0437\u0443 \u043e\u0442\u043a\u0440\u043e\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0441\u044b\u043b\u043e\u043a \u0438\u043b\u0438  \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 (\u0434\u043b\u044f \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u044f \u0443\u0431\u0440\u0430\u043b \u043f\u043e\u043a\u0430 \u0432\u0441\u043f\u043b\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u043c\u0435\u043d\u044e, \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u043e \u0432\u0438\u0434\u043d\u043e \u043a\u043d\u043e\u043f\u043a\u0438):</p> <p></p> <p>\u0415\u0441\u043b\u0438 \u0431\u044b \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e <code>switch_inline_query</code> \u0432\u043c\u0435\u0441\u0442\u043e <code>switch_inline_query_current_chat</code>, \u0442\u043e Telegram \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0438\u043b  \u0431\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0447\u0430\u0442, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043c\u043e\u0436\u0435\u0442 \u043f\u0438\u0441\u0430\u0442\u044c, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u0438\u043b \u0431\u044b \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0442\u0430\u043c.</p> <p>\u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0440\u043e\u0443\u0442\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043b\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0438 \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430:</p> handlers/delete_data.py<pre><code># \u0438\u043c\u043f\u043e\u0440\u0442\u044b\nrouter = Router()\n\n@router.message(\n    DeleteCommon.waiting_for_delete_start,\n    F.text,\n    ViaBotFilter(),\n    HasLinkFilter()\n)\nasync def link_deletion_handler(message: Message, link: str, state: FSMContext):\n    delete_link(message.from_user.id, link)\n    await state.clear()\n    await message.answer(\n        text=\"\u0421\u0441\u044b\u043b\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0430! \"\n             \"\u0412\u044b\u0434\u0430\u0447\u0430 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0430 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043c\u0438\u043d\u0443\u0442.\")\n\n@router.message(\n    DeleteCommon.waiting_for_delete_start,\n    F.photo[-1].file_unique_id.as_(\"file_unique_id\"),\n    ViaBotFilter()\n)\nasync def image_deletion_handler(\n        message: Message,\n        state: FSMContext,\n        file_unique_id: str\n):\n    delete_image(message.from_user.id, file_unique_id)\n    await state.clear()\n    await message.answer(\n        text=\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e! \"\n             \"\u0412\u044b\u0434\u0430\u0447\u0430 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0430 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043c\u0438\u043d\u0443\u0442.\")\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435: \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043c\u044b \u0443\u0434\u0430\u043b\u044f\u0435\u043c \u043f\u043e <code>file_unique_id</code>, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 <code>file_id</code>  \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0437\u043d\u044b\u0439 (\u0435\u0441\u043b\u0438 \u043a\u0440\u0430\u0442\u043a\u043e: \u0432 \u043f\u043e\u043b\u043d\u043e\u043c <code>file_id</code> \u0437\u0430\u0448\u0438\u0442\u044b \u043e\u0442\u043c\u0435\u0442\u043a\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438 \u043f\u0440\u043e\u0447\u0438\u0435 \u043d\u0435\u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435).</p>"},{"location":"inline-mode/#switch-parameter","title":"Switch \u0442\u0443\u0434\u0430 \u0438 \u043e\u0431\u0440\u0430\u0442\u043d\u043e","text":"<p>\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u0440\u0430\u043d\u0435\u0435 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u043b\u0438 \u0444\u043e\u0440\u043c\u0430\u0442 \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432, \u0442\u043e \u0432\u0438\u0434\u0435\u043b\u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b  \u0441 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u043e\u043c <code>switch_pm</code>. \u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0438\u043c\u0438 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0441\u044f, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043c\u043e\u0433 \u0441\u0440\u0430\u0437\u0443 \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u043b\u044e\u0431\u043e\u0433\u043e  \u0447\u0430\u0442\u0430, \u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 \u043b\u0438\u0447\u043a\u0438 \u0441 \u0431\u043e\u0442\u043e\u043c.</p> <p>\u0414\u043e\u0431\u0430\u0432\u0438\u043c \u0432 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0438\u043d\u043b\u0430\u0439\u043d-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u044b\u0448\u0435\u0443\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u043f\u0438\u0448\u0435\u043c \u0432\u044b\u0437\u043e\u0432 \u043c\u0435\u0442\u043e\u0434\u0430 <code>answer_inline_query()</code>  \u0432 \u0444\u0430\u0439\u043b\u0435 <code>handlers/inline_mode.py</code>:</p> <pre><code>await inline_query.answer(\n        results, is_personal=True,\n        switch_pm_text=\"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0435\u0449\u0451 \u00bb\u00bb\",\n        switch_pm_parameter=\"add\"\n    )\n</code></pre> <p>\u0412 \u0444\u0430\u0439\u043b\u0435 <code>handlers/common.py</code> \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0443 \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/save</code> \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0435\u0449\u0451 \u043e\u0434\u043d\u0443 \u0442\u043e\u0447\u043a\u0443 \u0432\u0445\u043e\u0434\u0430 \u0447\u0435\u0440\u0435\u0437 \u0444\u0438\u043b\u044c\u0442\u0440 <code>CommandStart</code>  \u0441 \u0434\u0438\u043f\u043b\u0438\u043d\u043a\u043e\u043c <code>add</code>:</p> handlers/common.py<pre><code># \u043d\u043e\u0432\u044b\u0439 \u0438\u043c\u043f\u043e\u0440\u0442:\nfrom aiogram.filters.command import CommandStart\n\n@router.message(CommandStart(magic=F.args == \"add\"))\n@router.message(Command(\"save\"), StateFilter(None))\nasync def cmd_save(message: Message, state: FSMContext):\n    ...\n\n# \u0423\u0447\u0442\u0438\u0442\u0435, \u0447\u0442\u043e \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0430 \u043f\u0440\u043e\u0441\u0442\u043e /start \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u0434\u0442\u0438 \u041f\u041e\u0417\u0416\u0415\n@router.message(Command(commands=[\"start\"]))\nasync def cmd_start(message: Message, state: FSMContext):\n    ...\n</code></pre> <p>\u0410 \u0442\u0430\u043a\u0436\u0435 \u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u044d\u0442\u0430\u043f\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043e\u043a \u0434\u043e\u0431\u0430\u0432\u0438\u043c <code>switch_inline_query</code> \u043a\u043d\u043e\u043f\u043a\u0443 \u0441 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435\u043c  \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043a\u0438\u043d\u0443\u0442\u044c \u0447\u0442\u043e-\u0442\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u0439 \u0447\u0430\u0442:</p> <pre><code># \u0444\u0430\u0439\u043b handlers/save_text.py\n@router.message(TextSave.waiting_for_description, F.text.func(len) &lt;= 30)\n@router.message(TextSave.waiting_for_description, Command(\"skip\"))\nasync def last_step(...):\n    # \u0442\u0443\u0442 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\n    kb = [[InlineKeyboardButton(\n        text=\"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c\",\n        switch_inline_query=\"links\"\n    )]]\n    await message.answer(\n        text=\"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430!\",\n        reply_markup=InlineKeyboardMarkup(inline_keyboard=kb)\n    )\n\n# \u0444\u0430\u0439\u043b handlers/save_images.py\n@router.message(SaveCommon.waiting_for_save_start, F.photo[-1].as_(\"photo\"))\nasync def save_image(...):\n    # \u0442\u0443\u0442 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\n    kb = [[InlineKeyboardButton(\n        text=\"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c\",\n        switch_inline_query=\"images\"\n    )]]\n    await message.answer(\n        text=\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!\",\n        reply_markup=InlineKeyboardMarkup(inline_keyboard=kb)\n    )\n</code></pre> <p>\u0418 \u0437\u0434\u0435\u0441\u044c \u043a\u0440\u043e\u0435\u0442\u0441\u044f \u0435\u0449\u0451 \u043e\u0434\u043d\u0430 \u043f\u0440\u0438\u043a\u043e\u043b\u044c\u043d\u0430\u044f \u0444\u0438\u0447\u0430 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0430: \u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u044b\u0437\u043e\u0432\u0435\u0442\u0435 \u0431\u043e\u0442\u0430 \u043d\u0435 \u0432 \u041b\u0421 \u0441 \u043d\u0438\u043c, \u043f\u0435\u0440\u0435\u0439\u0434\u0451\u0442\u0435 \u043f\u043e \u043a\u043d\u043e\u043f\u043a\u0435  \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0435\u0449\u0451 \u00bb\u00bb\", \u0438 \u0434\u043e\u0439\u0434\u0451\u0442\u0435 \u0434\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0448\u0430\u0433\u0430, \u0442\u043e \u043a\u043e\u0433\u0434\u0430 \u0431\u043e\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0441\u043e <code>switch_inline_query</code>-\u043a\u043d\u043e\u043f\u043a\u043e\u0439,  \u043a\u043b\u0438\u0435\u043d\u0442 Telegram \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u0435\u0440\u043d\u0451\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0447\u0430\u0442 \u0438 \u0441\u0440\u0430\u0437\u0443 \u043e\u0442\u043a\u0440\u043e\u0435\u0442 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c \u0441 \u043d\u0443\u0436\u043d\u044b\u043c \u0442\u0435\u043a\u0441\u0442\u043e\u043c!</p>"},{"location":"inline-mode/#extras","title":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u044b","text":""},{"location":"inline-mode/#lazy-loading","title":"\u041f\u043e\u0434\u0433\u0440\u0443\u0437\u043a\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432","text":"<p>\u0421\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 Bot API, \u0432 \u043e\u0434\u043d\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435 answerInlineQuery  \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043d\u0435 \u0431\u043e\u043b\u0435\u0435 50 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432. \u0410 \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0431\u043e\u043b\u044c\u0448\u0435? \u041d\u0430 \u044d\u0442\u043e\u0442 \u0441\u043b\u0443\u0447\u0430\u0439 \u043f\u0440\u0438\u0433\u043e\u0434\u0438\u0442\u0441\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 <code>next_offset</code>. \u0415\u0433\u043e  \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u0430\u043c \u0431\u043e\u0442, \u0438 \u044d\u0442\u043e \u0436\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0434\u0451\u0442 \u0432 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0438\u043d\u043b\u0430\u0439\u043d-\u0437\u0430\u043f\u0440\u043e\u0441\u0435, \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u043b\u0438\u0441\u0442\u0430\u0435\u0442 \u0432\u0441\u044e \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u043f\u0430\u0447\u043a\u0443.  \u0414\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u0447\u0438\u0441\u0435\u043b, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0449\u0438\u0439 \u043f\u0430\u0447\u043a\u0438 \u043f\u043e 50 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432, \u043d\u043e \u0441 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c 195:</p> handlers/inline_pagination_demo.py<pre><code>def get_fake_results(start_num: int, size: int = 50) -&gt; list[int]:\n    \"\"\"\n    \u0413\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0447\u0438\u0441\u0435\u043b\n\n    :param start_num: \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440\u0430\n    :param size: \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u0430\u0447\u043a\u0438 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447. 50)\n    :return: \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0447\u0438\u0441\u0435\u043b\n    \"\"\"\n    overall_items = 195\n    # \u0415\u0441\u043b\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\n    if start_num &gt;= overall_items:\n        return []\n    # \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043d\u0435\u043f\u043e\u043b\u043d\u043e\u0439 \u043f\u0430\u0447\u043a\u0438 (\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439)\n    elif start_num + size &gt;= overall_items:\n        return list(range(start_num, overall_items+1))\n    else:\n        return list(range(start_num, start_num+size))\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0438\u043d\u043b\u0430\u0439\u043d-\u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u0442\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u0438 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0438 \u043a \u043a\u043e\u043d\u0446\u0443 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u043f\u0438\u0441\u043a\u0430 Telegram \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u043b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043f\u043e\u043b\u0435 <code>offset</code> \u0438 \u0441\u0442\u0430\u0432\u0438\u043c \u0435\u0433\u043e \u0440\u0430\u0432\u043d\u044b\u043c \u0435\u0434\u0438\u043d\u0438\u0446\u0435, \u0435\u0441\u043b\u0438 \u043e\u043d\u043e \u043f\u0443\u0441\u0442\u043e\u0435. \u0414\u0430\u043b\u0435\u0435 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c  \u0444\u0435\u0439\u043a\u043e\u0432\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432. \u0415\u0441\u043b\u0438 \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435 \u0440\u043e\u0432\u043d\u043e 50 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432, \u0442\u043e \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c <code>next_offset</code> \u0440\u0430\u0432\u043d\u044b\u0439 \u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443  \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e + 50. \u0415\u0441\u043b\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043c\u0435\u043d\u044c\u0448\u0435, \u0442\u043e \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c, \u0447\u0442\u043e\u0431\u044b Telegram \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u044b\u0442\u0430\u043b\u0441\u044f \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438:</p> handlers/inline_pagination_demo.py<pre><code>@router.inline_query(F.query == \"long\")\nasync def pagination_demo(\n        inline_query: InlineQuery,\n):\n    # \u0412\u044b\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u043c offset \u043a\u0430\u043a \u0447\u0438\u0441\u043b\u043e\n    offset = int(inline_query.offset) if inline_query.offset else 1\n    results = [InlineQueryResultArticle(\n        id=str(item_num),\n        title=f\"\u041e\u0431\u044a\u0435\u043a\u0442 \u2116{item_num}\",\n        input_message_content=InputTextMessageContent(\n            message_text=f\"\u041e\u0431\u044a\u0435\u043a\u0442 \u2116{item_num}\"\n        )\n    ) for item_num in get_fake_results(offset)]\n    if len(results) &lt; 50:\n        await inline_query.answer(\n            results, is_personal=True\n        )\n    else:\n        await inline_query.answer(\n            results, is_personal=True, \n            next_offset=str(offset+50)\n        )\n</code></pre> <p>\u041f\u043e \u043c\u0435\u0440\u0435 \u043b\u0438\u0441\u0442\u0430\u043d\u0438\u044f \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432, \u0431\u043e\u0442 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0432\u0441\u0451 \u043d\u043e\u0432\u044b\u0435 \u0438 \u043d\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0434\u043e\u0439\u0434\u0451\u0442  \u0434\u043e 195-\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430, \u0434\u0430\u043b\u044c\u0448\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u0440\u0435\u043a\u0440\u0430\u0442\u044f\u0442\u0441\u044f.</p>"},{"location":"inline-mode/#inline-feedback","title":"\u0421\u0431\u043e\u0440 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438","text":"<p>\u041c\u0430\u043b\u043e \u043a\u0442\u043e \u0437\u043d\u0430\u0435\u0442, \u043d\u043e Telegram \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u0438\u0440\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u0435\u043d\u044c\u043a\u0443\u044e \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443 \u043f\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044e \u0431\u043e\u0442\u0430 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435. \u0414\u043b\u044f \u043d\u0430\u0447\u0430\u043b\u0430  \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0443\u044e \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0443 \u0443 @BotFather: <code>/mybots</code> - (\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043e\u0442\u0430) - Bot Settings - Inline Feedback:</p> <p></p> <p>\u0427\u0438\u0441\u043b\u0430 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0430\u0445 \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0442 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u044f ChosenInlineResult  \u043f\u0440\u0438 \u0432\u044b\u0431\u043e\u0440\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c \u043a\u0430\u043a\u043e\u0433\u043e-\u043b\u0438\u0431\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435. \u0422\u0430\u043a, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 10%, \u0442\u043e \u043f\u0440\u0438  \u043a\u0430\u0436\u0434\u043e\u043c \u0432\u044b\u0431\u043e\u0440\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044c \u0432 \u0434\u0435\u0441\u044f\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 ChosenInlineResult \u0432 \u0431\u043e\u0442\u0435. \u0412\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c  \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 100% Telegram \u043d\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442 \u0438\u0437-\u0437\u0430 \u0443\u0434\u0432\u043e\u0435\u043d\u0438\u044f \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043d\u0430 \u0431\u043e\u0442\u0430. \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0434\u043b\u044f \u0441\u043a\u043e\u043b\u044c\u043a\u043e-\u043d\u0438\u0431\u0443\u0434\u044c \u0441\u0435\u0440\u044c\u0451\u0437\u043d\u043e\u0439 \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0438  \u043f\u043e\u0434\u043e\u0431\u043d\u0430\u044f \u0444\u0438\u0447\u0430 \u043d\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442, \u043d\u043e \u0432 \u0443\u043c\u0435\u043b\u044b\u0445 \u0440\u0443\u043a\u0430\u0445 \u0438 \u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043c\u043e\u0436\u0435\u0442 \u0434\u0430\u0442\u044c \u043e\u0431\u0449\u0435\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e \u043d\u0430\u0438\u0431\u043e\u043b\u0435\u0435  \u043f\u043e\u043b\u0435\u0437\u043d\u044b\u0445 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u0445. \u041f\u0440\u0438\u043c\u0435\u0440 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430 \u043d\u0430 \u043f\u043e\u0434\u043e\u0431\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f:</p> handlers/inline_chosen_result_demo.py<pre><code>from aiogram import Router\nfrom aiogram.types import ChosenInlineResult\n\nrouter = Router()\n\n@router.chosen_inline_result()\nasync def pagination_demo(\n        chosen_result: ChosenInlineResult,\n):\n    # \u041f\u0438\u0448\u0435\u043c \u043f\u0440\u044f\u043c\u043e \u043d\u0430 \u044d\u043a\u0440\u0430\u043d. \u041d\u043e, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u0432\u044b \u0437\u0430\u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u043a\u0443\u0434\u0430-\u0442\u043e\n    print(\n        f\"After '{chosen_result.query}' query, \"\n        f\"user chose option with ID '{chosen_result.result_id}'\"\n    )\n</code></pre> <p>\u041d\u0435\u0441\u043c\u043e\u0442\u0440\u044f \u043d\u0430 \u0442\u043e, \u0447\u0442\u043e \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c \u043d\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f Inline Feedback, \u0443 \u044d\u0442\u043e\u0439 \u0448\u0442\u0443\u043a\u0438 \u0435\u0441\u0442\u044c \u043a\u0430\u043a  \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043e\u0434\u043d\u043e \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435: \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u0443\u0437\u044b\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0431\u043e\u0442\u044b \u043f\u044b\u0442\u0430\u044e\u0442\u0441\u044f \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u043b\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u043a\u043e\u043c\u043f\u043e\u0437\u0438\u0446\u0438\u0438 \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443,  \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044f \u043f\u0435\u0441\u043d\u044e \u0437\u0430\u0440\u0430\u043d\u0435\u0435. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b\u0437\u043e\u0432\u0430 \u0431\u043e\u0442\u0430 \u0432 \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c\u0435, \u043c\u043e\u0436\u043d\u043e \u043d\u0435 \u0443\u043b\u043e\u0436\u0438\u0442\u044c\u0441\u044f \u0432 10-15 \u0441\u0435\u043a\u0443\u043d\u0434,  \u043f\u043e \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044e \u043a\u043e\u0442\u043e\u0440\u044b\u0445 Bot API \u0432\u0435\u0440\u043d\u0451\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 \u043e \u00ab\u043f\u0440\u043e\u0442\u0443\u0445\u0448\u0435\u043c\u00bb \u0430\u043f\u0434\u0435\u0439\u0442\u0435.</p> <p>\u0418 \u0432\u043e\u0442 \u043a\u0430\u043a \u0432\u044b\u043a\u0440\u0443\u0447\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0438: \u043f\u043e\u043a\u0430 \u0431\u043e\u0442 \u0438\u0449\u0435\u0442 \u0442\u0440\u0435\u043a, \u0432 \u043f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u043d\u0438\u0438 \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442\u0441\u044f \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u0441\u044d\u043c\u043f\u043b  (5-10 \u0441\u0435\u043a\u0443\u043d\u0434). \u041a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0436\u043c\u0451\u0442 \u043d\u0430 \u043a\u0430\u043a\u0443\u044e-\u043b\u0438\u0431\u043e \u0441\u0442\u0440\u043e\u0447\u043a\u0443, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0430\u0443\u0434\u0438\u043e\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0441 \u043f\u0440\u0438\u043a\u0440\u0435\u043f\u043b\u0451\u043d\u043d\u043e\u0439 \u0438\u043d\u043b\u0430\u0439\u043d-\u043a\u043d\u043e\u043f\u043a\u043e\u0439 (\u0438\u043d\u0430\u0447\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435), \u0431\u043e\u0442 \u043b\u043e\u0432\u0438\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438, \u0434\u043e\u0441\u0442\u0430\u0451\u0442 \u0438\u0437 \u0430\u043f\u0434\u0435\u0439\u0442\u0430 \u0441 \u0442\u0438\u043f\u043e\u043c <code>ChosenInlineResult</code>  \u0441\u043a\u0432\u043e\u0437\u043d\u043e\u0439 <code>inline_message_id</code> \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u0433\u0440\u0443\u0437\u0438\u0442 \u043f\u043e\u043b\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u0430\u0443\u0434\u0438\u043e \u0438, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u044d\u0442\u043e\u0442 <code>inline_message_id</code> \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u0443\u0435\u0442  \u0441\u044d\u043c\u043f\u043b \u043d\u0430 \u043f\u043e\u043b\u043d\u043e\u0446\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0435\u043a. Telegram \u043f\u0440\u0438\u0443\u0447\u0430\u0435\u0442 \u043a \u043a\u043e\u0441\u0442\u044b\u043b\u044f\u043c, \u0434\u0430. </p>"},{"location":"messages/","title":"Xabarlar bilan ishlash","text":""},{"location":"messages/#xabarlar-bilan-ishlash","title":"Xabarlar bilan ishlash","text":"<p>Foydalanilayotgan aiogram versiyasi: 3.7.0</p> <p>Ushbu bo'limda biz xabarlarga turli formatlash turlarini qanday qo'llashni va media fayllar bilan ishlashni o'rganamiz.</p>"},{"location":"messages/#text","title":"Matn","text":"<p>Matnli xabarlarni qayta ishlash ko'pchilik botlar uchun eng muhim vazifalaridan biridir. Matn yordamida deyarli hamma  narsani ifodalash mumkin va  bazan ma'lumotni chiroyli tarzda taqdim etish zarur bo'ladi. Dasturchida ixtiyorida matnni belgilashning  uchta usuli mavjud: HTML, Markdown va MarkdownV2. Ulardan eng rivojlanganlari HTML va MarkdownV2 bo'lib, \"klassik\"  Markdown usuli kamroq imkoniyatlarni ega va u aiogramda endi ishlatilmaydi.</p> <p>Matn bilan ishlash usullarini ko'rib chiqishdan oldin, aiogram 3.x ning 2.x dan muhim farqini eslatib o'tish kerak:  ikkinchi veersiyada standart bo'yicha faqat matnli xabarlar qayta ishlanar edi,  uchda esa har qanday turdagi xabarlar qayta ishlanadi.  Aniqroq qilib aytganda, endi faqat matnli xabarlarni qanday tutib qolish kerakligi quyida ko'rsatilgan:</p> <pre><code># dekorator bilan eski usul\n@dp.message_handler()\nasync def func_name(...)\n\n# funksiya registrator bilan eski usul\ndp.register_message_handler(func_name)\n\n# dekorator bilan yangi usul\nfrom aiogram import F\n@dp.message(F.text)\nasync def func_name(...)\n\n# funksiya registrator bilan yangi usul\ndp.message.register(func_name, F.text)\n</code></pre> <p>\"Sehrli filtr\" F haqida boshqa bo'limda gaplashamiz.</p>"},{"location":"messages/#formatting-options","title":"Formatlangan chiqish","text":"<p>Xabarlarni yuborishda formatlashni tanlash uchun <code>parse_mode</code> argumenti javob beradi, masalan: </p><pre><code>from aiogram import F\nfrom aiogram.types import Message\nfrom aiogram.filters import Command\nfrom aiogram.enums import ParseMode\n\n# Agar F.text filtrini ko'rsatmasangiz,\n# handler hatto /test yozuvi bilan rasmga ham ishlaydi\n@dp.message(F.text, Command(\"test\"))\nasync def any_message(message: Message):\n    await message.answer(\n        \"Hello, &lt;b&gt;world&lt;/b&gt;!\", \n        parse_mode=ParseMode.HTML\n    )\n    await message.answer(\n        \"Hello, *world*\\!\", \n        parse_mode=ParseMode.MARKDOWN_V2\n    )\n</code></pre> <p></p> <p>Agar botda doimiy ravishda ma'lum bir formatlash ishlatilsa, har safar <code>parse_mode</code> argumentini ko'rsatish noqulay  bo'lishi mumkin. Yaxshiyamki, aiogramda botning standart sozlamalarini belgilash mumkin. Buning uchun <code>DefaultBotProperties</code>  obyektini yarating va kerakli sozlamalarni unga o'tkazing:</p> <pre><code>from aiogram.client.default import DefaultBotProperties\n\nbot = Bot(\n    token=\"123:abcxyz\",\n    default=DefaultBotProperties(\n        parse_mode=ParseMode.HTML\n        # bu yerda yana boshqa qiziqarli sozlamalar ham bor\n    )\n)\nbot = Bot(token=\"123:abcxyz\", parse_mode=\"HTML\")\n\n# qandaydir funksiyada...\nawait message.answer(\"HTML-belgilanishi bilan &lt;u&gt;xabar&lt;/u&gt;\")\n# formatlashni aniq o'chirish uchun,\n# parse_mode=None ni ko'rsating\nawait message.answer(\n    \"Hech qanday &lt;s&gt;belgilanishsiz xabar&lt;/s&gt;\", \n    parse_mode=None\n)\n</code></pre> <p></p>"},{"location":"messages/#input-escaping","title":"Kiritishni ekranga chiqarish","text":"<p>Ko'pincha botda xabarining yakuniy matni oldindan ma'lum bo'lmaydi va bot uni qandaydir tashqi  ma'lumotlar asosida shakllantiriladi: foydalanuvchining ismi, uning kiritgan ma'lumotlari va hokazo.  Keling, foydalanuvchini uning to'liq ismi bilan (<code>first_name + last_name</code>) salomlashadigan  <code>/hello</code> komandasi uchun handler yozamiz, masalan: \u00abHello, Ivan Ivanov\u00bb:</p> <pre><code>from aiogram.filters import Command\n\n@dp.message(Command(\"hello\"))\nasync def cmd_hello(message: Message):\n    await message.answer(\n        f\"Hello, &lt;b&gt;{message.from_user.full_name}&lt;/b&gt;\",\n        parse_mode=ParseMode.HTML\n    )\n</code></pre> <p>Hammasi yaxshi ishladi natijani quyidagi tasvirda ko'rish mumkin:</p> <p></p> <p>Ammo bu yerda &lt;C\u043b\u0430\u0432\u0438\u043a777&gt; ismli foydalanuvchi botga habar yzosa va bot javob qaytarmaydi! Loglarda quyidagilarni ko'rishimiz mumkin:  <code>aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities:  Unsupported start tag \"\u0421\u043b\u0430\u0432\u0438\u043a777\" at byte offset 7</code></p> <p>Obbo, bizda HTML formatlash rejimi yoqilganku va Telegram &lt;C\u043b\u0430\u0432\u0438\u043a777&gt; ni HTML teg sifatida qabul qilishga harakat qilmoqda.  Bu muammo. Ammo bu muammoni hal qilishning bir necha yo'li bor. Birinchi usul: uzatiladigan qiymatlarni ekranga chiqarish.</p> <pre><code>from aiogram import html\nfrom aiogram.filters import Command\n\n@dp.message(Command(\"hello\"))\nasync def cmd_hello(message: Message):\n    await message.answer(\n        f\"Hello, {html.bold(html.quote(message.from_user.full_name))}\",\n        parse_mode=ParseMode.HTML\n    )\n</code></pre> <p>Ikkinchi usul biroz murakkabroq, lekin yanada yaxsh usul hisoblanadi: matnni alohida va qaysi qismlar  formatlanishi kerakligi haqidagi ma'lumotni alohida yig'adigan maxsus klassdan foydalanish.</p> <pre><code>from aiogram.filters import Command\nfrom aiogram.utils.formatting import Text, Bold\n\n@dp.message(Command(\"hello\"))\nasync def cmd_hello(message: Message):\n    content = Text(\n        \"Hello, \",\n        Bold(message.from_user.full_name)\n    )\n    await message.answer(\n        **content.as_kwargs()\n    )\n</code></pre> <p>Yuqoridagi misolda <code>**content.as_kwargs()</code> konstruktsiyasi <code>text</code>, <code>entities</code>, <code>parse_mode</code> argumentlarini qaytaradi  va ularni <code>answer()</code> funksiyasiga lug'at ko'rinishida uzatadi.</p> <p></p> <p>Ushbu formatlash vositasi juda keng qamrovli bo'lib,  rasmiy hujjatlarda murakkab tuzilmalarni qanday qulay ko'rsatishni mumkinligini ko'rishinggiz mumkin, masalan:</p> <pre><code>from aiogram.filters import Command\nfrom aiogram.utils.formatting import (\n    Bold, as_list, as_marked_section, as_key_value, HashTag\n)\n\n@dp.message(Command(\"advanced_example\"))\nasync def cmd_advanced_example(message: Message):\n    content = as_list(\n        as_marked_section(\n            Bold(\"Success:\"),\n            \"Test 1\",\n            \"Test 3\",\n            \"Test 4\",\n            marker=\"\u2705 \",\n        ),\n        as_marked_section(\n            Bold(\"Failed:\"),\n            \"Test 2\",\n            marker=\"\u274c \",\n        ),\n        as_marked_section(\n            Bold(\"Summary:\"),\n            as_key_value(\"Total\", 4),\n            as_key_value(\"Success\", 3),\n            as_key_value(\"Failed\", 1),\n            marker=\"  \",\n        ),\n        HashTag(\"#test\"),\n        sep=\"\\n\\n\",\n    )\n    await message.answer(**content.as_kwargs())\n</code></pre> <p></p> <p>Turli formatlash usullari va qo'llab-quvvatlanadigan teglar haqida batafsil  Bot API hujjatlarida bilib olishingiz mumkin.</p>"},{"location":"messages/#keep-formatting","title":"Formatlashni saqlash","text":"<p>Tasavvur qiling, bot foydalanuvchidan formatlangan matn olishi va unga o'zidan biror narsani, masalan,  vaqt belgisini qo'shishi holatini ko'rib chiqamiz:</p> <pre><code># yangi import\nfrom datetime import datetime\n\n@dp.message(F.text)\nasync def echo_with_time(message: Message):\n    # Hozirgi vaqtni kompyuterning vaqt zonasida olamiz\n    time_now = datetime.now().strftime('%H:%M')\n    # Qo'shimcha matnni qo'shib qo'yamiz\n    added_text = html.underline(f\"\u0421\u043e\u0437\u0434\u0430\u043d\u043e \u0432 {time_now}\")\n    # Qo'shilgan matnni o'z ichiga olgan yangi xabar yuboramiz\n    await message.answer(f\"{message.text}\\n\\n{added_text}\", parse_mode=\"HTML\")\n</code></pre> <p></p> <p>Hooop, nimadir noto'g'ri ketdi to'g'rimi, nima uchun asl xabar formatlangan qiya va qalin holatda chiqmadi? Bu <code>message.text</code> hech qanday formatlashlarsiz shunchaki matnni qaytarishi tufaylidir. Kerakli formatda matn olish uchun alternativ xususiyatlardan foydalanishimiz mumkin: <code>message.html_text</code> yoki <code>message.md_text</code>. Hozir bizga birinchi variant kerak. Yuqoridagi misolda <code>message.text</code> ni <code>message.html_text</code>ga almashtiramiz va to'g'ri natijani olamiz:</p> <p></p>"},{"location":"messages/#message-entities","title":"Entities bilan ishlash","text":"<p>Telegram dasturchilarga foydalanuvchi xabarlarini o'zi tarafidan oldindan qayta ishlash orqali dasturchilar ishini ancha yengillashtiradi.  Masalan, ba'zi ob'ektlar elektron pochta, telefon raqami, foydalanuvchi nomi va boshqalar. Biz bularni Muntazam ifodalar (Regular_expression) bilan olishimiz shart emas,  balki to'g'ridan-to'g'ri Message obyekti va <code>entities</code> maydonidan olinishi mumkin,  bular esa MessageEntity turidagi ob'ektlarning ro'yxatini o'z ichiga oladi.  Misol tariqasida, xabardan havola, elektron pochta va qalin va qiya matnini chiqaradigan handler yozamiz. Bu yerda e'tibor qilishimiz kerak bo'lgan bir narsa bor. Telegram pochta, havola, qiya, qalin matnlarning o'zini emas, balki matndagi boshlanishini va uzunligini qaytaradi. Bundan tashqari, matn UTF-8 belgilarida hisoblanadi, lekin <code>entities</code> UTF-16 bilan ishlaydi, shuning uchun UTF-16 belgilar  (masalan emoji) mavjud bo'lsa, faqat pozitsiya va uzunlikni olish orqali foydalanishinggiz sizning qayta ishlangan matningizda hatoliklarga olib kelishi mumkin.</p> <p>Buni eng yaxshi quyidagi misol namoyish etadi. Skrinshotda botning birinchi javobi \"to'g'ridan-to'g'ri\" tahlil natijasidir,  ikkinchi javob esa aiogramning <code>extract_from()</code> metodini entity ustida qo'llash natijasidir. Unga kirish uchun barcha asl matn uzatiladi:</p> <pre><code>@dp.message(F.text)\nasync def extract_data(message: Message):\n    data = {\n        \"url\": \"&lt;N/A&gt;\",\n        \"email\": \"&lt;N/A&gt;\",\n        \"code\": \"&lt;N/A&gt;\"\n    }\n    entities = message.entities or []\n    for item in entities:\n        if item.type in data.keys():\n            # Xato\n            # data[item.type] = message.text[item.offset : item.offset+item.length]\n            # To'g'ri\n            data[item.type] = item.extract_from(message.text)\n    await message.reply(\n        \"\u0412\u043e\u0442 \u0447\u0442\u043e \u044f \u043d\u0430\u0448\u0451\u043b:\\n\"\n        f\"URL: {html.quote(data['url'])}\\n\"\n        f\"E-mail: {html.quote(data['email'])}\\n\"\n        f\"\u041f\u0430\u0440\u043e\u043b\u044c: {html.quote(data['code'])}\"\n    )\n</code></pre> <p></p>"},{"location":"messages/#commands-args","title":"Buyruqlar va ularning argumentlari","text":"<p>Telegram foydalanuvchilarga ma'lumot kiritishning ko'plab usullarini taqdim etadi.  Ulardan biri buyruqlar yani slesh bilan boshlanadigan kalit so'zlar, masalan, <code>/new</code> yoki <code>/ban</code> kabi.  Lekin bazan bot shunday dasturlanishi mumkinki, buyruqdan keyin qandaydir argumentlar kutiladi, masalan,  <code>/ban 2d</code> yoki <code>/settimer 20h This is delayed message</code>. Aiogram tarkibida dasturchilarning ishini osonlashtiradigan  <code>Command()</code> filtri mavjud. So'nggi misolni quydagi kodda amalga oshirib ko'ramiz:</p> <pre><code>@dp.message(Command(\"settimer\"))\nasync def cmd_settimer(\n        message: Message,\n        command: CommandObject\n):\n    # Agar hech qanday argument kiritilmasa,\n    # command.args None bo'ladi\n    if command.args is None:\n        await message.answer(\n            \"\u041e\u0448\u0438\u0431\u043a\u0430: \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b\"\n        )\n        return\n    # Argumentlarni birinchi uchragan bo'sh joy bo'yicha ikki qismga ajratishga harakat qilamiz\n    try:\n        delay_time, text_to_send = command.args.split(\" \", maxsplit=1)\n    # Agar ikki qismdan kam bo'lsa, ValueError yuzaga keladi\n    except ValueError:\n        await message.answer(\n            \"\u041e\u0448\u0438\u0431\u043a\u0430: \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b. \u041f\u0440\u0438\u043c\u0435\u0440:\\n\"\n            \"/settimer &lt;time&gt; &lt;message&gt;\"\n        )\n        return\n    await message.answer(\n        \"\u0422\u0430\u0439\u043c\u0435\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d!\\n\"\n        f\"\u0412\u0440\u0435\u043c\u044f: {delay_time}\\n\"\n        f\"\u0422\u0435\u043a\u0441\u0442: {text_to_send}\"\n    )\n</code></pre> <p>Buyruqni turli argumentlar bilan (yoki umuman argumentsiz) uzatishga harakat qilib, natijalarini tekshirib ko'ramiz:</p> <p></p> <p>Guruhlarda buyruqlar bilan kichik muammo yuzaga kelishi mumkin. Telegram avtomatik ravishda slesh bilan boshlanadigan buyruqlarni boshqa rangda yorqin qilib ko'rsatadi,  buning natijasida ba'zan guruh a'zolari uni bosib ko'rishi mumkin va shunday holatlar yuzaga keladi (skrinshotni yaratishda yordam bergan aziz obunachilarimga rahmat):</p> <p></p> <p>Buni oldini olish uchun <code>Command()</code> klasida <code>prefix</code> nomli maydoni mavjud. Bu bilan siz buyruqlar qanaqa belgi bilan boshlanganda ishlashini belgilab qo'yishinggiz mumkin.  Ular oddiy matn bilan bir xil rangda bo'ladi va yozish uchun to'liq qo'lda kiritishni talab qiladi, shuning uchun bunday yondashuvning foydasini o'zingiz baholashingiz mumkin.</p> <pre><code>@dp.message(Command(\"custom1\", prefix=\"%\"))\nasync def cmd_custom1(message: Message):\n    await message.answer(\"\u0412\u0438\u0436\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u0443!\")\n\n\n# Bir nechta prefikslarni ko'rsatish mumkin\n@dp.message(Command(\"custom2\", prefix=\"/!\"))\nasync def cmd_custom2(message: Message):\n    await message.answer(\"\u0418 \u044d\u0442\u0443 \u0442\u043e\u0436\u0435 \u0432\u0438\u0436\u0443!\")\n</code></pre> <p></p> <p>Maxsus prefikslarning guruhlardagi muammosi shundaki Privacy Mode yoqilgan (birlamchi holatda),  admin bo'lmagan botlar bunday buyruqlarni telegram mantig'i tufayli ko'rmasligi mumkin. Eng keng tarqalgan foydalanish holati bu guruh moderator botlari bo'lib, ular allaqachon administrator hisoblanadi.</p>"},{"location":"messages/#deeplinks","title":"Diplinklar","text":"<p>Telegramda bir oz ko'proq imkoniyatlarga ega bo'lgan bitta buyruq mavjud. Bu <code>/start</code>. Gap shundaki, <code>t.me/bot?start=xxx</code>  kabi havolani yasash mumkin va bunday havolaga o'tganda foydalanuvchiga \"Boshlash\" tugmasi ko'rsatiladi, u bosilganda bot  <code>/start xxx</code> xabarini oladi. Ya'ni, havolada qo'shimcha parametr joylashtiriladi, bu qo'lda kiritishni talab qilmaydi.  Bu \"deep link\" deb ataladi va turli narsalar uchun ishlatilishi mumkin: turli buyruqlarni  faollashtirish uchun shartliklar, referal tizim, botni tezkor sozlash va h.k. Keling, ikki misol yozamiz:</p> <pre><code>import re\nfrom aiogram import F\nfrom aiogram.types import Message\nfrom aiogram.filters import Command, CommandObject, CommandStart\n\n@dp.message(Command(\"help\"))\n@dp.message(CommandStart(\n    deep_link=True, magic=F.args == \"help\"\n))\nasync def cmd_start_help(message: Message):\n    await message.answer(\"Bu yordam xabari\")\n\n\n@dp.message(CommandStart(\n    deep_link=True,\n    magic=F.args.regexp(re.compile(r'book_(\\d+)'))\n))\nasync def cmd_start_book(\n        message: Message,\n        command: CommandObject\n):\n    book_number = command.args.split(\"_\")[1]\n    await message.answer(f\"Sending book \u2116{book_number}\")\n</code></pre> <p></p> <p>E'tibor bering, <code>start</code> orqali deep link foydalanuvchini bot bilan shaxsiy suhbatga yuboradi. Agar guruhni tanlash va deep linkni  u yerga yuborish kerak bo'lsa, <code>start</code>ni <code>startgroup</code> bilan almashtiring. Shuningdek, aiogramda deep linklarni to'g'ridan-to'g'ri koddan yaratish uchun qulay funktsiya mavjud.</p> <p>Botlar uchun bo'lmagan ko'proq diplinklar</p> <p>Telegram hujjatlarida foydalanuvchi ilovalari uchun barcha turdagi diplinklarning batafsil tavsifi mavjud: https://core.telegram.org/api/links</p>"},{"location":"messages/#link-previews","title":"Havolalar oldindan ko'rish","text":"<p>Odatda matnli xabarlarni havolalar bilan yuborishda Telegram birinchi havolani topib, uning oldindan ko\u2018ruv (Preview) ko\u2018rinishini  ko\u2018rsatishga harakat qiladi. Bu xatti-harakatni <code>send_message()</code> metodining <code>link_preview_options</code> argumenti sifatida  <code>LinkPreviewOptions</code> obyektini berib o'zingiz xohlagan tarzda sozlashingiz mumkin</p> <pre><code># Yangi import\nfrom aiogram.types import LinkPreviewOptions\n\n@dp.message(Command(\"links\"))\nasync def cmd_links(message: Message):\n    links_text = (\n        \"https://nplus1.ru/news/2024/05/23/voyager-1-science-data\"\n        \"\\n\"\n        \"https://t.me/telegram\"\n    )\n    # Havola o'chirilgan\n    options_1 = LinkPreviewOptions(is_disabled=True)\n    await message.answer(\n        f\"\u041d\u0435\u0442 \u043f\u0440\u0435\u0432\u044c\u044e \u0441\u0441\u044b\u043b\u043e\u043a\\n{links_text}\",\n        link_preview_options=options_1\n    )\n\n    # -------------------- #\n\n    # Kichik oldindan ko'ruv uchun prefer_small_media'ni True qilish kerak\n    options_2 = LinkPreviewOptions(\n        url=\"https://nplus1.ru/news/2024/05/23/voyager-1-science-data\",\n        prefer_small_media=True\n    )\n    await message.answer(\n        f\"\u041c\u0430\u043b\u0435\u043d\u044c\u043a\u043e\u0435 \u043f\u0440\u0435\u0432\u044c\u044e\\n{links_text}\",\n        link_preview_options=options_2\n    )\n\n    # -------------------- #\n\n    # Katta oldindan ko'ruv uchun prefer_large_media'ni True qilish kerak\n    options_3 = LinkPreviewOptions(\n        url=\"https://nplus1.ru/news/2024/05/23/voyager-1-science-data\",\n        prefer_large_media=True\n    )\n    await message.answer(\n        f\"\u0411\u043e\u043b\u044c\u0448\u043e\u0435 \u043f\u0440\u0435\u0432\u044c\u044e\\n{links_text}\",\n        link_preview_options=options_3\n    )\n\n    # -------------------- #\n\n    # Kichik oldindan ko'ruv va matnning ustiga joylashni bir vaqtda ishlatishimiz mumkin\n    options_4 = LinkPreviewOptions(\n        url=\"https://nplus1.ru/news/2024/05/23/voyager-1-science-data\",\n        prefer_small_media=True,\n        show_above_text=True\n    )\n    await message.answer(\n        f\"\u041c\u0430\u043b\u0435\u043d\u044c\u043a\u043e\u0435 \u043f\u0440\u0435\u0432\u044c\u044e \u043d\u0430\u0434 \u0442\u0435\u043a\u0441\u0442\u043e\u043c\\n{links_text}\",\n        link_preview_options=options_4\n    )\n\n    # -------------------- #\n\n    # Oldindan ko'ruv uchun qaysi havolani ishlatishni tanlashingiz mumkin\n    options_5 = LinkPreviewOptions(\n        url=\"https://t.me/telegram\"\n    )\n    await message.answer(\n        f\"\u041f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u043d\u0435 \u043f\u0435\u0440\u0432\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0438\\n{links_text}\",\n        link_preview_options=options_5\n    )\n</code></pre> <p>Natija: </p> <p>Shuningdek, ba'zi oldindan ko'ruv parametrlarini <code>DefaultBotProperties</code>da birlamchi holat sifatida belgilash mumkin,  bu haqida bob boshida aytilgan edi.</p>"},{"location":"messages/#media","title":"Mediafayllar","text":""},{"location":"messages/#uploading-media","title":"Fayllarni telegramga yuklash","text":"<p>Telegram oddiy matnli xabarlardan tashqari turli xil media fayllarni almashishga imkon beradi: rasm, video, giflar,  geolokatsiyalar, stikerlar va h.k. Ko'pchilik media fayllarda <code>file_id</code> va <code>file_unique_id</code> xususiyatlari mavjud. Birinchisini bir xil faylni qayta-qayta yuborish uchun ishlatish mumkin, chunki fayl allaqachon Telegram serverlarida  saqlanadi. Bu eng afzal usuldir.  Masalan, quyidagi kod botni foydalanuvchiga yuborilgan gifni darhol o'ziga qayta yuborishga misol bo'la oladi:</p> <pre><code>@dp.message(F.animation)\nasync def echo_gif(message: Message):\n    await message.reply_animation(message.animation.file_id)\n</code></pre> <p>Har doim to'g'ri file_id dan foydalaning!</p> <p>Bot yuborish uchun faqat o'zi bevosita olgan <code>file_id</code> dan foydalanishi kerak,  masalan foydalanuvchidan shaxsiy xabarlar orqali yoki guruh/kanaldagi media faylni ko'rgan holda.  Shu bilan birga, agar boshqa botdan olingan <code>file_id</code> dan foydalanishga harakat qilinsa ishlashi mumkin,  Ammo bir muncha vaqt o'tgach wrong url/file_id specified xatosi olinadi.  Shuning uchun faqat o'z botingizning <code>file_id</code> sidan foydalaning!</p> <p><code>file_id</code> dan farqli ravishda, <code>file_unique_id</code> identifikatoridan media faylni qayta yuborish yoki  yuklab olish uchun foydalanish mumkin emas, lekin u muayyan media uchun barcha botlarda bir xil bo'ladi.  Odatda <code>file_unique_id</code> bir nechta botlar o'zlarining <code>file_id</code> lari bir xil faylga tegishli ekanligini bilishi kerak bo'lganda kerak bo'ladi.</p> <p>Agar fayl hali Telegram serverida mavjud bo'lmasa, bot uni uch xil usulda Telegramga yuklashi mumkin:  Oddiy fayl sifatida, havola orqali va to'g'ridan-to'g'ri baytlar to'plami sifatida.  Yuborishni tezlashtirish va umuman olganda serverlarga nisbatan ehtiyotkorlik bilan munosabatda bo'lish uchun,  Telegram fayllarini yuklashni (upload) bir marta amalga oshirish va keyinchalik birinchi yuklashdan keyin mavjud  bo'lgan <code>file_id</code> dan foydalanish to'g'riroq bo'ladi.</p> <p>Aiogram 3.x da fayllar va media yuborish uchun 3 ta klass mavjud - <code>FSInputFile</code>, <code>BufferedInputFile</code>,  <code>URLInputFile</code>, ular bilan aiogram hujjatlarida  tanishishingiz mumkin.</p> <p>Keling, rasmlarni turli usullar bilan yuborishning oddiy misolini ko'rib chiqaylik: </p><pre><code>from aiogram.types import FSInputFile, URLInputFile, BufferedInputFile\n\n@dp.message(Command('images'))\nasync def upload_photo(message: Message):\n    # Bu yerda yuborilgan fayllar file_id sini keyin ulardan foydalanish uchun saqlaymiz\n    file_ids = []\n\n    # BufferedInputFile ni qo'llash uchun `open()` kabi \"odatiy\" fayl ochilish usulidan foydalanamiz. \n    # Ammo ushbu usul masalan Pillow orqali rasm tahrirlash amalga oshirilgandan so'ng, \n    # RAMdan baytlarni yuborish uchun eng mos usul hisoblanadi\n    with open(\"buffer_emulation.jpg\", \"rb\") as image_from_buffer:\n        result = await message.answer_photo(\n            BufferedInputFile(\n                image_from_buffer.read(),\n                filename=\"image from buffer.jpg\"\n            ),\n            caption=\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u0437 \u0431\u0443\u0444\u0435\u0440\u0430\"\n        )\n        file_ids.append(result.photo[-1].file_id)\n\n    # Fayl tizimi orqali faylni yuborish\n    image_from_pc = FSInputFile(\"image_from_pc.jpg\")\n    result = await message.answer_photo(\n        image_from_pc,\n        caption=\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435\"\n    )\n    file_ids.append(result.photo[-1].file_id)\n\n    # Havola orqali fayl yuborish\n    image_from_url = URLInputFile(\"https://picsum.photos/seed/groosha/400/300\")\n    result = await message.answer_photo(\n        image_from_url,\n        caption=\"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435\"\n    )\n    file_ids.append(result.photo[-1].file_id)\n    await message.answer(\"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b:\\n\"+\"\\n\".join(file_ids))\n</code></pre> <p>Rasmlar, videolar va GIF'lar uchun sarlavhani yuqoriga ko'chirishingiz mumkin:</p> <pre><code>@dp.message(Command(\"gif\"))\nasync def send_gif(message: Message):\n    await message.answer_animation(\n        animation=\"&lt;GIF file_id'si&gt;\",\n        caption=\"\u042f \u0441\u0435\u0433\u043e\u0434\u043d\u044f:\",\n        show_caption_above_media=True\n    )\n</code></pre> <p></p>"},{"location":"messages/#downloading-media","title":"Fayllarni telegramdan yuklab olish","text":"<p>Faylni foydalanuvchiga qaytarib yuborishdan tashqari bot mediani o'z kompyuteriga/serveriga yuklab olishi mumkin. Buning uchun <code>Bot</code>  klasidagi ob'ektda <code>download()</code> usuli mavjud. Quyidagi misollarda fayllar to'g'ridan-to'g'ri fayl tizimiga yuklab olinadi, Ammo buning o'rniga, keyinchalik ba'zi kodlar (masalan Pillow) da foydalanish uchun uni BytesIO ob'ektida xotirada saqlashinggiz ham mumkin.</p> <pre><code>@dp.message(F.photo)\nasync def download_photo(message: Message, bot: Bot):\n    await bot.download(\n        message.photo[-1],\n        destination=f\"/tmp/{message.photo[-1].file_id}.jpg\"\n    )\n\n\n@dp.message(F.sticker)\nasync def download_sticker(message: Message, bot: Bot):\n    await bot.download(\n        message.sticker,\n        # Windows uchun path'ni tuzatishimiz kerak\n        destination=f\"/tmp/{message.sticker.file_id}.webp\"\n    )\n</code></pre> <p>Nega biz rasmlar uchun <code>message.photo</code> emas, balki <code>message.photo[-1]</code> dan foydalandik ? Chunki Telegram'dagi rasmlar bir vaqtning o'zida bir nechta nusxada yuboriladi. Barchasi bir xil ammo turli o'lchamda, bunda rasmlar list ko'rinishida sifatsizdan sifatligacha tartiblangan bo'ladi. Shunga ko'ra eng sifatli rasmni olish uchun <code>photo[-1]</code> dan foydalanamiz va biz eng sifatli rasm hajmi bilan ishlashimiz mumkin.</p> <p>Katta hajmdagi fayllarni yuklab olish</p> <p>Telegram Bot API'dan foydalanadigan botlar 20 megabaytdan  oshmaydigan fayllarni yuklashi mumkin. Agar siz katta hajmdagi fayllarni yuklab olishni/yuklashni  rejalashtirmoqchi bo'lsangiz, Telegram Bot API bilan emas, Telegram Client API bilan o'zaro aloqada bo'lgan  kutubxonalardan foydalanishinggiz yaxshiroq, masalan, Telethon yoki Pyrogram. Ko'pchilik bilishmaydi lekin Telegram Client API dan nafaqat oddiy hisoblar,  balki botlar ham foydalanishi mumkin</p> <p>Bot API 5.0 versiyasidan boshlab siz katta fayllar bilan ishlash uchun o'zingizning  Bot API serveringizdan foydalanishingiz mumkin.</p>"},{"location":"messages/#albums","title":"Albomlar","text":"<p>Biz Telegram'da albomlar (yani media guruh) deb ataydigan narsa, aslida umumiy <code>media_group_id</code> ga ega bo\u2018lgan va  foydalanuvchilariga vizual tarzda \"bitta\" habar ko'rinishida ko'rinadigan bir nechta habarlardir.  Aiogramda 3.1 versiyasidan boshlab  \"jamlagich\" albomi mavjud bo'lib,  Quyida biz uning ishlashini ko'rib chiqamiz. Ammo avvalo media guruhlarning bir nechta xususiyatlarini sanab o'tishimiz kerak:</p> <ul> <li>Hech qanday usul bilan ularga inline klaviatura qo'shish yoki repyl klaviaturani birga yuborish mumkin emas.</li> <li>Albomdagi har bir media fayl o'ziga xos izohga (caption) ega bo'lishi mumkin. Agar faqat bitta media izohga ega bo'lsa,  u butun albom uchun umumiy izoh sifatida chiqariladi.</li> <li>Suratlarni bir albomda videolar bilan aralashtirib yuborish mumkin, ammo fayllar (Document) va musiqa (Audio) hech narsaga aralashtirilmaydi,  faqat shu turdagi media bilan.</li> <li>Albomda 10 tadan ko'p media fayl bo'lishi mumkin emas.</li> </ul> <p>Keling buni aiogramda qanday qilinishini ko'rib chiqaylik:</p> <pre><code>from aiogram.filters import Command\nfrom aiogram.types import FSInputFile, Message\nfrom aiogram.utils.media_group import MediaGroupBuilder\n\n@dp.message(Command(\"album\"))\nasync def cmd_album(message: Message):\n    album_builder = MediaGroupBuilder(\n        caption=\"\u041e\u0431\u0449\u0430\u044f \u043f\u043e\u0434\u043f\u0438\u0441\u044c \u0434\u043b\u044f \u0431\u0443\u0434\u0443\u0449\u0435\u0433\u043e \u0430\u043b\u044c\u0431\u043e\u043c\u0430\"\n    )\n    album_builder.add(\n        type=\"photo\",\n        media=FSInputFile(\"image_from_pc.jpg\")\n        # caption=\"\u041f\u043e\u0434\u043f\u0438\u0441\u044c \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c\u0443 \u043c\u0435\u0434\u0438\u0430\"\n\n    )\n    # Agar biz medianing turini bilsak\n    # add_&lt;media tipi&gt; ko'rinishida foydalanishimiz mumkin\n    album_builder.add_photo(\n        # Havolalar yoki file_id uchun darhol qiymatni ko'rsatish kifoya\n        media=\"https://picsum.photos/seed/groosha/400/300\"\n    )\n    album_builder.add_photo(\n        media=\"&lt;sizdagi file_id&gt;\"\n    )\n    await message.answer_media_group(\n        # build() metodini chaqirishni unutmang\n        media=album_builder.build()\n    )\n</code></pre> <p>Natija: </p> <p></p> <p>Ammo albomlarni yuklab olishda hammasi ancha rasvo... Yuqorida aytilganidek, albomlar - bu shunchaki guruhlangan alohida xabarlardir,  demak ular botga ham turli xil yangilanish (Update) larda keladi. Butun albomni bittada qabul qilish uchun 100% ishonchli usul mavjud emas,  lekin buni minimal yo'qotishlar bilan amalga oshirishga harakat qilish mumkin. Odatda, bu middleware orqali amalga oshiriladi,  media guruhlarni qabul qilish bo'yicha mening shaxsiy yechimimni  ushbu havola orqali topishingiz mumkin.</p>"},{"location":"messages/#service","title":"Xizmat (servis) xabarlari","text":"<p>Telegramdagi xabarlar matnli, media fayllar va xizmat (ya'ni, servis) xabarlarga bo'linadi.  Keling ularning oxirgisi haqida gaplashishamiz.</p> <p></p> <p>Ular g\u2018alati ko\u2018rinishga ega va ular bilan o\u2018zaro aloqalar cheklangan bo\u2018lishiga qaramay,  ular o\u2018zining ID raqamlari bor va hatto ularning egasi mavjud bo\u2018lgan xabarlardir.  Shuni ta\u2019kidlash kerak-ki, xizmat xabarlarining qo\u2018llanilish doirasi yillar davomida o\u2018zgarib bordi va  hozirda sizning botingiz ular bilan ishlamasligi yoki faqat o\u2018chirish bilan shug\u2018ullanishi mumkin.</p> <p>Batafsil ma\u2019lumotga to'xtalmasdan, aniq bir misolni ko\u2018rib chiqamiz: Guruhga yangi  kirgan a'zoga \"xush kelibsiz\" xabarini yuborib ko'ramiz. Bunday xizmat xabarida content_type \"new_chat_members\"ga teng  bo\u2018ladi, ammo bu aslida bir xil nomdagi maydonga ega bo\u2018lgan Message obyekti hisoblanadi.\"</p> <pre><code>@dp.message(F.new_chat_members)\nasync def somebody_added(message: Message):\n    for user in message.new_chat_members:\n        # full_name maydoni ism va familiyani olib beradi\n        # (screenshotda foydalanuvchilarning familiyasi yo'q)\n        await message.reply(f\"\u041f\u0440\u0438\u0432\u0435\u0442, {user.full_name}\")\n</code></pre> <p></p> <p>Shuni esda tutingki <code>message.new_chat_members</code> ro'yxatdir, chunki bitta foydalanuvchi bir vaqtning o'zida  bir nechta ishtirokchilarni qo'shishi mumkin. Shuningdek, <code>message.from_user</code> va <code>message.new_chat_members</code> maydonlarini  adashtirmaslik kerak. Birinchisi - bu subyekt, ya'ni harakatni amalga oshirgan shaxs. Ikkinchisi - bu harakat ob'yektlari.  Ya'ni agar siz \u00abAnna Boris va Viktorni qo'shdi\u00bb ko'rinishidagi xabarni ko'rsangiz, <code>message.from_user</code> - bu Anna haqidagi  ma'lumot, va <code>message.new_chat_members</code> ro'yxati Boris va Viktor haqidagi ma'lumotni o'z ichiga oladi.</p> <p>Xizmat xabarlariga to'liq ishonmang!</p> <p>Yangi a'zolar qo'shilishi (new_chat_members) va chiqib ketishi (left_chat_member) haqida xizmat xabarlarida  bitta noxush holat mavjud: ular ishonchsiz, ya'ni umuman xabar yaratilmasligi mumkin. Masalan, new_chat_members haqidagi xabar, bu habar 10k (10 ming) ishtirokchiga yaqin bo'lgan guruhda yaratilmaydi,  left_chat_member esa 50 ta ishtirokchida (lekin bu bobni yozishda men 9 ishtirokchili guruhda left_chat_member xabari  yaratilmaganiga duch keldim. Yarim soat o'tgach, boshqa odam chiqib ketganda shu guruhda xabar paydo bo'ldi).</p> <p>Bot API 5.0 chiqarilishi bilan dasturchilar istalgan o'lchamdagi guruhlarda va shuningdek kanallarda  a'zolarning kirishi/chiqishini ko'rishning ancha ishonchli usuliga ega bo'ldilar.  Ammo bu haqda boshqa safar gaplashamiz.</p>"},{"location":"messages/#bonus","title":"Bonus: matnda havolani yashirish","text":"<p>Ba'zi holatlarda rasm bilan uzun xabar yuborish kerak bo'lib qolishi mumkin, lekin media fayllarga qo'yiladigan izohlar  limiti 1024 ta belgi, oddiy matnli xabarlarda esa bu 4096 ta belgini tashkil etadi. Media havolasini pastda matnga qo'shish esa chiroyli ko'rinmaydi. Bu muammoni hal qilish uchun bir necha yil avval HTML-belgilashda \"yashirin havolalar\" usuli o'ylab topilgan.  Asosi shundaki, havolani nol kenglikdagi bo'shliqqa joylashtirib,  butun konstruktsiyani xabar boshiga qo'yish mumkin. Kuzatuvchi uchun xabarda ortiqcha narsa ko'rinmaydi  lekin Telegram serveri barchasini ko'radi va oldindan ko'ruv(preview)ni qo'shadi.  Aiogram ishlab chiquvchilari buning uchun hatto <code>hide_link()</code> nomli maxsus yordamchi metodini yaratishgan: </p><pre><code># yangi import\nfrom aiogram.utils.markdown import hide_link\n\n@dp.message(Command(\"hidden_link\"))\nasync def cmd_hidden_link(message: Message):\n    await message.answer(\n        f\"{hide_link('https://telegra.ph/file/562a512448876923e28c3.png')}\"\n        f\"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f Telegram: *\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442*\\n\"\n        f\"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438: *\u043d\u0435 \u0447\u0438\u0442\u0430\u044e\u0442 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e*\\n\"\n        f\"\u0413\u0440\u0443\u0448\u0430:\"\n    )\n</code></pre> <p></p> <p>Yuqorida ko'rsatilgan LinkPreviewOptions yordamida yuqorida uzun 4096 belgilik izoh bilan media faylni qo'yishingiz mumkin.</p> <p>Hozircha shu. Keyingi boblarda ko'rishguncha! Layk bosing, obuna bo'ling, qo'ng'iroq tugmasini bosishni unutmang!</p>"},{"location":"payments/","title":"\u041f\u043b\u0430\u0442\u0435\u0436\u0438 \u0432 Telegram","text":""},{"location":"payments/#payments","title":"\u041f\u043b\u0430\u0442\u0435\u0436\u0438 \u0432 Telegram","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f aiogram: 3.7.0</p> <p>\u0418\u0437 \u044d\u0442\u043e\u0439 \u0433\u043b\u0430\u0432\u044b \u0432\u044b \u0443\u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a \u043c\u043e\u0436\u043d\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u043a\u0443\u043f\u043a\u0438 \u0432 \u0441\u0432\u043e\u0438\u0445 Telegram-\u0431\u043e\u0442\u0430\u0445 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0439 \u0432\u0430\u043b\u044e\u0442\u044b  Telegram Stars. </p>"},{"location":"payments/#pay-with-stars","title":"\u041f\u043b\u0430\u0442\u0435\u0436\u0438 \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 Stars","text":"<p>\u041d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u0438\u044e\u043d\u044f 2024 \u0433\u043e\u0434\u0430, \u0432\u0441\u0435 \u043f\u043b\u0430\u0442\u0435\u0436\u0438 \u0437\u0430 \u0446\u0438\u0444\u0440\u043e\u0432\u044b\u0435 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b \u0438 \u0443\u0441\u043b\u0443\u0433\u0438 \u0432 Telegram \u0434\u043e\u043b\u0436\u043d\u044b \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043d\u043e\u0432\u043e\u0439  \u0446\u0438\u0444\u0440\u043e\u0432\u043e\u0439 \u0432\u0430\u043b\u044e\u0442\u044b Telegram Stars. \u041c\u044b \u043d\u0435 \u0431\u0443\u0434\u0435\u043c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e \u043e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0438 \u00ab\u0417\u0432\u0451\u0437\u0434\u043e\u0447\u0435\u043a\u00bb, \u0442\u0435\u043c \u0431\u043e\u043b\u0435\u0435, \u0447\u0442\u043e \u0434\u0435\u0442\u0430\u043b\u0438 \u043c\u043e\u0433\u0443\u0442  \u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f \u0441\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c. \u041d\u043e\u0432\u043e\u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0434\u043e\u0432\u043e\u043b\u044c\u043d\u043e \u0441\u043f\u043e\u0440\u043d\u043e\u0435, \u043d\u043e \u0441\u0443\u0434\u044f \u043f\u043e \u0432\u0441\u0435\u043c\u0443, \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430\u043c \u0431\u043e\u0442\u043e\u0432 \u043f\u0440\u0438\u0434\u0451\u0442\u0441\u044f \u0441 \u044d\u0442\u0438\u043c \u043a\u0430\u043a-\u0442\u043e \u0436\u0438\u0442\u044c  \u0434\u0430\u043b\u044c\u0448\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u0442\u043e\u0438\u0442 \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f \u0432 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438.</p>"},{"location":"payments/#plan","title":"\u041f\u043b\u0430\u043d \u0440\u0430\u0431\u043e\u0442","text":"<p>\u0414\u043b\u044f \u043d\u0430\u0433\u043b\u044f\u0434\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u0431\u043e\u0442\u0430 \u0434\u043b\u044f \u043f\u0440\u0438\u0451\u043c\u0430 \u0434\u043e\u0431\u0440\u043e\u0432\u043e\u043b\u044c\u043d\u044b\u0445 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439 (\u0434\u043e\u043d\u0430\u0442\u043e\u0432). \u0414\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u043f\u0440\u0435\u0441\u0435\u0442\u044b (<code>/\u2060donate_1</code>, <code>/\u2060donate_25</code>, <code>/\u2060donate_50</code>),  \u0430 \u0442\u0430\u043a\u0436\u0435 \u0432\u0432\u043e\u0434 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430 \u0437\u0432\u0451\u0437\u0434\u043e\u0447\u0435\u043a (<code>/\u2060donate 777</code>, \u0437\u0434\u0435\u0441\u044c \u0447\u0438\u0441\u043b\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0451\u0442\u0441\u044f \u043a\u0430\u043a \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b).  \u0422\u0430\u043a\u0436\u0435 \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/\u2060refund</code>, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043c\u043e\u0433 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043f\u043e\u0442\u0440\u0430\u0447\u0435\u043d\u043d\u044b\u0435 Stars \u043d\u0430 \u0441\u0432\u043e\u0439 \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0430\u043a\u043a\u0430\u0443\u043d\u0442.  \u041f\u043e \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044e Telegram,  \u0432\u0441\u0435 \u0431\u043e\u0442\u044b, \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0449\u0438\u0435 \u043e\u043f\u043b\u0430\u0442\u0443 \u0437\u0430 \u0446\u0438\u0444\u0440\u043e\u0432\u044b\u0435 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b \u0438 \u0443\u0441\u043b\u0443\u0433\u0438, \u043e\u0431\u044f\u0437\u0430\u043d\u044b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/\u2060paysupport</code>, \u043d\u043e \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443  \u043d\u0430 \u044d\u0442\u043e\u0442 \u0441\u0447\u0451\u0442 \u043d\u0435\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0440\u0430\u0437\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0439, \u0442\u043e \u0432 \u043d\u0435\u0439 \u0431\u0443\u0434\u0435\u043c \u043b\u0438\u0448\u043d\u0438\u0439 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u044f\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/\u2060refund</code>.</p>"},{"location":"payments/#technologies","title":"\u0422\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438","text":"<p>\u041f\u0440\u0435\u0436\u0434\u0435 \u0432\u0441\u0435\u0433\u043e, aiogram, \u043f\u0440\u0438\u0447\u0451\u043c \u0432\u0435\u0440\u0441\u0438\u0438 \u043d\u0435 \u043d\u0438\u0436\u0435 3.7.0. \u041d\u0435\u0441\u043c\u043e\u0442\u0440\u044f \u043d\u0430 \u0442\u043e, \u0447\u0442\u043e \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u043c\u0435\u0442\u043e\u0434\u0430  sendInvoice \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0443\u0436\u0435 \u0434\u0430\u0432\u043d\u043e, \u043c\u0435\u0442\u043e\u0434  refundStarPayment \u0431\u044b\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u0432 Bot API 7.4, \u0447\u0442\u043e  \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432\u0435\u0440\u0441\u0438\u0438 3.7 \u0443 aiogram.</p> <p>\u0414\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0430 structlog.  \u0415\u0451 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u0438\u0434\u043d\u043e \u0432 \u0441\u043d\u0438\u043f\u043f\u0435\u0442\u0430\u0445 \u0432 \u044d\u0442\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435, \u043d\u043e \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0445 \u0442\u0435\u043a\u0441\u0442\u0430\u0445 \u043a \u0433\u043b\u0430\u0432\u0435  \u043e\u043d\u0430 \u0435\u0441\u0442\u044c.</p> <p>\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u043a\u0441\u0442\u044b, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0431\u043e\u0442\u043e\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 Project Fluent \u043e\u0442 Mozilla.  \u041f\u043e\u043c\u0438\u043c\u043e \u0441\u043d\u0438\u043f\u043f\u0435\u0442\u0430 \u0441 Python-\u043a\u043e\u0434\u043e\u043c \u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u0432\u0438\u0434\u0435\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438. \u0414\u0430\u0431\u044b \u0443\u043f\u0440\u043e\u0441\u0442\u0438\u0442\u044c \u0441\u0435\u0431\u0435 \u0437\u0430\u0434\u0430\u0447\u0443,  \u0430 \u0432\u0430\u043c \u043f\u043e\u043c\u043e\u0447\u044c \u0441\u0444\u043e\u043a\u0443\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u043e\u0432\u043e\u043c \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0435, \u0443\u0441\u043b\u043e\u0432\u0438\u043c\u0441\u044f, \u0447\u0442\u043e \u044f\u0437\u044b\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0440\u043e\u043b\u0438 \u043d\u0435 \u0438\u0433\u0440\u0430\u0435\u0442; \u0431\u043e\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442  \u043e\u0442\u0434\u0430\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0438 \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435 \u0438\u0437 \u043e\u0434\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430.</p> <p>\u0415\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0437\u043d\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u043e \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 Telegram-\u0431\u043e\u0442\u043e\u0432 \u043d\u0430 \u0440\u0430\u0437\u043d\u044b\u0435 \u044f\u0437\u044b\u043a\u0438 \u0431\u0435\u0437 \u0432\u044b\u0448\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0445 \u0441\u0430\u043c\u043e\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0439,  \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0430\u0435\u043c \u0432\u0430\u0441 \u043d\u0430 \u043d\u0430\u0448 \u043f\u043b\u0430\u0442\u043d\u044b\u0439 \u043a\u0443\u0440\u0441  \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Stepik.</p>"},{"location":"payments/#command-start","title":"\u041f\u0438\u0448\u0435\u043c \u043a\u043e\u0434. \u041a\u043e\u043c\u0430\u043d\u0434\u0430 /start","text":"<p>\u041f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/\u2060start</code> \u0431\u043e\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u044b\u0434\u0430\u0432\u0430\u0442\u044c \u0432\u043e\u0442 \u0442\u0430\u043a\u043e\u0439 \u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439 \u0442\u0435\u043a\u0441\u0442</p> <pre><code>cmd-start =\n    \u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435! \u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0440\u0435\u0448\u0438\u043b\u0438 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0431\u043e\u0442\u043e\u043c. \n    \u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b:\n\n    \u2022 /donate_1: \u043f\u043e\u0434\u0430\u0440\u0438\u0442\u044c 1 \u0437\u0432\u0435\u0437\u0434\u0443.\n    \u2022 /donate_25: \u043f\u043e\u0434\u0430\u0440\u0438\u0442\u044c 25 \u0437\u0432\u0451\u0437\u0434.\n    \u2022 /donate_50: \u043f\u043e\u0434\u0430\u0440\u0438\u0442\u044c 50 \u0437\u0432\u0451\u0437\u0434.\n    \u2022 /donate &lt;\u0447\u0438\u0441\u043b\u043e&gt;: \u043f\u043e\u0434\u0430\u0440\u0438\u0442\u044c &lt;\u0447\u0438\u0441\u043b\u043e&gt; \u0437\u0432\u0451\u0437\u0434.\n    \u2022 /paysupport: \u043f\u043e\u043c\u043e\u0449\u044c \u0441 \u043f\u043e\u043a\u0443\u043f\u043a\u0430\u043c\u0438.\n    \u2022 /refund: \u0432\u043e\u0437\u0432\u0440\u0430\u0442 \u043f\u043b\u0430\u0442\u0435\u0436\u0430 (\u0440\u0435\u0444\u0430\u043d\u0434).\n</code></pre> <p>\u041a\u043e\u0434:</p> <pre><code>@router.message(CommandStart())\nasync def cmd_start(\n    message: Message,\n    l10n: FluentLocalization,\n):\n    await message.answer(\n        l10n.format_value(\"cmd-start\"),\n        parse_mode=None,\n    )\n</code></pre> <p>\u0423 \u044d\u0442\u043e\u0433\u043e \u0431\u043e\u0442\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0440\u0435\u0436\u0438\u043c \u0440\u0430\u0437\u043c\u0435\u0442\u043a\u0438 HTML, \u043d\u043e \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441 \u044d\u0442\u0438\u043c \u0440\u0435\u0436\u0438\u043c\u043e\u043c, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443  \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0430 <code>&lt;\u2060\u0447\u0438\u0441\u043b\u043e\u2060&gt;</code>. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 <code>parse_mode</code> \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 <code>None</code>. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 <code>l10n</code> \u2013  \u044d\u0442\u043e \u043c\u0438\u0434\u043b\u0432\u0430\u0440\u044c \u0434\u043b\u044f \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438, \u043f\u043e\u0434\u043a\u043b\u0430\u0434\u044b\u0432\u0430\u044e\u0449\u0430\u044f \u0432 \u0445\u044d\u043d\u0434\u043b\u0435\u0440 \u043e\u0431\u044a\u0435\u043a\u0442 <code>FluentLocalization</code>. \u0412 \u043b\u044e\u0431\u043e\u0439 \u043d\u0435\u043f\u043e\u043d\u044f\u0442\u043d\u043e\u0439 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438 \u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435  \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a\u0438 \u043a \u0433\u043b\u0430\u0432\u0435.</p>"},{"location":"payments/#commands-donate","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b /donate","text":"<p>\u0414\u0430\u043b\u0435\u0435 \u043d\u0443\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/\u2060donate</code> \u0441 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u043c \u0432\u044b\u0431\u043e\u0440\u043e\u043c \u0441\u0443\u043c\u043c\u044b, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0433\u043e\u0442\u043e\u0432\u044b\u0445 \u043f\u0440\u0435\u0441\u0435\u0442\u043e\u0432.  \u041f\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u043d\u0430 \u0438\u044e\u043d\u044c 2024 \u0433\u043e\u0434\u0430 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u0437\u0432\u0451\u0437\u0434 \u0434\u043b\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0438 \u2013 2500, \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438 \u0438\u043d\u0432\u043e\u0439\u0441\u0430 \u043d\u0430 \u0431\u00f3\u043b\u044c\u0448\u0443\u044e \u0441\u0443\u043c\u043c\u0443  Telegram-\u043a\u043b\u0438\u0435\u043d\u0442\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442 \u00ab\u043b\u043e\u043c\u0430\u0442\u044c\u0441\u044f\u00bb \u0438 \u043d\u0435 \u0434\u0430\u044e\u0442 \u043f\u0440\u0438\u043e\u0431\u0440\u0435\u0441\u0442\u0438 \u043d\u043e\u0432\u044b\u0435 \u0437\u0432\u0451\u0437\u0434\u044b \u043f\u0440\u044f\u043c\u043e \u043f\u0435\u0440\u0435\u0434 \u043f\u043e\u043a\u0443\u043f\u043a\u043e\u0439. \u0422\u0430\u043a \u0447\u0442\u043e \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u043c\u0441\u044f  \u0441\u0443\u043c\u043c\u043e\u0439 \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 [1;2500] \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e.</p> <p>\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439-\u043f\u0440\u0435\u0441\u0435\u0442\u043e\u043c \u0438 \u043e\u0431\u044b\u0447\u043d\u043e\u0439 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f; \u043c\u043e\u0436\u043d\u043e \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0432\u0441\u0451 \u0432 \u043e\u0434\u0438\u043d \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a. \u041d\u0430\u0447\u043d\u0451\u043c \u0435\u0433\u043e \u043f\u0438\u0441\u0430\u0442\u044c:  \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0438 \u0440\u0430\u0441\u043f\u0430\u0440\u0441\u0438\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435. \u0414\u043b\u044f \u043f\u0440\u0435\u0441\u0435\u0442\u043e\u0432 \u043d\u0430\u0434\u043e \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0441\u0430\u043c\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u044e \u0438 \u0432\u044b\u0442\u0430\u0449\u0438\u0442\u044c  \u043f\u0440\u0430\u0432\u0443\u044e \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0443 \u043a\u0430\u043a \u0447\u0438\u0441\u043b\u043e, \u0430 \u0434\u043b\u044f \u043e\u0431\u044b\u0447\u043d\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0430\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043e \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0451:</p> <pre><code>@router.message(Command(\"donate_1\"))\n@router.message(Command(\"donate_25\"))\n@router.message(Command(\"donate_50\"))\n@router.message(Command(\"donate\"))\nasync def cmd_donate(\n    message: Message,\n    command: CommandObject,\n    l10n: FluentLocalization,\n):\n    # \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0430 /donate \u0427\u0418\u0421\u041b\u041e,\n    # \u0442\u043e\u0433\u0434\u0430 \u0432\u044b\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u0435\u043c \u0447\u0438\u0441\u043b\u043e \u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b\n    if command.command != \"donate\":\n        amount = int(command.command.split(\"_\")[1])\n    # \u0412 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043f\u044b\u0442\u0430\u0435\u043c\u0441\u044f \u043f\u0430\u0440\u0441\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0432\u0432\u043e\u0434\n    else:\n        # \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0447\u0438\u0441\u043b\u043e \u0438 \u043d\u0430 \u0435\u0433\u043e \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\n        if (\n            command.args is None\n            or not command.args.isdigit()\n            or not 1 &lt;= int(command.args) &lt;= 2500\n        ):\n            await message.answer(\n                l10n.format_value(\"custom-donate-input-error\")\n            )\n            # \u0417\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443\n            return\n        amount = int(command.args)\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c, \u043a\u043e\u0433\u0434\u0430 \u0447\u0438\u0441\u043b\u043e \u0437\u0432\u0451\u0437\u0434 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0438 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u043e, \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0438\u043d\u0432\u043e\u0439\u0441, \u0442.\u0435. \u0441\u0447\u0451\u0442 \u043d\u0430 \u043e\u043f\u043b\u0430\u0442\u0443.  \u0412 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 Telegram Stars \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:</p> <pre><code>    ### \u044d\u0442\u043e \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430 \u0438\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u0441\u043d\u0438\u043f\u043f\u0435\u0442\u0430! ###\n\n    # \u0414\u043b\u044f \u043f\u043b\u0430\u0442\u0435\u0436\u0435\u0439 \u0432 Telegram Stars \u0441\u043f\u0438\u0441\u043e\u043a \u0446\u0435\u043d\n    # \u041e\u0411\u042f\u0417\u0410\u041d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0420\u041e\u0412\u041d\u041e \u0438\u0437 1 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430\n    prices = [LabeledPrice(label=\"XTR\", amount=amount)]\n    await message.answer_invoice(\n        title=l10n.format_value(\"invoice-title\"),\n        description=l10n.format_value(\n            \"invoice-description\",\n            {\"starsCount\": amount}\n        ),\n        prices=prices,\n        # provider_token \u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c\n        provider_token=\"\",\n        # \u0412 \u043f\u0435\u0439\u043b\u043e\u0430\u0439\u0434 \u043c\u043e\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0447\u0442\u043e \u0443\u0433\u043e\u0434\u043d\u043e,\n        # \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0430\u0439\u0434\u0438 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u043e\u043a\u0443\u043f\u0430\u0435\u0442\u0441\u044f\n        payload=f\"{amount}_stars\",\n        # XTR - \u044d\u0442\u043e \u043a\u043e\u0434 \u0432\u0430\u043b\u044e\u0442\u044b Telegram Stars\n        currency=\"XTR\"\n    )\n</code></pre> <p></p> <p>\u041a\u043d\u043e\u043f\u043a\u0430 \"\u041e\u043f\u043b\u0430\u0442\u0438\u0442\u044c\" \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u0441\u0443\u043c\u043c\u043e\u0439 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c\u043e\u043c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438, \u0435\u0451 \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0443\u0447\u043d\u0443\u044e.  \u041d\u043e \u043f\u0440\u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u0438 \u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u0438\u043d\u043b\u0430\u0439\u043d-\u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0443 \u0438 \u043f\u0440\u0438\u0446\u0435\u043f\u0438\u0442\u044c \u0435\u0451 \u043a \u0438\u043d\u0432\u043e\u0439\u0441\u0443. \u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0435: \u043f\u0435\u0440\u0432\u043e\u0439 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c  \u043a\u043d\u043e\u043f\u043a\u0430 \u0441 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c <code>pay=True</code>. \u0415\u0441\u043b\u0438 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u044d\u043c\u043e\u0434\u0437\u0438 \u2b50 \u0438\u043b\u0438 \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0443 XTR, \u0442\u043e \u044d\u0442\u043e\u0442 \u0442\u0435\u043a\u0441\u0442 \u0431\u0443\u0434\u0435\u0442  \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043c\u0435\u043d\u0451\u043d \u043d\u0430 \u0438\u043a\u043e\u043d\u043a\u0443 Telegram Star:</p> <pre><code>    builder = InlineKeyboardBuilder()\n    builder.button(\n        text=f\"\u041e\u043f\u043b\u0430\u0442\u0438\u0442\u044c {amount} XTR\",\n        pay=True\n    )\n    builder.button(\n        text=\"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u043a\u0443\u043f\u043a\u0443\",\n        callback_data=\"cancel\"\n    )\n    builder.adjust(1)\n\n    prices = [LabeledPrice(label=\"XTR\", amount=amount)]\n    await message.answer_invoice(\n        title=l10n.format_value(\"invoice-title\"),\n        description=l10n.format_value(\n            \"invoice-description\",\n            {\"starsCount\": amount}\n        ),\n        prices=prices,\n        provider_token=\"\",\n        payload=f\"{amount}_stars\",\n        currency=\"XTR\",\n        # \u041f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u043c \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0443\n        reply_markup=builder.as_markup()\n    )\n</code></pre> <p></p> <p>\u041a \u0441\u043b\u043e\u0432\u0443, \u0438\u043d\u0432\u043e\u0439\u0441 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438 \u0432 \u0432\u0438\u0434\u0435 \u043a\u043b\u0438\u043a\u0430\u0431\u0435\u043b\u044c\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0438 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f:</p> <pre><code>@router.message(Command(\"donate_link\"))\nasync def cmd_link(\n    message: Message,\n    bot: Bot,\n    l10n: FluentLocalization,\n):\n    # \u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u0441\u044b\u043b\u043a\u0438 \u043d\u0430 \u0438\u043d\u0432\u043e\u0439\u0441 \u0432 1 \u0437\u0432\u0435\u0437\u0434\u0443\n    # \u0412 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u044d\u0442\u043e\u0442 API-\u0432\u044b\u0437\u043e\u0432, Telegram \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \n    # \u0441\u0440\u0430\u0437\u0443 \u0441\u0441\u044b\u043b\u043a\u0443.\n    invoice_link = await bot.create_invoice_link(\n        title=l10n.format_value(\"invoice-title\"),\n        description=l10n.format_value(\n            \"invoice-description\",\n            {\"starsCount\": 1}\n        ),\n        prices=[LabeledPrice(label=\"XTR\", amount=1)],\n        provider_token=\"\",\n        payload=\"demo\",\n        currency=\"XTR\"\n    )\n    await message.answer(\n        l10n.format_value(\n            \"invoice-link-text\",\n            {\"link\": invoice_link}\n        )\n    )\n</code></pre> <p>\u041d\u043e\u0432\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0432 \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438:</p> <pre><code>invoice-title = \u0414\u043e\u0431\u0440\u043e\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435\ninvoice-description =\n    {$starsCount -&gt;\n        [one] {$starsCount} \u0437\u0432\u0435\u0437\u0434\u0430\n        [few] {$starsCount} \u0437\u0432\u0435\u0437\u0434\u044b\n       *[other] {$starsCount} \u0437\u0432\u0451\u0437\u0434\n}\n\ncustom-donate-input-error = \n    \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0443\u043c\u043c\u0443 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 &lt;code&gt;/donate \u0427\u0418\u0421\u041b\u041e&lt;/code&gt;, \n    \u0433\u0434\u0435 \u0427\u0418\u0421\u041b\u041e \u043e\u0442 1 \u0434\u043e 2500 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e.\n\ninvoice-link-text =\n    \u0412\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c &lt;a href=\"{$link}\"&gt;\u044d\u0442\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u043e\u0439&lt;/a&gt; \u0434\u043b\u044f \u0434\u043e\u043d\u0430\u0442\u0430 \u0432 \u0440\u0430\u0437\u043c\u0435\u0440\u0435 1 \u0437\u0432\u0435\u0437\u0434\u044b.\n</code></pre>"},{"location":"payments/#pre-checkout","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u0435\u0440\u0435\u0434 \u043e\u043f\u043b\u0430\u0442\u043e\u0439","text":"<p>\u0415\u0441\u043b\u0438 \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0417\u0432\u0451\u0437\u0434 \u043d\u0430 \u0441\u0447\u0435\u0442\u0443, \u0442\u043e Bot API \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 \u0431\u043e\u0442\u0443 \u0430\u043f\u0434\u0435\u0439\u0442 \u0442\u0438\u043f\u0430  PreCheckoutQuery. \u0423 \u0431\u043e\u0442\u0430 \u0435\u0441\u0442\u044c \u0440\u043e\u0432\u043d\u043e 10 \u0441\u0435\u043a\u0443\u043d\u0434, \u0447\u0442\u043e\u0431\u044b \u0435\u0449\u0451 \u0440\u0430\u0437  \u0432\u0441\u0451 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0438 \u043b\u0438\u0431\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u043f\u043e\u043a\u0443\u043f\u043a\u0443, \u043b\u0438\u0431\u043e \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0435\u0451. \u0417\u0430\u0447\u0435\u043c \u043e\u0442\u043c\u0435\u043d\u044f\u0442\u044c? \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u043e\u043f\u044b\u0442\u0430\u043b\u0441\u044f \u043a\u0443\u043f\u0438\u0442\u044c \u043e\u0434\u0438\u043d  \u0438 \u0442\u043e\u0442 \u0436\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u0432\u0430\u0436\u0434\u044b. \u0418\u043b\u0438 \u043e\u043d \u0437\u0430\u0431\u0430\u043d\u0435\u043d \u0432 \u0431\u043e\u0442\u0435 \u0438 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u043c\u0435\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043d\u0438\u0447\u0435\u0433\u043e \u043f\u043e\u043a\u0443\u043f\u0430\u0442\u044c. \u0427\u0442\u043e \u0443\u0433\u043e\u0434\u043d\u043e.  \u0415\u0441\u043b\u0438 \u0441\u0442\u043e\u0438\u0442 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u043a\u0443\u043f\u043a\u0443, \u0442\u043e \u0431\u043e\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043e\u0442\u0432\u0435\u0442\u0438\u0442\u044c \u043d\u0430 PreCheckoutQuery \u0441 <code>ok=False</code> \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u043c \u0442\u0435\u043a\u0441\u0442\u043e\u043c \u043e\u0448\u0438\u0431\u043a\u0438. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: </p> <pre><code># \u0422\u0435\u043a\u0441\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432 FTL-\u0444\u0430\u0439\u043b\u0435:\npre-checkout-failed-reason = \u041d\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u0435\u0441\u0442\u0430 \u0434\u043b\u044f \u0434\u0435\u043d\u0435\u0433 \ud83d\ude2d\n\n# \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043d\u0430 Python:\n@router.pre_checkout_query()\nasync def on_pre_checkout_query(\n    pre_checkout_query: PreCheckoutQuery,\n    l10n: FluentLocalization,\n):\n    await pre_checkout_query.answer(\n        ok=False,\n        error_message=l10n.format_value(\"pre-checkout-failed-reason\")\n    )\n</code></pre> <p>\u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0431\u043e\u0442 \u0443\u0432\u0438\u0434\u0438\u0442 \u0447\u0442\u043e-\u0442\u043e \u0442\u0430\u043a\u043e\u0435:</p> <p></p> <p>\u041d\u043e \u0447\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u0432\u0441\u0451 \u0431\u0443\u0434\u0435\u0442 \u0445\u043e\u0440\u043e\u0448\u043e \u0438 \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043e\u043f\u043b\u0430\u0442\u0443:</p> <pre><code>@router.pre_checkout_query()\nasync def on_pre_checkout_query(\n    pre_checkout_query: PreCheckoutQuery,\n):\n    await pre_checkout_query.answer(ok=True)\n</code></pre>"},{"location":"payments/#after-payment","title":"\u041f\u043e\u0441\u043b\u0435 \u043e\u043f\u043b\u0430\u0442\u044b","text":"<p>\u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0438 \u0431\u043e\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u0430\u043f\u0434\u0435\u0439\u0442 \u0442\u0438\u043f\u0430 Message \u0441 \u043d\u0435\u043f\u0443\u0441\u0442\u044b\u043c \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u043c <code>successful_payment</code>, \u0432 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e  \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u044b\u0441\u043a\u0430\u0442\u044c \u0430\u0439\u0434\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438, \u043f\u044d\u0439\u043b\u043e\u0430\u0434 (\u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0441\u0430\u043c \u043f\u0435\u0440\u0435\u0434\u0430\u0451\u0442 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u0438\u043d\u0432\u043e\u0439\u0441\u0430) \u0438  \u043f\u0440\u043e\u0447\u0438\u0435 \u0448\u0442\u0443\u043a\u0438. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0441 \u043f\u043e\u043a\u0443\u043f\u043a\u043e\u0439, \u0434\u043e\u0431\u0430\u0432\u0438\u0432 \u0441 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c \u044d\u0444\u0444\u0435\u043a\u0442 \u043e\u0433\u043e\u043d\u044c\u043a\u0430, \u043f\u0440\u0438\u0441\u043b\u0430\u0442\u044c ID  \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0440\u0435\u0444\u0430\u043d\u0434\u0430 (\u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e), \u043b\u0438\u0431\u043e \u0441\u0440\u0430\u0437\u0443 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0417\u0432\u0435\u0437\u0434\u0443 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u043c\u0438 \u0431\u043e\u0442\u0430\u043c\u0438. </p> <pre><code>@router.message(F.successful_payment)\nasync def on_successful_payment(\n    message: Message,\n    l10n: FluentLocalization,\n):\n    await message.answer(\n        l10n.format_value(\n            \"payment-successful\",\n            {\"id\": message.successful_payment.telegram_payment_charge_id}\n        ),\n        # \u042d\u0442\u043e \u044d\u0444\u0444\u0435\u043a\u0442 \"\u043e\u0433\u043e\u043d\u044c\" \u0438\u0437 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0445 \u0440\u0435\u0430\u043a\u0446\u0438\u0439\n        message_effect_id=\"5104841245755180586\",\n    )\n</code></pre> <p>\u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044e:</p> <pre><code>payment-successful =\n    &lt;b&gt;\u041e\u0433\u0440\u043e\u043c\u043d\u043e\u0435 \u0441\u043f\u0430\u0441\u0438\u0431\u043e!&lt;/b&gt;\n\n    \u0412\u0430\u0448 \u0430\u0439\u0434\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438:\n    &lt;code&gt;{$id}&lt;/code&gt;\n\n    \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u0435\u0433\u043e, \u0435\u0441\u043b\u0438 \u0432\u0434\u0440\u0443\u0433 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0440\u0435\u0444\u0430\u043d\u0434 \u0432 \u0431\u0443\u0434\u0443\u0449\u0435\u043c \ud83d\ude22\n</code></pre> <p></p>"},{"location":"payments/#refunds","title":"\u0412\u043e\u0437\u0432\u0440\u0430\u0442\u044b \u043f\u043e\u043a\u0443\u043f\u043e\u043a","text":"<p>\u0421\u0442\u0440\u043e\u0433\u043e \u0433\u043e\u0432\u043e\u0440\u044f, \u043f\u0435\u0440\u0435\u0434 \u043d\u0430\u0447\u0430\u043b\u043e\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u043e\u0442\u043e\u043c \u044e\u0437\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u043c\u0435\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441 \u0443\u0441\u043b\u043e\u0432\u0438\u044f\u043c\u0438 (Terms of Service).  \u0412 \u0447\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u0438, \u0442\u0430\u043c \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0447\u0451\u0442\u043a\u043e \u043f\u0440\u043e\u043f\u0438\u0441\u0430\u043d\u043e, \u0437\u0430 \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430, \u0430 \u0437\u0430 \u0447\u0442\u043e \u043d\u0435\u043b\u044c\u0437\u044f. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435  \u0441\u0440\u0430\u0437\u0443 \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c, \u0447\u0442\u043e \u0437\u0430 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0446\u0438\u0444\u0440\u043e\u0432\u043e\u0439 \u0442\u043e\u0432\u0430\u0440 \u0440\u0435\u0444\u0430\u043d\u0434\u043e\u0432 (\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043e\u0432) \u043d\u0435 \u043f\u0440\u0435\u0434\u0443\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e, \u0438\u043b\u0438 \u0447\u0442\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0442 \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f  \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0439 \u0443\u0441\u043b\u0443\u0433\u0438 \u0438\u043b\u0438 \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0438\u0445 \u0434\u043d\u0435\u0439. \u041e\u0431 \u044d\u0442\u043e\u043c \u0440\u0435\u0448\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u043c, \u0432 \u043d\u0430\u0448\u0435\u043c  \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u043c \u0431\u043e\u0442\u0435 \u043c\u044b \u0434\u0430\u0434\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u0437\u0430 \u043b\u044e\u0431\u0443\u044e \u043f\u043e\u043a\u0443\u043f\u043a\u0443. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u0443  <code>/\u2060refund</code>, \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u043c \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u043c \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0430\u0439\u0434\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438. \u041c\u0435\u0442\u043e\u0434  refundStarPayment \u043c\u043e\u0436\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438, \u0432 \u0447\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u0438, \u043e \u0442\u043e\u043c,  \u0447\u0442\u043e ID \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0438\u043b\u0438 \u0447\u0442\u043e \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u0437\u0430 \u043f\u043e\u043a\u0443\u043f\u043a\u0443 \u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u0431\u044b\u043b\u0438 \u0443\u0436\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u044b.  \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u044d\u0442\u0438 \u0441\u043b\u0443\u0447\u0430\u0438 \u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u0440\u0435\u0444\u0430\u043d\u0434\u044b:</p> <pre><code>@router.message(Command(\"refund\"))\nasync def cmd_refund(\n    message: Message,\n    bot: Bot,\n    command: CommandObject,\n    l10n: FluentLocalization,\n):\n    transaction_id = command.args\n    if transaction_id is None:\n        await message.answer(\n            l10n.format_value(\"refund-no-code-provided\")\n        )\n        return\n    try:\n        await bot.refund_star_payment(\n            user_id=message.from_user.id,\n            telegram_payment_charge_id=transaction_id\n        )\n        await message.answer(\n            l10n.format_value(\"refund-successful\")\n        )\n    except TelegramBadRequest as error:\n        if \"CHARGE_NOT_FOUND\" in error.message:\n            text = l10n.format_value(\"refund-code-not-found\")\n        elif \"CHARGE_ALREADY_REFUNDED\" in error.message:\n            text = l10n.format_value(\"refund-already-refunded\")\n        else:\n            # \u041f\u0440\u0438 \u0432\u0441\u0435\u0445 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \u2013 \u0442\u0430\u043a\u043e\u0439 \u0436\u0435 \u0442\u0435\u043a\u0441\u0442,\n            # \u043a\u0430\u043a \u0438 \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435\n            text = l10n.format_value(\"refund-code-not-found\")\n        await message.answer(text)\n        return\n</code></pre> <p>\u0420\u044f\u0434\u043e\u043c \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u044b <code>/\u2060paysupport</code>, \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u043d\u0430 <code>/\u2060refund</code>:</p> <pre><code>@router.message(Command(\"paysupport\"))\nasync def cmd_paysupport(\n    message: Message,\n    l10n: FluentLocalization\n):\n    await message.answer(l10n.format_value(\"cmd-paysupport\"))\n</code></pre> <p>\u0422\u0435\u043a\u0441\u0442\u043e\u0432 \u043f\u0440\u0438\u0434\u0451\u0442\u0441\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u044d\u0442\u043e\u0442 \u0440\u0430\u0437 \u043f\u043e\u0431\u043e\u043b\u044c\u0448\u0435: </p> <pre><code>refund-successful =\n    \u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0451\u043d \u0443\u0441\u043f\u0435\u0448\u043d\u043e. \u041f\u043e\u0442\u0440\u0430\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0432\u0451\u0437\u0434\u044b \u0443\u0436\u0435 \u0432\u0435\u0440\u043d\u0443\u043b\u0438\u0441\u044c \u043d\u0430 \u0432\u0430\u0448 \u0441\u0447\u0451\u0442 \u0432 Telegram.\n\nrefund-no-code-provided =\n    \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 &lt;code&gt;/refund \u041a\u041e\u0414&lt;/code&gt;, \u0433\u0434\u0435 \u041a\u041e\u0414 \u2013 \u0430\u0439\u0434\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438.\n    \u0415\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u043f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043b\u0430\u0442\u0435\u0436\u0430, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \"\u0417\u0432\u0451\u0437\u0434\u044b\" \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438 Telegram.\n\nrefund-code-not-found =\n    \u0422\u0430\u043a\u043e\u0439 \u043a\u043e\u0434 \u043f\u043e\u043a\u0443\u043f\u043a\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u043c\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.\n\nrefund-already-refunded =\n    \u0417\u0430 \u044d\u0442\u0443 \u043f\u043e\u043a\u0443\u043f\u043a\u0443 \u0443\u0436\u0435 \u0440\u0430\u043d\u0435\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0451\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432.\n\ncmd-paysupport =\n    \u0415\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u0437\u0430 \u043f\u043e\u043a\u0443\u043f\u043a\u0443, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439 /refund\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:</p> <p></p> <p>\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0431\u043e\u0442\u0430 \u0432 \u0434\u0435\u043b\u0435</p> <p>\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u043e\u043f\u043b\u0430\u0442\u0443 \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 Telegram Stars \u0432 \u0431\u043e\u0442\u0435 @GrooshaDonateBot.  \u0412\u0430\u043c \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u044e\u0442\u0441\u044f \u0417\u0432\u0451\u0437\u0434\u044b \u0434\u043b\u044f \u043b\u044e\u0431\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438, \u043d\u043e \u0435\u0441\u043b\u0438 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435\u0441\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439 <code>/\u2060demo</code>, \u0442\u043e  \u043f\u043b\u0430\u0442\u0451\u0436 \u0432 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u043c \u0440\u0430\u0437\u043c\u0435\u0440\u0435 1 \u0437\u0432\u0435\u0437\u0434\u044b \u0441\u0440\u0430\u0437\u0443 \u0436\u0435 \u0432\u0435\u0440\u043d\u0451\u0442\u0441\u044f \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u043d\u0430 \u0432\u0430\u0448 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u043f\u043e\u0441\u043b\u0435 \u043f\u043e\u043a\u0443\u043f\u043a\u0438.</p> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0432\u044b \u0433\u043e\u0442\u043e\u0432\u044b \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u043e\u043f\u043b\u0430\u0442\u0443 \u0437\u0430 \u0446\u0438\u0444\u0440\u043e\u0432\u044b\u0435 \u0442\u043e\u0432\u0430\u0440\u044b \u0438 \u0443\u0441\u043b\u0443\u0433\u0438 \u0432 \u0441\u0432\u043e\u0438\u0445 \u0431\u043e\u0442\u0430\u0445 \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 Telegram Stars, \u0443\u0440\u0430!</p>"},{"location":"quickstart/","title":"Aiogram bilan tanishish","text":""},{"location":"quickstart/#aiogram-bilan-tanishish","title":"Aiogram bilan tanishish","text":"<p>Foydalanilayotgan aiogram versiyasi: 3.7.0</p> <p>Ba'zi tafsilotlar ataylab soddalashtirilgan!</p> <p>Ushbu kitob muallifi, nazariyadan tashqari amaliyot ham bo'lishi kerak deb hisoblaydi. Keyingi keltirilgan kodni maksimal darajada sodda qilib qayta yaratish uchun,  faqat mahalliy rivojlantirish va o'qitishga mos keladigan yondashuvlardan foydalanishga to'g'ri keldi.</p> <p>Shunday qilib, masalan, barcha yoki deyarli barcha bo'limlarda bot tokeni dastur kodida ko'rsatiladi.  Bu yomon yondashuv, chunki agar kodni ommaviy repozitoriyga (masalan, GitHub) yuklashdan oldin uni o'chirishni unutib qo'ysangiz,  tokenning oshkor bo'lishiga olib kelishi mumkin.</p> <p>Yoki ba'zida ma'lumotlar ombori sifatida faqat operativ xotirada joylashgan tuzilmalar (lug'atlar, ro'yxatlar ...) ishlatiladi.  Aslida bunday qilish to'g'ri hisoblanmaydi, chunki bot to'xtatilganda ma'lumotlar tiklanmaydi va yo'qolishiga olib keladi.</p> <p>Shuningdek, Telegramdan yangilanishlarni olish mexanizmi sifatida polling tanlangan,  chunki u deyarli barcha muhitlarda ishonchli ishlaydi va deyarli barcha ishlab chiquvchilarga mos keladi.</p> <p>Muhim esda tuting, muallifning maqsadi aiogram yordamida aynan Telegram Bot API bilan ishlashni tushuntirish,  va umuman olganda butun kompyuter fanlarini tushuntirish emas.</p>"},{"location":"quickstart/#glossary","title":"Terminologiya","text":"<p>Bir xil terminlardan foydalanish uchun ularni kelishib olamiz va bu keyinchalik chalkashishning oldini oladi:</p> <ul> <li>Shaxsiy \u2014 shaxsiy xabarlar, bot holatida bu foydalanuvchi bilan botning birga-yakka muloqoti, guruh/kanal emas.</li> <li>Chat \u2014 shaxsiy, guruhlar, superguruhlar va kanallarning umumiy nomi.</li> <li>Update \u2014 ushbu ro'yxatdagi har qanday hodisa: xabar, xabarni tahrirlash, callback, inline-so'rov, to'lov, botni guruhga qo'shish va h.k.</li> <li>Handler \u2014 dispatcherdan/routerdan navbatdagi update-ni qabul qilib, uni qayta ishlaydigan asinxron funksiya.</li> <li>Dispatcher \u2014 Telegramdan yangilanishlarni qabul qilish va keyingi qayta ishlash uchun mos handlerga uzatish bilan shug'ullanadigan ob'ekt.</li> <li>Router \u2014 dispatcherga o'xshash, lekin handlerlar to'plamining kichik to'plamiga javob beradi. Dispatcherni asos router deb atash mumkin.</li> <li>Filter \u2014 odatda True yoki False qaytaradigan va handler chaqirilishi yoki chaqirilmasligiga ta'sir qiladigan ifoda.</li> <li>Middleware \u2014 updatelardan kelgan ma'lumotlarni qabul qilish va handlerga yetmasdan qayta ishlash uchun qo'shiladigan 'qatlam'.</li> </ul>"},{"location":"quickstart/#installation","title":"O'rnatish","text":"<p>Avvalo bot uchun papka ochamiz, u yerda virtual environment (venv)'ni yaratamiz va  aiogram kutubxonasini o\u2018rnatamiz. Python 3.9 versiyasi o\u2018rnatilganligini tekshiramiz (agar sizda 3.9 va undan yuqori versiya o\u2018rnatilgan bo'lsa, ushbu bo\u2018limni o\u2018tkazib yuborishingiz mumkin):</p> <pre><code>[groosha@main lesson_01]$ python3.9\nPython 3.9.9 (main, Jan 11 2022, 16:35:07) \n[GCC 11.1.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; exit()\n[groosha@main lesson_01]$ \n</code></pre> <p>Endi <code>requirements.txt</code> faylini yaratamiz, unda biz foydalanadigan aiogram versiyasini ko'rsatamiz.  Shuningdek, konfiguratsiya fayllari uchun pydantic-settings kutubxonasi ham kerak bo'ladi.</p> <p>Aiogram versiyalari haqida</p> <p>Ushbu bo'limda aiogram 3.x ishlatiladi, ishni boshlashdan oldin kutubxonaning  yangiliklar kanaliga kirib, yangi versiyaning mavjudligini tekshirishni tavsiya qilaman.  3 raqami bilan boshlanadigan har qanday yangi versiya bilan ishlashinggiz mumkin, chunki aiogram 2.x versiyasi yangilanmaydi va eskirgan deb hisoblanadi.</p> <pre><code>[groosha@main 01_quickstart]$ python3.11 -m venv venv\n[groosha@main 01_quickstart]$ echo \"aiogram&lt;4.0\" &gt; requirements.txt\n[groosha@main 01_quickstart]$ echo \"pydantic-settings\" &gt;&gt; requirements.txt\n[groosha@main 01_quickstart]$ source venv/bin/activate\n(venv) [groosha@main 01_quickstart]$ pip install -r requirements.txt \n# ...bu yerda o'rnatish haqida ko'plab yozuvlar chiqadi...\nSuccessfully installed ...shunga o'xshash...\n[groosha@main 01_quickstart]$\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \"venv\" \u0432 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0435. \u041e\u043d \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u0447\u0442\u043e \u043c\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u043c\u0441\u044f \u0432 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0438 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c \"venv\". \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u0432\u043d\u0443\u0442\u0440\u0438 venv \u0432\u044b\u0437\u043e\u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u044b <code>python</code> \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0432\u0441\u0451 \u0442\u043e\u0442 \u0436\u0435 Python 3.11: </p> <p>Terminaldagi \"venv\" boshmatniga e'tibor bering. Bu bizning \"venv\" deb nomlangan virtual muhit ichida ekanligimizni bildiradi. Keling, venv ichida \"python\" buyrug'iga yozib uning ishga tushishini tekshirib ko'ramiz: </p><pre><code>(venv) [groosha@main 01_quickstart]$ python\nPython 3.11.9 (main, Jan 11 2024, 16:35:07) \n[GCC 11.1.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; exit()\n(venv) [groosha@main 01_quickstart]$ deactivate \n[groosha@main 01_quickstart]$ \n</code></pre> <p>Muhit bizga xalaqit bermasligi uchun <code>deactivate</code> buyrug'ini bilan venv'dan chiqishimiz mumkin.</p> <p>Agar siz botlarni yozish uchun PyCharm'dan foydalanayotgan bo'lsangiz,  Telegram ob'ektlarida kodni avtomatik to\u2018ldirishni qo\u2018llash uchun  Pydantic'ning uchinchi tomon plaginini o'rnatishni ham tavsiya qilaman.</p>"},{"location":"quickstart/#hello-world","title":"Birinchi bot","text":"<p>Keling, aiogram asosiy shabloniga ega bot.py faylini yarataylik: </p>bot.py<pre><code>import asyncio\nimport logging\nfrom aiogram import Bot, Dispatcher, types\nfrom aiogram.filters.command import Command\n\n# Muhim xabarlarni o'tkazib yubormaslik uchun loglashni yoqamiz\nlogging.basicConfig(level=logging.INFO)\n# Bot obyektini yaratamiz\nbot = Bot(token=\"12345678:AaBbCcDdEeFfGgHh\")\n# Dispatcher obyektini yaratamiz\ndp = Dispatcher()\n\n# /start buyrug'iga uchun handler\n@dp.message(Command(\"start\"))\nasync def cmd_start(message: types.Message):\n    await message.answer(\"Hello!\")\n\n# Yangi update'larni olish uchun polling jarayonini boshlaymiz\nasync def main():\n    await dp.start_polling(bot)\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>Birinchi navbatda e'tibor qaratishingiz kerak bo'lgan narsa: aiogram asinxron kutubxona hisoblanadi,  shuning uchun handlerlaringiz ham asinxron bo'lishi kerak. API metodlarini chaqirishdan oldin await kalit so'zini qo'yish kerak, chunki bu chaqiriqlar korutinlarni qaytaradi.</p> <p>Python\u2019da asinxron dasturlash</p> <p>Rasmiy hujjatlarni e'tiborsiz qoldirmang! Python saytida ajoyib asyncio qo'llanmasi mavjud.</p> <p>Agar siz ilgari Telegram uchun boshqa biror boshqa kutubxona, masalan pyTelegramBotAPI bilan ishlagan bo'lsangiz,  handler'larni tushuningizda qiyinlik tug'ilmaydi. Farqi shundaki, aiogramda handlerlarni dispatcher boshqaradi. Dispatcher funksiya-handlerlarni ro'yxatdan o'tkazadi va ularni chaqiruvchi hodisalar ro'yxatini filtrlardan foydalanib qo'shimcha cheklaydi.  Telegramdan navbatdagi yangilanish (update) qabul qilingandan so'ng, dispatcher barcha filtrlar bo'yicha mos keladigan kerakli qayta ishlash funksiyasini tanlaydi.  Agar ikki funksiya mantiqiy jihatdan bir xil filtrlarga ega bo'lsa, avvalroq ro'yxatdan o'tkazilgan funksiya chaqiriladi.</p> <p>Funksiyani xabarlarni qayta ishlovchi sifatida ro'yxatdan o'tkazish uchun quyidagi ikki amaldan birini bajarish kerak: 1. Uni yuqoridagi misoldagi kabi dekorator bilan yozish.  Turli xil dekoratorlar bilan keyinchalik tanishamiz. 2. Dispatcher yoki routerda ro'yxatdan o'tkazish(register) metodini to'g'ridan-to'g'ri chaqirish.</p> <p>Quyidagi kodni ko'rib chiqamiz: </p><pre><code># /test1 buyrug'iga uchun handler\n@dp.message(Command(\"test1\"))\nasync def cmd_test1(message: types.Message):\n    await message.reply(\"Test 1\")\n\n# /test2 buyrug'iga uchun handler\nasync def cmd_test2(message: types.Message):\n    await message.reply(\"Test 2\")\n</code></pre> <p>Keling, botning ushbu kodini ishga tushiramiz: </p> <p><code>cmd_test2</code> handleri ishlamaydi, chunki dispatcher undan xabardor emas.  Bu xatoni to'g'rilaymiz va funksiyani alohida ro'yxatdan o'tkazamiz: </p><pre><code># \u0425\u044d\u043d\u0434\u043b\u0435\u0440 \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 /test2\nasync def cmd_test2(message: types.Message):\n    await message.reply(\"Test 2\")\n\n# \u0413\u0434\u0435-\u0442\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043c\u0435\u0441\u0442\u0435, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 main():\ndp.message.register(cmd_test2, Command(\"test2\"))\n</code></pre> <p>Botni yangidan ishga tushiramiz: </p>"},{"location":"quickstart/#sugar","title":"Sintaktik shakar (syntactic sugar)","text":"<p>Kodni toza va o'qilishi osonroq qilish uchun aiogram Telegramning standart obyektlarining imkoniyatlarini kengaytiradi.  Masalan, <code>bot.send_message(...)</code> o'rniga <code>message.answer(...)</code> yoki <code>message.reply(...)</code> deb yozish mumkin.  Oxirgi ikki holatda <code>chat_id</code>ni ko'rsatish shart emas, chunki u dastlabki xabardagi kabi bo'ladi. <code>answer</code> va <code>reply</code> orasidagi farq oddiy: birinchi metod shunchaki xabarni shu chatga yuboradi,  ikkinchisi esa <code>message</code>dan xabariga \"javob\" qiladi (bu holatda bot jo'natgan habar sizning habaringgizga bog'langan bo'ladi): </p><pre><code>@dp.message(Command(\"answer\"))\nasync def cmd_answer(message: types.Message):\n    await message.answer(\"Bu oddiy xabar\")\n\n\n@dp.message(Command(\"reply\"))\nasync def cmd_reply(message: types.Message):\n    await message.reply('Bu \"javob\" xabari')\n</code></pre> <p>Bundan tashqari, xabarlarning ko'p turlari uchun  \"answer_{type}\" yoki \"reply_{type}\" shaklidagi yordamchi metodlar mavjud, masalan: </p><pre><code>@dp.message(Command(\"dice\"))\nasync def cmd_dice(message: types.Message):\n    await message.answer_dice(emoji=\"\ud83c\udfb2\")\n</code></pre> <p><code>message: types.Message</code> qanday ma'noni bildiradi?</p> <p>Python kuchli dinamik tiplashgan interpretatsiyalanuvchi til bo'lib,  C++ yoki Java kabi ichki tip tekshiruvi mavjud emas. Biroq, 3.5-versiyasidan boshlab,  tilga tip ko'rsatmalarini qo'llab-quvvatlash qo'shildi, bu esa turli tekshiruvlar va PyCharm kabi IDE\u2019lar ishlatilayotgan  qiymatlarning turlarini tahlil qilib, dasturchiga noto'g'ri narsa uzatilsa xabar berish imkonini beradi.  Bu holatda <code>types.Message</code> matni PyCharm'ga <code>message</code> o'zgaruvchisi aiogram kutubxonasining <code>types</code> modulida tavsiflangan  <code>Message</code> turiga ega ekanligini bildiradi (kodingiz boshidagi importlarga qarang).  Bu orqali IDE atributlar va funksiyalarni ko'rsatib turishi mumkin.</p> <p><code>/dice</code> buyrug'i yuborilganda, bot shu chatga o'yin kubigini yuboradi. Albatta, agar uni boshqa chatga yuborish kerak bo'lsa,  odatdagidek await <code>bot.send_dice(...)</code>ni chaqirishga to'g'ri keladi. Lekin <code>bot</code> obyekti (<code>Bot</code> sinfining nusxasi) ma'lum bir  funksiyaning ko'rinishida mavjud bo'lmasligi mumkin. aiogram 3.x da yangilanish kelganda kutubxona bot obyekti aniq bo'lmagan holda  handlerga uzatiladi va uni bot argumenti sifatida olish mumkin. Faraz qilaylik, siz <code>/dice</code> buyrug'i bilan kubikni shu  chatga emas, balki ID -100123456789 bo'lgan kanalga yubormoqchisiz. Oldingi funksiyani quyidagicha qayta yozamiz:</p> <pre><code># import qilishni unutmang\nfrom aiogram.enums.dice_emoji import DiceEmoji\n\n@dp.message(Command(\"dice\"))\nasync def cmd_dice(message: types.Message, bot: Bot):\n    await bot.send_dice(-100123456789, emoji=DiceEmoji.DICE)\n</code></pre>"},{"location":"quickstart/#pass-extras","title":"Qo'shimcha parametrlarni uzatish","text":"<p>Ba'zida botni ishga tushirganda bir yoki bir nechta qo'shimcha qiymatlarni uzatish kerak bo'lishi mumkin.  Bu qandaydir o'zgaruvchi, konfiguratsiya obyekti, biror narsalar ro'yxati va boshqa narsalar bo'lishi mumkin.  Buning uchun bu ma'lumotlarni (kwargs) argumentlar sifatida dispatcherga uzatish yoki lug'at bilan ishlayotgandek  qiymatlarni belgilash kifoya.</p> <p>Bunday imkoniyat yagona nusxada bo'lishi va bot ishlayotgan paytda o'zgarmasligi kerak bo'lgan obyektlarni uzatish uchun  eng mos keladi (ya'ni, faqat o'qish uchun). Agar qiymat vaqt o'tishi bilan o'zgarishi kerak bo'lsa,  bu faqat o'zgaruvchan obyektlar bilan ishlaydi.  Handlerlarda qiymatlarni olish uchun ularni oddiygina argumentlar sifatida ko'rsating. Misol orqali ko'rib chiqamiz:</p> <pre><code># Boshqa joyda\n# Masalan, ilovaning kirish nuqtasida\nfrom datetime import datetime\n\n# bot = ...\ndp = Dispatcher()\ndp[\"started_at\"] = datetime.now().strftime(\"%Y-%m-%d %H:%M\")\nawait dp.start_polling(bot, mylist=[1, 2, 3])\n\n\n@dp.message(Command(\"add_to_list\"))\nasync def cmd_add_to_list(message: types.Message, mylist: list[int]):\n    mylist.append(7)\n    await message.answer(\"7 raqa qo'shildi\")\n\n\n@dp.message(Command(\"show_list\"))\nasync def cmd_show_list(message: types.Message, mylist: list[int]):\n    await message.answer(f\"Sizning ro'yxatinggiz: {mylist}\")\n\n\n@dp.message(Command(\"info\"))\nasync def cmd_info(message: types.Message, started_at: str):\n    await message.answer(f\"Bot ishga tushirildi {started_at}\")\n</code></pre> <p>Endi started_at o'zgaruvchisi va mylist ro'yxatini turli handlerlarda o'qish va yozish mumkin. Agar har bir yangilanish  uchun noyob qiymatlarni (masalan, DBMS sessiya obyektini) uzatishingiz kerak bo'lsa,  middlewarelar bilan tanishing.</p> <p></p>"},{"location":"quickstart/#konfiguratsiya-fayllari","title":"Konfiguratsiya fayllari","text":"<p>Tokenni to'g'ridan-to'g'ri kodda saqlamaslik uchun (agar siz botingizni ommaviy repozitoriyga yuklamoqchi bo'lsangiz?)  bunday ma'lumotlarni alohida konfiguratsiya fayliga chiqarishingiz mumkin. Bu haqida rus tilidagi maqola majud,  Kod yozayotganinggizda environment o'zgaruvchilarini o'zgartirishnggiz kifoya, ammo ushbu kitob doirasida biz <code>.env</code> fayllaridan foydalanamiz, bu kodlarimizni biroz soddalashtiradi va bu kitob foydalanuvchilariga loyihani ko'rsatishda yordam beradi.</p> <p>Shunday qilib, <code>bot.py</code> yonida quyidagi ko'rinishdagi <code>config_reader.py</code> nomli alohida fayl yaratamiz:</p> config_reader.py<pre><code>from pydantic_settings import BaseSettings, SettingsConfigDict\nfrom pydantic import SecretStr\n\n\nclass Settings(BaseSettings):\n    # Maxfiy ma'lumotlar uchun, masalan, bot tokeni uchun \n    # str o'rniga SecretStr ishlatish tavsiya etiladi\n    bot_token: SecretStr\n\n    # Pydanticning ikkinchi versiyasidan boshlab, sozlamalar klassining sozlamalari \n    # model_config orqali belgilanadi\n    # Bu holda UTF-8 kodlash bilan o'qiladigan .env fayli ishlatiladi\n\n    model_config = SettingsConfigDict(env_file='.env', env_file_encoding='utf-8')\n\n\n# Fayl import qilinganda darhol \n# konfiguratsiya obyekti yaratiladi va tasdiqlanadi,\n# keyinchalik uni turli joylardan import qilish mumkin\nconfig = Settings()\n</code></pre> <p>Endi <code>bot.py</code> faylimizni biroz tahrir qilamiz:</p> bot.py<pre><code># import\nfrom config_reader import config\n\n# Secret* turi bo'lgan yozuvlar uchun \n# haqiqiy mazmunni olish uchun get_secret_value() metodini chaqirish kerak, \n# aks holda '*******' ko'rsatiladi\nbot = Bot(token=config.bot_token.get_secret_value())\n</code></pre> <p>Oxirida, <code>.env</code> (boshida nuqta bilan) faylini yaratamiz va unda bot tokenini yozamiz: </p>.env<pre><code>BOT_TOKEN = 0000000000:AaBbCcDdEeFfGgHhIiJjKkLlMmNn\n</code></pre> <p>Agar hammasi to'g'ri qilingan bo'lsa, python-dotenv <code>.env</code> faylidagi o'zgaruvchilarni yuklaydi, pydantic  ularni tasdiqlaydi va bot obyekti kerakli token bilan muvaffaqiyatli yaratiladi.</p> <p>Shu bilan biz kutubxona bilan tanishishni yakunlaymiz, keyingi bo'limlarda aiogram va Telegram Bot API ning boshqa \"foydali funksiyalar\"ini ko'rib chiqamiz.</p>"},{"location":"routers/","title":"Routerlar, ko\u2018p fayllilik va bot tuzilmasi","text":""},{"location":"routers/#routerlar-kop-fayllilik-va-bot-tuzilmasi","title":"Routerlar, ko\u2018p fayllilik va bot tuzilmasi","text":"<p>Foydalanilayotgan aiogram versiyasi: 3.7.0</p> <p>Ushbu bobda biz aiogram 3.x ning yangi imkoniyati \u2014 routerlar bilan tanishamiz, kodimizni alohida komponentlarga ajratishni o\u2018rganamiz va keyingi boblar hamda amaliyot uchun qulay bo\u2018ladigan botning asosiy tuzilmasini shakllantiramiz.</p>"},{"location":"routers/#entrypoint","title":"Dasturga kirish nuqtasi","text":"<p>Teatr garderobdan boshlangani kabi, bot ham kirish nuqtasidan boshlanadi. Bu faylni <code>bot.py</code> deb ataymiz. Unda kerakli obyektlarni yaratib, pollingni ishga tushiradigan asinxron <code>main()</code> funksiyasini yozamiz. Qanday obyektlar kerak? Avvalo, albatta, botning o\u2018zi. Bir nechta bot bo\u2018lishi ham mumkin, lekin bu haqida keyinroq. Ikkinchidan, dispatcher kerak bo\u2018ladi. Dispatcher Telegramdan keladigan hodisalarni qabul qilib, ularni handlerlar orqali filtrlab va middleware'lar yordamida tarqatadi.</p> bot.py<pre><code>import asyncio\nfrom aiogram import Bot, Dispatcher\n\n\n# Botni ishga tushirish\nasync def main():\n    bot = Bot(token=\"TOKEN\")\n    dp = Dispatcher()\n\n    # Botni ishga tushiramiz va barcha to'plangan xabarlarni o'tkazib yuboramiz\n    # Ha, bu metod pollingda ham ishlaydi\n    await bot.delete_webhook(drop_pending_updates=True)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>Lekin xabarlarni qayta ishlash uchun faqat shu yetarli emas, yana handlerlar kerak bo'ladi. Ularni boshqa fayllarga joylashtirishni xohlaymiz, chunki minglab qatorli koddan qochish kerak. Oldingi boblarda barcha handlerlar dispatcherga biriktirilgan edi, lekin hozir dispatcher funksiyaning ichida va uni global qilishni istamaymiz. Nima qilish kerak? Bu yerda yordamga...</p>"},{"location":"routers/#routers","title":"Routerlar","text":"<p>aiogram 3.x rasmiy hujjatlari ga murojaat qilamiz va quyidagi rasmga qaraymiz:</p> <p></p> <p>Nimani ko'ryapmiz?</p> <ol> <li>Dispatcher \u2014 ildiz router.</li> <li>Handlerlar routerlarga biriktiriladi.</li> <li>Routerlar ichma-ich bo'lishi mumkin, lekin ular orasida faqat bir yo'nalishli bog'lanish bo'ladi.</li> <li>Routerlarni ulash (va tekshirish) tartibi aniq belgilanadi.</li> </ol> <p>Quyidagi rasmda esa update'ning kerakli handlerni topish tartibi ko'rsatilgan:</p> <p></p> <p>Keling, ikki funksiyali oddiy bot yozamiz:</p> <ol> <li>Botga <code>/start</code> yuborilsa, u savol va ikkita tugma (\"Ha\" va \"Yo'q\") yuboradi.</li> <li>Boshqa har qanday matn, stiker yoki gif yuborilsa, bot xabar turini javob qiladi.</li> </ol> <p>Avval klaviaturani tayyorlaymiz: <code>bot.py</code> yonida <code>keyboards</code> papkasini va unda <code>for_questions.py</code> faylini yaratamiz. Unda \"Ha\" va \"Yo'q\" tugmalari bir qatorda bo'ladigan oddiy klaviatura funksiyasini yozamiz:</p> keyboards/for_questions.py<pre><code>from aiogram.types import ReplyKeyboardMarkup\nfrom aiogram.utils.keyboard import ReplyKeyboardBuilder\n\ndef get_yes_no_kb() -&gt; ReplyKeyboardMarkup:\n    kb = ReplyKeyboardBuilder()\n    kb.button(text=\"Ha\")\n    kb.button(text=\"Yo'q\")\n    kb.adjust(2)\n    return kb.as_markup(resize_keyboard=True)\n</code></pre> <p>Hech qanday murakkablik yo'q, klaviaturalarni oldingi bobda batafsil ko'rganmiz. Endi <code>bot.py</code> yonida <code>handlers</code> papkasini va unda <code>questions.py</code> faylini yaratamiz.</p> handlers/questions.py<pre><code>from aiogram import Router, F\nfrom aiogram.filters import Command\nfrom aiogram.types import Message, ReplyKeyboardRemove\n\nfrom keyboards.for_questions import get_yes_no_kb\n\nrouter = Router()  # [1]\n\n@router.message(Command(\"start\"))  # [2]\nasync def cmd_start(message: Message):\n    await message.answer(\n        \"Ishingizdan mamnunmisiz?\",\n        reply_markup=get_yes_no_kb()\n    )\n\n@router.message(F.text.lower() == \"ha\")\nasync def answer_yes(message: Message):\n    await message.answer(\n        \"Zo'r!\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n\n@router.message(F.text.lower() == \"yo'q\")\nasync def answer_no(message: Message):\n    await message.answer(\n        \"Afsus...\",\n        reply_markup=ReplyKeyboardRemove()\n    )\n</code></pre> <p>[1] va [2] bandlariga e'tibor bering. Birinchidan, har bir modulda o'z routerini yaratdik va uni keyin ildiz routerga (dispatcherga) ulaymiz. Ikkinchidan, handlerlar endi lokal routerga biriktiriladi.</p> <p>Xuddi shu tarzda <code>different_types.py</code> faylini ham yaratamiz, unda xabar turini chiqaruvchi handlerlar bo'ladi:</p> handlers/different_types.py<pre><code>from aiogram import Router, F\nfrom aiogram.types import Message\n\nrouter = Router()\n\n@router.message(F.text)\nasync def message_with_text(message: Message):\n    await message.answer(\"Bu matnli xabar!\")\n\n@router.message(F.sticker)\nasync def message_with_sticker(message: Message):\n    await message.answer(\"Bu stiker!\")\n\n@router.message(F.animation)\nasync def message_with_gif(message: Message):\n    await message.answer(\"Bu GIF!\")\n</code></pre> <p>Endi <code>bot.py</code> ga qaytamiz, router va handler fayllarini import qilib, dispatcherga ulaymiz:</p> bot.py<pre><code>import asyncio\nfrom aiogram import Bot, Dispatcher\nfrom handlers import questions, different_types\n\n\n# Botni ishga tushirish\nasync def main():\n    bot = Bot(token=\"TOKEN\")\n    dp = Dispatcher()\n\n    dp.include_routers(questions.router, different_types.router)\n\n    # Routerlarni har birini alohida ham ulash mumkin\n    # dp.include_router(questions.router)\n    # dp.include_router(different_types.router)\n\n    # Botni ishga tushiramiz va barcha to'plangan xabarlarni o'tkazib yuboramiz\n    # Ha, bu metod pollingda ham ishlaydi\n    await bot.delete_webhook(drop_pending_updates=True)\n    await dp.start_polling(bot)\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>Biz shunchaki <code>handlers/</code> papkasidagi fayllarni import qilib, ulardagi routerlarni dispatcherga ulaymiz. Bu yerda importlar tartibi muhim! Agar routerlarni ulash tartibini o'zgartirsak, <code>/start</code> komandasi uchun bot birinchi mos kelgan handlerni (masalan, <code>message_with_text()</code>) ishlatadi va \"Bu matnli xabar!\" deb javob beradi. Filtrlar haqida keyinroq batafsil gaplashamiz, hozir esa yana bir savolga to'xtalamiz.</p>"},{"location":"routers/#conclusion","title":"Xulosa","text":"<p>Botimizni turli fayllarga toza va tartibli ajratdik, ishlashiga xalaqit bermadik. Fayl va papkalar taxminan quyidagicha ko'rinishda bo'ladi (bu yerda ba'zi ahamiyatsiz fayllar ko'rsatilmagan):</p> <pre><code>\u251c\u2500\u2500 bot.py\n\u251c\u2500\u2500 handlers\n\u2502   \u251c\u2500\u2500 different_types.py\n\u2502   \u2514\u2500\u2500 questions.py\n\u251c\u2500\u2500 keyboards\n\u2502   \u2514\u2500\u2500 for_questions.py\n</code></pre> <p>Kelgusida ham shu tuzilmani saqlaymiz, unga filtrlar, middleware'lar, ma'lumotlar bazasi bilan ishlash uchun fayllar va boshqalar qo'shiladi.</p>"},{"location":"special-updates/","title":"\u0410\u043f\u0434\u0435\u0439\u0442\u044b my_chat_member \u0438 chat_member","text":""},{"location":"special-updates/#special-updates","title":"\u041e\u0441\u043e\u0431\u044b\u0435 \u0430\u043f\u0434\u0435\u0439\u0442\u044b","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f aiogram: 3.7.0</p>"},{"location":"special-updates/#intro","title":"\u0412\u0432\u0435\u0434\u0435\u043d\u0438\u0435","text":"<p>\u041f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435 \u0432\u0438\u0434\u044b \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0432 Telegram \u0438\u043c\u0435\u044e\u0442 \u043a\u0430\u043a\u043e\u0435-\u0442\u043e \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u044e\u0437\u0435\u0440\u0430. \u0421\u043b\u0443\u0436\u0435\u0431\u043d\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u043e\u0431\u044b\u0447\u043d\u044b\u0435,  \u043a\u043e\u043b\u0431\u044d\u043a\u0438, \u0438\u043d\u043b\u0430\u0439\u043d-\u0440\u0435\u0436\u0438\u043c... \u043d\u043e \u0435\u0441\u0442\u044c \u0434\u0432\u0430 \u0432\u0438\u0434\u0430 \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432, \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044b\u0435 \u0438\u043c\u0435\u043d\u043d\u043e \u0434\u043b\u044f \u0441\u0430\u043c\u0438\u0445 \u0431\u043e\u0442\u043e\u0432. \u0420\u0435\u0447\u044c \u043f\u043e\u0439\u0434\u0451\u0442 \u043e  <code>my_chat_member</code> \u0438 <code>chat_member</code></p> <p>\u041a\u043e\u0433\u0434\u0430-\u0442\u043e \u0434\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0431\u043e\u0442\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043b\u0438 \u0432 \u00ab\u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u043c \u0432\u0430\u043a\u0443\u0443\u043c\u0435\u00bb: \u0431\u0430\u043d\u0430\u043b\u044c\u043d\u043e \u043d\u0430 \u043b\u044e\u0431\u044b\u0435  \u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u0441\u043a\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f, \u0431\u0443\u0434\u044c \u0442\u043e \u0431\u0430\u043d\u044b \u0438\u043b\u0438 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0431\u044b\u043b\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u044e\u0437\u0435\u0440\u0430 \u0447\u0435\u0440\u0435\u0437 \u043c\u0435\u0442\u043e\u0434\u044b  getChatMember \u0438\u043b\u0438  getChatAdministrators, \u0434\u0430 \u0435\u0449\u0451 \u0438 \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u0430 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u043e\u0439  \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u043a \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u0434\u0430\u0431\u044b \u043d\u0435 \u0443\u043f\u0435\u0440\u0435\u0442\u044c\u0441\u044f \u0432 \u043b\u0438\u043c\u0438\u0442\u044b Bot API, \u0442\u043e\u0447\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0445 [\u043b\u0438\u043c\u0438\u0442\u043e\u0432] \u043f\u043e-\u043f\u0440\u0435\u0436\u043d\u0435\u043c\u0443 \u043e\u0441\u0442\u0430\u044e\u0442\u0441\u044f  \u0442\u0430\u0439\u043d\u043e\u0439 \u0437\u0430 \u0441\u0435\u043c\u044c\u044e \u043f\u0435\u0447\u0430\u0442\u044f\u043c\u0438. </p> <p>\u0418\u043b\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u0430\u043a\u043e\u0439-\u043d\u0438\u0431\u0443\u0434\u044c \u0445\u0438\u0442\u0440\u044b\u0439 \u044e\u0437\u0435\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u043b \u0431\u043e\u0442\u0430 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443, \u0443\u0431\u0438\u0440\u0430\u043b \u0443 \u0442\u043e\u0433\u043e \u043f\u0440\u0430\u0432\u043e \u043f\u0438\u0441\u0430\u0442\u044c \u0438 \u043d\u0430\u0447\u0438\u043d\u0430\u043b \u0434\u0451\u0440\u0433\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u044b,  \u043e\u0436\u0438\u0434\u0430\u044f, \u0447\u0442\u043e \u0431\u043e\u0442 \u043d\u0435 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0442\u0430\u043a\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443 \u0438 \u0441\u043b\u043e\u043c\u0430\u0435\u0442\u0441\u044f. \u0410 \u0443\u0436 \u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u043e\u0439 \u0432 \u043b\u0438\u0447\u043a\u0443 \u0432\u043e\u043e\u0431\u0449\u0435 \u0432\u0435\u0441\u0435\u043b\u043e: \u043d\u0435 \u0437\u043d\u0430\u044f \u0442\u043e\u0447\u043d\u043e, \u043a\u0430\u043a\u0430\u044f  \u0430\u043a\u0442\u0438\u0432\u043d\u0430\u044f \u0430\u0443\u0434\u0438\u0442\u043e\u0440\u0438\u044f \u0431\u043e\u0442\u0430, \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u043b\u043e\u0441\u044c \u043b\u0438\u0431\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u0430\u043a\u043e\u0435-\u043d\u0438\u0431\u0443\u0434\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432  \u0441\u0432\u043e\u0435\u0439 \u0431\u0430\u0437\u0435, \u043b\u0438\u0431\u043e, \u0447\u0442\u043e \u0447\u0443\u0442\u044c \u0433\u0443\u043c\u0430\u043d\u043d\u0435\u0435, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u044d\u0442\u0438\u043c \u044e\u0437\u0435\u0440\u0430\u043c \u043a\u0430\u043a\u043e\u0439-\u043d\u0438\u0431\u0443\u0434\u044c ChatAction, \u0442\u0438\u043f\u0430 \u00ab\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442\u2026\u00bb; \u043a\u0430\u043a \u0432\u044b\u044f\u0441\u043d\u0438\u043b\u043e\u0441\u044c,  \u0442\u0435\u043c, \u043a\u0442\u043e \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0431\u043e\u0442\u0430, \u044d\u0442\u043e \u0441\u0430\u043c\u043e\u0435 \u00ab\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442\u2026\u00bb \u043d\u0435 \u043f\u0440\u0438\u0434\u0451\u0442, \u0432\u0435\u0440\u043d\u0443\u0432 \u043e\u0448\u0438\u0431\u043a\u0443 \u043e\u0442 Bot API.</p> <p>\u0412 \u043c\u0430\u0440\u0442\u0435 2021 \u0433\u043e\u0434\u0430 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f \u043a\u0430\u0440\u0434\u0438\u043d\u0430\u043b\u044c\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u0430\u0441\u044c \u0432 \u043b\u0443\u0447\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \u0441 \u0440\u0435\u043b\u0438\u0437\u043e\u043c  \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f Bot API v5.1, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c  \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u043e\u0441\u044c \u0434\u0432\u0430 \u043d\u043e\u0432\u044b\u0445 \u0442\u0438\u043f\u0430 \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432: <code>my_chat_member</code> \u0438 <code>chat_member</code>. \u041e\u0431\u0430 \u0430\u043f\u0434\u0435\u0439\u0442\u0430 \u0432\u043d\u0443\u0442\u0440\u0438  \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 \u043e\u0434\u043d\u043e\u0433\u043e \u0438 \u0442\u043e\u0433\u043e \u0436\u0435 \u0442\u0438\u043f\u0430 ChatMemberUpdated.  \u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u044d\u0442\u0438\u043c\u0438 \u0434\u0432\u0443\u043c\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u044f\u043c\u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f:</p> <ul> <li><code>my_chat_member</code>. \u0417\u0434\u0435\u0441\u044c \u0432\u0441\u0451, \u0447\u0442\u043e \u043a\u0430\u0441\u0430\u0435\u0442\u0441\u044f \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0431\u043e\u0442\u0430, \u043b\u0438\u0431\u043e \u041b\u0421 \u044e\u0437\u0435\u0440\u0430 \u0441 \u0431\u043e\u0442\u043e\u043c: (\u0440\u0430\u0437)\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \u0431\u043e\u0442\u0430 \u044e\u0437\u0435\u0440\u043e\u043c  \u0432 \u041b\u0421, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u043e\u0442\u0430 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u043b\u0438 \u043a\u0430\u043d\u0430\u043b, \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043e\u0442\u0442\u0443\u0434\u0430, \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0440\u0430\u0432 \u0431\u043e\u0442\u0430 \u0438 \u0435\u0433\u043e \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0447\u0430\u0442\u0430\u0445 \u0438 \u0442.\u0434.</li> <li><code>chat_member</code>. \u0421\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0432\u0441\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u0438 \u043a\u0430\u043d\u0430\u043b\u0430\u0445, \u0433\u0434\u0435 \u0431\u043e\u0442 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435  \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430: \u043f\u0440\u0438\u0445\u043e\u0434/\u0443\u0445\u043e\u0434 \u044e\u0437\u0435\u0440\u043e\u0432 \u0432 \u0433\u0440\u0443\u043f\u043f\u044b, \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438/\u043e\u0442\u043f\u0438\u0441\u043a\u0438 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445, \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0440\u0430\u0432 \u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u043e\u0432 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439,  \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435/\u0441\u043d\u044f\u0442\u0438\u0435 \u0430\u0434\u043c\u0438\u043d\u043e\u0432 \u0438 \u043c\u043d\u043e\u0433\u043e\u0435 \u0434\u0440\u0443\u0433\u043e\u0435.</li> </ul> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e Telegram \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 \u0431\u043e\u0442\u0430\u043c \u0430\u043f\u0434\u0435\u0439\u0442\u044b <code>chat_member</code>, \u0438\u0445 \u043f\u0440\u0438\u0451\u043c \u043d\u0430\u0434\u043e \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e. \u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \u2014  \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435</p> <p>\u0412 \u0434\u0430\u043d\u043d\u043e\u0439 \u0433\u043b\u0430\u0432\u0435 \u043c\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u043c \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u044d\u0442\u0438 \u0430\u043f\u0434\u0435\u0439\u0442\u044b \u043d\u0430 \u043d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u0447\u0430\u0441\u0442\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0445 \u0437\u0430\u0434\u0430\u0447\u0430\u0445, \u043e\u0434\u043d\u0430\u043a\u043e \u043f\u0435\u0440\u0435\u0434 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u043e\u043c  \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0430\u043c \u043d\u0430\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u044e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441  \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435\u0439  \u0438\u0437 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 aiogram 3.x.</p>"},{"location":"special-updates/#chatmemberupdated","title":"\u041e\u0431\u044a\u0435\u043a\u0442 ChatMemberUpdated","text":"<p>\u0421\u0430\u043c \u043f\u043e \u0441\u0435\u0431\u0435 \u043e\u0431\u044a\u0435\u043a\u0442 ChatMemberUpdated \u0437\u0430\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u0435\u0442 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0433\u043e  \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u044f. \u0427\u0442\u043e\u0431\u044b \u0438\u0437\u0443\u0447\u0438\u0442\u044c \u0435\u0433\u043e \u043f\u043e\u0431\u043b\u0438\u0436\u0435, \u043f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c, \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0410\u043b\u0438\u0441\u0430 \u0437\u0430\u0431\u0430\u043d\u0438\u043b\u0430  \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430 \u0412\u0438\u0442\u044e. \u0421 \u043f\u043e\u043b\u044f\u043c\u0438 <code>chat</code> \u0438 <code>date</code> \u0432\u0441\u0451 \u043e\u0447\u0435\u0432\u0438\u0434\u043d\u043e, \u0438\u0445 \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u043c.</p> <p>\u041f\u043e\u043b\u0435 <code>from</code> (\u0432 \u0432\u0430\u0448\u0435\u043c Python-\u043a\u043e\u0434\u0435 \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 <code>from_user</code>) \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0441\u0443\u0431\u044a\u0435\u043a\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f. \u0412 \u043d\u0430\u0448\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0441\u0443\u0431\u044a\u0435\u043a\u0442  \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u2014 \u044d\u0442\u043e \u0410\u043b\u0438\u0441\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u043e <code>from</code> (<code>from_user</code>) \u0431\u0443\u0434\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 User \u0441  \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043e\u0431 \u0410\u043b\u0438\u0441\u0435.</p> <p><code>old_chat_member</code> \u0438 <code>new_chat_member</code>. \u041f\u043e\u0434 \u044d\u0442\u0438\u043c\u0438 \u043f\u043e\u043b\u044f\u043c\u0438 \u0441\u043a\u0440\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u00ab\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u00bb  \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0414\u041e \u0438 \u041f\u041e\u0421\u041b\u0415 \u0441\u043e\u0431\u044b\u0442\u0438\u044f. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0432 <code>old_chat_member</code> \u0431\u0443\u0434\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u0442\u0438\u043f\u043e\u043c  ChatMemberMember (\u044d\u0442\u043e \u043d\u0435 \u043e\u043f\u0435\u0447\u0430\u0442\u043a\u0430), \u0438 \u043f\u043e\u043b\u0435\u043c <code>user</code> \u0441 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439  \u043e \u0412\u0438\u0442\u0435, \u0430 \u0432 <code>new_chat_member</code> \u2014 \u043e\u0431\u044a\u0435\u043a\u0442 ChatMemberBanned \u0441 \u043f\u043e\u043b\u0435\u043c  <code>user</code> \u0432\u0441\u0451 \u043f\u0440\u043e \u0442\u043e\u0433\u043e \u0436\u0435 \u043d\u0435\u0441\u0447\u0430\u0441\u0442\u043d\u043e\u0433\u043e \u0412\u0438\u043a\u0442\u043e\u0440\u0430.</p> <p>\u041d\u0430\u043a\u043e\u043d\u0435\u0446, \u0435\u0441\u043b\u0438 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u043b\u0438 \u043a\u0430\u043d\u0430\u043b \u0432\u0441\u0442\u0443\u043f\u0438\u043b\u0430 \u0443\u0441\u043b\u043e\u0432\u043d\u0430\u044f \u041c\u0430\u0448\u0430, \u0442\u043e \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 ChatMemberUpdated \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u043f\u0443\u0441\u0442\u043e\u0435 \u043f\u043e\u043b\u0435  <code>invite_link</code>, \u0441 \u0442\u0438\u043f\u043e\u043c ChatInviteLink \u0438 \u0441\u0432\u0435\u0434\u0435\u043d\u0438\u044f\u043c\u0438 \u043e \u0442\u043e\u043c,  \u043f\u043e \u043a\u0430\u043a\u043e\u0439 \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u043e\u043d\u0430 \u043f\u0440\u0438\u0448\u043b\u0430. </p> <p>\u041e \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043a\u0430\u0445</p> <p>\u0417\u0434\u0435\u0441\u044c \u0441\u0442\u043e\u0438\u0442 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0432\u0430\u0436\u043d\u0443\u044e \u0440\u0435\u043c\u0430\u0440\u043a\u0443: \u043a\u0430\u0436\u0434\u044b\u0439 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440  \u0433\u0440\u0443\u043f\u043f\u044b/\u043a\u0430\u043d\u0430\u043b\u0430 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0431\u043e\u0442\u043e\u0432) \u043c\u043e\u0436\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0441 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438. \u0415\u0441\u043b\u0438 \u0431\u043e\u0442  \u00ab\u043f\u043e\u0439\u043c\u0430\u043b\u00bb \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430 \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0439 \u0438\u043c [\u0431\u043e\u0442\u043e\u043c] \u0436\u0435 \u0441\u0441\u044b\u043b\u043a\u0435, \u0442\u043e \u0432 \u043f\u043e\u043b\u0435 <code>invite_link</code> \u043e\u0431\u044a\u0435\u043a\u0442\u0430 ChatInviteLink  \u0431\u0443\u0434\u0435\u0442 \u0432\u0438\u0434\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u0446\u0435\u043b\u0438\u043a\u043e\u043c (\u0431\u0435\u0437 <code>https://t.me</code>, \u0440\u0430\u0437\u0443\u043c\u0435\u0435\u0442\u0441\u044f). \u041d\u043e \u0435\u0441\u043b\u0438 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a \u043f\u0440\u0438\u0448\u0451\u043b \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435 \u0434\u0440\u0443\u0433\u043e\u0433\u043e  \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430, \u0442\u043e \u0431\u043e\u0442 \u0443\u0432\u0438\u0434\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0432\u0443\u044e \u0447\u0430\u0441\u0442\u044c, \u0432\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 \u043c\u043d\u043e\u0433\u043e\u0442\u043e\u0447\u0438\u0435. </p> <p>\u0412\u0435\u0440\u043e\u044f\u0442\u043d\u0435\u0435 \u0432\u0441\u0435\u0433\u043e, \u044d\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u043d\u043e \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u0431\u043e\u0442\u044b \u043d\u0435 \u043c\u043e\u0433\u043b\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u043e\u043c\u0443 \u043f\u043e\u043f\u0430\u043b\u043e \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0441\u044b\u043b\u043a\u0438,  \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430\u043c\u0438 \u0447\u0430\u0442\u0430.</p> <p>\u041a\u0441\u0442\u0430\u0442\u0438, \u043f\u043e \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0441\u0442\u0440\u0430\u043d\u043d\u043e\u0439 \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c\u043d\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u0435, \u0435\u0441\u043b\u0438 \u0432\u0441\u0442\u0443\u043f\u0438\u0442\u044c \u0432 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u0443\u044e \u0433\u0440\u0443\u043f\u043f\u0443 \u043f\u043e \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435  (\u0434\u0430\u0436\u0435 \u043d\u0435 \u043f\u043e \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0443), \u0442\u043e \u0431\u043e\u0442 \u043d\u0435 \u0443\u0432\u0438\u0434\u0438\u0442 \u0441\u0441\u044b\u043b\u043a\u0443 (\u043f\u043e\u043b\u0443\u0447\u0438\u0442 <code>None</code>). \u0422\u0435\u043b\u0435\u0433\u0430 \ud83e\udd37\u200d\u2642\ufe0f</p>"},{"location":"special-updates/#my-chat-member","title":"\u0410\u043f\u0434\u0435\u0439\u0442 my_chat_member","text":""},{"location":"special-updates/#ban-unban-pm","title":"\u0411\u0430\u043d\u044b/\u0440\u0430\u0437\u0431\u0430\u043d\u044b \u0432 \u041b\u0421","text":"<p>\u0412 \u043f\u0440\u043e\u0444\u0438\u043b\u044c\u043d\u044b\u0445 \u0447\u0430\u0442\u0430\u0445 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441: \u00ab\u043a\u0430\u043a \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c \u0431\u043e\u0442\u0430,  \u0435\u0441\u043b\u0438 \u043a\u0442\u043e-\u0442\u043e \u043c\u043e\u0433 \u0435\u0433\u043e \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c?\u00bb. \u0420\u0430\u0437\u0443\u043c\u0435\u0435\u0442\u0441\u044f, \u043f\u0435\u0440\u0432\u044b\u043c \u0438 \u0433\u043b\u0430\u0432\u043d\u044b\u043c \u0441\u043e\u0432\u0435\u0442\u043e\u043c \u0431\u0443\u0434\u0435\u0442:  \u00ab\u0441\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u043d\u0430\u043b\u00bb, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043a\u0430\u043d\u0430\u043b\u044b \u2014 \u044d\u0442\u043e \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0438\u043d\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439  \u043e \u0447\u0451\u043c-\u043b\u0438\u0431\u043e.</p> <p>\u041d\u043e \u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u0441\u0451 \u0436\u0435 \u0442\u0432\u0451\u0440\u0434\u043e \u0440\u0435\u0448\u0438\u043b\u0438, \u0447\u0442\u043e \u0431\u0443\u0434\u0435\u0442\u0435 \u0434\u0435\u043b\u0430\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c \u043f\u0440\u044f\u043c\u043e \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442\u0430, \u0442\u043e \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0442\u0440\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445  \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0430\u043a\u0442\u0443\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0431\u043e\u0442\u0430:</p> <ol> <li>\u041d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \u043f\u0443\u0442\u0451\u043c \u043e\u0442\u043b\u043e\u0432\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0438 \u0432\u043d\u0435\u0441\u0435\u043d\u0438\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0432 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445  \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439.</li> <li>\u0427\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043a\u0430\u043a\u043e\u0433\u043e-\u043b\u0438\u0431\u043e ChatAction,  \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u00ab\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442\u00bb \u043f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439.</li> <li>\u041f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u043d\u0438\u0435\u043c \u0430\u043f\u0434\u0435\u0439\u0442\u0430 my_chat_member.</li> </ol> <p>\u0421\u0435\u0439\u0447\u0430\u0441 \u043d\u0430\u0441 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f.3. \u041d\u0430\u0443\u0447\u0438\u043c\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e <code>my_chat_member</code> \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0442\u044c, \u0447\u0442\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c  \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0438\u043b\u0438 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0431\u043e\u0442\u0430. \u041d\u043e \u043f\u0440\u0435\u0436\u0434\u0435, \u0447\u0435\u043c \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u043c \u00ab\u043c\u0430\u0433\u0438\u044e\u00bb aiogram, \u0440\u0430\u0437\u0431\u0435\u0440\u0451\u043c\u0441\u044f, \u043a\u0430\u043a \u0443\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0435 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438  \u0432\u044b\u0433\u043b\u044f\u0434\u044f\u0442 \u0432 \u0441\u0430\u043c\u043e\u043c Bot API. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0441 \u0431\u043e\u0442\u043e\u043c, \u043e\u0442\u043a\u0440\u043e\u0435\u043c \u0434\u0438\u0430\u043b\u043e\u0433 \u0441 \u043d\u0438\u043c \u0432 Telegram \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e  \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u043c \u0438 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043e\u043f\u0446\u0438\u0438 \u0432 UI \u043c\u0435\u0441\u0441\u0435\u043d\u0434\u0436\u0435\u0440\u0430. \u0414\u0430\u043b\u0435\u0435 \u043e\u0442\u043a\u0440\u043e\u0435\u043c \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0438\u043b\u0438 \u043a\u0430\u043a\u043e\u0439-\u043d\u0438\u0431\u0443\u0434\u044c  Insomnia/Postman \u0438 \u043f\u0435\u0440\u0435\u0439\u0434\u0451\u043c \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435 <code>https://api.telegram.org/bot&lt;TOKEN&gt;/getupdates</code>, \u0447\u0442\u043e\u0431\u044b \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0435\u0449\u0451 \u043d\u0435  \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON.</p> <p>\u0418\u0442\u0430\u043a, \u0432\u043e\u0442 \u0447\u0442\u043e \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u0431\u043e\u0442\u0443, \u043a\u043e\u0433\u0434\u0430 \u043a\u0442\u043e-\u0442\u043e \u0435\u0433\u043e \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442:</p> <p></p> <p>\u041d\u0430 \u0447\u0442\u043e \u043d\u0430\u0434\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435:</p> <ul> <li>\u0421\u043e\u0431\u044b\u0442\u0438\u0435 <code>my_chat_member</code> \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u0432 \u041b\u0421 \u0441 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c Groosha (chat_id \u0440\u0430\u0432\u0435\u043d \u043c\u043e\u0435\u043c\u0443 Telegram ID).</li> <li>\u0418\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440 (\u0441\u0443\u0431\u044a\u0435\u043a\u0442) \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2014 \u0442\u043e\u0436\u0435 Groosha.</li> <li>\u0412 \u043f\u043e\u043b\u0435 <code>old_chat_member</code> \u0432\u0438\u0434\u043d\u043e, \u043d\u0430\u0434 \u043a\u0435\u043c \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 (\u043d\u0430\u0434 \u0431\u043e\u0442\u043e\u043c) \u0438 \u043a\u0430\u043a\u043e\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \u0431\u043e\u0442\u0430 \u0432 \u041b\u0421 \u0431\u044b\u043b \u0414\u041e: \"member\",  \u0442.\u0435. \u0431\u043e\u0442 \u041d\u0415 \u0431\u044b\u043b \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d \u0440\u0430\u043d\u0435\u0435.</li> <li>\u0412 \u043f\u043e\u043b\u0435 <code>new_chat_member</code> \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 <code>user</code> \u0442\u043e \u0436\u0435 \u0441\u0430\u043c\u043e\u0435, \u0430 \u0432\u043e\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 \u0443\u0436\u0435 \"kicked\", \u0442.\u0435. \u041f\u041e\u0421\u041b\u0415 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0431\u043e\u0442 \u0431\u044b\u043b  \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c.</li> </ul> <p>\u0422\u043e \u0435\u0441\u0442\u044c, \u0431\u043e\u0442 \u0432 \u041b\u0421 \u0441 Groosha \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u043b \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0441\u0432\u043e\u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438\u0437 \"member\" \u0432 \"kicked\". \u0422\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c, \u0447\u0442\u043e \u043f\u0440\u0438\u0448\u043b\u043e \u043e\u0442  Telegram \u043f\u043e\u0441\u043b\u0435 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438:</p> <p></p> <p>\u042d\u0442\u043e\u0442 \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442 \u043f\u043e\u0445\u043e\u0436 \u043d\u0430 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439, \u043d\u043e \u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c\u0441\u044f, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u043c\u0435\u0442\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u0438\u0446\u0443: \u0434\u0440\u0443\u0433\u043e\u0439 <code>update_id</code>  (\u0443\u0432\u0435\u043b\u0438\u0447\u0438\u043b\u0441\u044f \u043d\u0430 \u0435\u0434\u0438\u043d\u0438\u0446\u0443), \u0430 \u0442\u0430\u043a\u0436\u0435 \u0441\u0442\u0430\u0442\u0443\u0441\u044b \u0414\u041e \u0438 \u041f\u041e\u0421\u041b\u0415 \u043f\u043e\u043c\u0435\u043d\u044f\u043b\u0438\u0441\u044c \u043c\u0435\u0441\u0442\u0430\u043c\u0438. \u0411\u043e\u0442 \u0432 \u041b\u0421 \u0441 Groosha \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u043b \u043f\u0435\u0440\u0435\u0445\u043e\u0434  \u0438\u0437 \"kicked\" \u0432 \"member\". \u041a\u0440\u043e\u043c\u0435 \u0442\u043e\u0433\u043e, \u043e\u0431\u044b\u0447\u043d\u043e \u0440\u044f\u0434\u043e\u043c \u0431\u0443\u0434\u0435\u0442 \u0435\u0449\u0451 \u043e\u0434\u0438\u043d \u0430\u043f\u0434\u0435\u0439\u0442 \u0443\u0436\u0435 \u0441 \u0442\u0438\u043f\u043e\u043c <code>message</code> \u0438 \u0441 \u043a\u043e\u043c\u0430\u043d\u0434\u043e\u0439 <code>/start</code>  \u0432 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c. \u041e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u044b \u043f\u0440\u0438 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u0431\u043e\u0442\u0430 \u0441\u0440\u0430\u0437\u0443 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/start</code>, \u043d\u043e \u043d\u0435 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u044d\u0442\u043e  \u043f\u043e\u043b\u0430\u0433\u0430\u0442\u044c\u0441\u044f: \u043f\u043e\u0434\u043e\u0431\u043d\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043e\u0441\u0442\u0430\u044e\u0442\u0441\u044f \u043d\u0430 \u043e\u0442\u043a\u0443\u043f \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0432\u0435\u0441\u0442\u0438 \u0441\u0435\u0431\u044f \u043f\u043e-\u0440\u0430\u0437\u043d\u043e\u043c\u0443.</p> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u0443\u0447\u0438\u043c\u0441\u044f \u0440\u0435\u0430\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u0430 \u0442\u0430\u043a\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0447\u0435\u0440\u0435\u0437 aiogram \u043d\u0430 \u043f\u0440\u043e\u0441\u0442\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435: \u043f\u0443\u0441\u0442\u044c \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437 \u0434\u0432\u0443\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445  \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0431\u043e\u0442\u0430 \u0441 \u0430\u0439\u0434\u0438 111 \u0438 222. \u041f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/start</code> \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u044e\u0437\u0435\u0440\u0430 \u0432 \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438, \u0430 \u043f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 <code>/users</code> \u0431\u0443\u0434\u0435\u043c  \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u0430\u0439\u0434\u0438 \u0442\u0435\u0445, \u043a\u0442\u043e \u043d\u0435 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0431\u043e\u0442\u0430 (\u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043f\u0440\u0438 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u0431\u043e\u0442\u0430 \u0431\u0443\u0434\u0435\u043c \u0443\u0431\u0438\u0440\u0430\u0442\u044c \u0430\u0439\u0434\u0438 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430, \u0430  \u043f\u0440\u0438 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u0441\u043d\u043e\u0432\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u043c).</p> <p>\u0412\u043e\u0442 \u0433\u043e\u0442\u043e\u0432\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440 \u043f\u043e\u0434 \u0432\u044b\u0448\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f:</p> handlers/in_pm.py<pre><code>from aiogram import F, Router\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, MEMBER, KICKED\nfrom aiogram.filters.command import \\\n    CommandStart, Command\nfrom aiogram.types import ChatMemberUpdated, Message\n\nrouter = Router()\nrouter.my_chat_member.filter(F.chat.type == \"private\")\nrouter.message.filter(F.chat.type == \"private\")\n\n# \u0418\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430!\n# \u0412 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0436\u0438\u0437\u043d\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u043e\u043b\u0435\u0435 \u043d\u0430\u0434\u0451\u0436\u043d\u044b\u0435\n# \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0430\u0439\u0434\u0438 \u044e\u0437\u0435\u0440\u043e\u0432\nusers = {111, 222}\n\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(member_status_changed=KICKED)\n)\nasync def user_blocked_bot(event: ChatMemberUpdated):\n    users.discard(event.from_user.id)\n\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(member_status_changed=MEMBER)\n)\nasync def user_unblocked_bot(event: ChatMemberUpdated):\n    users.add(event.from_user.id)\n\n\n@router.message(CommandStart())\nasync def cmd_start(message: Message):\n    await message.answer(\"Hello\")\n    users.add(message.from_user.id)\n\n\n@router.message(Command(\"users\"))\nasync def cmd_users(message: Message):\n    await message.answer(\"\\n\".join(f\"\u2022 {user_id}\" for user_id in users))\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435: \u0434\u043b\u044f \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u0432 \u043d\u0430 \u0430\u043f\u0434\u0435\u0439\u0442 <code>my_chat_member</code> \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0444\u0438\u043b\u044c\u0442\u0440 <code>ChatMemberUpdatedFilter</code> \u0441  \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043e\u0442\u043b\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u041f\u041e\u0421\u041b\u0415 (\u0442.\u0435. \u0430\u0442\u0440\u0438\u0431\u0443\u0442 <code>new_chat_member</code> \u0443 \u0430\u043f\u0434\u0435\u0439\u0442\u0430). \u0422.\u0435. \u0432 \u0434\u0430\u043d\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043d\u0430\u0441  \u043d\u0435 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u0435\u0442, \u0432 \u043a\u0430\u043a\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 \u0431\u044b\u043b \u044e\u0437\u0435\u0440 \u0414\u041e.</p> <p>\u0418 \u0432\u043e\u0442 \u043a\u0430\u043a \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435:</p> <p></p>"},{"location":"special-updates/#bot-added-to-group","title":"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443","text":"<p>\u0415\u0449\u0451 \u0447\u0430\u0441\u0442\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043e\u0442 \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0449\u0438\u0445 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u0432: \u00ab\u043a\u0430\u043a \u043f\u043e\u0439\u043c\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u043e\u0442\u0430 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443?\u00bb. \u0427\u0442\u043e \u0436,  \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0442\u044c\u0441\u044f. \u041d\u043e \u043f\u0435\u0440\u0435\u0434 \u044d\u0442\u0438\u043c \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c, \u043a\u0430\u043a\u0438\u0435 \u0432\u043e\u043e\u0431\u0449\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c  \u00ab\u0441\u0442\u0430\u0442\u0443\u0441\u044b\u00bb \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f:</p> <ul> <li>creator (\u043e\u043d \u0436\u0435 owner) \u2014 \u0432\u043b\u0430\u0434\u0435\u043b\u0435\u0446 \u0447\u0430\u0442\u0430. \u0421\u0443\u0434\u044f \u043f\u043e \u0432\u0441\u0435\u043c\u0443, \u0431\u043e\u0442 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0438\u043c\u0435\u0442\u044c \u0442\u0430\u043a\u043e\u0439 \u0441\u0442\u0430\u0442\u0443\u0441. \u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446 \u0431\u0435\u0437\u0430\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u043d\u043e \u0438\u043c\u0435\u0435\u0442  \u0432\u0441\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0430 \u0432 \u0447\u0430\u0442\u0435, \u043a\u0440\u043e\u043c\u0435 \u00ab\u0430\u043d\u043e\u043d\u0438\u043c\u043d\u043e\u0441\u0442\u0438\u00bb, \u043e\u043d\u0430 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u0442\u0443\u0434\u0430-\u0441\u044e\u0434\u0430 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e.</li> <li>administrator \u2014 \u043b\u044e\u0431\u043e\u0439 \u0434\u0440\u0443\u0433\u043e\u0439 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440. \u0412 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \u043c\u043e\u0436\u043d\u043e \u0443\u0431\u0440\u0430\u0442\u044c \u0435\u043c\u0443 \u0432\u043e\u043e\u0431\u0449\u0435 \u0432\u0441\u0435 \u043f\u0440\u0430\u0432\u0430,  \u043d\u043e \u043e\u043d \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043e\u0441\u0442\u0430\u043d\u0435\u0442\u0441\u044f \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u043c \u0438 \u0441\u043c\u043e\u0436\u0435\u0442, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0447\u0438\u0442\u0430\u0442\u044c Recent Actions \u0438 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c slow mode.</li> <li>member \u2014 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a \u0447\u0430\u0442\u0430 \u0441 \u043f\u0440\u0430\u0432\u0430\u043c\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e. \u0423\u0437\u043d\u0430\u0442\u044c \u044d\u0442\u0438 \u00ab\u043f\u0440\u0430\u0432\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\u00bb \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 \u0433\u0440\u0443\u043f\u043f\u0430\u043c\u0438 \u043c\u043e\u0436\u043d\u043e, \u0432\u044b\u0437\u0432\u0430\u0432  API-\u043c\u0435\u0442\u043e\u0434 getChat \u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0432 \u043f\u043e\u043b\u0435 <code>permissions</code>.</li> <li>restricted \u2014 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c, \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u044b\u0439 \u0432 \u043a\u0430\u043a\u0438\u0445-\u0442\u043e \u043f\u0440\u0430\u0432\u0430\u0445. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u0439\u0441\u044f \u0432 \u0442.\u043d. \"read-only\".  \u0412\u0410\u0416\u041d\u041e: \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 <code>restricted</code> \u044e\u0437\u0435\u0440 \u043c\u043e\u0436\u0435\u0442 \u043a\u0430\u043a \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435, \u0442\u0430\u043a \u0438 \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f, \u043f\u043e\u044d\u0442\u043e\u043c\u0443  \u0443 ChatMemberRestricted \u043d\u0430\u0434\u043e \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0444\u043b\u0430\u0433 <code>is_member</code>.</li> <li>left \u2014 \u00ab\u043e\u043d \u0443\u043b\u0435\u0442\u0435\u043b, \u043d\u043e \u043e\u0431\u0435\u0449\u0430\u043b \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f\u00bb, \u0442.\u0435. \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0448\u0435\u043b \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b,  \u043d\u043e \u043f\u0440\u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u0438 \u043c\u043e\u0436\u0435\u0442 \u0441\u043d\u043e\u0432\u0430 \u0437\u0430\u0439\u0442\u0438. \u0418 \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b\u0445\u043e\u0434\u0430 \u043e\u043d \u043d\u0435 \u0431\u044b\u043b \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 <code>restricted</code>.</li> <li>banned \u2014 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u0430\u043d\u0435\u043d \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e, \u043f\u043e\u043a\u0430 \u0435\u0433\u043e  \u043d\u0435 \u0440\u0430\u0437\u0431\u0430\u043d\u044f\u0442.</li> </ul> <p>\u0418\u043c\u0435\u044f \u043f\u043e\u0434 \u0440\u0443\u043a\u043e\u0439 \u0432\u044b\u0448\u0435\u0438\u0437\u043b\u043e\u0436\u0435\u043d\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e, \u043d\u0435\u0442\u0440\u0443\u0434\u043d\u043e \u0434\u043e\u0433\u0430\u0434\u0430\u0442\u044c\u0441\u044f, \u0447\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u00ab\u0431\u043e\u0442\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443\u00bb \u2014 \u044d\u0442\u043e \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0438\u0437  \u043d\u0430\u0431\u043e\u0440\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 <code>{banned, left, restricted(is_member=False)}</code>  \u0432 \u043d\u0430\u0431\u043e\u0440 <code>{restricted(is_member=True), member, administrator}</code>. \u0422\u0430\u043a\u043e\u0439 \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043f\u043e-\u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u0438 \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f transition, \u0438  \u0432 aiogram 3.x \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0437\u0430\u0433\u043e\u0442\u043e\u0432\u043a\u0438. </p> <p>\u0412\u0430\u0440\u0438\u0430\u043d\u0442 \u21161: \u0442\u0443\u043f\u043e \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0438\u043c \u0432\u0441\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0414\u041e \u0438 \u041f\u041e\u0421\u041b\u0415:</p> <pre><code># \u041d\u0435 \u0437\u0430\u0431\u044b\u0432\u0430\u0435\u043c \u0438\u043c\u043f\u043e\u0440\u0442\u044b:\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, KICKED, LEFT, MEMBER, \\\n    RESTRICTED, ADMINISTRATOR, CREATOR\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=\n        (KICKED | LEFT | -RESTRICTED)\n        &gt;&gt;\n        (+RESTRICTED | MEMBER | ADMINISTRATOR | CREATOR)\n    )\n)\n</code></pre> <p>\u0412\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u0430\u044f \u0447\u0435\u0440\u0442\u0430 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \"\u0438\u043b\u0438\", \u0431\u0438\u0442\u043e\u0432\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \"&gt;&gt;\" \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430,  \u0430 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u00ab\u043f\u043b\u044e\u0441\u00bb \u0438 \u00ab\u043c\u0438\u043d\u0443\u0441\u00bb \u043e\u043a\u043e\u043b\u043e RESTRICTED \u043e\u0442\u043d\u043e\u0441\u044f\u0442\u0441\u044f \u043a \u0444\u043b\u0430\u0433\u0443 <code>is_member</code> (\u043f\u043b\u044e\u0441 - True, \u043c\u0438\u043d\u0443\u0441 - False).</p> <p>\u041d\u043e \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a aiogram \u043f\u043e\u0448\u0451\u043b \u0434\u0430\u043b\u044c\u0448\u0435 \u0438 \u043e\u0431\u0435\u0440\u043d\u0443\u043b \u044d\u0442\u0438 \u0434\u0432\u0430 \u043d\u0430\u0431\u043e\u0440\u0430 \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f <code>IS_NOT_MEMBER</code> \u0438 <code>IS_MEMBER</code>  \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e. \u0423\u043f\u0440\u043e\u0441\u0442\u0438\u043c \u043d\u0430\u0448 \u043a\u043e\u0434 \u0432 \u0432\u0438\u0434\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u21162:</p> <pre><code># \u041d\u0435\u043c\u043d\u043e\u0433\u043e \u0434\u0440\u0443\u0433\u0438\u0435 \u0438\u043c\u043f\u043e\u0440\u0442\u044b\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, IS_NOT_MEMBER, IS_MEMBER\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=\n        IS_NOT_MEMBER &gt;&gt; IS_MEMBER\n    )\n)\n</code></pre> <p>\u041d\u043e \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443, \u043f\u043e\u0432\u0442\u043e\u0440\u044e\u0441\u044c, \u0442\u0430\u043a\u043e\u0439 \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0434\u043e\u0432\u043e\u043b\u044c\u043d\u043e \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0431\u043e\u0442\u0430\u0445, \u0442\u043e \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043f\u043e\u0448\u0451\u043b \u0435\u0449\u0451 \u0434\u0430\u043b\u044c\u0448\u0435 \u0438  \u043e\u0431\u0435\u0440\u043d\u0443\u043b \u0442\u0430\u043a\u043e\u0439 \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0432 \u0432\u0438\u0434\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 <code>JOIN_TRANSITION</code>, \u043f\u043e\u043b\u0443\u0447\u0438\u0432 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u21163:</p> <pre><code># \u0418 \u0435\u0449\u0451 \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043c\u043f\u043e\u0440\u0442\u043e\u0432\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, JOIN_TRANSITION\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=JOIN_TRANSITION\n    )\n)\n</code></pre> <p>\u041d\u0430\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u044e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043d\u0430\u0431\u043e\u0440\u0430\u043c\u0438 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0438 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u043e\u0432  \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438, \u0447\u0442\u043e\u0431\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c  \u0441\u0432\u043e\u0439 \u043a\u043e\u0434 \u0447\u0438\u0449\u0435.</p> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u0435\u0449\u0451 \u043e\u0434\u0438\u043d \u0440\u043e\u0443\u0442\u0435\u0440, \u043f\u043e\u0434 \u043a\u043e\u0442\u043e\u0440\u044b\u043c \u0431\u0443\u0434\u0443\u0442 \u0434\u0432\u0430 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0430, \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u044e\u0449\u0438\u0435 \u043d\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u043e\u0442\u0430  \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u043b\u0438 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443 \u0432 \u0440\u043e\u043b\u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430 \u0438 \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430.  \u041f\u0440\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u0431\u0443\u0434\u0435\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0432 \u0447\u0430\u0442 \u0441\u0432\u043e\u0434\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0442\u043e\u043c, \u043a\u0443\u0434\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0431\u043e\u0442\u0430:</p> handlers/bot_in_group.py<pre><code>from aiogram import F, Router\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, IS_NOT_MEMBER, MEMBER, ADMINISTRATOR\nfrom aiogram.types import ChatMemberUpdated\n\nrouter = Router()\nrouter.my_chat_member.filter(F.chat.type.in_({\"group\", \"supergroup\"}))\n\nchats_variants = {\n    \"group\": \"\u0433\u0440\u0443\u043f\u043f\u0443\",\n    \"supergroup\": \"\u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443\"\n}\n\n\n# \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438 \u0441\u043b\u0443\u0447\u0430\u0439 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u043e\u0442\u0430 \u043a\u0430\u043a Restricted,\n# \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u0441 \u043d\u0438\u043c \u043d\u0435 \u0431\u0443\u0434\u0435\u0442\n\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=IS_NOT_MEMBER &gt;&gt; ADMINISTRATOR\n    )\n)\nasync def bot_added_as_admin(event: ChatMemberUpdated):\n    # \u0421\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u043b\u0443\u0447\u0430\u0439: \u0431\u043e\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u043a\u0430\u043a \u0430\u0434\u043c\u0438\u043d.\n    # \u041b\u0435\u0433\u043a\u043e \u043c\u043e\u0436\u0435\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\n    await event.answer(\n        text=f\"\u041f\u0440\u0438\u0432\u0435\u0442! \u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043c\u0435\u043d\u044f \u0432 \"\n             f'{chats_variants[event.chat.type]} \"{event.chat.title}\" '\n             f\"\u043a\u0430\u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430. ID \u0447\u0430\u0442\u0430: {event.chat.id}\"\n    )\n\n\n@router.my_chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=IS_NOT_MEMBER &gt;&gt; MEMBER\n    )\n)\nasync def bot_added_as_member(event: ChatMemberUpdated, bot: Bot):\n    # \u0412\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e\u0441\u043b\u043e\u0436\u043d\u0435\u0435: \u0431\u043e\u0442\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043a\u0430\u043a \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430.\n    # \u041d\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u043e \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c.\n    chat_info = await bot.get_chat(event.chat.id)\n    if chat_info.permissions.can_send_messages:\n        await event.answer(\n            text=f\"\u041f\u0440\u0438\u0432\u0435\u0442! \u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043c\u0435\u043d\u044f \u0432 \"\n                 f'{chats_variants[event.chat.type]} \"{event.chat.title}\" '\n                 f\"\u043a\u0430\u043a \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430. ID \u0447\u0430\u0442\u0430: {event.chat.id}\"\n        )\n    else:\n        print(\"\u041a\u0430\u043a-\u043d\u0438\u0431\u0443\u0434\u044c \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u043c \u044d\u0442\u0443 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044e\")\n</code></pre> <p>\u041d\u043e, \u043a\u0430\u043a \u0438 \u0432\u0441\u0435\u0433\u0434\u0430, \u0435\u0441\u0442\u044c \u043d\u044e\u0430\u043d\u0441, \u0438 \u0447\u0442\u043e\u0431\u044b \u0435\u0433\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c, \u043d\u0430\u0434\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u043e\u0442\u0430 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443,  \u0430 \u0437\u0430\u0442\u0435\u043c \u0441\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0435\u0451 \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443. \u0414\u043b\u044f \u043d\u0430\u0433\u043b\u044f\u0434\u043d\u043e\u0441\u0442\u0438, \u044f \u0441\u043e\u0437\u0434\u0430\u043b \u0433\u0440\u0443\u043f\u043f\u0443  \u0441\u043e \u0441\u0432\u043e\u0438\u043c \u0431\u043e\u0442\u043e\u043c @my_id_bot, \u0430 \u0437\u0430\u0442\u0435\u043c \u0434\u043e\u0431\u0430\u0432\u0438\u043b \u0442\u0443\u0434\u0430 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u0431\u043e\u0442\u0430 \u0441 \u043a\u043e\u0434\u043e\u043c, \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u043c \u0432\u044b\u0448\u0435.  \u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443:</p> <p></p> <p>\u041e\u0439, \u043f\u043e\u0447\u0435\u043c\u0443-\u0442\u043e \u0431\u043e\u0442 \u043e\u0442\u0440\u0435\u0430\u0433\u0438\u0440\u043e\u0432\u0430\u043b \u0442\u0430\u043a, \u043a\u0430\u043a \u0431\u0443\u0434\u0442\u043e \u0435\u0433\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438, \u0445\u043e\u0442\u044f \u0432\u0440\u043e\u0434\u0435 \u043a\u0430\u043a \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c.  \u041d\u0430 \u0434\u0435\u043b\u0435, \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443 \u0434\u043b\u044f \u0431\u043e\u0442\u0430 \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043a\u0430\u043a \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 \u043d\u043e\u0432\u044b\u0439 \u0447\u0430\u0442. \u041a \u0441\u0447\u0430\u0441\u0442\u044c\u044e, \u0432  \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0431\u043e\u0442\u0443 \u0442\u0430\u043a\u0436\u0435 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 Message \u0441 \u043d\u0435\u043f\u0443\u0441\u0442\u044b\u043c\u0438 \u043f\u043e\u043b\u044f\u043c\u0438  <code>migrate_from_chat_id</code> \u0438 <code>migrate_to_chat_id</code>. \u0410 \u0434\u0430\u043b\u044c\u0448\u0435 \u0434\u0435\u043b\u043e \u0437\u0430 \u043c\u0430\u043b\u044b\u043c: \u043f\u0440\u0438 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u043d\u0438\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f <code>my_chat_member</code>  \u043d\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c, \u0447\u0442\u043e \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0432\u0440\u0435\u043c\u044f (\u0441\u043a\u0430\u0436\u0435\u043c, \u0437\u0430 \u043f\u0430\u0440\u0443 \u0441\u0435\u043a\u0443\u043d\u0434) \u043d\u0435 \u0431\u044b\u043b\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439  \u0441 \u043d\u0435\u043f\u0443\u0441\u0442\u044b\u043c \u043f\u043e\u043b\u0435\u043c <code>migrate_to_chat_id</code>.</p> <p>\u0420\u0435\u0448\u0435\u043d\u0438\u0435 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0435 \u0432\u044b\u0448\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u0438 \u0431\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043e \u0432 \u043c\u043e\u0451\u043c @my_id_bot:  \u0432\u043e\u0442 \u0442\u0430\u043a (\u0437\u0432\u0451\u0437\u0434\u043e\u0447\u043a\u0438 \u043d\u0430 \u0433\u0438\u0442\u0445\u0430\u0431\u0435 \u0432\u0441\u044f\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442\u0441\u044f)</p> <p>\u0413\u0440\u0443\u043f\u043f\u044b \u0438 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u044b</p> <p>\u0412\u043e\u043f\u0440\u0435\u043a\u0438 \u0447\u0430\u0441\u0442\u043e\u043c\u0443 \u0437\u0430\u0431\u043b\u0443\u0436\u0434\u0435\u043d\u0438\u044e, \u043e\u0431\u044b\u0447\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043f\u043e-\u043f\u0440\u0435\u0436\u043d\u0435\u043c\u0443 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442 \u0438 \u043d\u0438\u043a\u0443\u0434\u0430 \u0438\u0441\u0447\u0435\u0437\u0430\u0442\u044c \u043d\u0435 \u0441\u043e\u0431\u0438\u0440\u0430\u044e\u0442\u0441\u044f. \u041e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435  \u043a\u043b\u0438\u0435\u043d\u0442\u044b Telegram \u0438\u0441\u0445\u043e\u0434\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u044e\u0442 \u0438\u043c\u0435\u043d\u043d\u043e \u043e\u0431\u044b\u0447\u043d\u0443\u044e \u0433\u0440\u0443\u043f\u043f\u0443, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043d\u0435\u044f\u0432\u043d\u043e \u043f\u0440\u0438 \u043d\u0430\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0438 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f  \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443. \u0418 \u0435\u0441\u0442\u044c \u0441\u0435\u0440\u044c\u0451\u0437\u043d\u044b\u0435 \u043f\u043e\u0434\u043e\u0437\u0440\u0435\u043d\u0438\u044f, \u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0435 \u0433\u043e\u0434\u044b \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0441\u044f,  \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u0432 \u0441\u0432\u0435\u0442\u0435 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u043d\u0430 \u043e\u0431\u044b\u0447\u043d\u044b\u0435 (\u043d\u0435-\u043f\u0440\u0435\u043c\u0438\u0443\u043c) \u0443\u0447\u0451\u0442\u043a\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438\u043c\u0438\u0442 \u043d\u0430 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 500 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u0438 \u043a\u0430\u043d\u0430\u043b\u0430\u0445  \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e.</p> <p>\u041f\u0440\u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u0438, \u043f\u043e\u043c\u0438\u043c\u043e \u0441\u043c\u0435\u043d\u044b ID \u0447\u0430\u0442\u0430, \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0442\u0430\u043a\u0436\u0435 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u043e\u0431\u043e\u0447\u043d\u044b\u0435 \u044d\u0444\u0444\u0435\u043a\u0442\u044b, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0437\u0430\u0447\u0430\u0441\u0442\u0443\u044e \u043f\u0440\u043e\u0449\u0435 \u0432\u0441\u0435\u0433\u043e  \u043f\u043e\u0441\u043b\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0441\u0440\u0430\u0437\u0443 \u0435\u0451 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u043e\u0439, \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0430\u0439\u0434\u0438 \u0438 \u043d\u0435 \u043f\u0430\u0440\u0438\u0442\u044c\u0441\u044f.  \u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439, \u043f\u0440\u0438\u0432\u043e\u0434\u044f\u0449\u0438\u0439 \u043a \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0432 \u0441\u0443\u043f\u0435\u0440\u0433\u0440\u0443\u043f\u043f\u0443, \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0437\u0434\u0435\u0441\u044c:  https://t.me/tgbeta/3424.</p>"},{"location":"special-updates/#chat-member","title":"\u0410\u043f\u0434\u0435\u0439\u0442 chat_member","text":"<p>\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043e\u0441\u043e\u0431\u044b\u0439 \u0442\u0438\u043f \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432 <code>chat_member</code> \u2014 \u0445\u0438\u0442\u0440\u044b\u0439. \u0414\u0435\u043b\u043e \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043e\u043d \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c\u043e\u043c,  \u0438 \u0447\u0442\u043e\u0431\u044b Bot API \u0435\u0433\u043e \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u043b, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 getUpdates \u0438\u043b\u0438 setWebhook  \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043d\u0443\u0436\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0439. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:</p> <pre><code># \u0442\u0443\u0442 \u0438\u043c\u043f\u043e\u0440\u0442\u044b\n\nasync def main():\n    # \u0442\u0443\u0442 \u043a\u043e\u0434\n    dp = Dispatcher()\n    bot = Bot(\"\u0442\u043e\u043a\u0435\u043d\")\n    await dp.start_polling(\n        bot, \n        allowed_updates=[\"message\", \"inline_query\", \"chat_member\"]\n    )\n</code></pre> <p>\u0422\u043e\u0433\u0434\u0430 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0431\u043e\u0442\u0430 \u0442\u0435\u043b\u0435\u0433\u0430 \u043d\u0430\u0447\u043d\u0451\u0442 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0442\u044c \u0442\u0440\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0445 \u0442\u0438\u043f\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439, \u043d\u043e \u0431\u0435\u0437 \u0432\u0441\u0435\u0445 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445.</p> <p>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0438 aiogram \u043f\u043e\u0434\u043e\u0448\u043b\u0438 \u043a \u0442\u0435\u043c\u0435 \u0438\u0437\u044f\u0449\u043d\u043e: \u0435\u0441\u043b\u0438 \u044f\u0432\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c <code>allowed_updates</code>, \u0442\u043e  \u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a \u0440\u0435\u043a\u0443\u0440\u0441\u0438\u0432\u043d\u043e \u043f\u0440\u043e\u0439\u0434\u0451\u0442 \u043f\u043e \u0432\u0441\u0435\u043c \u0440\u043e\u0443\u0442\u0435\u0440\u0430\u043c, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0430, \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u0438 \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e  \u0441\u043e\u0431\u0435\u0440\u0451\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0445 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432. \u0425\u043e\u0442\u0438\u0442\u0435 \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435? \u041f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0439\u0442\u0435 <code>allowed_updates</code> \u044f\u0432\u043d\u043e.</p> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u043d\u0435 \u043d\u0435 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u0430\u043f\u0434\u0435\u0439\u0442 &lt;XXX&gt; ???</p> <p>\u0412 \u043f\u0440\u043e\u0444\u0438\u043b\u044c\u043d\u044b\u0445 \u0447\u0430\u0442\u0430\u0445 \u0440\u0435\u0433\u0443\u043b\u044f\u0440\u043d\u043e \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u044e\u0442: \u00ab\u041c\u043e\u0439 \u043a\u043e\u0434 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442, \u043d\u0435 \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u0435\u0442 \u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0435, \u043f\u043e\u0447\u0435\u043c\u0443?\u00bb</p> <p>\u041f\u0435\u0440\u0432\u043e\u0435, \u0447\u0442\u043e \u0441\u0442\u043e\u0438\u0442 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u2014 \u0443\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f, \u0447\u0442\u043e \u043d\u0443\u0436\u043d\u044b\u0439 \u0430\u043f\u0434\u0435\u0439\u0442 \u0432\u043e\u043e\u0431\u0449\u0435 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u0431\u043e\u0442\u0443. \u0418\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c,  \u0441 \u043a\u0430\u043a\u0438\u043c <code>allowed_updates</code> \u0431\u044b\u043b \u0432\u044b\u0437\u0432\u0430\u043d \u043f\u043e\u043b\u043b\u0438\u043d\u0433/\u0432\u0435\u0431\u0445\u0443\u043a\u0438 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0440\u0430\u0437. \u041f\u0440\u043e\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u044d\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043f\u0440\u044f\u043c\u043e \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435:</p> <ol> <li>\u0412\u0437\u044f\u0442\u044c \u0442\u043e\u043a\u0435\u043d \u0431\u043e\u0442\u0430, \u043d\u0430\u0437\u043e\u0432\u0451\u043c \u0435\u0433\u043e AAAAA</li> <li>\u0421\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u0432\u0438\u0434\u0430 <code>https://api.telegram.org/botAAAAA/getWebhookInfo</code></li> <li>\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043f\u043e \u043d\u0435\u0439</li> </ol> <p>\u0414\u0430\u043b\u0435\u0435 \u0432\u043d\u0438\u043c\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0437\u0443\u0447\u0438\u0442\u044c JSON \u0432 \u043e\u0442\u0432\u0435\u0442\u0435. \u0415\u0441\u043b\u0438 \u043a\u043b\u044e\u0447 <code>allowed_updates</code> \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442, \u0442\u043e \u0443\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f, \u0447\u0442\u043e \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0439  \u0442\u0438\u043f \u0430\u043f\u0434\u0435\u0439\u0442\u043e\u0432 \u0435\u0441\u0442\u044c \u0432 \u0441\u043f\u0438\u0441\u043a\u0435. \u0415\u0441\u043b\u0438 \u043a\u043b\u044e\u0447\u0430 \u043d\u0435\u0442, \u044d\u0442\u043e \u0440\u0430\u0432\u043d\u043e\u0437\u043d\u0430\u0447\u043d\u043e \u00ab\u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u0432\u0441\u0451, \u043a\u0440\u043e\u043c\u0435 <code>chat_member</code>\u00bb</p>"},{"location":"special-updates/#actualizing-admins","title":"\u0410\u043a\u0442\u0443\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0441\u043f\u0438\u0441\u043a\u0430 \u0430\u0434\u043c\u0438\u043d\u043e\u0432 \u0432 \u0433\u0440\u0443\u043f\u043f\u0430\u0445","text":"<p>\u0427\u0430\u0441\u0442\u0430\u044f \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0431\u043e\u0442\u043e\u0432-\u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432: \u043a\u0430\u043a \u043d\u0430 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u043c\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043d\u0430\u043b\u043e\u0436\u0438\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043f\u0440\u0430\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0430.  \u041a \u043f\u0440\u0438\u043c\u0435\u0440\u0443, \u043a\u0430\u043a \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0431\u0430\u043d\u0438\u0442\u044c \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u043f\u043e \u043a\u043e\u043c\u0430\u043d\u0434\u0435 /ban \u043c\u043e\u0433\u043b\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u044b \u0433\u0440\u0443\u043f\u043f\u044b. </p> <p>\u041f\u0435\u0440\u0432\u0430\u044f \u0438 \u043d\u0430\u0438\u0432\u043d\u0430\u044f \u043c\u044b\u0441\u043b\u044c \u2014 \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c getChatMember, \u0447\u0442\u043e\u0431\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u044e\u0437\u0435\u0440\u0430 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435.  \u0412\u0442\u043e\u0440\u0430\u044f \u043c\u044b\u0441\u043b\u044c \u2014 \u0437\u0430\u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u043e \u0437\u043d\u0430\u043d\u0438\u0435 \u043d\u0430 \u043a\u043e\u0440\u043e\u0442\u043a\u043e\u0435 \u0432\u0440\u0435\u043c\u044f.  \u0422\u0440\u0435\u0442\u044c\u044f \u0438 \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0438\u0434\u0435\u044f \u2014 \u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435 \u0431\u043e\u0442\u0430 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u0434\u043c\u0438\u043d\u043e\u0432,  \u0430 \u0434\u0430\u043b\u044c\u0448\u0435 \u0441\u043b\u0443\u0448\u0430\u0442\u044c \u0430\u043f\u0434\u0435\u0439\u0442\u044b chat_member \u043e\u0431 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u0438\u0445 \u0441\u043e\u0441\u0442\u0430\u0432\u0430 \u0438 \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e.  \u0411\u043e\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u043b\u0441\u044f? \u041d\u0435 \u0431\u0435\u0434\u0430, \u0441\u043d\u043e\u0432\u0430 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0438 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u0441 \u043d\u0438\u043c.</p> <p>\u041d\u0430\u043f\u0438\u0448\u0435\u043c \u0440\u043e\u0443\u0442\u0435\u0440, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0431\u0443\u0434\u0435\u043c \u0441\u043b\u0435\u0434\u0438\u0442\u044c \u0437\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c \u0441\u043e\u0441\u0442\u0430\u0432\u0430 \u0430\u0434\u043c\u0438\u043d\u043e\u0432 \u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u044b\u0439 \u0438\u0437\u0432\u043d\u0435 \u0441\u043f\u0438\u0441\u043e\u043a  (\u0442\u043e\u0447\u043d\u0435\u0435, \u0432 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u0445 python \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u043e, \u043e\u043d\u043e \u0436\u0435 Set):</p> handlers/admin_changes_in_group.py<pre><code>from aiogram import F, Router\nfrom aiogram.filters.chat_member_updated import \\\n    ChatMemberUpdatedFilter, KICKED, LEFT, \\\n    RESTRICTED, MEMBER, ADMINISTRATOR, CREATOR\nfrom aiogram.types import ChatMemberUpdated\n\nfrom config_reader import config\n\nrouter = Router()\nrouter.chat_member.filter(F.chat.id == config.main_chat_id)\n\n\n@router.chat_member(\n    ChatMemberUpdatedFilter(\n        member_status_changed=\n        (KICKED | LEFT | RESTRICTED | MEMBER)\n        &gt;&gt;\n        (ADMINISTRATOR | CREATOR)\n    )\n)\nasync def admin_promoted(event: ChatMemberUpdated, admins: set[int]):\n    admins.add(event.new_chat_member.user.id)\n    await event.answer(\n        f\"{event.new_chat_member.user.first_name} \"\n        f\"\u0431\u044b\u043b(\u0430) \u043f\u043e\u0432\u044b\u0448\u0435\u043d(\u0430) \u0434\u043e \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430!\"\n    )\n\n\n@router.chat_member(\n    ChatMemberUpdatedFilter(\n        # \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0440\u0435\u043b\u043e\u043a\n        # \u0418\u043b\u0438 \u043c\u043e\u0436\u043d\u043e \u0431\u044b\u043b\u043e \u043f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u043c\u0435\u0441\u0442\u0430\u043c\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0432 \u0441\u043a\u043e\u0431\u043a\u0430\u0445\n        member_status_changed=\n        (KICKED | LEFT | RESTRICTED | MEMBER)\n        &lt;&lt;\n        (ADMINISTRATOR | CREATOR)\n    )\n)\nasync def admin_demoted(event: ChatMemberUpdated, admins: set[int]):\n    admins.discard(event.new_chat_member.user.id)\n    await event.answer(\n        f\"{event.new_chat_member.user.first_name} \"\n        f\"\u0431\u044b\u043b(\u0430) \u043f\u043e\u043d\u0438\u0436\u0435\u043d(\u0430) \u0434\u043e \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e \u044e\u0437\u0435\u0440\u0430!\"\n    )\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u043f\u0438\u0448\u0435\u043c \u0434\u0440\u0443\u0433\u043e\u0439 \u0440\u043e\u0443\u0442\u0435\u0440 \u0441 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u043e\u043c \u043d\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/ban</code>. \u0412 \u0441\u0430\u043c\u043e\u043c \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u0435 \u0431\u0443\u0434\u0435\u043c \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0430\u0439\u0434\u0438  \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u0432\u043e \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435 <code>admins</code> \u0438 \u0438\u0441\u0445\u043e\u0434\u044f \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0430\u0442\u044c \u0438\u043b\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0430\u0442\u044c \u0431\u0430\u043d:</p> handlers/events_in_group.py<pre><code>from aiogram import Router, F\nfrom aiogram.filters.command import Command\nfrom aiogram.types import Message\n\nrouter = Router()\n\n# \u0412\u043e\u043e\u0431\u0449\u0435 \u0433\u043e\u0432\u043e\u0440\u044f, \u043c\u043e\u0436\u043d\u043e \u043d\u0430 \u0440\u043e\u0443\u0442\u0435\u0440 \u043d\u0430\u0432\u0435\u0441\u0438\u0442\u044c \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0439 \u0444\u0438\u043b\u044c\u0442\u0440\n# \u0441 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u043e\u0439, \u043b\u0435\u0436\u0438\u0442 \u043b\u0438 \u0430\u0439\u0434\u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u0432\u043e \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435 admins.\n# \u0422\u043e\u0433\u0434\u0430 \u0432\u0441\u0435 \u0445\u044d\u043d\u0434\u043b\u0435\u0440\u044b \u0432 \u0440\u043e\u0443\u0442\u0435\u0440\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f\n# \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043b\u044e\u0434\u0435\u0439 \u0438\u0437 admins, \u044d\u0442\u043e \u0441\u043e\u043a\u0440\u0430\u0442\u0438\u0442 \u043a\u043e\u0434 \u0438 \u0438\u0437\u0431\u0430\u0432\u0438\u0442 \u043e\u0442 \u043b\u0438\u0448\u043d\u0435\u0433\u043e if\n# \u041d\u043e \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u0447\u0435\u0440\u0435\u0437 if-else, \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u043e \u043d\u0430\u0433\u043b\u044f\u0434\u043d\u0435\u0435\n\n\n@router.message(Command(\"ban\"), F.reply_to_message)\nasync def cmd_ban(message: Message, admins: set[int]):\n    if message.from_user.id not in admins:\n        await message.answer(\n            \"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u0434\u043b\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u044d\u0442\u043e\u0433\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f\"\n        )\n    else:\n        await message.chat.ban(\n            user_id=message.reply_to_message.from_user.id\n        )\n        await message.answer(\"\u041d\u0430\u0440\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\")\n</code></pre> <p>\u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u043e\u0443\u0442\u0435\u0440\u044b \u0432 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u043c \u0444\u0430\u0439\u043b\u0435 \u0438 \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u0434\u043c\u0438\u043d\u043e\u0432 \u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435. \u0421\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0432\u043e\u0442 \u043f\u043e\u043b\u043d\u043e\u0435  \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435, \u0432\u043c\u0435\u0441\u0442\u0435 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u043c\u0438 \u043f\u0440\u0430\u0432\u043a\u0430\u043c\u0438.</p> bot.py<pre><code>import asyncio\nimport logging\n\nfrom aiogram import Bot, Dispatcher\nfrom aiogram.client.default import DefaultBotProperties\nfrom aiogram.enums import ParseMode\n\nfrom config_reader import config\nfrom handlers import in_pm, bot_in_group, admin_changes_in_group, events_in_group\n\n\nasync def main():\n    logging.basicConfig(\n        level=logging.INFO,\n        format=\"%(asctime)s - %(levelname)s - %(name)s - %(message)s\",\n    )\n\n    dp = Dispatcher()\n    bot = Bot(\n        config.bot_token.get_secret_value(),\n        default=DefaultBotProperties(\n            parse_mode=ParseMode.HTML\n        )\n    )\n    dp.include_routers(\n        in_pm.router, events_in_group.router,\n        bot_in_group.router, admin_changes_in_group.router\n    )\n\n    # \u041f\u043e\u0434\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043f\u0438\u0441\u043a\u0430 \u0430\u0434\u043c\u0438\u043d\u043e\u0432\n    admins = await bot.get_chat_administrators(config.main_chat_id)\n    admin_ids = {admin.user.id for admin in admins}\n\n    await dp.start_polling(bot, admins=admin_ids)\n\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c, \u0447\u0442\u043e \u0432 \u0438\u0442\u043e\u0433\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c. \u041f\u0440\u043e\u0431\u0443\u0435\u043c \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/ban</code> \u043d\u0435-\u0430\u0434\u043c\u0438\u043d\u043e\u043c:</p> <p></p> <p>\u0418\u0434\u0451\u043c \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0438 \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u0435\u043c \u0410\u0440\u0442\u0443\u0440\u0430 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u043c (\u0431\u043e\u0442 \u0443\u0432\u0438\u0434\u0438\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0438 \u0441\u043e\u043e\u0431\u0449\u0438\u0442 \u043e\u0431 \u044d\u0442\u043e\u043c \u0432 \u0447\u0430\u0442\u0435):</p> <p></p> <p>\u041e\u0442\u0437\u043e\u0432\u0451\u043c \u043f\u0440\u0430\u0432\u0430 \u0430\u0434\u043c\u0438\u043d\u0430 \u0443 \u043f\u043e\u0434\u043e\u043f\u044b\u0442\u043d\u043e\u0433\u043e \u043f\u0430\u0446\u0438\u0435\u043d\u0442\u0430 \u0438 \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u043c \u0435\u0433\u043e \u0435\u0449\u0451 \u0440\u0430\u0437 \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 <code>/ban</code>:</p> <p></p> <p>\u0422\u0435\u043f\u0435\u0440\u044c \u0432\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441 \u044d\u0442\u0438\u043c\u0438 \u00ab\u043d\u0435\u0432\u0438\u0434\u0438\u043c\u044b\u043c\u0438\u00bb \u0430\u043f\u0434\u0435\u0439\u0442\u0430\u043c\u0438, \u0443\u0440\u0430! \u041d\u0430\u043f\u043e\u0441\u043b\u0435\u0434\u043e\u043a, \u043f\u043e\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u044e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f  \u0441 \u0435\u0449\u0451 \u043e\u0434\u043d\u0438\u043c \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u043c \u0431\u043e\u0442\u043e\u043c, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c  \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u044b\u0448\u0435\u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0435 \u0444\u0438\u0448\u043a\u0438.</p>"}]}